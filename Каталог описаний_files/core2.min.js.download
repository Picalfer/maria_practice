!function(t){function e(i){if(o[i])return o[i].exports;var r=o[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var o={};e.m=t,e.c=o,e.d=function(t,o,i){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([,function(t,e){tvWebpackJsonp([0],Array(74).concat([function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.GeoSortingBy=e.GeoMapMode=e.GeoFilterMode=void 0;var o;!function(t){t[t.List=1]="List",t[t.Map=2]="Map"}(o=e.GeoFilterMode||(e.GeoFilterMode={}));var i;!function(t){t.Resort="region",t.Hotel="hotel"}(i=e.GeoMapMode||(e.GeoMapMode={}));var r;!function(t){t[t.popularity=0]="popularity",t[t.price=1]="price",t[t.name=2]="name"}(r=e.GeoSortingBy||(e.GeoSortingBy={})),t.GeoSortingBy=r,t.GeoMapMode=i,t.GeoFilterMode=o}).call(e,o(0))},,,,,function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.BaseOrderPage=void 0;var n=o(134),s=o(4),a=o(5),l=o(10),u=o(254),c=o(373),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._layoutControl.update({ShowCart:!0,ShowFavoriteHotels:!0})},e.prototype.update=function(e){t.prototype.update.call(this,e),this._Menu.update(e),this._FavoriteHotelsMenu.update(e)},e.prototype._getSideNavContent=function(){return this._Menu=new c.ResultMenuControl({ClickMenu:new s.Delegate(this,this._onClickMenu)}),this._Menu.getDomNode()},e.prototype._getFavoriteHotelsSideNavContent=function(){return this._FavoriteHotelsMenu=new u.ResultFavoriteHotelsMenuControl({ModeView:a.ModeView.Mobile,StyleTheme:l.StyleThemeEnum.THEME2,Title:"Избранные отели",MenuClicked:new s.Delegate(this,this._onClickFavoriteHotelsMenu)}),this._FavoriteHotelsMenu.getDomNode()},e.prototype._onSideNavShow=function(){this._FavoriteHotelsMenu&&this._FavoriteHotelsMenu.update({ForceUpdate:!0})},e.prototype._onClickMenu=function(){this._layoutControl.update({SideNavSettings:r(r({},this._getSideNavSettings()),{Visible:!1})})},e.prototype._onClickFavoriteHotelsMenu=function(){this._layoutControl.update({FavoriteHotelsSideNavSettings:r(r({},this._getFavoriteHotelsSideNavSettings()),{Visible:!1})})},e}(n.LayoutPage);e.BaseOrderPage=h,t.BaseOrderPage=h}).call(e,o(0))},function(t,e,o){/* @preserve
 * Leaflet 1.7.1, a JS library for interactive maps. http://leafletjs.com
 * (c) 2010-2019 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */
!function(t,o){o(e)}(0,function(t){"use strict";function e(t){var e,o,i,r;for(o=1,i=arguments.length;o<i;o++){r=arguments[o];for(e in r)t[e]=r[e]}return t}function o(t,e){var o=Array.prototype.slice;if(t.bind)return t.bind.apply(t,o.call(arguments,1));var i=o.call(arguments,2);return function(){return t.apply(e,i.length?i.concat(o.call(arguments)):arguments)}}function i(t){return t._leaflet_id=t._leaflet_id||++ye,t._leaflet_id}function r(t,e,o){var i,r,n,s;return s=function(){i=!1,r&&(n.apply(o,r),r=!1)},n=function(){i?r=arguments:(t.apply(o,arguments),setTimeout(s,e),i=!0)}}function n(t,e,o){var i=e[1],r=e[0],n=i-r;return t===i&&o?t:((t-r)%n+n)%n+r}function s(){return!1}function a(t,e){var o=Math.pow(10,void 0===e?6:e);return Math.round(t*o)/o}function l(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function u(t){return l(t).split(/\s+/)}function c(t,e){Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?fe(t.options):{});for(var o in e)t.options[o]=e[o];return t.options}function h(t,e,o){var i=[];for(var r in t)i.push(encodeURIComponent(o?r.toUpperCase():r)+"="+encodeURIComponent(t[r]));return(e&&-1!==e.indexOf("?")?"&":"?")+i.join("&")}function d(t,e){return t.replace(ge,function(t,o){var i=e[o];if(void 0===i)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(e)),i})}function p(t,e){for(var o=0;o<t.length;o++)if(t[o]===e)return o;return-1}function _(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}function f(t){var e=+new Date,o=Math.max(0,16-(e-me));return me=e+o,window.setTimeout(t,o)}function y(t,e,i){if(!i||Te!==f)return Te.call(window,o(t,e));t.call(e)}function g(t){t&&we.call(window,t)}function C(){}function v(t){if("undefined"!=typeof L&&L&&L.Mixin){t=Ce(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}function m(t,e,o){this.x=o?Math.round(t):t,this.y=o?Math.round(e):e}function T(t,e,o){return t instanceof m?t:Ce(t)?new m(t[0],t[1]):void 0===t||null===t?t:"object"==typeof t&&"x"in t&&"y"in t?new m(t.x,t.y):new m(t,e,o)}function w(t,e){if(t)for(var o=e?[t,e]:t,i=0,r=o.length;i<r;i++)this.extend(o[i])}function S(t,e){return!t||t instanceof w?t:new w(t,e)}function P(t,e){if(t)for(var o=e?[t,e]:t,i=0,r=o.length;i<r;i++)this.extend(o[i])}function b(t,e){return t instanceof P?t:new P(t,e)}function I(t,e,o){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==o&&(this.alt=+o)}function O(t,e,o){return t instanceof I?t:Ce(t)&&"object"!=typeof t[0]?3===t.length?new I(t[0],t[1],t[2]):2===t.length?new I(t[0],t[1]):null:void 0===t||null===t?t:"object"==typeof t&&"lat"in t?new I(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===e?null:new I(t,e,o)}function M(t,e,o,i){if(Ce(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=o,this._d=i}function D(t,e,o,i){return new M(t,e,o,i)}function E(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function k(t,e){var o,i,r,n,s,a,l="";for(o=0,r=t.length;o<r;o++){for(s=t[o],i=0,n=s.length;i<n;i++)a=s[i],l+=(i?"L":"M")+a.x+" "+a.y;l+=e?po?"z":"x":""}return l||"M0 0"}function R(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}function A(t,e,o,i){return"touchstart"===e?N(t,o,i):"touchmove"===e?U(t,o,i):"touchend"===e&&j(t,o,i),this}function V(t,e,o){var i=t["_leaflet_"+e+o];return"touchstart"===e?t.removeEventListener(yo,i,!1):"touchmove"===e?t.removeEventListener(go,i,!1):"touchend"===e&&(t.removeEventListener(Co,i,!1),t.removeEventListener(vo,i,!1)),this}function N(t,e,i){var r=o(function(t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&St(t),F(t,e)});t["_leaflet_touchstart"+i]=r,t.addEventListener(yo,r,!1),To||(document.addEventListener(yo,B,!0),document.addEventListener(go,H,!0),document.addEventListener(Co,x,!0),document.addEventListener(vo,x,!0),To=!0)}function B(t){mo[t.pointerId]=t}function H(t){mo[t.pointerId]&&(mo[t.pointerId]=t)}function x(t){delete mo[t.pointerId]}function F(t,e){t.touches=[];for(var o in mo)t.touches.push(mo[o]);t.changedTouches=[t],e(t)}function U(t,e,o){var i=function(t){t.pointerType===(t.MSPOINTER_TYPE_MOUSE||"mouse")&&0===t.buttons||F(t,e)};t["_leaflet_touchmove"+o]=i,t.addEventListener(go,i,!1)}function j(t,e,o){var i=function(t){F(t,e)};t["_leaflet_touchend"+o]=i,t.addEventListener(Co,i,!1),t.addEventListener(vo,i,!1)}function G(t,e,o){function i(t){if(no){if(!t.isPrimary)return;if("mouse"===t.pointerType)return}else if(t.touches.length>1)return;var e=Date.now(),o=e-(n||e);s=t.touches?t.touches[0]:t,a=o>0&&o<=l,n=e}function r(t){if(a&&!s.cancelBubble){if(no){if("mouse"===t.pointerType)return;var o,i,r={};for(i in s)o=s[i],r[i]=o&&o.bind?o.bind(s):o;s=r}s.type="dblclick",s.button=0,e(s),n=null}}var n,s,a=!1,l=250;return t[Po+wo+o]=i,t[Po+So+o]=r,t[Po+"dblclick"+o]=e,t.addEventListener(wo,i,!!co&&{passive:!1}),t.addEventListener(So,r,!!co&&{passive:!1}),t.addEventListener("dblclick",e,!1),this}function W(t,e){var o=t[Po+wo+e],i=t[Po+So+e],r=t[Po+"dblclick"+e];return t.removeEventListener(wo,o,!!co&&{passive:!1}),t.removeEventListener(So,i,!!co&&{passive:!1}),t.removeEventListener("dblclick",r,!1),this}function z(t){return"string"==typeof t?document.getElementById(t):t}function q(t,e){var o=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!o||"auto"===o)&&document.defaultView){var i=document.defaultView.getComputedStyle(t,null);o=i?i[e]:null}return"auto"===o?null:o}function Z(t,e,o){var i=document.createElement(t);return i.className=e||"",o&&o.appendChild(i),i}function Y(t){var e=t.parentNode;e&&e.removeChild(t)}function K(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function X(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function Q(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function J(t,e){if(void 0!==t.classList)return t.classList.contains(e);var o=ot(t);return o.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(o)}function $(t,e){if(void 0!==t.classList)for(var o=u(e),i=0,r=o.length;i<r;i++)t.classList.add(o[i]);else if(!J(t,e)){var n=ot(t);et(t,(n?n+" ":"")+e)}}function tt(t,e){void 0!==t.classList?t.classList.remove(e):et(t,l((" "+ot(t)+" ").replace(" "+e+" "," ")))}function et(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function ot(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function it(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&rt(t,e)}function rt(t,e){var o=!1,i="DXImageTransform.Microsoft.Alpha";try{o=t.filters.item(i)}catch(t){if(1===e)return}e=Math.round(100*e),o?(o.Enabled=100!==e,o.Opacity=e):t.style.filter+=" progid:"+i+"(opacity="+e+")"}function nt(t){for(var e=document.documentElement.style,o=0;o<t.length;o++)if(t[o]in e)return t[o];return!1}function st(t,e,o){var i=e||new m(0,0);t.style[bo]=(Qe?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(o?" scale("+o+")":"")}function at(t,e){t._leaflet_pos=e,to?st(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function lt(t){return t._leaflet_pos||new m(0,0)}function ut(){ft(window,"dragstart",St)}function ct(){yt(window,"dragstart",St)}function ht(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(dt(),Do=t,Eo=t.style.outline,t.style.outline="none",ft(window,"keydown",dt))}function dt(){Do&&(Do.style.outline=Eo,Do=void 0,Eo=void 0,yt(window,"keydown",dt))}function pt(t){do{t=t.parentNode}while(!(t.offsetWidth&&t.offsetHeight||t===document.body));return t}function _t(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}function ft(t,e,o,i){if("object"==typeof e)for(var r in e)Ct(t,r,e[r],o);else{e=u(e);for(var n=0,s=e.length;n<s;n++)Ct(t,e[n],o,i)}return this}function yt(t,e,o,i){if("object"==typeof e)for(var r in e)vt(t,r,e[r],o);else if(e){e=u(e);for(var n=0,s=e.length;n<s;n++)vt(t,e[n],o,i)}else{for(var a in t[Ro])vt(t,a,t[Ro][a]);delete t[Ro]}return this}function gt(){if(no)return!(He||Ze)}function Ct(t,e,o,r){var n=e+i(o)+(r?"_"+i(r):"");if(t[Ro]&&t[Ro][n])return this;var s=function(e){return o.call(r||t,e||window.event)},a=s;no&&0===e.indexOf("touch")?A(t,e,s,n):so&&"dblclick"===e&&!gt()?G(t,s,n):"addEventListener"in t?"touchstart"===e||"touchmove"===e||"wheel"===e||"mousewheel"===e?t.addEventListener(Ao[e]||e,s,!!co&&{passive:!1}):"mouseenter"===e||"mouseleave"===e?(s=function(e){e=e||window.event,Dt(t,e)&&a(e)},t.addEventListener(Ao[e],s,!1)):t.addEventListener(e,a,!1):"attachEvent"in t&&t.attachEvent("on"+e,s),t[Ro]=t[Ro]||{},t[Ro][n]=s}function vt(t,e,o,r){var n=e+i(o)+(r?"_"+i(r):""),s=t[Ro]&&t[Ro][n];if(!s)return this;no&&0===e.indexOf("touch")?V(t,e,n):so&&"dblclick"===e&&!gt()?W(t,n):"removeEventListener"in t?t.removeEventListener(Ao[e]||e,s,!1):"detachEvent"in t&&t.detachEvent("on"+e,s),t[Ro][n]=null}function mt(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,Mt(t),this}function Tt(t){return Ct(t,"wheel",mt),this}function wt(t){return ft(t,"mousedown touchstart dblclick",mt),Ct(t,"click",Ot),this}function St(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Pt(t){return St(t),mt(t),this}function bt(t,e){if(!e)return new m(t.clientX,t.clientY);var o=_t(e),i=o.boundingClientRect;return new m((t.clientX-i.left)/o.x-e.clientLeft,(t.clientY-i.top)/o.y-e.clientTop)}function It(t){return He?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/Vo:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function Ot(t){Lo[t.type]=!0}function Mt(t){var e=Lo[t.type];return Lo[t.type]=!1,e}function Dt(t,e){var o=e.relatedTarget;if(!o)return!0;try{for(;o&&o!==t;)o=o.parentNode}catch(t){return!1}return o!==t}function Et(t,e){return new Ho(t,e)}function kt(t,e){if(!e||!t.length)return t.slice();var o=e*e;return t=Nt(t,o),t=Vt(t,o)}function Rt(t,e,o){return Math.sqrt(Ut(t,e,o,!0))}function At(t,e,o){return Ut(t,e,o)}function Vt(t,e){var o=t.length,i=typeof Uint8Array!=void 0+""?Uint8Array:Array,r=new i(o);r[0]=r[o-1]=1,Lt(t,r,e,0,o-1);var n,s=[];for(n=0;n<o;n++)r[n]&&s.push(t[n]);return s}function Lt(t,e,o,i,r){var n,s,a,l=0;for(s=i+1;s<=r-1;s++)(a=Ut(t[s],t[i],t[r],!0))>l&&(n=s,l=a);l>o&&(e[n]=1,Lt(t,e,o,i,n),Lt(t,e,o,n,r))}function Nt(t,e){for(var o=[t[0]],i=1,r=0,n=t.length;i<n;i++)Ft(t[i],t[r])>e&&(o.push(t[i]),r=i);return r<n-1&&o.push(t[n-1]),o}function Bt(t,e,o,i,r){var n,s,a,l=i?Xo:xt(t,o),u=xt(e,o);for(Xo=u;;){if(!(l|u))return[t,e];if(l&u)return!1;n=l||u,s=Ht(t,e,n,o,r),a=xt(s,o),n===l?(t=s,l=a):(e=s,u=a)}}function Ht(t,e,o,i,r){var n,s,a=e.x-t.x,l=e.y-t.y,u=i.min,c=i.max;return 8&o?(n=t.x+a*(c.y-t.y)/l,s=c.y):4&o?(n=t.x+a*(u.y-t.y)/l,s=u.y):2&o?(n=c.x,s=t.y+l*(c.x-t.x)/a):1&o&&(n=u.x,s=t.y+l*(u.x-t.x)/a),new m(n,s,r)}function xt(t,e){var o=0;return t.x<e.min.x?o|=1:t.x>e.max.x&&(o|=2),t.y<e.min.y?o|=4:t.y>e.max.y&&(o|=8),o}function Ft(t,e){var o=e.x-t.x,i=e.y-t.y;return o*o+i*i}function Ut(t,e,o,i){var r,n=e.x,s=e.y,a=o.x-n,l=o.y-s,u=a*a+l*l;return u>0&&(r=((t.x-n)*a+(t.y-s)*l)/u,r>1?(n=o.x,s=o.y):r>0&&(n+=a*r,s+=l*r)),a=t.x-n,l=t.y-s,i?a*a+l*l:new m(n,s)}function jt(t){return!Ce(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function Gt(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),jt(t)}function Wt(t,e,o){var i,r,n,s,a,l,u,c,h,d=[1,4,2,8];for(r=0,u=t.length;r<u;r++)t[r]._code=xt(t[r],e);for(s=0;s<4;s++){for(c=d[s],i=[],r=0,u=t.length,n=u-1;r<u;n=r++)a=t[r],l=t[n],a._code&c?l._code&c||(h=Ht(l,a,c,e,o),h._code=xt(h,e),i.push(h)):(l._code&c&&(h=Ht(l,a,c,e,o),h._code=xt(h,e),i.push(h)),i.push(a));t=i}return t}function zt(t){return new fi(t)}function qt(t,e){return new Ci(t,e)}function Zt(t,e){return new mi(t,e)}function Yt(t,e,o){return new Ti(t,e,o)}function Kt(t,e){return new wi(t,e)}function Xt(t,e){return new Si(t,e)}function Qt(t,e){var o,i,r,n,s="Feature"===t.type?t.geometry:t,a=s?s.coordinates:null,l=[],u=e&&e.pointToLayer,c=e&&e.coordsToLatLng||$t;if(!a&&!s)return null;switch(s.type){case"Point":return o=c(a),Jt(u,t,o,e);case"MultiPoint":for(r=0,n=a.length;r<n;r++)o=c(a[r]),l.push(Jt(u,t,o,e));return new pi(l);case"LineString":case"MultiLineString":return i=te(a,"LineString"===s.type?0:1,c),new wi(i,e);case"Polygon":case"MultiPolygon":return i=te(a,"Polygon"===s.type?1:2,c),new Si(i,e);case"GeometryCollection":for(r=0,n=s.geometries.length;r<n;r++){var h=Qt({geometry:s.geometries[r],type:"Feature",properties:t.properties},e);h&&l.push(h)}return new pi(l);default:throw new Error("Invalid GeoJSON object.")}}function Jt(t,e,o,i){return t?t(e,o):new Ci(o,i&&i.markersInheritOptions&&i)}function $t(t){return new I(t[1],t[0],t[2])}function te(t,e,o){for(var i,r=[],n=0,s=t.length;n<s;n++)i=e?te(t[n],e-1,o):(o||$t)(t[n]),r.push(i);return r}function ee(t,e){return e="number"==typeof e?e:6,void 0!==t.alt?[a(t.lng,e),a(t.lat,e),a(t.alt,e)]:[a(t.lng,e),a(t.lat,e)]}function oe(t,e,o,i){for(var r=[],n=0,s=t.length;n<s;n++)r.push(e?oe(t[n],e-1,o,i):ee(t[n],i));return!e&&o&&r.push(r[0]),r}function ie(t,o){return t.feature?e({},t.feature,{geometry:o}):re(o)}function re(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}function ne(t,e){return new Pi(t,e)}function se(t,e,o){return new Di(t,e,o)}function ae(t,e,o){return new Ei(t,e,o)}function le(t){return new Ni(t)}function ue(t){return new Bi(t)}function ce(t,e){return new Hi(t,e)}function he(t,e){return new xi(t,e)}function de(t){return ho?new Ui(t):null}function pe(t){return po||_o?new zi(t):null}function _e(t,e){return new qi(t,e)}var fe=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}(),ye=0,ge=/\{ *([\w_-]+) *\}/g,Ce=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},ve="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",me=0,Te=window.requestAnimationFrame||_("RequestAnimationFrame")||f,we=window.cancelAnimationFrame||_("CancelAnimationFrame")||_("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)},Se={extend:e,create:fe,bind:o,lastId:ye,stamp:i,throttle:r,wrapNum:n,falseFn:s,formatNum:a,trim:l,splitWords:u,setOptions:c,getParamString:h,template:d,isArray:Ce,indexOf:p,emptyImageUrl:ve,requestFn:Te,cancelFn:we,requestAnimFrame:y,cancelAnimFrame:g};C.extend=function(t){var o=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=o.__super__=this.prototype,r=fe(i);r.constructor=o,o.prototype=r;for(var n in this)Object.prototype.hasOwnProperty.call(this,n)&&"prototype"!==n&&"__super__"!==n&&(o[n]=this[n]);return t.statics&&(e(o,t.statics),delete t.statics),t.includes&&(v(t.includes),e.apply(null,[r].concat(t.includes)),delete t.includes),r.options&&(t.options=e(fe(r.options),t.options)),e(r,t),r._initHooks=[],r.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=r._initHooks.length;t<e;t++)r._initHooks[t].call(this)}},o},C.include=function(t){return e(this.prototype,t),this},C.mergeOptions=function(t){return e(this.prototype.options,t),this},C.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),o="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(o),this};var Pe={on:function(t,e,o){if("object"==typeof t)for(var i in t)this._on(i,t[i],e);else{t=u(t);for(var r=0,n=t.length;r<n;r++)this._on(t[r],e,o)}return this},off:function(t,e,o){if(t)if("object"==typeof t)for(var i in t)this._off(i,t[i],e);else{t=u(t);for(var r=0,n=t.length;r<n;r++)this._off(t[r],e,o)}else delete this._events;return this},_on:function(t,e,o){this._events=this._events||{};var i=this._events[t];i||(i=[],this._events[t]=i),o===this&&(o=void 0);for(var r={fn:e,ctx:o},n=i,s=0,a=n.length;s<a;s++)if(n[s].fn===e&&n[s].ctx===o)return;n.push(r)},_off:function(t,e,o){var i,r,n;if(this._events&&(i=this._events[t])){if(!e){for(r=0,n=i.length;r<n;r++)i[r].fn=s;return void delete this._events[t]}if(o===this&&(o=void 0),i)for(r=0,n=i.length;r<n;r++){var a=i[r];if(a.ctx===o&&a.fn===e)return a.fn=s,this._firingCount&&(this._events[t]=i=i.slice()),void i.splice(r,1)}}},fire:function(t,o,i){if(!this.listens(t,i))return this;var r=e({},o,{type:t,target:this,sourceTarget:o&&o.sourceTarget||this});if(this._events){var n=this._events[t];if(n){this._firingCount=this._firingCount+1||1;for(var s=0,a=n.length;s<a;s++){var l=n[s];l.fn.call(l.ctx||this,r)}this._firingCount--}}return i&&this._propagateEvent(r),this},listens:function(t,e){var o=this._events&&this._events[t];if(o&&o.length)return!0;if(e)for(var i in this._eventParents)if(this._eventParents[i].listens(t,e))return!0;return!1},once:function(t,e,i){if("object"==typeof t){for(var r in t)this.once(r,t[r],e);return this}var n=o(function(){this.off(t,e,i).off(t,n,i)},this);return this.on(t,e,i).on(t,n,i)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[i(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[i(t)],this},_propagateEvent:function(t){for(var o in this._eventParents)this._eventParents[o].fire(t.type,e({layer:t.target,propagatedFrom:t.target},t),!0)}};Pe.addEventListener=Pe.on,Pe.removeEventListener=Pe.clearAllEventListeners=Pe.off,Pe.addOneTimeEventListener=Pe.once,Pe.fireEvent=Pe.fire,Pe.hasEventListeners=Pe.listens;var be=C.extend(Pe),Ie=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};m.prototype={clone:function(){return new m(this.x,this.y)},add:function(t){return this.clone()._add(T(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(T(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new m(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new m(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Ie(this.x),this.y=Ie(this.y),this},distanceTo:function(t){t=T(t);var e=t.x-this.x,o=t.y-this.y;return Math.sqrt(e*e+o*o)},equals:function(t){return t=T(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=T(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+a(this.x)+", "+a(this.y)+")"}},w.prototype={extend:function(t){return t=T(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new m((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new m(this.min.x,this.max.y)},getTopRight:function(){return new m(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,o;return t="number"==typeof t[0]||t instanceof m?T(t):S(t),t instanceof w?(e=t.min,o=t.max):e=o=t,e.x>=this.min.x&&o.x<=this.max.x&&e.y>=this.min.y&&o.y<=this.max.y},intersects:function(t){t=S(t);var e=this.min,o=this.max,i=t.min,r=t.max,n=r.x>=e.x&&i.x<=o.x,s=r.y>=e.y&&i.y<=o.y;return n&&s},overlaps:function(t){t=S(t);var e=this.min,o=this.max,i=t.min,r=t.max,n=r.x>e.x&&i.x<o.x,s=r.y>e.y&&i.y<o.y;return n&&s},isValid:function(){return!(!this.min||!this.max)}},P.prototype={extend:function(t){var e,o,i=this._southWest,r=this._northEast;if(t instanceof I)e=t,o=t;else{if(!(t instanceof P))return t?this.extend(O(t)||b(t)):this;if(e=t._southWest,o=t._northEast,!e||!o)return this}return i||r?(i.lat=Math.min(e.lat,i.lat),i.lng=Math.min(e.lng,i.lng),r.lat=Math.max(o.lat,r.lat),r.lng=Math.max(o.lng,r.lng)):(this._southWest=new I(e.lat,e.lng),this._northEast=new I(o.lat,o.lng)),this},pad:function(t){var e=this._southWest,o=this._northEast,i=Math.abs(e.lat-o.lat)*t,r=Math.abs(e.lng-o.lng)*t;return new P(new I(e.lat-i,e.lng-r),new I(o.lat+i,o.lng+r))},getCenter:function(){return new I((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new I(this.getNorth(),this.getWest())},getSouthEast:function(){return new I(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof I||"lat"in t?O(t):b(t);var e,o,i=this._southWest,r=this._northEast;return t instanceof P?(e=t.getSouthWest(),o=t.getNorthEast()):e=o=t,e.lat>=i.lat&&o.lat<=r.lat&&e.lng>=i.lng&&o.lng<=r.lng},intersects:function(t){t=b(t);var e=this._southWest,o=this._northEast,i=t.getSouthWest(),r=t.getNorthEast(),n=r.lat>=e.lat&&i.lat<=o.lat,s=r.lng>=e.lng&&i.lng<=o.lng;return n&&s},overlaps:function(t){t=b(t);var e=this._southWest,o=this._northEast,i=t.getSouthWest(),r=t.getNorthEast(),n=r.lat>e.lat&&i.lat<o.lat,s=r.lng>e.lng&&i.lng<o.lng;return n&&s},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=b(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}},I.prototype={equals:function(t,e){return!!t&&(t=O(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+a(this.lat,t)+", "+a(this.lng,t)+")"},distanceTo:function(t){return Me.distance(this,O(t))},wrap:function(){return Me.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,o=e/Math.cos(Math.PI/180*this.lat);return b([this.lat-e,this.lng-o],[this.lat+e,this.lng+o])},clone:function(){return new I(this.lat,this.lng,this.alt)}};var Oe={latLngToPoint:function(t,e){var o=this.projection.project(t),i=this.scale(e);return this.transformation._transform(o,i)},pointToLatLng:function(t,e){var o=this.scale(e),i=this.transformation.untransform(t,o);return this.projection.unproject(i)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,o=this.scale(t);return new w(this.transformation.transform(e.min,o),this.transformation.transform(e.max,o))},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?n(t.lng,this.wrapLng,!0):t.lng;return new I(this.wrapLat?n(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),o=this.wrapLatLng(e),i=e.lat-o.lat,r=e.lng-o.lng;if(0===i&&0===r)return t;var n=t.getSouthWest(),s=t.getNorthEast();return new P(new I(n.lat-i,n.lng-r),new I(s.lat-i,s.lng-r))}},Me=e({},Oe,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var o=Math.PI/180,i=t.lat*o,r=e.lat*o,n=Math.sin((e.lat-t.lat)*o/2),s=Math.sin((e.lng-t.lng)*o/2),a=n*n+Math.cos(i)*Math.cos(r)*s*s,l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return this.R*l}}),De={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,o=this.MAX_LATITUDE,i=Math.max(Math.min(o,t.lat),-o),r=Math.sin(i*e);return new m(this.R*t.lng*e,this.R*Math.log((1+r)/(1-r))/2)},unproject:function(t){var e=180/Math.PI;return new I((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:function(){var t=6378137*Math.PI;return new w([-t,-t],[t,t])}()};M.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new m((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var Ee,ke,Re,Ae=e({},Me,{code:"EPSG:3857",projection:De,transformation:function(){var t=.5/(Math.PI*De.R);return D(t,.5,-t,.5)}()}),Ve=e({},Ae,{code:"EPSG:900913"}),Le=document.documentElement.style,Ne="ActiveXObject"in window,Be=Ne&&!document.addEventListener,He="msLaunchUri"in navigator&&!("documentMode"in document),xe=R("webkit"),Fe=R("android"),Ue=R("android 2")||R("android 3"),je=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Ge=Fe&&R("Google")&&je<537&&!("AudioNode"in window),We=!!window.opera,ze=!He&&R("chrome"),qe=R("gecko")&&!xe&&!We&&!Ne,Ze=!ze&&R("safari"),Ye=R("phantom"),Ke="OTransition"in Le,Xe=0===navigator.platform.indexOf("Win"),Qe=Ne&&"transition"in Le,Je="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Ue,$e="MozPerspective"in Le,to=!window.L_DISABLE_3D&&(Qe||Je||$e)&&!Ke&&!Ye,eo="undefined"!=typeof orientation||R("mobile"),oo=eo&&xe,io=eo&&Je,ro=!window.PointerEvent&&window.MSPointerEvent,no=!(!window.PointerEvent&&!ro),so=!window.L_NO_TOUCH&&(no||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),ao=eo&&We,lo=eo&&qe,uo=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,co=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",s,e),window.removeEventListener("testPassiveEventSupport",s,e)}catch(t){}return t}(),ho=function(){return!!document.createElement("canvas").getContext}(),po=!(!document.createElementNS||!E("svg").createSVGRect),_o=!po&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(t){return!1}}(),fo={ie:Ne,ielt9:Be,edge:He,webkit:xe,android:Fe,android23:Ue,androidStock:Ge,opera:We,chrome:ze,gecko:qe,safari:Ze,phantom:Ye,opera12:Ke,win:Xe,ie3d:Qe,webkit3d:Je,gecko3d:$e,any3d:to,mobile:eo,mobileWebkit:oo,mobileWebkit3d:io,msPointer:ro,pointer:no,touch:so,mobileOpera:ao,mobileGecko:lo,retina:uo,passiveEvents:co,canvas:ho,svg:po,vml:_o},yo=ro?"MSPointerDown":"pointerdown",go=ro?"MSPointerMove":"pointermove",Co=ro?"MSPointerUp":"pointerup",vo=ro?"MSPointerCancel":"pointercancel",mo={},To=!1,wo=ro?"MSPointerDown":no?"pointerdown":"touchstart",So=ro?"MSPointerUp":no?"pointerup":"touchend",Po="_leaflet_",bo=nt(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Io=nt(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Oo="webkitTransition"===Io||"OTransition"===Io?Io+"End":"transitionend";if("onselectstart"in document)Ee=function(){ft(window,"selectstart",St)},ke=function(){yt(window,"selectstart",St)};else{var Mo=nt(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Ee=function(){if(Mo){var t=document.documentElement.style;Re=t[Mo],t[Mo]="none"}},ke=function(){Mo&&(document.documentElement.style[Mo]=Re,Re=void 0)}}var Do,Eo,ko={TRANSFORM:bo,TRANSITION:Io,TRANSITION_END:Oo,get:z,getStyle:q,create:Z,remove:Y,empty:K,toFront:X,toBack:Q,hasClass:J,addClass:$,removeClass:tt,setClass:et,getClass:ot,setOpacity:it,testProp:nt,setTransform:st,setPosition:at,getPosition:lt,disableTextSelection:Ee,enableTextSelection:ke,disableImageDrag:ut,enableImageDrag:ct,preventOutline:ht,restoreOutline:dt,getSizedParentNode:pt,getScale:_t},Ro="_leaflet_events",Ao={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"},Vo=Xe&&ze?2*window.devicePixelRatio:qe?window.devicePixelRatio:1,Lo={},No={on:ft,off:yt,stopPropagation:mt,disableScrollPropagation:Tt,disableClickPropagation:wt,preventDefault:St,stop:Pt,getMousePosition:bt,getWheelDelta:It,fakeStop:Ot,skipped:Mt,isExternalTarget:Dt,addListener:ft,removeListener:yt},Bo=be.extend({run:function(t,e,o,i){this.stop(),this._el=t,this._inProgress=!0,this._duration=o||.25,this._easeOutPower=1/Math.max(i||.5,.2),this._startPos=lt(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=y(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,o=1e3*this._duration;e<o?this._runFrame(this._easeOut(e/o),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var o=this._startPos.add(this._offset.multiplyBy(t));e&&o._round(),at(this._el,o),this.fire("step")},_complete:function(){g(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),Ho=be.extend({options:{crs:Ae,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=c(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=o(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(O(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Io&&to&&!ao&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ft(this._proxy,Oo,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,o,i){if(o=void 0===o?this._zoom:this._limitZoom(o),t=this._limitCenter(O(t),o,this.options.maxBounds),i=i||{},this._stop(),this._loaded&&!i.reset&&!0!==i){void 0!==i.animate&&(i.zoom=e({animate:i.animate},i.zoom),i.pan=e({animate:i.animate,duration:i.duration},i.pan));if(this._zoom!==o?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,o,i.zoom):this._tryAnimatedPan(t,i.pan))return clearTimeout(this._sizeTimer),this}return this._resetView(t,o),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(to?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(to?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,o){var i=this.getZoomScale(e),r=this.getSize().divideBy(2),n=t instanceof m?t:this.latLngToContainerPoint(t),s=n.subtract(r).multiplyBy(1-1/i),a=this.containerPointToLatLng(r.add(s));return this.setView(a,e,{zoom:o})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():b(t);var o=T(e.paddingTopLeft||e.padding||[0,0]),i=T(e.paddingBottomRight||e.padding||[0,0]),r=this.getBoundsZoom(t,!1,o.add(i));if((r="number"==typeof e.maxZoom?Math.min(e.maxZoom,r):r)===1/0)return{center:t.getCenter(),zoom:r};var n=i.subtract(o).divideBy(2),s=this.project(t.getSouthWest(),r),a=this.project(t.getNorthEast(),r);return{center:this.unproject(s.add(a).divideBy(2).add(n),r),zoom:r}},fitBounds:function(t,e){if(t=b(t),!t.isValid())throw new Error("Bounds are not valid.");var o=this._getBoundsCenterZoom(t,e);return this.setView(o.center,o.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(t=T(t).round(),e=e||{},!t.x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Bo,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){$(this._mapPane,"leaflet-pan-anim");var o=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,o,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,o){function i(t){var e=t?-1:1,o=t?g:f,i=g*g-f*f+e*m*m*C*C,r=2*o*m*C,n=i/r,s=Math.sqrt(n*n+1)-n;return s<1e-9?-18:Math.log(s)}function r(t){return(Math.exp(t)-Math.exp(-t))/2}function n(t){return(Math.exp(t)+Math.exp(-t))/2}function s(t){return r(t)/n(t)}function a(t){return f*(n(T)/n(T+v*t))}function l(t){return f*(n(T)*s(T+v*t)-r(T))/m}function u(t){return 1-Math.pow(1-t,1.5)}function c(){var o=(Date.now()-w)/P,i=u(o)*S;o<=1?(this._flyToFrame=y(c,this),this._move(this.unproject(h.add(d.subtract(h).multiplyBy(l(i)/C)),_),this.getScaleZoom(f/a(i),_),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}if(o=o||{},!1===o.animate||!to)return this.setView(t,e,o);this._stop();var h=this.project(this.getCenter()),d=this.project(t),p=this.getSize(),_=this._zoom;t=O(t),e=void 0===e?_:e;var f=Math.max(p.x,p.y),g=f*this.getZoomScale(_,e),C=d.distanceTo(h)||1,v=1.42,m=v*v,T=i(0),w=Date.now(),S=(i(1)-T)/v,P=o.duration?1e3*o.duration:1e3*S*.8;return this._moveStart(!0,o.noMoveStart),c.call(this),this},flyToBounds:function(t,e){var o=this._getBoundsCenterZoom(t,e);return this.flyTo(o.center,o.zoom,e)},setMaxBounds:function(t){return t=b(t),t.isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var o=this.getCenter(),i=this._limitCenter(o,this._zoom,b(t));return o.equals(i)||this.panTo(i,e),this._enforcingBounds=!1,this},panInside:function(t,e){e=e||{};var o=T(e.paddingTopLeft||e.padding||[0,0]),i=T(e.paddingBottomRight||e.padding||[0,0]),r=this.getCenter(),n=this.project(r),s=this.project(t),a=this.getPixelBounds(),l=a.getSize().divideBy(2),u=S([a.min.add(o),a.max.subtract(i)]);if(!u.contains(s)){this._enforcingBounds=!0;var c=n.subtract(s),h=T(s.x+c.x,s.y+c.y);(s.x<u.min.x||s.x>u.max.x)&&(h.x=n.x-c.x,c.x>0?h.x+=l.x-o.x:h.x-=l.x-i.x),(s.y<u.min.y||s.y>u.max.y)&&(h.y=n.y-c.y,c.y>0?h.y+=l.y-o.y:h.y-=l.y-i.y),this.panTo(this.unproject(h),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=e({animate:!1,pan:!0},!0===t?{animate:!0}:t);var i=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var r=this.getSize(),n=i.divideBy(2).round(),s=r.divideBy(2).round(),a=n.subtract(s);return a.x||a.y?(t.animate&&t.pan?this.panBy(a):(t.pan&&this._rawPanBy(a),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:i,newSize:r})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=e({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var i=o(this._handleGeolocationResponse,this),r=o(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(i,r,t):navigator.geolocation.getCurrentPosition(i,r,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,o=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+o+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,o=t.coords.longitude,i=new I(e,o),r=i.toBounds(2*t.coords.accuracy),n=this._locateOptions;if(n.setView){var s=this.getBoundsZoom(r);this.setView(i,n.maxZoom?Math.min(s,n.maxZoom):s)}var a={latlng:i,bounds:r,timestamp:t.timestamp};for(var l in t.coords)"number"==typeof t.coords[l]&&(a[l]=t.coords[l]);this.fire("locationfound",a)},addHandler:function(t,e){if(!e)return this;var o=this[t]=new e(this);return this._handlers.push(o),this.options[t]&&o.enable(),this},remove:function(){if(this._initEvents(!0),this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),Y(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(g(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var t;for(t in this._layers)this._layers[t].remove();for(t in this._panes)Y(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var o="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),i=Z("div",o,e||this._mapPane);return t&&(this._panes[t]=i),i},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new P(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,o){t=b(t),o=T(o||[0,0]);var i=this.getZoom()||0,r=this.getMinZoom(),n=this.getMaxZoom(),s=t.getNorthWest(),a=t.getSouthEast(),l=this.getSize().subtract(o),u=S(this.project(a,i),this.project(s,i)).getSize(),c=to?this.options.zoomSnap:1,h=l.x/u.x,d=l.y/u.y,p=e?Math.max(h,d):Math.min(h,d);return i=this.getScaleZoom(p,i),c&&(i=Math.round(i/(c/100))*(c/100),i=e?Math.ceil(i/c)*c:Math.floor(i/c)*c),Math.max(r,Math.min(n,i))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new m(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var o=this._getTopLeftPoint(t,e);return new w(o,o.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var o=this.options.crs;return e=void 0===e?this._zoom:e,o.scale(t)/o.scale(e)},getScaleZoom:function(t,e){var o=this.options.crs;e=void 0===e?this._zoom:e;var i=o.zoom(t*o.scale(e));return isNaN(i)?1/0:i},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(O(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(T(t),e)},layerPointToLatLng:function(t){var e=T(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(O(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(O(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(b(t))},distance:function(t,e){return this.options.crs.distance(O(t),O(e))},containerPointToLayerPoint:function(t){return T(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return T(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(T(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(O(t)))},mouseEventToContainerPoint:function(t){return bt(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=z(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");ft(e,"scroll",this._onScroll,this),this._containerId=i(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&to,$(t,"leaflet-container"+(so?" leaflet-touch":"")+(uo?" leaflet-retina":"")+(Be?" leaflet-oldie":"")+(Ze?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=q(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),at(this._mapPane,new m(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||($(t.markerPane,"leaflet-zoom-hide"),$(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e){at(this._mapPane,new m(0,0));var o=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var i=this._zoom!==e;this._moveStart(i,!1)._move(t,e)._moveEnd(i),this.fire("viewreset"),o&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,o){void 0===e&&(e=this._zoom);var i=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),(i||o&&o.pinch)&&this.fire("zoom",o),this.fire("move",o)},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return g(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){at(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[i(this._container)]=this;var e=t?yt:ft;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),to&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){g(this._resizeRequest),this._resizeRequest=y(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var o,r=[],n="mouseout"===e||"mouseover"===e,s=t.target||t.srcElement,a=!1;s;){if((o=this._targets[i(s)])&&("click"===e||"preclick"===e)&&!t._simulated&&this._draggableMoved(o)){a=!0;break}if(o&&o.listens(e,!0)){if(n&&!Dt(s,t))break;if(r.push(o),n)break}if(s===this._container)break;s=s.parentNode}return r.length||a||n||!Dt(s,t)||(r=[this]),r},_handleDOMEvent:function(t){if(this._loaded&&!Mt(t)){var e=t.type;"mousedown"!==e&&"keypress"!==e&&"keyup"!==e&&"keydown"!==e||ht(t.target||t.srcElement),this._fireDOMEvent(t,e)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,o,i){if("click"===t.type){var r=e({},t);r.type="preclick",this._fireDOMEvent(r,r.type,i)}if(!t._stopped&&(i=(i||[]).concat(this._findEventTargets(t,o)),i.length)){var n=i[0];"contextmenu"===o&&n.listens(o,!0)&&St(t);var s={originalEvent:t};if("keypress"!==t.type&&"keydown"!==t.type&&"keyup"!==t.type){var a=n.getLatLng&&(!n._radius||n._radius<=10);s.containerPoint=a?this.latLngToContainerPoint(n.getLatLng()):this.mouseEventToContainerPoint(t),s.layerPoint=this.containerPointToLayerPoint(s.containerPoint),s.latlng=a?n.getLatLng():this.layerPointToLatLng(s.layerPoint)}for(var l=0;l<i.length;l++)if(i[l].fire(o,s,!0),s.originalEvent._stopped||!1===i[l].options.bubblingMouseEvents&&-1!==p(this._mouseEvents,o))return}},_draggableMoved:function(t){return t=t.dragging&&t.dragging.enabled()?t:this,t.dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return lt(this._mapPane)||new m(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var o=this.getSize()._divideBy(2);return this.project(t,e)._subtract(o)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,o){var i=this._getNewPixelOrigin(o,e);return this.project(t,e)._subtract(i)},_latLngBoundsToNewLayerBounds:function(t,e,o){var i=this._getNewPixelOrigin(o,e);return S([this.project(t.getSouthWest(),e)._subtract(i),this.project(t.getNorthWest(),e)._subtract(i),this.project(t.getSouthEast(),e)._subtract(i),this.project(t.getNorthEast(),e)._subtract(i)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,o){if(!o)return t;var i=this.project(t,e),r=this.getSize().divideBy(2),n=new w(i.subtract(r),i.add(r)),s=this._getBoundsOffset(n,o,e);return s.round().equals([0,0])?t:this.unproject(i.add(s),e)},_limitOffset:function(t,e){if(!e)return t;var o=this.getPixelBounds(),i=new w(o.min.add(t),o.max.add(t));return t.add(this._getBoundsOffset(i,e))},_getBoundsOffset:function(t,e,o){var i=S(this.project(e.getNorthEast(),o),this.project(e.getSouthWest(),o)),r=i.min.subtract(t.min),n=i.max.subtract(t.max);return new m(this._rebound(r.x,-n.x),this._rebound(r.y,-n.y))},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),o=this.getMaxZoom(),i=to?this.options.zoomSnap:1;return i&&(t=Math.round(t/i)*i),Math.max(e,Math.min(o,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){tt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var o=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(o))&&(this.panBy(o,e),!0)},_createAnimProxy:function(){var t=this._proxy=Z("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(t){var e=bo,o=this._proxy.style[e];st(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),o===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Y(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();st(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,o){if(this._animatingZoom)return!0;if(o=o||{},!this._zoomAnimated||!1===o.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var i=this.getZoomScale(e),r=this._getCenterOffset(t)._divideBy(1-1/i);return!(!0!==o.animate&&!this.getSize().contains(r))&&(y(function(){this._moveStart(!0,!1)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,i,r){this._mapPane&&(i&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,$(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:r}),setTimeout(o(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&tt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),y(function(){this._moveEnd(!0)},this))}}),xo=C.extend({options:{position:"topright"},initialize:function(t){c(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),o=this.getPosition(),i=t._controlCorners[o];return $(e,"leaflet-control"),-1!==o.indexOf("bottom")?i.insertBefore(e,i.firstChild):i.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Y(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),Fo=function(t){return new xo(t)};Ho.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){function t(t,r){var n=o+t+" "+o+r;e[t+r]=Z("div",n,i)}var e=this._controlCorners={},o="leaflet-",i=this._controlContainer=Z("div",o+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)Y(this._controlCorners[t]);Y(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Uo=xo.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,o,i){return o<i?-1:i<o?1:0}},initialize:function(t,e,o){c(this,o),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1;for(var i in t)this._addLayer(t[i],i);for(i in e)this._addLayer(e[i],i,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return xo.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(i(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){$(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?($(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):tt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return tt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=Z("div",t),o=this.options.collapsed;e.setAttribute("aria-haspopup",!0),wt(e),Tt(e);var i=this._section=Z("section",t+"-list");o&&(this._map.on("click",this.collapse,this),Fe||ft(e,{mouseenter:this.expand,mouseleave:this.collapse},this));var r=this._layersLink=Z("a",t+"-toggle",e);r.href="#",r.title="Layers",so?(ft(r,"click",Pt),ft(r,"click",this.expand,this)):ft(r,"focus",this.expand,this),o||this.expand(),this._baseLayersList=Z("div",t+"-base",i),this._separator=Z("div",t+"-separator",i),this._overlaysList=Z("div",t+"-overlays",i),e.appendChild(i)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&i(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:i}),this.options.sortLayers&&this._layers.sort(o(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;K(this._baseLayersList),K(this._overlaysList),this._layerControlInputs=[];var t,e,o,i,r=0;for(o=0;o<this._layers.length;o++)i=this._layers[o],this._addItem(i),e=e||i.overlay,t=t||!i.overlay,r+=i.overlay?0:1;return this.options.hideSingleBase&&(t=t&&r>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(i(t.target)),o=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;o&&this._map.fire(o,e)},_createRadioElement:function(t,e){var o='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",i=document.createElement("div");return i.innerHTML=o,i.firstChild},_addItem:function(t){var e,o=document.createElement("label"),r=this._map.hasLayer(t.layer);t.overlay?(e=document.createElement("input"),e.type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=r):e=this._createRadioElement("leaflet-base-layers_"+i(this),r),this._layerControlInputs.push(e),e.layerId=i(t.layer),ft(e,"click",this._onInputClick,this);var n=document.createElement("span");n.innerHTML=" "+t.name;var s=document.createElement("div");return o.appendChild(s),s.appendChild(e),s.appendChild(n),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(o),this._checkDisabledLayers(),o},_onInputClick:function(){var t,e,o=this._layerControlInputs,i=[],r=[];this._handlingClick=!0;for(var n=o.length-1;n>=0;n--)t=o[n],e=this._getLayer(t.layerId).layer,t.checked?i.push(e):t.checked||r.push(e);for(n=0;n<r.length;n++)this._map.hasLayer(r[n])&&this._map.removeLayer(r[n]);for(n=0;n<i.length;n++)this._map.hasLayer(i[n])||this._map.addLayer(i[n]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var t,e,o=this._layerControlInputs,i=this._map.getZoom(),r=o.length-1;r>=0;r--)t=o[r],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&i<e.options.minZoom||void 0!==e.options.maxZoom&&i>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),jo=function(t,e,o){return new Uo(t,e,o)},Go=xo.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",o=Z("div",e+" leaflet-bar"),i=this.options;return this._zoomInButton=this._createButton(i.zoomInText,i.zoomInTitle,e+"-in",o,this._zoomIn),this._zoomOutButton=this._createButton(i.zoomOutText,i.zoomOutTitle,e+"-out",o,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),o},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,o,i,r){var n=Z("a",o,i);return n.innerHTML=t,n.href="#",n.title=e,n.setAttribute("role","button"),n.setAttribute("aria-label",e),wt(n),ft(n,"click",Pt),ft(n,"click",r,this),ft(n,"click",this._refocusOnMap,this),n},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";tt(this._zoomInButton,e),tt(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMinZoom())&&$(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMaxZoom())&&$(this._zoomInButton,e)}});Ho.mergeOptions({zoomControl:!0}),Ho.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Go,this.addControl(this.zoomControl))});var Wo=function(t){return new Go(t)},zo=xo.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e=Z("div","leaflet-control-scale"),o=this.options;return this._addScales(o,"leaflet-control-scale-line",e),t.on(o.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),e},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,o){t.metric&&(this._mScale=Z("div",e,o)),t.imperial&&(this._iScale=Z("div",e,o))},_update:function(){var t=this._map,e=t.getSize().y/2,o=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(o)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),o=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,o,e/t)},_updateImperial:function(t){var e,o,i,r=3.2808399*t;r>5280?(e=r/5280,o=this._getRoundNum(e),this._updateScale(this._iScale,o+" mi",o/e)):(i=this._getRoundNum(r),this._updateScale(this._iScale,i+" ft",i/r))},_updateScale:function(t,e,o){t.style.width=Math.round(this.options.maxWidth*o)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),o=t/e;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1,e*o}}),qo=function(t){return new zo(t)},Zo=xo.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){c(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=Z("div","leaflet-control-attribution"),wt(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),this._container},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var o=[];this.options.prefix&&o.push(this.options.prefix),t.length&&o.push(t.join(", ")),this._container.innerHTML=o.join(" | ")}}});Ho.mergeOptions({attributionControl:!0}),Ho.addInitHook(function(){this.options.attributionControl&&(new Zo).addTo(this)});var Yo=function(t){return new Zo(t)};xo.Layers=Uo,xo.Zoom=Go,xo.Scale=zo,xo.Attribution=Zo,Fo.layers=jo,Fo.zoom=Wo,Fo.scale=qo,Fo.attribution=Yo;var Ko=C.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ko.addTo=function(t,e){return t.addHandler(e,this),this};var Xo,Qo={Events:Pe},Jo=so?"touchstart mousedown":"mousedown",$o={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},ti={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},ei=be.extend({options:{clickTolerance:3},initialize:function(t,e,o,i){c(this,i),this._element=t,this._dragStartTarget=e||t,this._preventOutline=o},enable:function(){this._enabled||(ft(this._dragStartTarget,Jo,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(ei._dragging===this&&this.finishDrag(),yt(this._dragStartTarget,Jo,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(!t._simulated&&this._enabled&&(this._moved=!1,!J(this._element,"leaflet-zoom-anim")&&!(ei._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(ei._dragging=this,this._preventOutline&&ht(this._element),ut(),Ee(),this._moving)))){this.fire("down");var e=t.touches?t.touches[0]:t,o=pt(this._element);this._startPoint=new m(e.clientX,e.clientY),this._parentScale=_t(o),ft(document,ti[t.type],this._onMove,this),ft(document,$o[t.type],this._onUp,this)}},_onMove:function(t){if(!t._simulated&&this._enabled){if(t.touches&&t.touches.length>1)return void(this._moved=!0);var e=t.touches&&1===t.touches.length?t.touches[0]:t,o=new m(e.clientX,e.clientY)._subtract(this._startPoint);(o.x||o.y)&&(Math.abs(o.x)+Math.abs(o.y)<this.options.clickTolerance||(o.x/=this._parentScale.x,o.y/=this._parentScale.y,St(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=lt(this._element).subtract(o),$(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),$(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(o),this._moving=!0,g(this._animRequest),this._lastEvent=t,this._animRequest=y(this._updatePosition,this,!0)))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),at(this._element,this._newPos),this.fire("drag",t)},_onUp:function(t){!t._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){tt(document.body,"leaflet-dragging"),this._lastTarget&&(tt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var t in ti)yt(document,ti[t],this._onMove,this),yt(document,$o[t],this._onUp,this);ct(),ke(),this._moved&&this._moving&&(g(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,ei._dragging=!1}}),oi={simplify:kt,pointToSegmentDistance:Rt,closestPointOnSegment:At,clipSegment:Bt,_getEdgeIntersection:Ht,_getBitCode:xt,_sqClosestPointOnSegment:Ut,isFlat:jt,_flat:Gt},ii={clipPolygon:Wt},ri={project:function(t){return new m(t.lng,t.lat)},unproject:function(t){return new I(t.y,t.x)},bounds:new w([-180,-90],[180,90])},ni={R:6378137,R_MINOR:6356752.314245179,bounds:new w([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,o=this.R,i=t.lat*e,r=this.R_MINOR/o,n=Math.sqrt(1-r*r),s=n*Math.sin(i),a=Math.tan(Math.PI/4-i/2)/Math.pow((1-s)/(1+s),n/2);return i=-o*Math.log(Math.max(a,1e-10)),new m(t.lng*e*o,i)},unproject:function(t){for(var e,o=180/Math.PI,i=this.R,r=this.R_MINOR/i,n=Math.sqrt(1-r*r),s=Math.exp(-t.y/i),a=Math.PI/2-2*Math.atan(s),l=0,u=.1;l<15&&Math.abs(u)>1e-7;l++)e=n*Math.sin(a),e=Math.pow((1-e)/(1+e),n/2),u=Math.PI/2-2*Math.atan(s*e)-a,a+=u;return new I(a*o,t.x*o/i)}},si={LonLat:ri,Mercator:ni,SphericalMercator:De},ai=e({},Me,{code:"EPSG:3395",projection:ni,transformation:function(){var t=.5/(Math.PI*ni.R);return D(t,.5,-t,.5)}()}),li=e({},Me,{code:"EPSG:4326",projection:ri,transformation:D(1/180,1,-1/180,.5)}),ui=e({},Oe,{projection:ri,transformation:D(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var o=e.lng-t.lng,i=e.lat-t.lat;return Math.sqrt(o*o+i*i)},infinite:!0});Oe.Earth=Me,Oe.EPSG3395=ai,Oe.EPSG3857=Ae,Oe.EPSG900913=Ve,Oe.EPSG4326=li,Oe.Simple=ui;var ci=be.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[i(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[i(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var o=this.getEvents();e.on(o,this),this.once("remove",function(){e.off(o,this)},this)}this.onAdd(e),this.getAttribution&&e.attributionControl&&e.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),e.fire("layeradd",{layer:this})}}});Ho.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=i(t);return this._layers[e]?this:(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var e=i(t);return this._layers[e]?(this._loaded&&t.onRemove(this),t.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(t.getAttribution()),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return!!t&&i(t)in this._layers},eachLayer:function(t,e){for(var o in this._layers)t.call(e,this._layers[o]);return this},_addLayers:function(t){t=t?Ce(t)?t:[t]:[];for(var e=0,o=t.length;e<o;e++)this.addLayer(t[e])},_addZoomLimit:function(t){!isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[i(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=i(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,o=this._getZoomSpan();for(var i in this._zoomBoundLayers){var r=this._zoomBoundLayers[i].options;t=void 0===r.minZoom?t:Math.min(t,r.minZoom),e=void 0===r.maxZoom?e:Math.max(e,r.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,o!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var hi=ci.extend({initialize:function(t,e){c(this,e),this._layers={};var o,i;if(t)for(o=0,i=t.length;o<i;o++)this.addLayer(t[o])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return!!t&&("number"==typeof t?t:this.getLayerId(t))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,o,i=Array.prototype.slice.call(arguments,1);for(e in this._layers)o=this._layers[e],o[t]&&o[t].apply(o,i);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var o in this._layers)t.call(e,this._layers[o]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return i(t)}}),di=function(t,e){return new hi(t,e)},pi=hi.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),hi.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),hi.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new P;for(var e in this._layers){var o=this._layers[e];t.extend(o.getBounds?o.getBounds():o.getLatLng())}return t}}),_i=function(t,e){return new pi(t,e)},fi=C.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0]},initialize:function(t){c(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var o=this._getIconUrl(t);if(!o){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var i=this._createImg(o,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(i,t),i},_setIconStyles:function(t,e){var o=this.options,i=o[e+"Size"];"number"==typeof i&&(i=[i,i]);var r=T(i),n=T("shadow"===e&&o.shadowAnchor||o.iconAnchor||r&&r.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(o.className||""),n&&(t.style.marginLeft=-n.x+"px",t.style.marginTop=-n.y+"px"),r&&(t.style.width=r.x+"px",t.style.height=r.y+"px")},_createImg:function(t,e){return e=e||document.createElement("img"),e.src=t,e},_getIconUrl:function(t){return uo&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),yi=fi.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return yi.imagePath||(yi.imagePath=this._detectIconPath()),(this.options.imagePath||yi.imagePath)+fi.prototype._getIconUrl.call(this,t)},_detectIconPath:function(){var t=Z("div","leaflet-default-icon-path",document.body),e=q(t,"background-image")||q(t,"backgroundImage");return document.body.removeChild(t),e=null===e||0!==e.indexOf("url")?"":e.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")}}),gi=Ko.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new ei(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),$(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&tt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,o=e._map,i=this._marker.options.autoPanSpeed,r=this._marker.options.autoPanPadding,n=lt(e._icon),s=o.getPixelBounds(),a=o.getPixelOrigin(),l=S(s.min._subtract(a).add(r),s.max._subtract(a).subtract(r));if(!l.contains(n)){var u=T((Math.max(l.max.x,n.x)-l.max.x)/(s.max.x-l.max.x)-(Math.min(l.min.x,n.x)-l.min.x)/(s.min.x-l.min.x),(Math.max(l.max.y,n.y)-l.max.y)/(s.max.y-l.max.y)-(Math.min(l.min.y,n.y)-l.min.y)/(s.min.y-l.min.y)).multiplyBy(i);o.panBy(u,{animate:!1}),this._draggable._newPos._add(u),this._draggable._startPos._add(u),at(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=y(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(g(this._panRequest),this._panRequest=y(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,o=e._shadow,i=lt(e._icon),r=e._map.layerPointToLatLng(i);o&&at(o,i),e._latlng=r,t.latlng=r,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){g(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Ci=ci.extend({options:{icon:new yi,interactive:!0,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){c(this,e),this._latlng=O(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=O(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),o=t.icon.createIcon(this._icon),i=!1;o!==this._icon&&(this._icon&&this._removeIcon(),i=!0,t.title&&(o.title=t.title),"IMG"===o.tagName&&(o.alt=t.alt||"")),$(o,e),t.keyboard&&(o.tabIndex="0"),this._icon=o,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var r=t.icon.createShadow(this._shadow),n=!1;r!==this._shadow&&(this._removeShadow(),n=!0),r&&($(r,e),r.alt=""),this._shadow=r,t.opacity<1&&this._updateOpacity(),i&&this.getPane().appendChild(this._icon),this._initInteraction(),r&&n&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),Y(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Y(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&at(this._icon,t),this._shadow&&at(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&($(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),gi)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new gi(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&it(this._icon,t),this._shadow&&it(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}}),vi=ci.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return c(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+this._renderer.options.tolerance}}),mi=vi.extend({options:{fill:!0,radius:10},initialize:function(t,e){c(this,e),this._latlng=O(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=O(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return vi.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,o=this._clickTolerance(),i=[t+o,e+o];this._pxBounds=new w(this._point.subtract(i),this._point.add(i))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}}),Ti=mi.extend({initialize:function(t,o,i){if("number"==typeof o&&(o=e({},i,{radius:o})),c(this,o),this._latlng=O(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new P(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:vi.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,o=this._map,i=o.options.crs;if(i.distance===Me.distance){var r=Math.PI/180,n=this._mRadius/Me.R/r,s=o.project([e+n,t]),a=o.project([e-n,t]),l=s.add(a).divideBy(2),u=o.unproject(l).lat,c=Math.acos((Math.cos(n*r)-Math.sin(e*r)*Math.sin(u*r))/(Math.cos(e*r)*Math.cos(u*r)))/r;(isNaN(c)||0===c)&&(c=n/Math.cos(Math.PI/180*e)),this._point=l.subtract(o.getPixelOrigin()),this._radius=isNaN(c)?0:l.x-o.project([u,t-c]).x,this._radiusY=l.y-s.y}else{var h=i.unproject(i.project(this._latlng).subtract([this._mRadius,0]));this._point=o.latLngToLayerPoint(this._latlng),this._radius=this._point.x-o.latLngToLayerPoint(h).x}this._updateBounds()}}),wi=vi.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){c(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,o,i=1/0,r=null,n=Ut,s=0,a=this._parts.length;s<a;s++)for(var l=this._parts[s],u=1,c=l.length;u<c;u++){e=l[u-1],o=l[u];var h=n(t,e,o,!0);h<i&&(i=h,r=n(t,e,o))}return r&&(r.distance=Math.sqrt(i)),r},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,o,i,r,n,s,a=this._rings[0],l=a.length;if(!l)return null;for(t=0,e=0;t<l-1;t++)e+=a[t].distanceTo(a[t+1])/2;if(0===e)return this._map.layerPointToLatLng(a[0]);for(t=0,i=0;t<l-1;t++)if(r=a[t],n=a[t+1],o=r.distanceTo(n),(i+=o)>e)return s=(i-e)/o,this._map.layerPointToLatLng([n.x-s*(n.x-r.x),n.y-s*(n.y-r.y)])},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=O(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new P,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return jt(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],o=jt(t),i=0,r=t.length;i<r;i++)o?(e[i]=O(t[i]),this._bounds.extend(e[i])):e[i]=this._convertLatLngs(t[i]);return e},_project:function(){var t=new w;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new m(t,t);this._pxBounds=new w([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)])},_projectLatlngs:function(t,e,o){var i,r,n=t[0]instanceof I,s=t.length;if(n){for(r=[],i=0;i<s;i++)r[i]=this._map.latLngToLayerPoint(t[i]),o.extend(r[i]);e.push(r)}else for(i=0;i<s;i++)this._projectLatlngs(t[i],e,o)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);var e,o,i,r,n,s,a,l=this._parts;for(e=0,i=0,r=this._rings.length;e<r;e++)for(a=this._rings[e],o=0,n=a.length;o<n-1;o++)(s=Bt(a[o],a[o+1],t,o,!0))&&(l[i]=l[i]||[],l[i].push(s[0]),s[1]===a[o+1]&&o!==n-2||(l[i].push(s[1]),i++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,o=0,i=t.length;o<i;o++)t[o]=kt(t[o],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var o,i,r,n,s,a,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(o=0,n=this._parts.length;o<n;o++)for(a=this._parts[o],i=0,s=a.length,r=s-1;i<s;r=i++)if((e||0!==i)&&Rt(t,a[r],a[i])<=l)return!0;return!1}});wi._flat=Gt;var Si=wi.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,o,i,r,n,s,a,l,u=this._rings[0],c=u.length;if(!c)return null;for(n=s=a=0,t=0,e=c-1;t<c;e=t++)o=u[t],i=u[e],r=o.y*i.x-i.y*o.x,s+=(o.x+i.x)*r,a+=(o.y+i.y)*r,n+=3*r;return l=0===n?u[0]:[s/n,a/n],this._map.layerPointToLatLng(l)},_convertLatLngs:function(t){var e=wi.prototype._convertLatLngs.call(this,t),o=e.length;return o>=2&&e[0]instanceof I&&e[0].equals(e[o-1])&&e.pop(),e},_setLatLngs:function(t){wi.prototype._setLatLngs.call(this,t),jt(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return jt(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,o=new m(e,e);if(t=new w(t.min.subtract(o),t.max.add(o)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);for(var i,r=0,n=this._rings.length;r<n;r++)i=Wt(this._rings[r],t,!0),i.length&&this._parts.push(i)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,o,i,r,n,s,a,l,u=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(r=0,a=this._parts.length;r<a;r++)for(e=this._parts[r],n=0,l=e.length,s=l-1;n<l;s=n++)o=e[n],i=e[s],o.y>t.y!=i.y>t.y&&t.x<(i.x-o.x)*(t.y-o.y)/(i.y-o.y)+o.x&&(u=!u);return u||wi.prototype._containsPoint.call(this,t,!0)}}),Pi=pi.extend({initialize:function(t,e){c(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,o,i,r=Ce(t)?t:t.features;if(r){for(e=0,o=r.length;e<o;e++)i=r[e],(i.geometries||i.geometry||i.features||i.coordinates)&&this.addData(i);return this}var n=this.options;if(n.filter&&!n.filter(t))return this;var s=Qt(t,n);return s?(s.feature=re(t),s.defaultOptions=s.options,this.resetStyle(s),n.onEachFeature&&n.onEachFeature(t,s),this.addLayer(s)):this},resetStyle:function(t){return void 0===t?this.eachLayer(this.resetStyle,this):(t.options=e({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){t.setStyle&&("function"==typeof e&&(e=e(t.feature)),t.setStyle(e))}}),bi={toGeoJSON:function(t){return ie(this,{type:"Point",coordinates:ee(this.getLatLng(),t)})}};Ci.include(bi),Ti.include(bi),mi.include(bi),wi.include({toGeoJSON:function(t){var e=!jt(this._latlngs),o=oe(this._latlngs,e?1:0,!1,t);return ie(this,{type:(e?"Multi":"")+"LineString",coordinates:o})}}),Si.include({toGeoJSON:function(t){var e=!jt(this._latlngs),o=e&&!jt(this._latlngs[0]),i=oe(this._latlngs,o?2:e?1:0,!0,t);return e||(i=[i]),ie(this,{type:(o?"Multi":"")+"Polygon",coordinates:i})}}),hi.include({toMultiPoint:function(t){var e=[];return this.eachLayer(function(o){e.push(o.toGeoJSON(t).geometry.coordinates)}),ie(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var o="GeometryCollection"===e,i=[];return this.eachLayer(function(e){if(e.toGeoJSON){var r=e.toGeoJSON(t);if(o)i.push(r.geometry);else{var n=re(r);"FeatureCollection"===n.type?i.push.apply(i,n.features):i.push(n)}}}),o?ie(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}});var Ii=ne,Oi=ci.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,o){this._url=t,this._bounds=b(e),c(this,o)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&($(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Y(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&X(this._image),this},bringToBack:function(){return this._map&&Q(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=b(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:Z("img");if($(e,"leaflet-image-layer"),this._zoomAnimated&&$(e,"leaflet-zoom-animated"),this.options.className&&$(e,this.options.className),e.onselectstart=s,e.onmousemove=s,e.onload=o(this.fire,this,"load"),e.onerror=o(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t)return void(this._url=e.src);e.src=this._url,e.alt=this.options.alt},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),o=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;st(this._image,o,e)},_reset:function(){var t=this._image,e=new w(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),o=e.getSize();at(t,e.min),t.style.width=o.x+"px",t.style.height=o.y+"px"},_updateOpacity:function(){it(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)}}),Mi=function(t,e,o){return new Oi(t,e,o)},Di=Oi.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:Z("video");if($(e,"leaflet-image-layer"),this._zoomAnimated&&$(e,"leaflet-zoom-animated"),this.options.className&&$(e,this.options.className),e.onselectstart=s,e.onmousemove=s,e.onloadeddata=o(this.fire,this,"load"),t){for(var i=e.getElementsByTagName("source"),r=[],n=0;n<i.length;n++)r.push(i[n].src);return void(this._url=i.length>0?r:[e.src])}Ce(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted;for(var a=0;a<this._url.length;a++){var l=Z("source");l.src=this._url[a],e.appendChild(l)}}}),Ei=Oi.extend({_initImage:function(){var t=this._image=this._url;$(t,"leaflet-image-layer"),this._zoomAnimated&&$(t,"leaflet-zoom-animated"),this.options.className&&$(t,this.options.className),t.onselectstart=s,t.onmousemove=s}}),ki=ci.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(t,e){c(this,t),this._source=e},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&it(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&it(this._container,1),this.bringToFront()},onRemove:function(t){t._fadeAnimated?(it(this._container,0),this._removeTimeout=setTimeout(o(Y,void 0,this._container),200)):Y(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=O(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&X(this._container),this},bringToBack:function(){return this._map&&Q(this._container),this},_prepareOpen:function(t,e,o){if(e instanceof ci||(o=e,e=t),e instanceof pi)for(var i in t._layers){e=t._layers[i];break}if(!o)if(e.getCenter)o=e.getCenter();else{if(!e.getLatLng)throw new Error("Unable to get source layer LatLng.");o=e.getLatLng()}return this._source=e,this.update(),o},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=T(this.options.offset),o=this._getAnchor();this._zoomAnimated?at(this._container,t.add(o)):e=e.add(t).add(o);var i=this._containerBottom=-e.y,r=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=i+"px",this._container.style.left=r+"px"}},_getAnchor:function(){return[0,0]}}),Ri=ki.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t.openPopup(this),this},onAdd:function(t){ki.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof vi||this._source.on("preclick",mt))},onRemove:function(t){ki.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof vi||this._source.off("preclick",mt))},getEvents:function(){var t=ki.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t="leaflet-popup",e=this._container=Z("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),o=this._wrapper=Z("div",t+"-content-wrapper",e);if(this._contentNode=Z("div",t+"-content",o),wt(e),Tt(this._contentNode),ft(e,"contextmenu",mt),this._tipContainer=Z("div",t+"-tip-container",e),this._tip=Z("div",t+"-tip",this._tipContainer),this.options.closeButton){var i=this._closeButton=Z("a",t+"-close-button",e);i.href="#close",i.innerHTML="&#215;",ft(i,"click",this._onCloseButtonClick,this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var o=t.offsetWidth;o=Math.min(o,this.options.maxWidth),o=Math.max(o,this.options.minWidth),e.width=o+1+"px",e.whiteSpace="",e.height="";var i=t.offsetHeight,r=this.options.maxHeight;r&&i>r?(e.height=r+"px",$(t,"leaflet-popup-scrolled")):tt(t,"leaflet-popup-scrolled"),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),o=this._getAnchor();at(this._container,e.add(o))},_adjustPan:function(){if(this.options.autoPan){this._map._panAnim&&this._map._panAnim.stop();var t=this._map,e=parseInt(q(this._container,"marginBottom"),10)||0,o=this._container.offsetHeight+e,i=this._containerWidth,r=new m(this._containerLeft,-o-this._containerBottom);r._add(lt(this._container));var n=t.layerPointToContainerPoint(r),s=T(this.options.autoPanPadding),a=T(this.options.autoPanPaddingTopLeft||s),l=T(this.options.autoPanPaddingBottomRight||s),u=t.getSize(),c=0,h=0;n.x+i+l.x>u.x&&(c=n.x+i-u.x+l.x),n.x-c-a.x<0&&(c=n.x-a.x),n.y+o+l.y>u.y&&(h=n.y+o-u.y+l.y),n.y-h-a.y<0&&(h=n.y-a.y),(c||h)&&t.fire("autopanstart").panBy([c,h])}},_onCloseButtonClick:function(t){this._close(),Pt(t)},_getAnchor:function(){return T(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Ai=function(t,e){return new Ri(t,e)};Ho.mergeOptions({closePopupOnClick:!0}),Ho.include({openPopup:function(t,e,o){return t instanceof Ri||(t=new Ri(o).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=t,this.addLayer(t))},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&this.removeLayer(t),this}}),ci.include({bindPopup:function(t,e){return t instanceof Ri?(c(t,e),this._popup=t,t._source=this):(this._popup&&!e||(this._popup=new Ri(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t,e){return this._popup&&this._map&&(e=this._popup._prepareOpen(this,t,e),this._map.openPopup(this._popup,e)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(t){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(t)),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){var e=t.layer||t.target;if(this._popup&&this._map){if(Pt(t),e instanceof vi)return void this.openPopup(t.layer||t.target,t.latlng);this._map.hasLayer(this._popup)&&this._popup._source===e?this.closePopup():this.openPopup(e,t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var Vi=ki.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(t){ki.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(t){ki.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var t=ki.prototype.getEvents.call(this);return so&&!this.options.permanent&&(t.preclick=this._close),t},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Z("div",t)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,o,i=this._map,r=this._container,n=i.latLngToContainerPoint(i.getCenter()),s=i.layerPointToContainerPoint(t),a=this.options.direction,l=r.offsetWidth,u=r.offsetHeight,c=T(this.options.offset),h=this._getAnchor();"top"===a?(e=l/2,o=u):"bottom"===a?(e=l/2,o=0):"center"===a?(e=l/2,o=u/2):"right"===a?(e=0,o=u/2):"left"===a?(e=l,o=u/2):s.x<n.x?(a="right",e=0,o=u/2):(a="left",e=l+2*(c.x+h.x),o=u/2),t=t.subtract(T(e,o,!0)).add(c).add(h),tt(r,"leaflet-tooltip-right"),tt(r,"leaflet-tooltip-left"),tt(r,"leaflet-tooltip-top"),tt(r,"leaflet-tooltip-bottom"),$(r,"leaflet-tooltip-"+a),at(r,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&it(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return T(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Li=function(t,e){return new Vi(t,e)};Ho.include({openTooltip:function(t,e,o){return t instanceof Vi||(t=new Vi(o).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:this.addLayer(t)},closeTooltip:function(t){return t&&this.removeLayer(t),this}}),ci.include({bindTooltip:function(t,e){return t instanceof Vi?(c(t,e),this._tooltip=t,t._source=this):(this._tooltip&&!e||(this._tooltip=new Vi(e,this)),this._tooltip.setContent(t)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",o={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?o.add=this._openTooltip:(o.mouseover=this._openTooltip,o.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(o.mousemove=this._moveTooltip),so&&(o.click=this._openTooltip)),this[e](o),this._tooltipHandlersAdded=!t}},openTooltip:function(t,e){return this._tooltip&&this._map&&(e=this._tooltip._prepareOpen(this,t,e),this._map.openTooltip(this._tooltip,e),this._tooltip.options.interactive&&this._tooltip._container&&($(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(tt(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(t){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(t)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_openTooltip:function(t){var e=t.layer||t.target;this._tooltip&&this._map&&this.openTooltip(e,this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e,o,i=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),o=this._map.containerPointToLayerPoint(e),i=this._map.layerPointToLatLng(o)),this._tooltip.setLatLng(i)}});var Ni=fi.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),o=this.options;if(o.html instanceof Element?(K(e),e.appendChild(o.html)):e.innerHTML=!1!==o.html?o.html:"",o.bgPos){var i=T(o.bgPos);e.style.backgroundPosition=-i.x+"px "+-i.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});fi.Default=yi;var Bi=ci.extend({options:{tileSize:256,opacity:1,updateWhenIdle:eo,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){c(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),Y(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(X(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Q(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=r(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof m?t:new m(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,o=this.getPane().children,i=-t(-1/0,1/0),r=0,n=o.length;r<n;r++)e=o[r].style.zIndex,o[r]!==this._container&&e&&(i=t(i,+e));isFinite(i)&&(this.options.zIndex=i+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Be){it(this._container,this.options.opacity);var t=+new Date,e=!1,o=!1;for(var i in this._tiles){var r=this._tiles[i];if(r.current&&r.loaded){var n=Math.min(1,(t-r.loaded)/200);it(r.el,n),n<1?e=!0:(r.active?o=!0:this._onOpaqueTile(r),r.active=!0)}}o&&!this._noPrune&&this._pruneTiles(),e&&(g(this._fadeFrame),this._fadeFrame=y(this._updateOpacity,this))}},_onOpaqueTile:s,_initContainer:function(){this._container||(this._container=Z("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var o in this._levels)o=Number(o),this._levels[o].el.children.length||o===t?(this._levels[o].el.style.zIndex=e-Math.abs(t-o),this._onUpdateLevel(o)):(Y(this._levels[o].el),this._removeTilesAtZoom(o),this._onRemoveLevel(o),delete this._levels[o]);var i=this._levels[t],r=this._map;return i||(i=this._levels[t]={},i.el=Z("div","leaflet-tile-container leaflet-zoom-animated",this._container),i.el.style.zIndex=e,i.origin=r.project(r.unproject(r.getPixelOrigin()),t).round(),i.zoom=t,this._setZoomTransform(i,r.getCenter(),r.getZoom()),i.el.offsetWidth,this._onCreateLevel(i)),this._level=i,i}},_onUpdateLevel:s,_onRemoveLevel:s,_onCreateLevel:s,_pruneTiles:function(){if(this._map){var t,e,o=this._map.getZoom();if(o>this.options.maxZoom||o<this.options.minZoom)return void this._removeAllTiles();for(t in this._tiles)e=this._tiles[t],e.retain=e.current;for(t in this._tiles)if(e=this._tiles[t],e.current&&!e.active){var i=e.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)Y(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,o,i){var r=Math.floor(t/2),n=Math.floor(e/2),s=o-1,a=new m(+r,+n);a.z=+s;var l=this._tileCoordsToKey(a),u=this._tiles[l];return u&&u.active?(u.retain=!0,!0):(u&&u.loaded&&(u.retain=!0),s>i&&this._retainParent(r,n,s,i))},_retainChildren:function(t,e,o,i){for(var r=2*t;r<2*t+2;r++)for(var n=2*e;n<2*e+2;n++){var s=new m(r,n);s.z=o+1;var a=this._tileCoordsToKey(s),l=this._tiles[a];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),o+1<i&&this._retainChildren(r,n,o+1,i))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,o,i){var r=Math.round(e);r=void 0!==this.options.maxZoom&&r>this.options.maxZoom||void 0!==this.options.minZoom&&r<this.options.minZoom?void 0:this._clampZoom(r);var n=this.options.updateWhenZooming&&r!==this._tileZoom;i&&!n||(this._tileZoom=r,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==r&&this._update(t),o||this._pruneTiles(),this._noPrune=!!o),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var o in this._levels)this._setZoomTransform(this._levels[o],t,e)},_setZoomTransform:function(t,e,o){var i=this._map.getZoomScale(o,t.zoom),r=t.origin.multiplyBy(i).subtract(this._map._getNewPixelOrigin(e,o)).round();to?st(t.el,r,i):at(t.el,r)},_resetGrid:function(){var t=this._map,e=t.options.crs,o=this._tileSize=this.getTileSize(),i=this._tileZoom,r=this._map.getPixelWorldBounds(this._tileZoom);r&&(this._globalTileRange=this._pxBoundsToTileRange(r)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],i).x/o.x),Math.ceil(t.project([0,e.wrapLng[1]],i).x/o.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],i).y/o.x),Math.ceil(t.project([e.wrapLat[1],0],i).y/o.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,o=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),i=e.getZoomScale(o,this._tileZoom),r=e.project(t,this._tileZoom).floor(),n=e.getSize().divideBy(2*i);return new w(r.subtract(n),r.add(n))},_update:function(t){var e=this._map;if(e){var o=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var i=this._getTiledPixelBounds(t),r=this._pxBoundsToTileRange(i),n=r.getCenter(),s=[],a=this.options.keepBuffer,l=new w(r.getBottomLeft().subtract([a,-a]),r.getTopRight().add([a,-a]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var u in this._tiles){var c=this._tiles[u].coords;c.z===this._tileZoom&&l.contains(new m(c.x,c.y))||(this._tiles[u].current=!1)}if(Math.abs(o-this._tileZoom)>1)return void this._setView(t,o);for(var h=r.min.y;h<=r.max.y;h++)for(var d=r.min.x;d<=r.max.x;d++){var p=new m(d,h);if(p.z=this._tileZoom,this._isValidTile(p)){var _=this._tiles[this._tileCoordsToKey(p)];_?_.current=!0:s.push(p)}}if(s.sort(function(t,e){return t.distanceTo(n)-e.distanceTo(n)}),0!==s.length){this._loading||(this._loading=!0,this.fire("loading"));var f=document.createDocumentFragment();for(d=0;d<s.length;d++)this._addTile(s[d],f);this._level.el.appendChild(f)}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var o=this._globalTileRange;if(!e.wrapLng&&(t.x<o.min.x||t.x>o.max.x)||!e.wrapLat&&(t.y<o.min.y||t.y>o.max.y))return!1}if(!this.options.bounds)return!0;var i=this._tileCoordsToBounds(t);return b(this.options.bounds).overlaps(i)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,o=this.getTileSize(),i=t.scaleBy(o),r=i.add(o);return[e.unproject(i,t.z),e.unproject(r,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),o=new P(e[0],e[1]);return this.options.noWrap||(o=this._map.wrapLatLngBounds(o)),o},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),o=new m(+e[0],+e[1]);return o.z=+e[2],o},_removeTile:function(t){var e=this._tiles[t];e&&(Y(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){$(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=s,t.onmousemove=s,Be&&this.options.opacity<1&&it(t,this.options.opacity),Fe&&!Ue&&(t.style.WebkitBackfaceVisibility="hidden")},_addTile:function(t,e){var i=this._getTilePos(t),r=this._tileCoordsToKey(t),n=this.createTile(this._wrapCoords(t),o(this._tileReady,this,t));this._initTile(n),this.createTile.length<2&&y(o(this._tileReady,this,t,null,n)),at(n,i),this._tiles[r]={el:n,coords:t,current:!0},e.appendChild(n),this.fire("tileloadstart",{tile:n,coords:t})},_tileReady:function(t,e,i){e&&this.fire("tileerror",{error:e,tile:i,coords:t});var r=this._tileCoordsToKey(t);(i=this._tiles[r])&&(i.loaded=+new Date,this._map._fadeAnimated?(it(i.el,0),g(this._fadeFrame),this._fadeFrame=y(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),e||($(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Be||!this._map._fadeAnimated?y(this._pruneTiles,this):setTimeout(o(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new m(this._wrapX?n(t.x,this._wrapX):t.x,this._wrapY?n(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new w(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),Hi=Bi.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(t,e){this._url=t,e=c(this,e),e.detectRetina&&uo&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom++):(e.zoomOffset++,e.maxZoom--),e.minZoom=Math.max(0,e.minZoom)),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),Fe||this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var i=document.createElement("img");return ft(i,"load",o(this._tileOnLoad,this,e,i)),ft(i,"error",o(this._tileOnError,this,e,i)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i.alt="",i.setAttribute("role","presentation"),i.src=this.getTileUrl(t),i},getTileUrl:function(t){var o={r:uo?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&&(o.y=i),o["-y"]=i}return d(this._url,e(o,this.options))},_tileOnLoad:function(t,e){Be?setTimeout(o(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,o){var i=this.options.errorTileUrl;i&&e.getAttribute("src")!==i&&(e.src=i),t(o,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom,o=this.options.zoomReverse,i=this.options.zoomOffset;return o&&(t=e-t),t+i},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&(e=this._tiles[t].el,e.onload=s,e.onerror=s,e.complete||(e.src=ve,Y(e),delete this._tiles[t]))},_removeTile:function(t){var e=this._tiles[t];if(e)return Ge||e.el.setAttribute("src",ve),Bi.prototype._removeTile.call(this,t)},_tileReady:function(t,e,o){if(this._map&&(!o||o.getAttribute("src")!==ve))return Bi.prototype._tileReady.call(this,t,e,o)}}),xi=Hi.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,o){this._url=t;var i=e({},this.defaultWmsParams);for(var r in o)r in this.options||(i[r]=o[r]);o=c(this,o);var n=o.detectRetina&&uo?2:1,s=this.getTileSize();i.width=s.x*n,i.height=s.y*n,this.wmsParams=i},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,Hi.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),o=this._crs,i=S(o.project(e[0]),o.project(e[1])),r=i.min,n=i.max,s=(this._wmsVersion>=1.3&&this._crs===li?[r.y,r.x,n.y,n.x]:[r.x,r.y,n.x,n.y]).join(","),a=Hi.prototype.getTileUrl.call(this,t);return a+h(this.wmsParams,a,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+s},setParams:function(t,o){return e(this.wmsParams,t),o||this.redraw(),this}});Hi.WMS=xi,ce.wms=he;var Fi=ci.extend({options:{padding:.1,tolerance:0},initialize:function(t){c(this,t),i(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&$(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var o=this._map.getZoomScale(e,this._zoom),i=lt(this._container),r=this._map.getSize().multiplyBy(.5+this.options.padding),n=this._map.project(this._center,e),s=this._map.project(t,e),a=s.subtract(n),l=r.multiplyBy(-o).add(i).add(r).subtract(a);to?st(this._container,l,o):at(this._container,l)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),o=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new w(o,o.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Ui=Fi.extend({getEvents:function(){var t=Fi.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Fi.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");ft(t,"mousemove",this._onMouseMove,this),ft(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ft(t,"mouseout",this._handleMouseOut,this),this._ctx=t.getContext("2d")},_destroyContainer:function(){g(this._redrawRequest),delete this._ctx,Y(this._container),yt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var t;this._redrawBounds=null;for(var e in this._layers)t=this._layers[e],t._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){Fi.prototype._update.call(this);var t=this._bounds,e=this._container,o=t.getSize(),i=uo?2:1;at(e,t.min),e.width=i*o.x,e.height=i*o.y,e.style.width=o.x+"px",e.style.height=o.y+"px",uo&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){Fi.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[i(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,o=e.next,r=e.prev;o?o.prev=r:this._drawLast=r,r?r.next=o:this._drawFirst=o,delete t._order,delete this._layers[i(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,o,i=t.options.dashArray.split(/[, ]+/),r=[];for(o=0;o<i.length;o++){if(e=Number(i[o]),isNaN(e))return;r.push(e)}t.options._dashArray=r}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||y(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new w,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var o=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,o.x,o.y),this._ctx.clip()}this._drawing=!0;for(var i=this._drawFirst;i;i=i.next)t=i.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var o,i,r,n,s=t._parts,a=s.length,l=this._ctx;if(a){for(l.beginPath(),o=0;o<a;o++){for(i=0,r=s[o].length;i<r;i++)n=s[o][i],l[i?"lineTo":"moveTo"](n.x,n.y);e&&l.closePath()}this._fillStroke(l,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,o=this._ctx,i=Math.max(Math.round(t._radius),1),r=(Math.max(Math.round(t._radiusY),1)||i)/i;1!==r&&(o.save(),o.scale(1,r)),o.beginPath(),o.arc(e.x,e.y/r,i,0,2*Math.PI,!1),1!==r&&o.restore(),this._fillStroke(o,t)}},_fillStroke:function(t,e){var o=e.options;o.fill&&(t.globalAlpha=o.fillOpacity,t.fillStyle=o.fillColor||o.color,t.fill(o.fillRule||"evenodd")),o.stroke&&0!==o.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=o.opacity,t.lineWidth=o.weight,t.strokeStyle=o.color,t.lineCap=o.lineCap,t.lineJoin=o.lineJoin,t.stroke())},_onClick:function(t){for(var e,o,i=this._map.mouseEventToLayerPoint(t),r=this._drawFirst;r;r=r.next)e=r.layer,e.options.interactive&&e._containsPoint(i)&&("click"!==t.type&&"preclick"===t.type||!this._map._draggableMoved(e))&&(o=e);o&&(Ot(t),this._fireEvent([o],t))},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(tt(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var i,r,n=this._drawFirst;n;n=n.next)i=n.layer,i.options.interactive&&i._containsPoint(e)&&(r=i);r!==this._hoveredLayer&&(this._handleMouseOut(t),r&&($(this._container,"leaflet-interactive"),this._fireEvent([r],t,"mouseover"),this._hoveredLayer=r)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t),this._mouseHoverThrottled=!0,setTimeout(o(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,e,o){this._map._fireDOMEvent(e,o||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var o=e.next,i=e.prev;o&&(o.prev=i,i?i.next=o:o&&(this._drawFirst=o),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))}},_bringToBack:function(t){var e=t._order;if(e){var o=e.next,i=e.prev;i&&(i.next=o,o?o.prev=i:i&&(this._drawLast=i),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}}),ji=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),Gi={_initContainer:function(){this._container=Z("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Fi.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=ji("shape");$(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=ji("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[i(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;Y(e),t.removeInteractiveTarget(e),delete this._layers[i(t)]},_updateStyle:function(t){var e=t._stroke,o=t._fill,i=t.options,r=t._container;r.stroked=!!i.stroke,r.filled=!!i.fill,i.stroke?(e||(e=t._stroke=ji("stroke")),r.appendChild(e),e.weight=i.weight+"px",e.color=i.color,e.opacity=i.opacity,i.dashArray?e.dashStyle=Ce(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=i.lineCap.replace("butt","flat"),e.joinstyle=i.lineJoin):e&&(r.removeChild(e),t._stroke=null),i.fill?(o||(o=t._fill=ji("fill")),r.appendChild(o),o.color=i.fillColor||i.color,o.opacity=i.fillOpacity):o&&(r.removeChild(o),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),o=Math.round(t._radius),i=Math.round(t._radiusY||o);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+o+","+i+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){X(t._container)},_bringToBack:function(t){Q(t._container)}},Wi=_o?ji:E,zi=Fi.extend({getEvents:function(){var t=Fi.prototype.getEvents.call(this);return t.zoomstart=this._onZoomStart,t},_initContainer:function(){this._container=Wi("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Wi("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Y(this._container),yt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){Fi.prototype._update.call(this);var t=this._bounds,e=t.getSize(),o=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,o.setAttribute("width",e.x),o.setAttribute("height",e.y)),at(o,t.min),o.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=Wi("path");t.options.className&&$(e,t.options.className),t.options.interactive&&$(e,"leaflet-interactive"),this._updateStyle(t),this._layers[i(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){Y(t._path),t.removeInteractiveTarget(t._path),delete this._layers[i(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,o=t.options;e&&(o.stroke?(e.setAttribute("stroke",o.color),e.setAttribute("stroke-opacity",o.opacity),e.setAttribute("stroke-width",o.weight),e.setAttribute("stroke-linecap",o.lineCap),e.setAttribute("stroke-linejoin",o.lineJoin),o.dashArray?e.setAttribute("stroke-dasharray",o.dashArray):e.removeAttribute("stroke-dasharray"),o.dashOffset?e.setAttribute("stroke-dashoffset",o.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),o.fill?(e.setAttribute("fill",o.fillColor||o.color),e.setAttribute("fill-opacity",o.fillOpacity),e.setAttribute("fill-rule",o.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,k(t._parts,e))},_updateCircle:function(t){var e=t._point,o=Math.max(Math.round(t._radius),1),i=Math.max(Math.round(t._radiusY),1)||o,r="a"+o+","+i+" 0 1,0 ",n=t._empty()?"M0 0":"M"+(e.x-o)+","+e.y+r+2*o+",0 "+r+2*-o+",0 ";this._setPath(t,n)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){X(t._path)},_bringToBack:function(t){Q(t._path)}});_o&&zi.include(Gi),Ho.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&de(t)||pe(t)}});var qi=Si.extend({initialize:function(t,e){Si.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=b(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});zi.create=Wi,zi.pointsToPath=k,Pi.geometryToLayer=Qt,Pi.coordsToLatLng=$t,Pi.coordsToLatLngs=te,Pi.latLngToCoords=ee,Pi.latLngsToCoords=oe,Pi.getFeature=ie,Pi.asFeature=re,Ho.mergeOptions({boxZoom:!0});var Zi=Ko.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){ft(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){yt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Y(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),Ee(),ut(),this._startPoint=this._map.mouseEventToContainerPoint(t),ft(document,{contextmenu:Pt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=Z("div","leaflet-zoom-box",this._container),$(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new w(this._point,this._startPoint),o=e.getSize();at(this._box,e.min),this._box.style.width=o.x+"px",this._box.style.height=o.y+"px"},_finish:function(){this._moved&&(Y(this._box),tt(this._container,"leaflet-crosshair")),ke(),ct(),yt(document,{contextmenu:Pt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(o(this._resetState,this),0);var e=new P(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}});Ho.addInitHook("addHandler","boxZoom",Zi),Ho.mergeOptions({doubleClickZoom:!0});var Yi=Ko.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,o=e.getZoom(),i=e.options.zoomDelta,r=t.originalEvent.shiftKey?o-i:o+i;"center"===e.options.doubleClickZoom?e.setZoom(r):e.setZoomAround(t.containerPoint,r)}});Ho.addInitHook("addHandler","doubleClickZoom",Yi),Ho.mergeOptions({dragging:!0,inertia:!Ue,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Ki=Ko.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new ei(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}$(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){tt(this._map._container,"leaflet-grab"),tt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=b(this._map.options.maxBounds);this._offsetLimit=S(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,o=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(o),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),o=this._initialWorldOffset,i=this._draggable._newPos.x,r=(i-e+o)%t+e-o,n=(i+e+o)%t-e-o,s=Math.abs(r+o)<Math.abs(n+o)?r:n;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=s},_onDragEnd:function(t){var e=this._map,o=e.options,i=!o.inertia||this._times.length<2;if(e.fire("dragend",t),i)e.fire("moveend");else{this._prunePositions(+new Date);var r=this._lastPos.subtract(this._positions[0]),n=(this._lastTime-this._times[0])/1e3,s=o.easeLinearity,a=r.multiplyBy(s/n),l=a.distanceTo([0,0]),u=Math.min(o.inertiaMaxSpeed,l),c=a.multiplyBy(u/l),h=u/(o.inertiaDeceleration*s),d=c.multiplyBy(-h/2).round();d.x||d.y?(d=e._limitOffset(d,e.options.maxBounds),y(function(){e.panBy(d,{duration:h,easeLinearity:s,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}});Ho.addInitHook("addHandler","dragging",Ki),Ho.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Xi=Ko.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),ft(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),yt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,o=t.scrollTop||e.scrollTop,i=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(i,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,o,i=this._panKeys={},r=this.keyCodes;for(e=0,o=r.left.length;e<o;e++)i[r.left[e]]=[-1*t,0];for(e=0,o=r.right.length;e<o;e++)i[r.right[e]]=[t,0];for(e=0,o=r.down.length;e<o;e++)i[r.down[e]]=[0,t];for(e=0,o=r.up.length;e<o;e++)i[r.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,o,i=this._zoomKeys={},r=this.keyCodes;for(e=0,o=r.zoomIn.length;e<o;e++)i[r.zoomIn[e]]=t;for(e=0,o=r.zoomOut.length;e<o;e++)i[r.zoomOut[e]]=-t},_addHooks:function(){ft(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){yt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,o=t.keyCode,i=this._map;if(o in this._panKeys)i._panAnim&&i._panAnim._inProgress||(e=this._panKeys[o],t.shiftKey&&(e=T(e).multiplyBy(3)),i.panBy(e),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds));else if(o in this._zoomKeys)i.setZoom(i.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[o]);else{if(27!==o||!i._popup||!i._popup.options.closeOnEscapeKey)return;i.closePopup()}Pt(t)}}});Ho.addInitHook("addHandler","keyboard",Xi),Ho.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Qi=Ko.extend({addHooks:function(){ft(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){yt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=It(t),i=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var r=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o(this._performZoom,this),r),Pt(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),o=this._map.options.zoomSnap||0;t._stop();var i=this._delta/(4*this._map.options.wheelPxPerZoomLevel),r=4*Math.log(2/(1+Math.exp(-Math.abs(i))))/Math.LN2,n=o?Math.ceil(r/o)*o:r,s=t._limitZoom(e+(this._delta>0?n:-n))-e;this._delta=0,this._startTime=null,s&&("center"===t.options.scrollWheelZoom?t.setZoom(e+s):t.setZoomAround(this._lastMousePos,e+s))}});Ho.addInitHook("addHandler","scrollWheelZoom",Qi),Ho.mergeOptions({tap:!0,tapTolerance:15});var Ji=Ko.extend({addHooks:function(){ft(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){yt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(St(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var e=t.touches[0],i=e.target;this._startPos=this._newPos=new m(e.clientX,e.clientY),i.tagName&&"a"===i.tagName.toLowerCase()&&$(i,"leaflet-active"),this._holdTimeout=setTimeout(o(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",e))},this),1e3),this._simulateEvent("mousedown",e),ft(document,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),yt(document,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&t&&t.changedTouches){var e=t.changedTouches[0],o=e.target;o&&o.tagName&&"a"===o.tagName.toLowerCase()&&tt(o,"leaflet-active"),this._simulateEvent("mouseup",e),this._isTapValid()&&this._simulateEvent("click",e)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new m(e.clientX,e.clientY),this._simulateEvent("mousemove",e)},_simulateEvent:function(t,e){var o=document.createEvent("MouseEvents");o._simulated=!0,e.target._simulatedClick=!0,o.initMouseEvent(t,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(o)}});!so||no&&!Ze||Ho.addInitHook("addHandler","tap",Ji),Ho.mergeOptions({touchZoom:so&&!Ue,bounceAtZoomLimits:!0});var $i=Ko.extend({addHooks:function(){$(this._map._container,"leaflet-touch-zoom"),ft(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){tt(this._map._container,"leaflet-touch-zoom"),yt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var o=e.mouseEventToContainerPoint(t.touches[0]),i=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(o.add(i)._divideBy(2))),this._startDist=o.distanceTo(i),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),ft(document,"touchmove",this._onTouchMove,this),ft(document,"touchend",this._onTouchEnd,this),St(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,i=e.mouseEventToContainerPoint(t.touches[0]),r=e.mouseEventToContainerPoint(t.touches[1]),n=i.distanceTo(r)/this._startDist;if(this._zoom=e.getScaleZoom(n,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&n<1||this._zoom>e.getMaxZoom()&&n>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===n)return}else{var s=i._add(r)._divideBy(2)._subtract(this._centerPoint);if(1===n&&0===s.x&&0===s.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(s),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),g(this._animRequest);var a=o(e._move,e,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=y(a,this,!0),St(t)}},_onTouchEnd:function(){if(!this._moved||!this._zooming)return void(this._zooming=!1);this._zooming=!1,g(this._animRequest),yt(document,"touchmove",this._onTouchMove,this),yt(document,"touchend",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Ho.addInitHook("addHandler","touchZoom",$i),Ho.BoxZoom=Zi,Ho.DoubleClickZoom=Yi,Ho.Drag=Ki,Ho.Keyboard=Xi,Ho.ScrollWheelZoom=Qi,Ho.Tap=Ji,Ho.TouchZoom=$i,t.version="1.7.1",t.Control=xo,t.control=Fo,t.Browser=fo,t.Evented=be,t.Mixin=Qo,t.Util=Se,t.Class=C,t.Handler=Ko,t.extend=e,t.bind=o,t.stamp=i,t.setOptions=c,t.DomEvent=No,t.DomUtil=ko,t.PosAnimation=Bo,t.Draggable=ei,t.LineUtil=oi,t.PolyUtil=ii,t.Point=m,t.point=T,t.Bounds=w,t.bounds=S,t.Transformation=M,t.transformation=D,t.Projection=si,t.LatLng=I,t.latLng=O,t.LatLngBounds=P,t.latLngBounds=b,t.CRS=Oe,t.GeoJSON=Pi,t.geoJSON=ne,t.geoJson=Ii,t.Layer=ci,t.LayerGroup=hi,t.layerGroup=di,t.FeatureGroup=pi,t.featureGroup=_i,t.ImageOverlay=Oi,t.imageOverlay=Mi,t.VideoOverlay=Di,t.videoOverlay=se,t.SVGOverlay=Ei,t.svgOverlay=ae,t.DivOverlay=ki,t.Popup=Ri,t.popup=Ai,t.Tooltip=Vi,t.tooltip=Li,t.Icon=fi,t.icon=zt,t.DivIcon=Ni,t.divIcon=le,t.Marker=Ci,t.marker=qt,t.TileLayer=Hi,t.tileLayer=ce,t.GridLayer=Bi,t.gridLayer=ue,t.SVG=zi,t.svg=pe,t.Renderer=Fi,t.Canvas=Ui,t.canvas=de,t.Path=vi,t.CircleMarker=mi,t.circleMarker=Zt,t.Circle=Ti,t.circle=Yt,t.Polyline=wi,t.polyline=Kt,t.Polygon=Si,t.polygon=Xt,t.Rectangle=qi,t.rectangle=_e,t.Map=Ho,t.map=Et;var tr=window.L;t.noConflict=function(){return window.L=tr,this},window.L=t})},,,,,,function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.TV_HOT_OFFER_SHARE=e.TV_HOT_OFFER_LIKE=e.TV_HOT_OFFER_ERROR=e.TV_HOT_OFFER_LIST_TYPE=e.TV_HOT_OFFER_SOLD=e.TV_EDIT_MODE=e.TV_DELETE_BTN_HINT=e.TV_CREATE_BTN_HINT=e.TV_COPY_BTN_HINT=e.TV_OFFER_DELETE_CONFIRM=e.TV_OFFER_SHOW_DETAIL_BTN=e.TV_CANCEL_BTN=e.TV_SAVE_BTN=e.TV_DELETE_BTN=e.TV_CREATE_BTN=e.TV_COPY_BTN=e.TV_PRICE_BTN=e.TV_MENU_BTN=e.TV_OFFER_EDIT_BUTTONS=e.TV_OFFER_ACTION_BUTTONS=void 0,e.TV_OFFER_ACTION_BUTTONS="TVHotOfferActionButtons",e.TV_OFFER_EDIT_BUTTONS="TVHotOfferEditButtons",e.TV_MENU_BTN="TVHotOfferMenuButton",e.TV_PRICE_BTN="TVHotOfferPriceButton",e.TV_COPY_BTN="TVHotOfferCopy",e.TV_CREATE_BTN="TVHotOfferCreate",e.TV_DELETE_BTN="TVHotOfferDelete",e.TV_SAVE_BTN="TVHotOfferSaveButton",e.TV_CANCEL_BTN="TVHotOfferCancelButton",e.TV_OFFER_SHOW_DETAIL_BTN="TVHotOfferShowDetailButton",e.TV_OFFER_DELETE_CONFIRM="TVHotOfferDeleteConfirm",e.TV_COPY_BTN_HINT="TVHotOfferCopyHint",e.TV_CREATE_BTN_HINT="TVHotOfferCreateHint",e.TV_DELETE_BTN_HINT="TVHotOfferDeleteHint",e.TV_EDIT_MODE="TVEditMode",e.TV_HOT_OFFER_SOLD="TVHotOfferSold",e.TV_HOT_OFFER_LIST_TYPE="TVHotOfferList",e.TV_HOT_OFFER_ERROR="TVHotOfferError",e.TV_HOT_OFFER_LIKE="TVHotOfferLike",e.TV_HOT_OFFER_SHARE="TVHotOfferShare",t.TV_HOT_OFFER_SHARE=e.TV_HOT_OFFER_SHARE,t.TV_HOT_OFFER_LIKE=e.TV_HOT_OFFER_LIKE,t.TV_HOT_OFFER_ERROR=e.TV_HOT_OFFER_ERROR,t.TV_HOT_OFFER_LIST_TYPE=e.TV_HOT_OFFER_LIST_TYPE,t.TV_HOT_OFFER_SOLD=e.TV_HOT_OFFER_SOLD,t.TV_EDIT_MODE=e.TV_EDIT_MODE,t.TV_DELETE_BTN_HINT=e.TV_DELETE_BTN_HINT,t.TV_CREATE_BTN_HINT=e.TV_CREATE_BTN_HINT,t.TV_COPY_BTN_HINT=e.TV_COPY_BTN_HINT,t.TV_OFFER_DELETE_CONFIRM=e.TV_OFFER_DELETE_CONFIRM,t.TV_OFFER_SHOW_DETAIL_BTN=e.TV_OFFER_SHOW_DETAIL_BTN,t.TV_CANCEL_BTN=e.TV_CANCEL_BTN,t.TV_SAVE_BTN=e.TV_SAVE_BTN,t.TV_DELETE_BTN=e.TV_DELETE_BTN,t.TV_CREATE_BTN=e.TV_CREATE_BTN,t.TV_COPY_BTN=e.TV_COPY_BTN,t.TV_PRICE_BTN=e.TV_PRICE_BTN,t.TV_MENU_BTN=e.TV_MENU_BTN,t.TV_OFFER_EDIT_BUTTONS=e.TV_OFFER_EDIT_BUTTONS,t.TV_OFFER_ACTION_BUTTONS=e.TV_OFFER_ACTION_BUTTONS}).call(e,o(0))},,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.cartUtils=e.CartUtils=void 0;var i=o(1),r=o(5),n=o(6),s=o(13),a=o(211),l=o(273),u=function(){function t(){}return t.prototype.getCartCollectionItem=function(t){return{Client:t.client||"",Id:t.id,SearchInfo:t.info,SendInfo:t.sendlog||"",Time:t.carttime.split(":").splice(0,2).join(":"),ViewCount:t.viewcount||0}},t.prototype.getCartCollectionDate=function(t){var e=s.FormatDate.strToDate(t);return s.FormatDate.getFormatDate(e,"DD MMMM").toLowerCase()},t.prototype.getSortedCartList=function(t){return((0,i.getProperty)(t,"cartlist")||[]).sort(function(t,e){var o=s.FormatDate.strToDate(t.cartdate),i=s.FormatDate.strToDate(e.cartdate);return o>i?-1:o<i?1:0})},t.prototype.getCountryGroupedData=function(e){var o=this;return this._getUniqueKeysFromArray(e,t.COUNTRY_CODE_KEY).map(function(t){var r=e.find(function(e){return e.countrycode===t}),s=(0,n.parseCurrency)(r.currency),a=e.filter(function(e){return e.countrycode===t&&1!==(0,i.getProperty)(e,"notour")}).map(function(t){return t.currency===r.currency?t.price:0});return{Code:t,Currency:s,HotelsData:o._convertToHotelsByCountry(e,t),Name:r.countryname,Price:Math.min.apply(null,a)}}).sort(function(t,e){return t.Price-e.Price})},t.prototype.convertToursForCart=function(t){var e=function(t,e){return parseInt(t.Price,10)-parseInt(e.Price,10)};return t.map(function(t){return{Adults:t.adults,Child:t.child,Comment:t.comment,Country:t.countryname,Currency:(0,n.parseCurrency)(t.currency),DepartureId:Number(t.departurecode),DepartureNameFrom:t.departurenamefrom,FlyDate:t.flydate,HotelName:t.hotelname,Meal:t.mealfull,Nights:t.nights,NoTour:t.notour||!1,OperatorId:t.operatorcode,OperatorLink:t.operatorlink,Price:t.price,PriceOld:t.priceold,Recommend:Boolean(t.recommend),Room:t.room,RoomInfo:t.roominfo||0,RoomServiceType:Boolean(t.crafttourid)?a.RoomServiceTypeEnum.CRAFT:a.RoomServiceTypeEnum.COMMON,ShortId:t.shortid,ShortLink:t.shortlink,Stars:t.hotelstars,TourId:t.tourid,ViewCount:t.viewcount}}).sort(e)},t.prototype.getUpdateCustomerData=function(t){return{comment:{text:t.Comment},customer:{email:t.Email,fullName:t.Name,telephone:t.Phone}}},t.prototype.getDateNight=function(t,e){return s.FormatDate.getFormatDate(s.FormatDate.strToDate(t),"DD MMM")+" / "+e},t.prototype.getCustomerContent=function(t){if(!t)return"";var e=t.email;return[t.name,t.phone,e].filter(function(t){return t}).join(", ")},t.prototype.getCabinetManager=function(t){return(0,i.getProperty)(t,"manager")},t.prototype.getCartManagerId=function(t){return(0,i.getProperty)(t,"manager.id")},t.prototype.getCartMenuEnabledSettins=function(t){return{SaveLoad:!!(0,i.getProperty)(t,"saveload"),SendEmail:!!(0,i.getProperty)(t,"sendemail"),SendSms:!!(0,i.getProperty)(t,"sendsms")}},t.prototype.getCreatorInfo=function(t){if(!t)return{IsVisible:!1};var e=t.photo,o=t.logo,i=t.contacts,r=t.name;return{IsVisible:!!(e||r||i||o),Logo:o||"",Name:r||"",Photo:e||"",Text:i||""}},t.prototype.getMailData=function(t){return(0,i.getProperty)(t,"data.info.mail")},t.prototype.getSmsData=function(t){return(0,i.getProperty)(t,"data.info.sms")},t.prototype.getPrintInfo=function(t){return(0,i.getProperty)(t,"data.info.print")},t.prototype.getCartListFullData=function(t){return(0,i.getProperty)(t,"data.info.cartlistfull")||[]},t.prototype.getLMData=function(t){return{LMLink:this.getLMLink((0,i.getProperty)(t,"data")),LeadID:(0,i.getProperty)(t,"data.lead_id"),Success:(0,i.getProperty)(t,"data.success")}},t.prototype.getLMLink=function(t){return(0,i.getProperty)(t,"leadmanagerlink")},t.prototype.getNewCartConfirmSettings=function(t){var e=(0,n.removeSearchParams)((0,n.getDomainURLForLink)()),o=e+"#"+r.Hash.Cartid+"="+t;return{ContentHtml:l.controlUtils.getHTMLByTemplate("cart-new-confirm",{Link:{href:o,text:o}}).outerHTML||""}},t.prototype.getAddTourRequestParams=function(t){void 0===t&&(t={});var e=t.Currency,o=t.Price,r={};return(0,i.isDefined)(e)&&(r.currency=e),(0,i.isDefined)(o)&&(r.price=o),r},t.prototype.isSuccesResult=function(t){var e;return 1===parseInt(null===(e=null===t||void 0===t?void 0:t.data)||void 0===e?void 0:e.success,10)},t.prototype.getDepartureNameFrom=function(t){return"из "+t},t.prototype._convertToHotelsByCountry=function(e,o){var i=this,r=function(t,e){var o=function(t){return Math.min.apply(Math,t.Tours.map(function(t){return parseInt(t.Price,10)}))};return o(t)-o(e)},n=this._filterValuesByKey(e,t.COUNTRY_CODE_KEY,o);return this._getUniqueKeysFromArray(n,t.HOTEL_CODE_KEY).map(function(o){var r=e.find(function(t){return t.hotelcode===o}),s=r.crafttourid,a=r.hotelpicturemedium,l=r.hoteldescoriginal,u=r.hotelactype,c=r.hotelactypename,h=r.hotelstars,d=r.hotelregionname,p=r.hotelsubregionname,_=r.hotelname,f=r.hotelrating,y=r.hotelfoto,g=r.seadistance,C=i._filterValuesByKey(n,t.HOTEL_CODE_KEY,o),v=s||0,m=Boolean(y)||Boolean(s);return{Accomodation:parseInt(u,10),AccomodationName:c,CraftTourId:v,Description:l,Foto:m,Id:o,Name:_,Picture:a,Rating:f,Region:d,SeaDistance:g,Stars:parseInt(h,10),SubRegion:p,Tours:i.convertToursForCart(C)}}).sort(r)},t.prototype._filterValuesByKey=function(t,e,o){return t.filter(function(t){return t[e]&&t[e]===o})||[]},t.prototype._getUniqueKeysFromArray=function(t,e){if(Array.isArray(t)&&t.length&&t.filter(function(t){return(0,i.isDefined)(t[e])}).length===t.length){var o=t.map(function(t){return t[e]});return o.filter(function(t,e){return o.indexOf(t)===e})}return[]},t.COUNTRY_CODE_KEY="countrycode",t.HOTEL_CODE_KEY="hotelcode",t}();e.CartUtils=u,e.cartUtils=new u,t.cartUtils=e.cartUtils,t.CartUtils=u}).call(e,o(0))},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){o.d(e,"smoothScroll",function(){return r}),o.d(e,"animateScroll",function(){return n});var i=o(1),r=(o.n(i),function(){if(this&&this.__h)return this.__h;var t,e={},o=!!document.querySelector&&!!window.addEventListener,r=window,n={speed:500,easing:"easeInOutCubic",offset:0,updateURL:!0,callbackBefore:function(){},callbackAfter:function(){}},s=function(t,e,o){if("[object Object]"===Object.prototype.toString.call(t))for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(o,t[i],i,t);else for(var r=0,n=t.length;r<n;r++)e.call(o,t[r],r,t)},a=function(t,e){var o={};return s(t,function(e,i){o[i]=t[i]}),s(e,function(t,i){o[i]=e[i]}),o},l=function(t,e){for(var o=e.charAt(0);t&&t!==document;t=t.parentNode)if("."===o){if(Object(i.hasClass)(t,e.substr(1)))return t}else if("#"===o){if(t.id===e.substr(1))return t}else if("["===o&&t.hasAttribute(e.substr(1,e.length-2)))return t;return!1},u=function(t){for(var e,o=String(t),i=o.length,r=-1,n="",s=o.charCodeAt(0);++r<i;){if(0===(e=o.charCodeAt(r)))throw new InvalidCharacterError("Invalid character: the input contains U+0000.");e>=1&&e<=31||127==e||0===r&&e>=48&&e<=57||1===r&&e>=48&&e<=57&&45===s?n+="\\"+e.toString(16)+" ":n+=e>=128||45===e||95===e||e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122?o.charAt(r):"\\"+o.charAt(r)}return n},c=function(t,e){var o;return"easeInQuad"===t&&(o=e*e),"easeOutQuad"===t&&(o=e*(2-e)),"easeInOutQuad"===t&&(o=e<.5?2*e*e:(4-2*e)*e-1),"easeInCubic"===t&&(o=e*e*e),"easeOutCubic"===t&&(o=--e*e*e+1),"easeInOutCubic"===t&&(o=e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1),"easeInQuart"===t&&(o=e*e*e*e),"easeOutQuart"===t&&(o=1- --e*e*e*e),"easeInOutQuart"===t&&(o=e<.5?8*e*e*e*e:1-8*--e*e*e*e),"easeInQuint"===t&&(o=e*e*e*e*e),"easeOutQuint"===t&&(o=1+--e*e*e*e*e),"easeInOutQuint"===t&&(o=e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e),o||e},h=function(t,e,o){var i=0;if(t.offsetParent)do{i+=t.offsetTop,t=t.offsetParent}while(t);return i=i-e-o,i>=0?i:0},d=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},p=function(t){return t&&"object"==typeof JSON&&"function"==typeof JSON.parse?JSON.parse(t):{}};e.animateScroll=function(t,e,o){var s=a(s||n,o||{}),l=p(t?t.getAttribute("data-options"):null),_=Object(i.isHTML)(e)?e:document.querySelector("#"+u(e.substr(1)));s=a(s,l);var f,y,g,C=document.querySelector("[data-scroll-header]"),v=null===C?0:C.offsetHeight+C.offsetTop,m=r.pageYOffset,T=h(_,v,parseInt(s.offset,10)),w=T-m,S=d(),P=document.documentElement.clientHeight,b=0,I=function(o,i,n){var a=r.pageYOffset;(o==i||a==i||P+a>=S)&&(clearInterval(n),s.callbackAfter(t,e))},O=function(){b+=16,y=b/parseInt(s.speed,10),y=y>1?1:y,g=m+w*c(s.easing,y),r.scrollTo(0,Math.floor(g)),I(g,T,f)};0===r.pageYOffset&&r.scrollTo(0,0),function(){s.callbackBefore(t,e),f=setInterval(O,16)}()};var _=function(o){var i=l(o.target,"[data-scroll]");i&&"a"===i.tagName.toLowerCase()&&(o.preventDefault(),e.animateScroll(i,i.hash,t,o))};return e.destroy=function(){t&&(document.removeEventListener("click",_,!1),t=null)},e.init=function(i){o&&(e.destroy(),t=a(n,i||{}),document.addEventListener("click",_,!1))},this.__h=e,e}),n=function(t,e,o){if(!Object(i.isIE)()||Object(i.isIE)()>9)(new r).animateScroll(t,e,o);else{var n=Object(i.cumulativeOffset)(e).top;document.body.scrollTop=n,document.documentElement.scrollTop=n}};t.animateScroll=n,t.smoothScroll=r}.call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.MapPaneType=void 0;var o;!function(t){t.ActiveHotelsCluster="activeHotelsCluster",t.ActivePolygonCluster="activePolygonCluster",t.InactiveHotelsCluster="inactiveHotelsCluster",t.InactivePolygonCluster="inactivePolygonCluster",t.ActiveHotelsMarkers="activeHotelsMarkers",t.ActiveResortsMarkers="activeResortsMarkers",t.InactiveHotelsMarkers="inactiveHotelsMarkers",t.InactiveResortsMarkers="inactiveResortsMarkers",t.AirportsMarkers="airportsMarkers",t.RulerLine="rulerLine",t.RulerMouseMarker="rulerMouseMarker",t.RulerMarker="rulerMarker",t.SelectedMarker="selectedMarker",t.None=""}(o=e.MapPaneType||(e.MapPaneType={})),t.MapPaneType=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.LayerTypes=e.ViewType=void 0;var o;!function(t){t.Scheme="Scheme",t.Satellite="Satellite"}(o=e.ViewType||(e.ViewType={}));var i;!function(t){t[t.View=0]="View",t[t.ToursGroup=1]="ToursGroup"}(i=e.LayerTypes||(e.LayerTypes={})),t.LayerTypes=i,t.ViewType=o}).call(e,o(0))},,,,,,,,,,,,function(t,e,o){"use strict";(function(t){var i=this&&this.__assign||function(){return i=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},i.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.hotOfferUtils=void 0;var r=o(1),n=o(5),s=o(6),a=o(13),l=o(32),u=o(33),c=o(231),h=function(){function t(){}return t.prototype.getApiOfferData=function(t,e,o){void 0===e&&(e=0);var r=t.Description,n=t.PictureId,s=t.Price,a=t.Title,l=t.TourLink,u=t.FilterSettings,c=this.getApiFilterData(u),h=this.getApiOfferPrice(s,o);return i(i(i({},c),h),{description:r,hot_offer_id:e,link:l,picture_id:n,title:a})},t.prototype.getSettingsFromTourData=function(t){var e=t.countryId,o=t.departureId,i=t.hotelId,r=t.nights;return{Countries:[e],Departure:o,FlyDates:[t.tourDate],Hotels:[i],Nights:[r,r]}},t.prototype.getApiOfferPrice=function(t,e){return{currency_id:t&&(0,r.isDefined)(t.Currency)?t.Currency:e,old_price:t&&t.Old||null,price:t&&t.New||null}},t.prototype.getApiFilterData=function(t){var e=t.Countries,o=t.Departure,i=t.FlyDates,n=t.Hotels,l=t.Nights;return{country_id:(0,s.isNotEmptyArray)(e)&&(0,r.isDefined)(e[0])?e[0]:null,departure_id:(0,r.isDefined)(o)&&o>0?o:null,fly_date:(0,s.isNotEmptyArray)(i)&&(0,r.isDefined)(i[0])?a.FormatDate.convertToUTCDate(i[0]).toISOString():null,hotel_id:(0,s.isNotEmptyArray)(n)&&(0,r.isDefined)(n[0])?n[0]:null,nights:(0,s.isNotEmptyArray)(l)&&(0,r.isDefined)(l[0])?l[0]:null}},t.prototype.isSameOffersPrice=function(t,e){var o=t.hot_offer_id,i=t.price,r=t.old_price,n=e.Id,s=e.Price,a=o===n,l=i===s.New,u=r===s.Old;return a&&l&&u},t.prototype.isSameOffersStatus=function(t,e){var o=t.hot_offer_id,i=t.status,r=e.Id,n=e.Status,s=o===r,a=i===n;return s&&a},t.prototype.getDeparture=function(t){return t.FilterSettings&&t.FilterSettings.Departure||0},t.prototype.getCountries=function(t){return t.FilterSettings&&t.FilterSettings.Countries||[]},t.prototype.getCurrency=function(t){return t.Price&&t.Price.Currency||n.Currency.Rub},t.prototype.getFlyDates=function(t){return t.FilterSettings&&t.FilterSettings.FlyDates||[]},t.prototype.getFilterSettings=function(t){return t.FilterSettings||{}},t.prototype.getPrice=function(t){var e=this.getActualPrice(t);return{Min:e,Max:e}},t.prototype.getActualPrice=function(t){return t.Price&&t.Price.New||0},t.prototype.getSearchLink=function(t){return t.SearchLink||""},t.prototype.isViewMode=function(t){return t===u.HotOfferCardMode.View},t.prototype.isEditMode=function(t){return t===u.HotOfferCardMode.Edit},t.prototype.isCreatingOffer=function(t,e){return this.isEditMode(t)&&0===e},t.prototype.generateSearchLink=function(t,o,r){var n=l.clientUtils.getSearchLink(t),s=e.hotOfferUtils.getFilterSettings(o);return c.hotOffersUtils.getSearchLink(n,i(i({},s),{Currency:r}))},t}();e.hotOfferUtils=new h,t.hotOfferUtils=e.hotOfferUtils}).call(e,o(0))},,,,,,,,,,,,,,,,,function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.hotOffersStore=e.HotOffersStore=void 0;var i=o(33),r=o(3),n=o(81),s=o(1),a=o(6),l=o(20),u=function(){function t(){this.Changed=new r.UserEvent,this.Deleted=new r.UserEvent;var e=s.initSinglton.call(this,t);if(e)return e;this._catalog=n.catalogManager}return t.prototype.getItem=function(t){return this._catalog.get(l.CatalogName.HotOffers)(t)()},t.prototype.deleteItem=function(t){this._catalog.set(l.CatalogName.HotOffers)(t).data(null),this.Deleted.fire({Type:l.CatalogName.HotOffers,Id:t})},t.prototype.setItems=function(t){var e=this;(0,a.isNotEmptyArray)(t)&&t.forEach(function(t){e.setItem(t)})},t.prototype.setItem=function(t){var e=t.Id;this._catalog.set(l.CatalogName.HotOffers)(e).data(t),this.Changed.fire({Type:l.CatalogName.HotOffers,Id:e})},t.prototype.updateCount=function(t,e){var o=t.OfferId,r=t.Type,n=t.Action,s=this.getItem(o);switch(r){case i.HotOfferCounterType.Like:s.LikeCount=e,s.IsLiked=n===i.HotOfferCounterAction.INC;break;case i.HotOfferCounterType.Share:s.ShareCount=e;break;case i.HotOfferCounterType.View:s.ViewCount=(0,a.convertViewCount)(e)}this.setItem(s)},t}();e.HotOffersStore=u,e.hotOffersStore=new u,t.hotOffersStore=e.hotOffersStore,t.HotOffersStore=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.MarkerType=void 0;var o;!function(t){t[t.Active=0]="Active",t[t.InActive=1]="InActive"}(o=e.MarkerType||(e.MarkerType={})),t.MarkerType=o}).call(e,o(0))},,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.CartSettingsState=void 0;var o;!function(t){t[t.Hidden=0]="Hidden",t[t.Enable=1]="Enable",t[t.Disable=2]="Disable"}(o=e.CartSettingsState||(e.CartSettingsState={})),t.CartSettingsState=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.newRequestControl=void 0;var i=function(e){return t.newRequestControl(e)};e.newRequestControl=i,o.newRequestControl=e.newRequestControl}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.countryService=void 0;var i=o(27);e.countryService=new i.ApiService("/api/v1.1/countries"),t.countryService=e.countryService}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.SearchResultMode=void 0;var o;!function(t){t[t.PREPARE=0]="PREPARE",t[t.START=1]="START",t[t.SEARCH=2]="SEARCH",t[t.END=3]="END"}(o=e.SearchResultMode||(e.SearchResultMode={})),t.SearchResultMode=o}).call(e,o(0))},,,,,,,,,,,,,,,,,,,function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.CartMenu=void 0;var o;!function(t){t.SaveCart="SaveCart",t.LoadCart="LoadCart",t.NewCart="NewCart",t.OpenLM="OpenLM",t.MyCartCollections="MyCartCollections",t.Mail="Mail",t.Sms="Sms",t.Discount="Discount",t.Print="Print",t.ShareLink="ShareLink",t.Update="Update",t.Login="Login",t.Logout="Logout",t.Clear="Clear",t.Showcase="Showcase",t.EditProfile="EditProfile",t.EditCustomerData="EditCustomerData"}(o=e.CartMenu||(e.CartMenu={})),t.CartMenu=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.TourItemActions=void 0;var o;!function(t){t.DeleteTour="deletetour",t.EditComment="editcomment",t.GetDetail="getdetail",t.ShowHotelPhoto="showhotelphoto",t.ShowRoomInfo="showroominfo",t.ShowMyCarts="showmycarts",t.UpdateComment="updatecomment",t.UpdatePrice="updateprice",t.UpdateRecommend="updaterecommend"}(o=e.TourItemActions||(e.TourItemActions={})),t.TourItemActions=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.UserInputType=void 0;var o;!function(t){t[t.NAME=0]="NAME",t[t.PHONE=1]="PHONE",t[t.EMAIL=2]="EMAIL",t[t.ADDRESS=3]="ADDRESS"}(o=e.UserInputType||(e.UserInputType={})),t.UserInputType=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.OrderModeEnum=void 0;var o;!function(t){t[t.CUSTOMER=0]="CUSTOMER",t[t.MANAGER=1]="MANAGER",t[t.AGENCY=2]="AGENCY"}(o=e.OrderModeEnum||(e.OrderModeEnum={})),t.OrderModeEnum=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)},n=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var i,r=0,n=e.length;r<n;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.MapControl=void 0;var s=o(984),a=o(986),l=o(991),u=o(993),c=o(196),h=o(114),d=o(113),p=o(144),_=o(510),f=o(2),y=o(4),g=o(3),C=o(5),v=o(37),m=o(995),T=o(996),w=o(1e3),S=function(t){function e(e){var o=t.call(this,e)||this;return o.LayerChanged=new g.UserEvent,o.MapZoomChanged=new g.UserEvent,o.ToolDrawChanged=new g.UserEvent,o._ActiveItems=[],o._Class="TVMapControl",o._Layers=[h.LayerTypes.View,h.LayerTypes.ToursGroup],o._IsVisibleLayers=!0,o._IsVisibleTools=!0,o._ModeView=C.ModeView.DescTop,o._SelectedLayers=[],o._ShowMapInWindow=!0,o._ToursGroup=C.ToursGroupBy.Hotels,o._ErrorReport=null,o._MarkerClicked=null,o._activeHotelsPane=null,o._inactiveHotelsPane=null,o._map=null,o._zoomLevel=0,o._airportsCluster=null,o._hotelsCluster=null,o._resortsCluster=null,o.__initSettings(e),o._onMapZoomChanged=o._onMapZoomChanged.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){this._airportsCluster.destroy(),this._hotelsCluster.destroy(),this._resortsCluster.destroy(),this._map.destroy(),t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this);var e=this._SelectedLayers.find(function(t){return t.LayerType===h.LayerTypes.View}),o=(null===e||void 0===e?void 0:e.Item)||h.ViewType.Scheme;this._map=new u.LeafletMapControl({ParentNode:this._DomNode,SelectedLayer:o,ShowMapInWindow:this._ShowMapInWindow,ViewChanged:new y.Delegate(this,this._onMapViewChanged)}),this._IsVisibleTools&&(this._map=new a.MapToolsDecorator({Map:this._map,Changed:new y.Delegate(this,this._onToolsDecoratorChanged),ErrorReport:this._ErrorReport})),this._IsVisibleLayers&&(this._map=new s.MapLayersDecorator({DropPanelClass:"SearchMapLayersDropPanel",Items:this._getLayersItems(),Map:this._map,SelectedItems:this._SelectedLayers,Changed:new y.Delegate(this,this._onLayersDecoratorChanged)})),this._map=new l.MapZoomDecorator({Map:this._map}),this._createPanes(),this._hotelsCluster=new T.HotelsClusterBuilder({ActiveHotelsPane:this._activeHotelsPane,InactiveHotelsPane:this._inactiveHotelsPane,ModeView:this._ModeView,MarkerClicked:this._MarkerClicked}),this._resortsCluster=new w.ResortsClusterBuilder({ModeView:this._ModeView,MarkerClicked:this._MarkerClicked}),this._airportsCluster=new m.AdditionsClusterBuilder({IconClassName:"TVLeafletAirportMarker",PaneName:d.MapPaneType.AirportsMarkers,ZIndex:c.defaultMarkerPaneZindex-2})},e.prototype.show=function(){if(this._map){this._hotelsCluster.update({Map:this._map}),this._resortsCluster.update({Map:this._map}),this._airportsCluster.update({Map:this._map});this._map.getInstance().invalidateSize(!1),this._map.getInstance().on("zoomend",this._onMapZoomChanged)}},e.prototype.hide=function(){this._map.getInstance().off("zoomend",this._onMapZoomChanged),this._map.update({IsClearTools:!0})},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.AirportsItems,i=e.Bounds,r=e.BoundsActiveItemsEnabled,s=e.IsClearPolygon,a=e.IsNewActiveItems,l=e.IsNewInactiveItems,u=e.IsNewAirportsItems,c=e.SelectedLayers,h=e.View;if(a&&(this._hotelsCluster.clear({Type:p.MarkerType.Active}),this._resortsCluster.clear({Type:p.MarkerType.Active})),l&&(this._hotelsCluster.clear({Type:p.MarkerType.InActive}),this._resortsCluster.clear({Type:p.MarkerType.InActive})),this._hotelsCluster.update(e),this._resortsCluster.update(e),c&&this._map.update({SelectedItems:c}),i&&i.length>0&&this._map.update({Bounds:i}),h&&this._map.update({View:h}),s&&this._map.update({IsClearPolygon:s}),u&&this._airportsCluster.clear(),o&&this._airportsCluster.update({Items:n([],o,!0)}),r){var d=this._ActiveItems.map(function(t){return t.Coords});switch(!0){case 1===d.length:this._map.update({View:{Center:d[0],Zoom:v.DEFAULT_HOTEL_ZOOM_LEVEL}});break;case d.length>1:this._map.update({Bounds:d})}}},e.prototype.getInstance=function(){return this._map.getInstance()},e.prototype._createPanes=function(){var t={zIndex:""+(c.defaultMarkerPaneZindex+2)},e={zIndex:""+(c.defaultMarkerPaneZindex-1)};this._activeHotelsPane=this._map.createPane(d.MapPaneType.ActiveHotelsMarkers,t),this._inactiveHotelsPane=this._map.createPane(d.MapPaneType.InactiveHotelsMarkers,e),this._map.createPane(d.MapPaneType.ActiveResortsMarkers,t),this._map.createPane(d.MapPaneType.InactiveResortsMarkers,e);var o={zIndex:""+(c.defaultMarkerPaneZindex+3)};this._map.createPane(d.MapPaneType.SelectedMarker,o);var i={zIndex:""+(c.defaultMarkerPaneZindex+4)},r={zIndex:""+(c.defaultMarkerPaneZindex+5)},n={zIndex:""+(c.defaultMarkerPaneZindex+6)};this._map.createPane(d.MapPaneType.RulerLine,i),this._map.createPane(d.MapPaneType.RulerMouseMarker,r),this._map.createPane(d.MapPaneType.RulerMarker,n)},e.prototype._onMapViewChanged=function(t){this._hotelsCluster&&this._hotelsCluster.update({IsRefresh:!0})},e.prototype._onLayersDecoratorChanged=function(t){var e=t.LayerType,o=t.Type;switch(e){case h.LayerTypes.ToursGroup:o===C.ToursGroupBy.Hotels&&this._resortsCluster.update({SelectionDisable:!0}),o===C.ToursGroupBy.Resorts&&(this._hotelsCluster.update({SelectionDisable:!0}),this._map.update({IsClearPolygon:!0}));break;case h.LayerTypes.View:this._map.update({SelectedLayer:o})}this.LayerChanged.fire(r(r({},t),{Zoom:this._zoomLevel}))},e.prototype._onMapZoomChanged=function(t){this._zoomLevel=t.sourceTarget.getZoom(),this.MapZoomChanged.fire({Zoom:this._zoomLevel})},e.prototype._onToolsDecoratorChanged=function(t){switch(t.Type){case _.ToolType.Draw:this.ToolDrawChanged.fire(t)}},e.prototype._getLayersItems=function(){return this._Layers.map(function(t){switch(t){case h.LayerTypes.View:return{Items:[{Type:h.ViewType.Scheme},{Type:h.ViewType.Satellite}],LayerType:h.LayerTypes.View};case h.LayerTypes.ToursGroup:return{Items:[{Type:C.ToursGroupBy.Hotels},{Type:C.ToursGroupBy.Resorts}],LayerType:h.LayerTypes.ToursGroup}}})},e}(f.Control);e.MapControl=S,t.MapControl=S}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.defaultMarkerPaneZindex=e.LeafletMarkerControl=void 0;var r=o(80),n=o(9),s=o(3),a=o(5),l=o(8),u=o(113),c=o(144),h=o(513),d=o(514),p=function(t){function e(e){var o=t.call(this,e)||this;return o.Click=new s.UserEvent,o._ChildsCount=0,o._ClickEnabled=!0,o._Coords=[],o._IconClassName="",o._Id=0,o._Tooltip="",o._Pane=u.MapPaneType.None,o._ParentId=0,o._Price=0,o._Title="",o._ToursGroup=a.ToursGroupBy.Hotels,o._Type=c.MarkerType.InActive,o.__initSettings(e),o._onClicked=o._onClicked.bind(o),o._onShowTooltip=o._onShowTooltip.bind(o),o._render(),o}return i(e,t),e.prototype.destroy=function(){this._leafletMarker.off("click",this._onClicked),this._leafletMarker.off("mouseover",this._onShowTooltip),this._leafletMarker.remove(),this._leafletMarker=null,t.prototype.destroy.call(this)},e.prototype.getLayer=function(){return this._leafletMarker},e.prototype._onClicked=function(t){this.Click.fire(t)},e.prototype._render=function(){var t=d.markerUtils.getMarkerIcon({className:e.TV_LEAFLET_MARKER+" "+this._IconClassName,iconAnchor:d.HOTEL_ICON_ANCHOR},{ChildsCount:this._ChildsCount,Price:this._Price,Title:this._Title,Type:this._Type}),o={icon:t,id:this._Id,interactive:this._ClickEnabled,layerType:this._ToursGroup,parentId:this._ParentId,price:this._Price,riseOnHover:!0,type:this._Type};this._Pane!==u.MapPaneType.None&&(o.pane=this._Pane),this._leafletMarker=(0,h.tvMarker)(this._Coords,o),this._ClickEnabled&&this._leafletMarker.on("click",this._onClicked),this._Tooltip.length>0&&this._leafletMarker.on("mouseover",this._onShowTooltip)},e.prototype._onShowTooltip=function(t){if(!this._leafletMarker.getTooltip()){var e=t.originalEvent.target,o=e.offsetWidth,i=o/2-8,n=(0,r.tooltip)({className:"TVMarkerTooltip"+(this._Type===c.MarkerType.Active?" "+l.TV_ACTIVE:""),direction:"bottom",offset:[i,13],opacity:1,permanent:!1});n.setContent('<div class="TVMarkerTooltipContent">'+this._Tooltip+"</div>"),this._leafletMarker.bindTooltip(n),this._leafletMarker.openTooltip()}},e.TV_LEAFLET_MARKER="TVLeafletMarker",e}(n.Core);e.LeafletMarkerControl=p,e.defaultMarkerPaneZindex=600,t.defaultMarkerPaneZindex=e.defaultMarkerPaneZindex,t.LeafletMarkerControl=p}).call(e,o(0))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartManager=void 0;var s=o(104),a=o(9),l=o(4),u=o(3),c=o(7),h=o(1),d=o(5),p=o(6),_=o(110),f=o(22),y=o(45),g=o(207),C=o(21),v=o(14),m=o(50),T=o(111),w=o(177),S=o(800),P=o(285),b=o(227),I=o(801),O=o(802),M=o(807),D=o(808),E=o(291),k=o(816),R=o(432),A=o(289),V=o(191),L=o(818),N=o(433),B=o(169);o(819);var H=function(e){function o(o){var i=e.call(this,o)||this;return i.BeforeShow=new u.UserEvent,i.Changed=new u.UserEvent,i.Hide=new u.UserEvent,i.Show=new u.UserEvent,i.TourAdd=new u.UserEvent,i.TourAdded=new u.UserEvent,i._Enable=!1,i._FastRegistrationEnabled=!1,i._FormRequiredFields=d.FormRequiredFieldsType.PhoneOrEmail,i._ModeView=d.ModeView.DescTop,i._RegistrationEnabled=!1,i._ShowOperator=!1,i._Tours=[],i._ToursCount=0,i._cartService=t.cartService,i._instance=null,i._desctopController=null,i._mobileController=null,i._LeadManagerEnabled=!1,i._LeadManagerLink="",i._queueAddTours=[],i.__initSettings(o),s.cartCatalog.setActiveCartId(0),s.cartCatalog.setCartLeadId(0),i._init(),i}return r(o,e),o.prototype.update=function(t){var o=this._ModeView;e.prototype.update.call(this,t),o!==this._ModeView&&this._instance&&this._instance.destroy(),this._instance=this._getInstance()},o.prototype.addTour=function(t,e,o){var i=this,r=n(n({},o),{Ref:e,TourId:t});this.TourAdd.fire(r),this._logTour({TourId:t,Ref:e}),_.analiticManager.reachGoal(d.Metrica.AddToCart),this._RegistrationEnabled?f.authManager.refreshManager().then(function(){i._addTour(t,o)}):this._addTour(t,o)},o.prototype.hasTour=function(t){return this._Tours.indexOf(t)>-1},o.prototype.getCount=function(){return this._ToursCount},o.prototype.showCart=function(){this._RegistrationEnabled&&f.authManager.refreshManager(),this._ModeView===d.ModeView.Mobile&&v.router.Changed.addOnce(new l.Delegate(this,this._onRouteChanged)),this._cartService.getList(new l.Delegate(this,this._onDataLoaded,{Action:R.CartAction.List}))},o.prototype.clear=function(){this._deleteFromStorage(),s.cartCatalog.setActiveCartId(0),s.cartCatalog.setCartLeadId(0),s.cartCatalog.setToursData([]),this._ToursCount=0,this._Tours=[],this._LeadManagerLink="",this.Changed.fire({CartCount:this._ToursCount})},o.prototype._init=function(){this._initFromURL(),f.authManager.Logout.addOnce(new l.Delegate(this,this._onLogout)),f.authManager.LoginSuccess.addOnce(new l.Delegate(this,this._updateOnLogin)),this._instance=this._getInstance(),0===s.cartCatalog.getActiveCartId()&&this._initFromStorage()},o.prototype._initFromStorage=function(){var t=(0,y.getStorage)(c.STORAGE_CARTID);if((0,h.isDefined)(t)&&!isNaN(t))return s.cartCatalog.setActiveCartId(Number(t)),void this._cartService.getList(new l.Delegate(this,this._onDataLoaded,{Action:R.CartAction.Status}));f.authManager.isManager()&&this._cartService.getStatus(new l.Delegate(this,this._onDataLoaded,{Action:R.CartAction.Status})),this.clear()},o.prototype._onLogout=function(){this._deleteFromStorage(),this._updateInstance(),this.Changed.fire({CartCount:this._ToursCount})},o.prototype._saveToStorage=function(){var t=s.cartCatalog.getActiveCartId();if(t>0){var e=new Date;e.setDate(e.getDate()+o.SAVE_STORAGE_DAYS),(0,y.setStorage)(c.STORAGE_CARTID,t,{expires:e.toUTCString(),path:c.COOKIE_PATH})}},o.prototype._deleteFromStorage=function(){(0,y.deleteStorage)(c.STORAGE_CARTID)},o.prototype._logTour=function(e){t.actionLogService.log(d.ActionLog.TOUR,e,d.ActionLogQuery.CART)},o.prototype._addTour=function(t,e){var o=this;0===(s.cartCatalog.getActiveCartId()||0)&&((0,h.insertUnique)(this._queueAddTours,t),this._queueAddTours.length>1)||(this._addTourRequest(t,e).then(function(i){if(o._onDataLoaded(n({Action:R.CartAction.Add,SaveCart:!0},i)),o._queueAddTours.length>0){var r=o._queueAddTours.filter(function(e){return e!==t});for(o._queueAddTours=[];r.length>0;)o._addTour(r.pop(),e)}}).catch(function(t){return console.error(t.message||t)}),(0,h.insertUnique)(this._Tours,Number(t)))},o.prototype._addTourRequest=function(t,e){var o=this;return new Promise(function(i){var r=T.cartUtils.getAddTourRequestParams(e);o._cartService.addTour(n(n({},r),{tourid:t}),new l.Delegate(o,i))})},o.prototype._getInstance=function(){var e=this;this._managerController||(this._managerController=new O.ManagerController({Permissions:this._getPermissions(),LeadClicked:new l.Delegate(this,this._actionManagement,{Manage:A.CartManage.ExportToLM})}));var o={FormRequiredFields:this._FormRequiredFields,ManagerController:this._managerController,Permissions:this._getPermissions(),PreviewEnabled:this._Enable,ShowOperator:this._ShowOperator,BeforeShow:new l.Delegate(this,function(){e.BeforeShow.fire()}),ManageAction:new l.Delegate(this,this._actionManagement),ShowCart:new l.Delegate(this,this._onRequestCartTours)};return this._ModeView===d.ModeView.DescTop?(this._desctopController||(this._desctopController=t.newDesctopCartController(n(n({},o),{CartHide:new l.Delegate(this,this._onCartHide)}))),this._desctopController):(this._mobileController||(this._mobileController=new M.MobileCartController(o)),this._mobileController)},o.prototype._updateInstance=function(){var t=this;this._updateRole().then(function(){var e=t._getPermissions();t._instance.update({Permissions:e}),t._managerController.update({Permissions:e})})},o.prototype._updateRole=function(){var t=this._isStorageCart(),e=f.authManager.isManager(),o=this._isOwnToManager();o&&!t&&this._saveToStorage(),e&&t&&!this._getCartCreatorId()&&this._linkManager(),t&&e&&!o&&this._deleteFromStorage(),t=this._isStorageCart();var i=b.TOURIST_GUEST;return f.authManager.getRole().then(function(e){switch(e){case g.Role.MANAGER:case g.Role.PROMANAGER:i=t?b.MANAGER_CREATOR:b.MANAGER_GUEST;break;case g.Role.FREEMANAGER:i=t?b.FREE_MANAGER_CREATOR:b.FREE_MANAGER_GUEST;break;case g.Role.GUEST:i=t?b.TOURIST_CREATOR:b.TOURIST_GUEST;break;default:i=b.TOURIST_GUEST}I.cartRoleManager.update({Permissions:i})}).catch(function(){I.cartRoleManager.update({Permissions:i})})},o.prototype._linkManager=function(){var t=this,e=s.cartCatalog.getActiveCartId();s.cartCatalog.getTryToLinkCartId()!==s.cartCatalog.getActiveCartId()&&(this._cartService.linkManager(new l.Delegate(this,function(e){T.cartUtils.isSuccesResult(e)||t._deleteFromStorage(),t._refreshCart()})),s.cartCatalog.setTryToLinkCartId(e))},o.prototype._updateOnLogin=function(){this._isStorageCart()&&!this._getCartCreatorId()?this._linkManager():this._cartService.getList(new l.Delegate(this,this._setLoadedData))},o.prototype._isOwnToManager=function(){var t=this._getCartCreatorId();return t&&parseInt(f.authManager.getId(),10)===t},o.prototype._isStorageCart=function(){return Number((0,y.getStorage)(c.STORAGE_CARTID))===s.cartCatalog.getActiveCartId()},o.prototype._getCartCreatorId=function(){var t=s.cartCatalog.getInfoData();return parseInt(T.cartUtils.getCartManagerId(t),10)||0},o.prototype._getPermissions=function(){var t=T.cartUtils.getCartMenuEnabledSettins(s.cartCatalog.getPermissions()),e=0===s.cartCatalog.getActiveCartId(),o=t.SaveLoad,i=t.SendEmail,r=t.SendSms,a=B.CartSettingsState.Hidden,l=B.CartSettingsState.Disable,u=L.CartPermissionsSetting.Menu,c=L.CartPermissionsSetting.Load,h=L.CartPermissionsSetting.OpenLM,d=L.CartPermissionsSetting.Print,p=L.CartPermissionsSetting.Save,_=L.CartPermissionsSetting.SendEmail,f=L.CartPermissionsSetting.SendSms,y=L.CartPermissionsSetting.CustomerInfo,g=L.CartPermissionsSetting.ShareLink,C=L.CartPermissionsSetting.UpdatePrice;return n(n({},I.cartRoleManager.getPermissions()),{CustomerInfo:this._LeadManagerEnabled?I.cartRoleManager.get(y):a,FastRegistrationEnabled:this._FastRegistrationEnabled,Menu:n(n({},I.cartRoleManager.get(u)),{CreateLM:this._LeadManagerEnabled&&!this._LeadManagerLink?I.cartRoleManager.get(h):a,Load:o?I.cartRoleManager.get(c):a,OpenLM:this._LeadManagerEnabled&&this._LeadManagerLink?I.cartRoleManager.get(h):a,Print:e?l:I.cartRoleManager.get(d),Save:o?I.cartRoleManager.get(p):a,SendEmail:i?I.cartRoleManager.get(_):a,SendSms:r?I.cartRoleManager.get(f):a,ShareLink:e?l:I.cartRoleManager.get(g),UpdatePrice:e?l:I.cartRoleManager.get(C)}),RegistrationEnabled:this._RegistrationEnabled,UpdateCustomerEnabled:this._RegistrationEnabled,UpdateManagerInfoEnabled:this._RegistrationEnabled})},o.prototype._actionManagement=function(t){var e=this;switch(t.Manage){case A.CartManage.Save:this._cartService.save(t,new l.Delegate(this,function(o){e._onDataLoaded(o),t.Callback.fire(o)}));break;case A.CartManage.Load:this.clear(),s.cartCatalog.setActiveCartId(Number(t.Id)),this.showCart(),this._saveToStorage();break;case A.CartManage.Delete:var o=Number(t.Id);this._cartService.delete(o,t.Callback),o===s.cartCatalog.getActiveCartId()&&this.clear();break;case A.CartManage.Discount:this._cartService.setDiscount(t.Discount,new l.Delegate(this,this._onDataLoaded));break;case A.CartManage.UpdatePrice:case A.CartManage.UpdateComment:case A.CartManage.UpdateRecommend:this._cartService.updateTour(t,new l.Delegate(this,this._onDataLoaded));break;case A.CartManage.Remove:this._cartService.remove(t.TourId,new l.Delegate(this,this._onDataLoaded));break;case A.CartManage.Mail:var i=t.Callback;this._cartService.sendMail(t,new l.Delegate(this,function(t){var o=T.cartUtils.getLMLink(t);o&&e._updateLMLink(o),i.fire(t),e._refreshCart()}));break;case A.CartManage.GetMail:this._cartService.getEmail(new l.Delegate(this,function(t){s.cartCatalog.setMailData(T.cartUtils.getMailData(t))}));break;case A.CartManage.GetSms:this._cartService.getSms(new l.Delegate(this,function(t){s.cartCatalog.setSmsData(T.cartUtils.getSmsData(t))}));break;case A.CartManage.Sms:var r=t.Callback;this._cartService.sendSms(t,new l.Delegate(this,function(t){var o=T.cartUtils.getLMData(t);o.LMLink&&e._updateLMLink(o.LMLink),r.fire(t)}));break;case A.CartManage.Order:_.analiticManager.reachGoal(d.Metrica.HelpCart),this._cartService.sendAgency(t);break;case A.CartManage.Showcase:var n=new k.ToursPrintControl({Items:T.cartUtils.convertToursForCart(s.cartCatalog.getToursData()),ShowHotelName:t.ShowHotelName,Close:new l.Delegate(this,this._onCloseShowcase)});t.ShowcaseType===E.ShowcaseType.Print&&S.printUtils.printTours(n.getDomNode()),t.ShowcaseType===E.ShowcaseType.Screen&&S.printUtils.screenTours(n.getDomNode());break;case A.CartManage.Print:this._cartService.sendLog(d.ShareType.Print);var a=s.cartCatalog.getInfoData(),u={IsVisible:!1};if(a&&a.manager){var c=new D.CartPrintControl({CreatorInfo:T.cartUtils.getCreatorInfo(a.manager),Items:T.cartUtils.getCountryGroupedData(s.cartCatalog.getToursData())});S.printUtils.printTours(c.getDomNode())}else this._cartService.getPrint(new l.Delegate(this,function(t){var e=T.cartUtils.getPrintInfo(t);if(e){var o=e.pic,i=e.text;u={IsVisible:!0,Logo:o||"",Name:"",Photo:"",Text:i||""}}var r=new D.CartPrintControl({CreatorInfo:u,Items:T.cartUtils.getCountryGroupedData(s.cartCatalog.getToursData())});S.printUtils.printTours(r.getDomNode())}));break;case A.CartManage.Refresh:this._refreshCart();break;case A.CartManage.Clear:this.clear();break;case A.CartManage.ExportToLM:this._LeadManagerEnabled&&(this._LeadManagerLink?(this._openLead(),t.Callback.fire()):this._cartService.exportToLM(new l.Delegate(this,function(o){var i=T.cartUtils.getLMData(o);1===i.Success&&i.LMLink&&(e._updateLMLink(i.LMLink),e._openLead()),t.Callback.fire()})));break;case A.CartManage.UpdateProfile:var p=t.FullName,y=t.Info,g=t.PhotoFile,C=t.LogoFile,v={};(0,h.isDefined)(p)&&(v.manager=p),(0,h.isDefined)(y)&&(v.contacts=y),(0,h.isDefined)(g)&&(v.picture=g),(0,h.isDefined)(C)&&(v.logo=C),this._managerController.updateManagerInfo(v).then(function(o){"success"===o.status?e._refreshCart().then(function(){t.Callback.fire({success:!0})}):t.Callback.fire({success:!1})});break;case A.CartManage.UpdateCustomer:this._updateCustomer(t);break;case A.CartManage.CartListFull:this._cartService.getCartListFull(new l.Delegate(this,function(t){s.cartCatalog.setCartListFull(f.authManager.getId(),T.cartUtils.getCartListFullData(t))}));break;case A.CartManage.ShareLink:t.Type&&this._cartService.sendLog(t.Type)}},o.prototype._onCloseShowcase=function(){S.printUtils.hidePrintBody()},o.prototype._initFromURL=function(){var t=P.urlUtils.getHash();t&&t.name===d.Hash.Cartid&&!isNaN(Number(t.value))&&s.cartCatalog.setActiveCartId(Number(t.value))},o.prototype._onDataLoaded=function(t){var e=(0,h.getProperty)(t,"data");if(!e)return void s.cartCatalog.setActiveCartId(0);if(0===(0,h.getProperty)(e,"success"))return void s.cartCatalog.setActiveCartId(0);var o=(0,h.getProperty)(t,"Action"),i=(0,h.getProperty)(e,"status"),r=(0,h.getProperty)(e,"info"),a={},l=this._ToursCount;if(!i||(isNaN(i.tourscount)||(this._ToursCount=Number(i.tourscount),i.cartid&&t.SaveCart&&(s.cartCatalog.setActiveCartId(i.cartid||0),this._saveToStorage()),i.lmenabled&&(this._LeadManagerEnabled=1===i.lmenabled),i.leadmanagerlink&&(this._LeadManagerLink=i.leadmanagerlink),a.Count=this._ToursCount,a.Align=i.cartposition||N.CartPreviewAlign.Right),!i.cartid||s.cartCatalog.getActiveCartId()===i.cartid)){switch(r&&this._updateCartInfo(r),o){case R.CartAction.Status:this._instance.update(n({},a));break;case R.CartAction.Add:this._instance.update(n({},a)),this.TourAdded.fire(e);break;case R.CartAction.List:this._instance.update(n({},a)),this._instance.show()}this._setLoadedData(t),l!==this._ToursCount&&this.Changed.fire({CartCount:i.tourscount}),e.forcerefresh&&this._refreshCart()}},o.prototype._updateCartInfo=function(t){var e=t.currentmanagerlogin,o=t.currentmanagername,i={ManagerInfo:{currentmanagerlogin:e||"",currentmanagername:o||""}};this._instance.update(i)},o.prototype._refreshCart=function(){var t=this;this._instance.update({UpdatingTours:!0});var e=new Promise(function(e){t._cartService.refreshCart(new l.Delegate(t,function(t){return e(t)}))}),o=new Promise(function(t){setTimeout(function(){return t()},1e3)});return Promise.all([e,o]).then(function(e){return t._onDataLoaded(e[0]),e[0]})},o.prototype._setLoadedData=function(t){var e=(0,h.getProperty)(t,"data"),o=(0,h.getProperty)(e,"tours"),i=(0,h.getProperty)(e,"client"),r=(0,h.getProperty)(e,"info"),n=(0,h.getProperty)(t,"Action");if(i&&s.cartCatalog.setClientData(i),o&&(this._Tours=Array.isArray(o)?o.map(function(t){return Number(t.tourid)}):[],s.cartCatalog.setToursData(o)),r&&(s.cartCatalog.setInfoData(r),r.permissions&&s.cartCatalog.setPermissions(r.permissions),s.cartCatalog.setCartList(T.cartUtils.getSortedCartList(r)),this._updateCartInfo(r),this._updateInstance()),n===R.CartAction.List){(0,p.findGET)(d.Get.Action)===d.GetAction.CartPrint&&this._actionManagement({Manage:A.CartManage.Print}),this.Show.fire()}},o.prototype._onRequestCartTours=function(){this.showCart()},o.prototype._onCartHide=function(){s.cartCatalog.setActiveCartId(0),this._initFromStorage(),v.router.Changed.remove(this),this.Hide.fire()},o.prototype._onRouteChanged=function(t){var e=t.From,o=t.Navigation;if(e.includes(C.RouterPath.Cart+"/")&&o===m.NavigationDirection.Back&&(this._onCartHide(),location.hash.indexOf(d.Hash.Cartid)>-1)){var i=m.historyService.getState();m.historyService.replace(w.historyUtils.getCurrent(i),null,(0,p.getCurrentURL)()),location.reload()}},o.prototype._openLead=function(){t.windowOpen(this._LeadManagerLink,"_blank")},o.prototype._updateCustomer=function(t){var e=this;if(this._RegistrationEnabled)return void this._updateCustomerByLM(t);this._cartService.updateClientData(t,new l.Delegate(this,function(o){var i=T.cartUtils.getLMData(o),r=1===i.Success&&i.LeadID,n=T.cartUtils.getUpdateCustomerData(t);r&&(s.cartCatalog.setCartLeadId(Number(i.LeadID)),s.cartCatalog.setLeadData(i.LeadID,n)),i.LMLink&&e._updateLMLink(i.LMLink),t.Callback.fire({success:r})}))},o.prototype._updateCustomerByLM=function(t){var e=this,o=T.cartUtils.getUpdateCustomerData(t),i=s.cartCatalog.getCartLeadId();t.Id>0&&(o.customer.id=t.Id,o.customerId=t.Id);var r=function(i){e._managerController.updateCustomer(o).then(function(){t.Callback.fire({success:i})}).catch(function(){t.Callback.fire({success:!1})})};i?r(!0):this._cartService.exportToLM(new l.Delegate(this,function(o){var i=T.cartUtils.getLMData(o),n=1===i.Success&&Boolean(i.LeadID);if(n)return s.cartCatalog.setCartLeadId(Number(i.LeadID)),r(n),void(i.LMLink&&e._updateLMLink(i.LMLink));t.Callback.fire({success:n})}))},o.prototype._updateLMLink=function(t){this._LeadManagerLink=t,this._updateInstance()},o.TOURVISOR_LINK="//tourvisor.ru",o.SAVE_STORAGE_DAYS=14,o.MANAGER_ACTIONS=[V.CartMenu.Mail,V.CartMenu.Sms,V.CartMenu.SaveCart,V.CartMenu.LoadCart],o}(a.Core);e.CartManager=H,i.CartManager=H}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__assign||function(){return i=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},i.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.FREE_MANAGER_GUEST=e.TOURIST_GUEST=e.MANAGER_GUEST=e.FREE_MANAGER_CREATOR=e.TOURIST_CREATOR=e.MANAGER_CREATOR=void 0;var r=o(169);e.MANAGER_CREATOR={CustomerInfo:r.CartSettingsState.Enable,DeleteTour:!0,EditComment:!0,EditPrice:!0,Menu:{Discount:r.CartSettingsState.Enable,Load:r.CartSettingsState.Enable,Login:!1,Logout:!0,MyCartCollections:r.CartSettingsState.Enable,NewCart:r.CartSettingsState.Enable,OpenLM:r.CartSettingsState.Enable,Print:r.CartSettingsState.Enable,Save:r.CartSettingsState.Enable,SendEmail:r.CartSettingsState.Enable,SendSms:r.CartSettingsState.Enable,ShareLink:r.CartSettingsState.Enable,Showcase:r.CartSettingsState.Enable,Title:!0,UpdatePrice:r.CartSettingsState.Enable},Profile:r.CartSettingsState.Enable,Recommend:!0,SeeOperator:!0,TourvisorProActivation:!1,ViewCount:!0},e.TOURIST_CREATOR={CustomerInfo:r.CartSettingsState.Hidden,DeleteTour:!0,EditComment:!1,EditPrice:!1,Menu:{Discount:r.CartSettingsState.Hidden,Load:r.CartSettingsState.Hidden,Login:!0,Logout:!1,MyCartCollections:r.CartSettingsState.Hidden,NewCart:r.CartSettingsState.Enable,OpenLM:r.CartSettingsState.Hidden,Print:r.CartSettingsState.Enable,Save:r.CartSettingsState.Hidden,SendEmail:r.CartSettingsState.Hidden,SendSms:r.CartSettingsState.Hidden,ShareLink:r.CartSettingsState.Enable,Showcase:r.CartSettingsState.Hidden,Title:!1,UpdatePrice:r.CartSettingsState.Enable},Profile:r.CartSettingsState.Disable,Recommend:!1,SeeOperator:!1,TourvisorProActivation:!1,ViewCount:!1},e.FREE_MANAGER_CREATOR=i(i({},e.TOURIST_CREATOR),{Menu:i(i({},e.TOURIST_CREATOR.Menu),{Login:!1,Logout:!0,Title:!0}),Profile:r.CartSettingsState.Enable,TourvisorProActivation:!0}),e.MANAGER_GUEST={CustomerInfo:r.CartSettingsState.Hidden,DeleteTour:!1,EditComment:!1,EditPrice:!1,Menu:{Discount:r.CartSettingsState.Disable,Load:r.CartSettingsState.Disable,Login:!1,Logout:!0,MyCartCollections:r.CartSettingsState.Enable,NewCart:r.CartSettingsState.Enable,OpenLM:r.CartSettingsState.Disable,Print:r.CartSettingsState.Enable,Save:r.CartSettingsState.Disable,SendEmail:r.CartSettingsState.Disable,SendSms:r.CartSettingsState.Disable,ShareLink:r.CartSettingsState.Enable,Showcase:r.CartSettingsState.Disable,Title:!0,UpdatePrice:r.CartSettingsState.Enable},Profile:r.CartSettingsState.Disable,Recommend:!1,SeeOperator:!1,TourvisorProActivation:!1,ViewCount:!1},e.TOURIST_GUEST={CustomerInfo:r.CartSettingsState.Hidden,DeleteTour:!1,EditComment:!1,EditPrice:!1,Menu:{Discount:r.CartSettingsState.Hidden,Load:r.CartSettingsState.Hidden,Login:!0,Logout:!1,MyCartCollections:r.CartSettingsState.Hidden,NewCart:r.CartSettingsState.Enable,OpenLM:r.CartSettingsState.Hidden,Print:r.CartSettingsState.Enable,Save:r.CartSettingsState.Hidden,SendEmail:r.CartSettingsState.Hidden,SendSms:r.CartSettingsState.Hidden,ShareLink:r.CartSettingsState.Enable,Showcase:r.CartSettingsState.Hidden,Title:!1,UpdatePrice:r.CartSettingsState.Enable},Profile:r.CartSettingsState.Disable,Recommend:!1,SeeOperator:!1,TourvisorProActivation:!1,ViewCount:!1},e.FREE_MANAGER_GUEST=i(i({},e.TOURIST_GUEST),{Menu:i(i({},e.TOURIST_GUEST.Menu),{Login:!1,Logout:!0,Title:!0}),TourvisorProActivation:!0}),t.FREE_MANAGER_GUEST=e.FREE_MANAGER_GUEST,t.TOURIST_GUEST=e.TOURIST_GUEST,t.MANAGER_GUEST=e.MANAGER_GUEST,t.FREE_MANAGER_CREATOR=e.FREE_MANAGER_CREATOR,t.TOURIST_CREATOR=e.TOURIST_CREATOR,t.MANAGER_CREATOR=e.MANAGER_CREATOR}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.addResetDecorator=e.InputPro=void 0;var n=o(2),s=o(4),a=o(3),l=o(1),u=o(827),c=o(83),h="text",d=function(t){function e(e){var o=t.call(this,e)||this;return o.Blur=new a.UserEvent,o.Validating=new a.UserEvent,o._CheckValid=!0,o._Class="TVInputPro",o._IsAnimateFixedLabel=!1,o._IsDate=!1,o._IsNumber=!1,o._IsValid=!1,o._Label="",o._LiteraOnly=!1,o._MaxLength=0,o._NumberOnly=!1,o._ReadOnly=!1,o._Placeholder="",o._Type=h,o._Value="",t.prototype.__initSettings.call(o,e),o._onFocusInputPro=o._onFocusInputPro.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._IsAnimateFixedLabel&&(0,l.addClass)(this._DomNode,"TVInputAnimateFixedLabel"),""!==this._Label&&(this._labelNode=(0,l.newDiv)("TVInputLabel",this._DomNode),this._labelNode.innerHTML=this._Label);var e={CheckValid:this._CheckValid,ReadOnly:this._ReadOnly,ParentNode:this._DomNode,Placeholder:this._Placeholder,Type:this._Type,Value:this._Value,Blur:new s.Delegate(this,this._onBlurInput),Focus:new s.Delegate(this,this._onFocusInput)};this._IsDate?this._input=new u.DateInput(r(r({},e),{IsDate:!0})):this._input=new c.Input(r(r({},e),{LiteraOnly:this._LiteraOnly,NumberOnly:this._NumberOnly})),(0,l.addEvent)(this._DomNode,"click",this._onFocusInputPro)},e.prototype.update=function(t){var o=t.CheckValid,i=t.ClearValid,r=t.IsValid,n=t.ReadOnly,s=t.Value;(0,l.isDefined)(s)&&(this._input.setValue(s),this._updateIsValid({Value:s})),(0,l.isDefined)(i)&&(0,l.removeClass)(this._DomNode,e.TV_INVALID_INPUT),(0,l.isDefined)(r)&&(this._IsValid=r,this._input.setValid(r),this._updateValidClass()),(0,l.isDefined)(n)&&(this._ReadOnly=n,this._input.setReadOnly(n)),(0,l.isDefined)(o)&&(this._CheckValid=o,this._input.setCheckValid(o))},e.prototype.destroy=function(){(0,l.removeEvent)(this._DomNode,"click",this._onFocusInputPro),t.prototype.destroy.call(this)},e.prototype.getSettings=function(){return{Value:this._Value,IsValid:this._IsValid}},e.prototype.validate=function(){return this._IsValid=this._input.isValid(),this.Validating.fire({Value:this._Value,IsValid:this._IsValid}),this._updateValidClass(),this._IsValid},e.prototype.select=function(){this._input.select()},e.prototype._onFocusInput=function(){this._checkFocusAnimateFixedLabel()},e.prototype._onFocusInputPro=function(){this._ReadOnly||(this._checkFocusAnimateFixedLabel(),this._input.setFocus(!0))},e.prototype._onBlurInput=function(t){this._updateIsValid(t),this.Blur.fire(r(r({},t),{IsValid:this._IsValid}))},e.prototype._checkFocusAnimateFixedLabel=function(){this._IsAnimateFixedLabel&&(0,l.addClass)(this._DomNode,"TVFocusAnimateLabel")},e.prototype._updateValidClass=function(){(0,l.updateClass)(this._DomNode,e.TV_INVALID_INPUT,!this._IsValid)},e.prototype._updateIsValid=function(t){var e=t.Value;switch(this._Value=e,this._IsValid=this._input.isValid(),!0){case!this._CheckValid:break;default:this._updateValidClass()}(0,l.updateClass)(this._DomNode,"TVFocusAnimateLabel",0!==t.Value.length&&this._IsAnimateFixedLabel)},e.TV_INVALID_INPUT="TVInvalidInput",e}(n.Control);e.InputPro=d;var p=function(t,e,o){void 0===o&&(o="");var i=(0,l.newDiv)("TVClearFilter",t.getDomNode()),r=function(t){(0,l.setVisible)(i,t.Value.length>0)},n=function(){t.update({Value:o}),r({Value:o}),t.select()};r({Value:e}),t.Blur.add(new s.Delegate(null,r)),(0,l.addEvent)(i,"click",n)};e.addResetDecorator=p,t.addResetDecorator=e.addResetDecorator,t.InputPro=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.hotOfferService=void 0;var r=o(33),n=o(46),s=o(5),a=o(27),l=o(47),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._defaultSortProp="created_at",e}return i(e,t),e.prototype.actualize=function(t,e){return this._addReferer(e),n.cors.update({Url:this.url+"/"+t+"/actualize"}),n.cors.get(e).catch(function(t){return l.logService.error(t)})},e.prototype.generate=function(t,e){return n.cors.update({Url:this.url+"/generate"}),n.cors.post(t,{Query:e}).catch(function(t){return l.logService.error(t)})},e.prototype.query=function(e){return e.sortDir=s.SortDirEnum.desc,e.sortProp=this._defaultSortProp,t.prototype.query.call(this,e)},e.prototype.updateCount=function(t,e,o){switch(n.cors.update({Url:this.url+"/"+t+"/"+this._getCountPath(e)}),o){case r.HotOfferCounterAction.INC:return n.cors.post({}).catch(function(t){return l.logService.error(t)});case r.HotOfferCounterAction.DEC:return n.cors.delete({}).catch(function(t){return l.logService.error(t)})}},e.prototype._getCountPath=function(t){var e="";switch(t){case r.HotOfferCounterType.Like:e="like";break;case r.HotOfferCounterType.Share:e="share";break;case r.HotOfferCounterType.View:e="view"}return e},e}(a.ApiService);e.hotOfferService=new u("/api/v1.1/hot-offer-informations"),t.hotOfferService=e.hotOfferService}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.hotOffersShareUtils=e.HotOffersShareUtils=void 0;var i=o(1),r=o(5),n=o(6),s=o(28),a=o(451),l=function(){function t(){}return t.prototype.getOfferLink=function(t){return(0,n.removeSearchParams)((0,n.getClientDomainURLForLink)())+"#"+r.Hash.Offerid+"="+t},t.prototype.getShareInfo=function(t){var e=t.PictureId,o=t.Price,r=t.Uid,n=this._getShareTitle(t),a=this._getShareDescription(t);return a=a?"\n"+a:"",{AddInfo:[a],Currency:o.Currency,Discount:(0,i.getDiscount)(o.New,o.Old,!0),Id:r,MainInfo:[n,this._getPrice(t)],PictureShortLink:s.pictureUtils.getTourcartPictureLink(e),RealPrice:Math.round(o.New)||0}},t.prototype.getShareText=function(t){if(!t)return"";var e=[],o=this._getPrice(t),i=this._getShareTitle(t),r=this._getShareDescription(t);return r=r?"\n"+r:"",e=[o,i,r].filter(function(t){return t}),e.join("\n")},t.prototype.getShareSettings=function(t){var e=t.Id,o=this.getOfferLink(e),i=this.getShareText(t);return{Info:this.getShareInfo(t),Link:o,Text:i}},t.prototype._getPrice=function(t){if(!t)return"";var e=t.Price,o=e&&e.New||0;if(!o)return"";var r=e&&e.Currency;return"Цена тура: "+(0,i.getPrice)(o)+" "+(0,n.getPureCurrencyRusStr)(r).toLowerCase()+"/чел"},t.prototype._getShareDescription=function(t){if(!t)return"";var e=a.HotOffersContentUtils.formatStr,o=t.Description;return o?""+e((0,n.br2nl)(o)):""},t.prototype._getShareTitle=function(t){if(!t)return"";var e=a.HotOffersContentUtils.formatStr,o=t.Title;return o?e(o):""},t}();e.HotOffersShareUtils=l,e.hotOffersShareUtils=new l,t.hotOffersShareUtils=e.hotOffersShareUtils,t.HotOffersShareUtils=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__assign||function(){return i=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},i.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.hotOffersUtils=void 0;var r=o(7),n=o(1),s=o(5),a=o(6),l=o(13),u=o(28),c=o(38),h=o(33),d=o(166),p=function(){function t(){}return t.prototype.getApiItems=function(t){return t&&(0,n.isArray)(t.items)?t.items:[]},t.prototype.getItems=function(t){var e=this;return t.map(function(t){return e.getItem(t)}).filter(function(t){return t})},t.prototype.getItem=function(t,e){if(t){var o=t.client_id,l=t.created_at,c=t.currency_id,d=t.description,p=t.id,_=t.like_count,f=t.link,y=t.old_price,g=t.picture,C=t.picture_id,v=t.price,m=t.share_count,T=t.status,w=t.title,S=t.tour_id,P=t.view_count,b=l?this.getDateWithDayAndHours(l):"",I=g&&g.path||"",O=(0,a.isUrl)(I)?I:u.pictureUtils.getHotOfferLink(I),M=this.getOfferId(t),D=(0,n.isDefined)(c)?c:s.Currency.Rub,E=(0,n.isDefined)(T)&&T!==h.HotOfferStatus.NONE?T:h.HotOfferStatus.ACTUAL,k=this._getSearchSettings(t),R=this.getSearchLink(e,i(i({},k),{Currency:D,Tourists:{Adults:r.DEFAULT_ADULTS,Children:[]}})),A=this._getSnapshots(t,e,D);return{Date:b,Description:d||"",FilterSettings:k,Id:M,IsManual:(0,n.isNumber)(o),LikeCount:_||0,PictureId:C||0,PictureLink:O,Price:{Currency:D,New:v||0,Old:y||0},SearchLink:R,ShareCount:m||0,Snapshots:A,Status:E,Title:w||"",TourId:S||0,TourLink:f||"",Uid:p,ViewCount:(0,a.convertViewCount)(P||0)}}},t.prototype.getDateWithDayAndHours=function(t){var e=new Date,o=new Date;o.setDate(o.getDate()-1);var i=new Date(t),r="";switch(!0){case e.getDate()===i.getDate()&&e.getMonth()===i.getMonth():r="Сегодня";break;case o.getMilliseconds()===i.getDate()&&e.getMonth()===i.getMonth():r="Вчера";break;default:r=i.getDate()+" "+l.FormatDate.getShortMonthName(i.getMonth())}var n=i.getHours(),s=i.getMinutes();return r+" "+(n<10?"0":"")+n+":"+(s<10?"0":"")+s},t.prototype.getPageCount=function(t){return t&&Number(t.pageCount)||0},t.prototype.getOfferId=function(t){return t&&t.hot_offer_id||0},t.prototype.getId=function(t){return t&&t.id||0},t.prototype.getSearchLink=function(t,e){var o=e.Countries,i=e.Departure;return t&&i&&(0,a.isNotEmptyArray)(o)?""+t+(0,a.formUri)(e):""},t.prototype._getSnapshots=function(t,e,o){var r=this,s=t.snapshots,a=void 0===s?[]:s,u=t.nights,c=t.fly_date;return a.map(function(s){var a=s.fly_date,h=s.meal_id,d=s.price,p=l.FormatDate.getPureDate(a),_=r._getSearchSettings(i(i({},t),{fly_date:a,meal_id:h})),f=r.getSearchLink(e,i(i({},_),{Currency:o}));return{Currency:o,Date:p.getDate()+" "+l.FormatDate.getShortMonthName(p.getMonth()),Day:l.FormatDate.getJSWeekdayName(p.getDay()),IsCurrent:c===a,Link:f,Nights:u>0?u+" нч":"",Price:(0,n.getPrice)(d)}})},t.prototype._getSearchSettings=function(t){var e=t.country_id,o=t.departure_id,i=t.fly_date,n=t.hotel_id,a=t.meal_id,u=t.nights,h=t.region_id,p=t.stars;return{Countries:e?[e]:[],Departure:o||r.DEFAULT_DEPARTURE_ID,Feed:a||s.MealType.Any,FlyDates:i?[l.FormatDate.getPureDate(i),l.FormatDate.getPureDate(i)]:[],FormMode:c.SearchFormMode.FLIGHTS,HotelClass:p||r.MIN_STARS,Hotels:n?[n]:[],Nights:u?[u,u]:[],Regular:d.HOT_OFFER_DEFAULT_REGULAR,Resorts:h?[h]:[]}},t}();e.hotOffersUtils=new p,t.hotOffersUtils=e.hotOffersUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.fromTourvisorService=void 0;var i=o(7),r=o(45),n=function(){function t(){}return t.prototype.setFlag=function(){var t=new Date;t.setMonth(t.getMonth()+1),(0,r.setStorage)(i.STORAGE_FROM_TV,1,{expires:t.toUTCString(),path:i.COOKIE_PATH})},t.prototype.hasFlag=function(){var t=(0,r.getStorage)(i.STORAGE_FROM_TV);return Boolean(t)},t}();e.fromTourvisorService=new n,t.fromTourvisorService=e.fromTourvisorService}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.TourProgramGalleryType=void 0;var o;!function(t){t[t.GALLERY=1]="GALLERY",t[t.SLIDER=2]="SLIDER"}(o=e.TourProgramGalleryType||(e.TourProgramGalleryType={})),t.TourProgramGalleryType=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelReviewsView=void 0;var r=o(2),n=o(4),s=o(3),a=o(1),l=o(476),u=o(303),c=function(t){function e(e){var o=t.call(this,e)||this;return o.UpButtonClicked=new s.UserEvent,o.templateName="hotel-reviews-view",o._HotelId=0,o._InitReviewsCount=0,o._ReviewsServicesLinks=null,o._UpButtonEnable=!0,o._Ready=null,o._addReviewControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){this._Ready=null,t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this),this._hotelReviewsController=new u.HotelReviewsController({HotelId:this._HotelId,InitReviewsCount:this._InitReviewsCount,ParentNode:this._nodes.reviewsNode,ReviewsServicesLinks:this._ReviewsServicesLinks,AddReviewClicked:new n.Delegate(this,this._onAddReviewClicked),DataLoaded:this._Ready,MoreReviewClicked:new n.Delegate(this,this._showUpButton)})},e.prototype.update=function(e){t.prototype.update.call(this,e),this._reset(),(0,a.isDefined)(e.HotelId)&&this._hotelReviewsController.update(e)},e.prototype._onAddReviewClicked=function(){(0,a.addClass)(this._DomNode,e.TV_ADD_REVIEW_ENABLE);var t=this._nodes.addReviewNode;this._addReviewControl||(this._addReviewControl=new l.CreateHotelReviewControl({HotelId:this._HotelId,ParentNode:t})),(0,a.show)(t)},e.prototype._onUpButtonClick=function(){this.UpButtonClicked.fire()},e.prototype._reset=function(){(0,a.hide)(this._nodes.addReviewNode),this._UpButtonEnable&&(0,a.hide)(this._nodes.upButton),(0,a.removeClass)(this._DomNode,e.TV_ADD_REVIEW_ENABLE),this._addReviewControl&&(this._addReviewControl.destroy(),this._addReviewControl=null)},e.prototype._showUpButton=function(){this._UpButtonEnable&&(0,a.show)(this._nodes.upButton)},e.TV_ADD_REVIEW_ENABLE="TVAddReviewEnable",e}(r.Control);e.HotelReviewsView=c,t.HotelReviewsView=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.OnlinePartnerActionEnum=void 0;var o;!function(t){t.MAP="map",t.REDIRECT="redirect",t.DIRECT="direct"}(o=e.OnlinePartnerActionEnum||(e.OnlinePartnerActionEnum={})),t.OnlinePartnerActionEnum=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TourBuyControl=void 0;var n=o(34),s=o(120),a=o(2),l=o(4),u=o(3),c=o(7),h=o(1),d=o(5),p=o(6),_=o(13),f=o(32),y=o(184),g=o(40),C=o(934),v=o(935),m=o(193),T=o(490),w=o(938),S=o(491),P=o(943),b=o(305),I=o(945),O=o(309),M=function(t){function e(e){var o=t.call(this,e)||this;return o.ExportCrmClicked=new u.UserEvent,o.SendingClicked=new u.UserEvent,o._Class="TVTourBuyControl",o._CrmError="",o._CrmName=d.ExportCrmName.NONE,o._CrmStatus=d.ExportCrmStatus.DISABLE,o._CrmUrl="",o._FormRequiredFields=d.FormRequiredFieldsType.PhoneOrEmail,o._IncludePrices=[],o._IsEnabledBuy=!0,o._IsManager=!1,o._IsVisibleConfirmation=!1,o._IsVisibleContract=!0,o._IsVisiblePriceWaiter=!1,o._ModeView=d.ModeView.DescTop,o._PaymentTypesEnabled=!0,o._Price=0,o._PriceType=d.PriceType.ForRoom,o._PromocodeEnabled=!1,o._TourBuyType=O.TourBuyTypeEnum.BUY,o._TourId=0,o._UserInputFields=[m.UserInputType.NAME,m.UserInputType.PHONE,m.UserInputType.EMAIL,m.UserInputType.ADDRESS],o._UserInputLabels={ADDRESS:c.ADDRESS_LABEL,EMAIL:c.EMAIL_LABEL,NAME:c.FULL_NAME_LABEL,PHONE:c.MOBILE_PHONE_LABEL},o._ContractClicked=null,o._actionButtons=null,o._actionFactory=null,o._pricesControl=null,o._touristsForm=null,o._userForm=null,o._headerNode=null,o._footerNode=null,o._currency=d.Currency.Rub,o._prePayType=d.PayType.Full,o._prePayValue=0,o._promoCode="",o._promoDiscount=0,o._touristsData=[],o._userData={},o._touristsVisa=0,t.prototype.__initSettings.call(o,e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._headerNode=(0,h.newDiv)("TVTourBuyHeader",this._DomNode),this._touristsForm=new P.TourBuyTouristListControl({Class:"TVTourBuyTouristData",ModeView:this._ModeView,ParentNode:this._DomNode,TouristDataChanged:new l.Delegate(this,this._onTouristDataChanged)});var e=this._isVisibleContract();this._userForm=new T.CustomerContactsForm({FormRequiredFields:this._FormRequiredFields,IsVisibleContract:e,ParentNode:this._DomNode,UserInputFields:this._UserInputFields,UserInputLabels:this._UserInputLabels,Changed:new l.Delegate(this,this._onUserDataChanged),ContractClicked:this._ContractClicked,PromocodeChanged:new l.Delegate(this,this._onPromocodeChanged)}),this._footerNode=(0,h.newDiv)("TVTourBuyFooter",this._DomNode),this._pricesControl=new b.TourCardPriceControl({IsVisibleConfirmation:this._IsVisibleConfirmation,ParentNode:this._footerNode,PriceType:this._PriceType}),this._actionFactory=new w.TourBuyActionFactory,this._renderActionButtons(),this._updateType(),this._updatePrices()},e.prototype.update=function(e){var o=this._IsManager;t.prototype.update.call(this,e);var i=e.CrmError,r=e.CrmName,n=e.CrmStatus,a=e.CrmUrl,l=e.IncludePrices,u=e.IsEnabledBuy,c=e.IsForceUpdate,d=e.IsManager,p=e.IsVisibleConfirmation,y=e.IsVisiblePriceWaiter,C=e.Price,v=e.PriceType,m=e.PromocodeEnabled,T=e.TourId;if((0,h.isDefined)(d)&&o!==d){this._renderActionButtons();var w=this._isVisibleContract(),P=this._isVisiblePromocode();this._userForm.update({IsVisibleContract:w,IsEnabledPromocode:P})}if((0,h.isDefined)(T)||(0,h.isDefined)(c)){this._clear();var b=s.orderCatalog.getClientData(),I=s.orderCatalog.getTourData(this._TourId),O=f.clientUtils.getClientBuyData(b),M=g.tourUtils.getTourBuyData(I);this._currency=g.tourUtils.getCurrency(I);var D=g.tourUtils.getVisa(I);this._touristsData=s.orderCatalog.getTouristsData()||[],this._touristsForm.update({Adults:M.Adults,Children:M.Children,Currency:this._currency,RusPassport:O.RusPassport,TourEndDate:_.FormatDate.strToDate(M.TourEndDate),TourStartDate:_.FormatDate.strToDate(M.TourStartDate),TouristData:this._touristsData,Visa:D}),this._userData=s.orderCatalog.getUserData()||{};var E=f.clientUtils.getRequiredAddress(b),P=this._isVisiblePromocode();this._userForm.update({IsEnabledPromocode:P,IsRequiredAddress:E,TourId:this._TourId,TourPrice:this._Price,Value:this._userData}),this._actionButtons instanceof S.TourBuyCustomerButtonsControl&&this._actionButtons.update({Currency:this._currency,PrePaymentTypes:O.PaymentTypes,Reset:!0}),this._pricesControl.update({Currency:this._currency})}if(((0,h.isDefined)(p)||(0,h.isDefined)(v)||(0,h.isDefined)(y))&&this._pricesControl.update({IsVisibleConfirmation:this._IsVisibleConfirmation,IsVisibleWaiter:this._IsVisiblePriceWaiter,PriceType:this._PriceType}),((0,h.isDefined)(l)||(0,h.isDefined)(C)||(0,h.isDefined)(T))&&this._updatePrices(),(0,h.isDefined)(C)&&this._userForm.update({TourPrice:this._Price}),(0,h.isDefined)(a)||(0,h.isDefined)(n)||(0,h.isDefined)(r)||(0,h.isDefined)(i)||(0,h.isDefined)(u)){var k={};(0,h.isDefined)(a)&&(this._actionButtons.update({IsVisibleCrmWaiter:!1}),k.CrmUrl=a),(0,h.isDefined)(n)&&(k.CrmStatus=n),(0,h.isDefined)(r)&&(k.CrmName=r),(0,h.isDefined)(i)&&(k.CrmError=i),(0,h.isDefined)(u)&&(k.IsEnableBuy=this._IsEnabledBuy),this._actionButtons.update(k)}if((0,h.isDefined)(m)){var P=this._isVisiblePromocode();this._userForm.update({IsEnabledPromocode:P})}},e.prototype.destroy=function(){this._clear(),this._ContractClicked=null,t.prototype.destroy.call(this)},e.prototype._clear=function(){this._promoDiscount=0,this._promoCode="",this._touristsVisa=0,this._actionButtons.update({CrmUrl:"",IsVisibleCrmWaiter:!1,IsVisibleWaiter:!1})},e.prototype._init=function(){var t=n.clientCatalog.getClientData();this._FormRequiredFields=f.clientUtils.getFormRequiredFields(t)},e.prototype._onBuyClicked=function(){var t=this._touristsForm.validate(),e=this._userForm.validate(),o=!(this._actionButtons instanceof S.TourBuyCustomerButtonsControl)||this._actionButtons.validate();switch(!0){case!t:return void this._touristsForm.scrollToInvalid();case!e:return void this._userForm.scrollToInvalid();case!o:return}var i=y.touristUtils.getOrderTouristData(this._touristsData),r=C.userUtils.getOrderUserData(this._userData,this._promoCode,this._promoDiscount),n=this._getPrice(),s={PayType:this._prePayType,Price:n,Tourists:i,UserData:r,CallBack:new l.Delegate(this,this._onBuyResponse)};this._prePayType===d.PayType.Prepay&&(s.Prepay=this._prePayValue),this._actionButtons.update({IsVisibleWaiter:!0}),this.SendingClicked.fire(s)},e.prototype._onBuyResponse=function(){this._actionButtons.update({IsVisibleWaiter:!0})},e.prototype._onExportCrmClicked=function(t){if(!(this._CrmUrl.length>0)){var e=t.Event;(0,h.preventDefault)(e),this._actionButtons.update({IsVisibleCrmWaiter:!0});var o=y.touristUtils.getOrderTouristData(this._touristsData),i=C.userUtils.getOrderUserData(this._userData,this._promoCode,this._promoDiscount),r=this._getPrice(),n={PayType:this._prePayType,Price:r,Tourists:o,UserData:i};this._prePayType===d.PayType.Prepay&&(n.Prepay=this._prePayValue),this.ExportCrmClicked.fire(n)}},e.prototype._onPaymentChanged=function(t){var e=t.PrepayValue,o=t.SelectedPayType;this._prePayValue=e,this._prePayType=o},e.prototype._onPromocodeChanged=function(t){var e=t.Discount,o=t.PromoCode;this._promoDiscount=e,this._promoCode=o,this._updatePrices()},e.prototype._onTouristDataChanged=function(t){var e=t.Value,o=t.Index;this._touristsData[o]=r(r({},this._touristsData[o]),e);var i=[];this._touristsData&&this._touristsData.forEach(function(t){var e=(0,p.getFilteredData)(t);Object.keys(e).length>0&&i.push(e)}),s.orderCatalog.setTouristsData(i),this._updatePrices()},e.prototype._onUserDataChanged=function(t){var e=t.Value;this._userData=r(r({},this._userData),e);var o=(0,p.getFilteredData)(this._userData);s.orderCatalog.setUserData(o)},e.prototype._renderActionButtons=function(){this._actionButtons&&this._actionButtons.destroy(),this._actionButtons=this._IsManager?this._actionFactory.getManager({CrmName:this._CrmName,CrmStatus:this._CrmStatus,IsEnableBuy:this._IsEnabledBuy,ParentNode:this._footerNode,BuyClicked:new l.Delegate(this,this._onBuyClicked),ExportCrmClicked:new l.Delegate(this,this._onExportCrmClicked)}):this._actionFactory.getCustomer({IsEnableBuy:this._IsEnabledBuy,IsVisiblePrePayment:this._PaymentTypesEnabled,ModeView:this._ModeView,ParentNode:this._footerNode,BuyClicked:new l.Delegate(this,this._onBuyClicked),ContractClicked:this._ContractClicked,PrePaymentChanged:new l.Delegate(this,this._onPaymentChanged)})},e.prototype._updateType=function(){switch(this._TourBuyType){case O.TourBuyTypeEnum.OPERATOR_BOOKING:(0,h.addClass)(this._DomNode,I.TV_OPERATOR_BOOKING);break;case O.TourBuyTypeEnum.BUY_IN_CREDIT:break;case O.TourBuyTypeEnum.BUY:}},e.prototype._updateVisa=function(){var t=s.orderCatalog.getTourData(this._TourId);this._touristsVisa=v.visaUtils.getTouristsVisaCharge(t,this._touristsData)},e.prototype._updatePrices=function(){this._updateVisa();var t=this._getIncludePrices(),e=this._getPrice();this._pricesControl.update({IncludePrices:t,Price:e}),this._actionButtons instanceof S.TourBuyCustomerButtonsControl&&this._actionButtons.update({Price:e})},e.prototype._isVisibleContract=function(){return this._IsVisibleContract&&this._ModeView===d.ModeView.Mobile&&!this._IsManager},e.prototype._isVisiblePromocode=function(){return this._PromocodeEnabled&&!this._IsManager},e.prototype._getIncludePrices=function(){var t=this._IncludePrices;return this._touristsVisa>0&&(t=g.tourUtils.addVisaCharge(t,this._touristsVisa)),0!==this._promoDiscount&&(t=g.tourUtils.addPromoсodeDiscount(t,-this._promoDiscount)),t},e.prototype._getPrice=function(){var t=this._Price;return this._touristsVisa>0&&(t+=this._touristsVisa),0!==this._promoDiscount&&(t-=this._promoDiscount),t},e}(a.Control);e.TourBuyControl=M,t.TourBuyControl=M}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.ManagerOrderAction=void 0;var o;!function(t){t[t.EXPORT_CRM=0]="EXPORT_CRM",t[t.CREATE_CONTRACT=1]="CREATE_CONTRACT",t[t.BOOKING=2]="BOOKING",t[t.OPEN_TO=3]="OPEN_TO",t[t.OPERATOR_BOOKING=4]="OPERATOR_BOOKING"}(o=e.ManagerOrderAction||(e.ManagerOrderAction={})),t.ManagerOrderAction=o}).call(e,o(0))},function(t,e,o){"use strict";var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ResultBuilder=void 0;var n=o(17),s=o(2),a=o(4),l=o(3),u=o(7),c=o(1),h=o(5),d=o(6),p=o(119),_=o(10),f=o(35),y=o(38),g=o(62),C=o(979),v=o(980),m=function(t){function e(){var o=null!==t&&t.apply(this,arguments)||this;return o.SendRequest=new l.UserEvent,o._AvailableTourDateLinks=[],o._ExpandAll=!1,o._FlyMonth=0,o._ModeView=h.ModeView.None,o._ShowHelpForm=!0,o._ShowOperator=!1,o._SizeRenderBlock=e.RenderedBlockCount,o._Sort=h.SortBy.Price,o._activeItemsArr=[],o._items={},o._itemsNotViewed=[],o._helpForm=null,o._helpRequestBlocks=[],o._renderedCount=0,o._removeQueueTimeouts={},o._expandItems=[],o._expand=!1,o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),(0,c.addEvent)(window,"scroll",this._onScrollWindow)},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.AvailableTourDateLinks;(0,c.isDefined)(o)&&this._updateAvailableTourDates(o)},e.prototype.clear=function(){this._items={},this._itemsNotViewed=[],this._helpRequestBlocks=[],this._renderedCount=0,this._activeItemsArr=[],this._expandItems=[],this._expand=this._ExpandAll,(0,c.removeChildren)(this._DomNode)},e.prototype.sort=function(t){this._Sort=t,this._redrawItems()},e.prototype.filter=function(){this._redrawItems()},e.prototype.isAllRendered=function(){return this._renderedCount===this._activeItemsArr.length},e.prototype.getLastRenderedItem=function(){for(var t=this._activeItemsArr.length-1;t>=0;t--)if(this._isRenderedItem(this._activeItemsArr[t]))return this._activeItemsArr[t];return null},e.prototype.getActiveItemsCount=function(){return this._activeItemsArr.length},e.prototype.updateAll=function(){this._SizeRenderBlock=this._renderedCount,this._DomNode.style.opacity="0",setTimeout(function(){this._onRedrawItems(),this._SizeRenderBlock=e.RenderedBlockCount}.bind(this),e.UpdateDelay)},e.prototype.hideLastQuestionBlock=function(){var t=this._helpRequestBlocks.length;t>1&&(0,c.hide)(this._helpRequestBlocks[t-1].getParentNode())},e.prototype.renderMore=function(t){for(var e=this._activeItemsArr,o=e.length,i=0,r=t&&t<this._SizeRenderBlock?t:0;i<o&&r<this._SizeRenderBlock;){var n=e[i];if(!this._isRenderedItem(n)){if(!this._renderItem(n,this._Sort!==h.SortBy.Price))continue;r++}i++}return r},e.prototype.end=function(){if(this._activeItemsArr.length>0)return void this._renderQuestionBlock();this._helpForm?this._DomNode.appendChild(this._helpForm.getDomNode()):this._helpForm=new C.HelpFormControl({AvailableTourDateLinks:this._AvailableTourDateLinks,ParentNode:this._DomNode,StyleTheme:this._Theme===h.Theme.Theme1?_.StyleThemeEnum.THEME1:_.StyleThemeEnum.THEME2,AvailableTourDateClicked:new a.Delegate(this,this._onAvailableTourDateClicked),SearchRegularClicked:new a.Delegate(this,this._onSearchRegularClicked),SubmitClicked:new a.Delegate(this,this._onShowRequestForm,{Metrica:h.Metrica.NoTour})});var t=n.resultStore.getActualSearchSettings(),e=t.FormMode,o=t.Regular,i=o===h.RegularTours.On,r=e===y.SearchFormMode.FLIGHTS;this._helpForm.update({IsVisibleRegular:this._ShowHelpForm&&!i&&r,IsVisibleRequest:this._ShowHelpForm,IsVisibleTourDates:this._ShowHelpForm})},e.prototype.setIsVisible=function(e){this._IsVisible!==e&&(e?(this._redrawItems(),n.resultStore.Changed.addOnce(new a.Delegate(this,this._onResultStoreChanged))):n.resultStore.Changed.remove(this),t.prototype.setIsVisible.call(this,e))},e.prototype.expand=function(){this._expand=!this._expand;for(var t=this._activeItemsArr,e=0;this._isRenderedItem(t[e])&&e<t.length;)t[e].update({Expand:this._expand}),e++},e.prototype.destroy=function(){(0,c.removeEvent)(window,"scroll",this._onScrollWindow),n.resultStore.Changed.remove(this),t.prototype.destroy.call(this)},e.prototype._init=function(){this._expand=this._ExpandAll,this._onRedrawItems=this._onRedrawItems.bind(this),this._onScrollWindow=this._onScrollWindow.bind(this),this._IsVisible&&n.resultStore.Changed.addOnce(new a.Delegate(this,this._onResultStoreChanged))},e.prototype._redrawItems=function(){this._DomNode.style.opacity="0",this._activeItemsArr=[],setTimeout(this._onRedrawItems,e.UpdateDelay)},e.prototype._updateAvailableTourDates=function(t){if(this._helpForm){var e=n.resultStore.getActualSearchSettings().FormMode,o=e===y.SearchFormMode.FLIGHTS;this._helpForm.update({AvailableTourDateLinks:t,IsVisibleTourDates:o})}},e.prototype._onRedrawItems=function(){this._closeItems(),this._DomNode.style.opacity="",(0,c.removeEvent)(window,"scroll",this._onScrollWindow);var t=(0,c.getScrolls)().Y;switch((0,c.removeChildren)(this._DomNode),this._renderedCount=0,this._helpRequestBlocks=[],this._itemsNotViewed=[],this._Sort){case h.SortBy.Price:this._renderItemsByPrice();break;case h.SortBy.Rating:this._renderItemsByRating();break;case h.SortBy.Popularity:this._renderItemsByPop();break;case h.SortBy.Name:this._renderItemsByName()}(0,c.setScrollTop)(t),(0,c.addEvent)(window,"scroll",this._onScrollWindow)},e.prototype._closeItems=function(){for(var t=this._expandItems.length-1;t>=0;t--)this._items[this._expandItems[t]].update({Expand:!1});this._expand=this._ExpandAll},e.prototype._renderFirst=function(){for(var t=-1,o=0,i=this._activeItemsArr.length-1;t<i&&o<this._SizeRenderBlock;)t++,this._renderItem(this._activeItemsArr[t])&&(++o!==e.MinDistanceToQuestionBlock&&o!==this._SizeRenderBlock||this._renderQuestionBlock())},e.prototype._updateRenderItems=function(){var t=this._SizeRenderBlock;if(this._renderedCount<t)for(var o=Math.min(this._activeItemsArr.length,t),i=0;i<o;i++){var r=this._renderedCount;this._isRenderedItem(this._activeItemsArr[i])||this._renderItem(this._activeItemsArr[i]),this._renderedCount===e.MinDistanceToQuestionBlock&&r!==this._renderedCount&&this._renderQuestionBlock()}else for(var o=this._getIndexOfLastRenderedItem(),i=0;i<o;i++)if(!this._isRenderedItem(this._activeItemsArr[i])){var r=this._renderedCount;this._removeLastNotVisibleItem(),this._renderItem(this._activeItemsArr[i]),this._renderedCount===e.MinDistanceToQuestionBlock&&r!==this._renderedCount&&this._renderQuestionBlock()}},e.prototype._onMinPriceChanged=function(t){if(this._Sort===h.SortBy.Price){var e=this._items[t.Id],o=this._activeItemsArr.indexOf(e);if(!(o<=0)){var i=this._getBeforeIndex(e);if(i!==o&&-1!==i){var r=this._activeItemsArr[i];if((0,c.changeIndex)(this._activeItemsArr,o,i),r)if(this._isRenderedItem(e)){this._isRenderedItem(r)||this._renderItem(r);var n=this._getNodesPosition(e.getParentNode()),s=e.getParentNode().offsetHeight;n===h.ViewPortPos.Visible?this._removeItem(e):this._DomNode.removeChild(e.getParentNode());var a=this._getNodesPosition(r.getParentNode());n===h.ViewPortPos.Above&&a===h.ViewPortPos.Under&&(document.body.scrollTop-=s),a===h.ViewPortPos.Visible&&n!==h.ViewPortPos.Visible?this._insertBeforeItem(e,r):this._DomNode.insertBefore(e.getParentNode(),r.getParentNode()),n===h.ViewPortPos.Under&&a===h.ViewPortPos.Above&&(document.body.scrollTop+=s)}else this._isRenderedItem(r)&&(this._removeLastNotVisibleItem(),this._renderItem(e))}}}},e.prototype._getBeforeIndex=function(t){var e,o=t.getPrice(),i=this._activeItemsArr.indexOf(t),r=i-1,n=-1;for(e=this._activeItemsArr[r].getPrice();r>=0&&(o<e||0===e)&&(e>0&&(n=r),!(--r<0));)e=this._activeItemsArr[r].getPrice();return n},e.prototype._insertBeforeItem=function(t,e){var o=t.getParentNode(),i=t.getDomNode(),r=o.cloneNode();this._DomNode.appendChild(o);var n=i.offsetHeight;this._DomNode.removeChild(o),o.style.height=n+"px",r.style.height="0",i.parentNode&&i.parentNode.removeChild(i),this._DomNode.insertBefore(r,e.getParentNode()),t.setParentNode(r),setTimeout(function(){r.style.height=n+10+"px",i.style.overflow="hidden",r.appendChild(i),setTimeout(function(){r.style.height="",i.style.overflow=""},600)},50)},e.prototype._renderItemsByPrice=function(){var t=this._getItems();t.sort(function(t,e){return t.getPrice()<e.getPrice()?-1:t.getPrice()>e.getPrice()?1:0}),this._activeItemsArr=t,this._renderFirst()},e.prototype._renderItemsByRating=function(){},e.prototype._renderItemsByPop=function(){},e.prototype._renderItemsByName=function(){},e.prototype._addToDom=function(t){var e=this._getBeforeItem(t);if(e){this._isRenderedItem(e)||this._renderItem(e);var o=void 0;try{o=this._getNodesPosition(e.getParentNode())}catch(t){}this._DomNode.insertBefore(t.getParentNode(),e.getParentNode()),o===h.ViewPortPos.Above&&(document.body.scrollTop+=t.getParentNode().offsetHeight)}else this._DomNode.appendChild(t.getParentNode())},e.prototype._renderItem=function(t,e){if(0===t.getPrice())return!1;if(!t.getParentNode()){var o=(0,c.newDiv)("blpricesort");t.setParentNode(o),t.render()}return e?this._DomNode.appendChild(t.getParentNode()):this._addToDom(t),this._renderedCount++,this._updateItemsNotViewed(t),!0},e.prototype._removeItem=function(t){var e=this,o=t.getParentNode();if(Object.keys(this._items).length<3)return void(0,c.remove)(o);var i=o.cloneNode();o.parentNode.insertBefore(i,o);var n=t.clone({Class:"TVClone",ParentNode:i}),s=t.getId()+"-"+t.getPrice(),l={CloneItem:n,CloneItemRoot:i,Hash:s},u=r({SourceNode:o},l);n.update({IsVisibleGoToItem:!0,GoToItemClicked:new a.Delegate(this,this._onGoToItemClick.bind(this,u))}),i.style.height=i.offsetHeight+"px",i.style.opacity="1",this._removeQueueTimeouts[s]=setTimeout(function(){return e._removeItemTimeout(l)},1e4)},e.prototype._removeItemTimeout=function(t){var e=t.Hash,o=t.CloneItemRoot,i=t.CloneItem;clearTimeout(this._removeQueueTimeouts[e]),delete this._removeQueueTimeouts[e],o.style.overflow="hidden",o.style.height="0px",o.style.opacity="0",setTimeout(function(){(0,c.remove)(o),i.destroy()},500)},e.prototype._onGoToItemClick=function(t){var e=t.SourceNode;if(this._removeItemTimeout(t),this._ModeView===h.ModeView.DescTop){var o=(0,c.cumulativeOffset)(e);return void(0,c.scrollToTop)(200,o.top-u.FIXED_TOOLBAR_HEIGHT)}e.scrollIntoView({block:"start",behavior:"smooth"})},e.prototype._onScrollWindow=function(){for(var t=(0,c.getScrolls)().Y+(0,c.getViewPort)().y,e=this._itemsNotViewed.length-1;e>=0;e--){t>this._itemsNotViewed[e].getDomNode().offsetTop&&this._itemsNotViewed.splice(e,1)}},e.prototype._updateItemsNotViewed=function(t){var e=(0,c.getScrolls)().Y+(0,c.getViewPort)().y;t.getDomNode().offsetTop>e&&this._itemsNotViewed.push(t)},e.prototype._getIndexOfLastRenderedItem=function(){for(var t=this._activeItemsArr.length-1;t>=0&&!this._isRenderedItem(this._activeItemsArr[t]);t--);return t},e.prototype._removeLastNotVisibleItem=function(){if(this._itemsNotViewed.length>0){var t=this._activeItemsArr[this._getIndexOfLastRenderedItem()],e=this._itemsNotViewed.indexOf(t);this._itemsNotViewed.splice(e,1),this._DomNode.removeChild(t.getParentNode()),this._renderedCount--}},e.prototype._renderQuestionBlock=function(){if(this._ModeView===h.ModeView.DescTop&&this._ShowHelpForm){var t;if(this._helpRequestBlocks.length<2){var o=(0,c.newDiv)("blpricesort",this._DomNode);t=new v.HelpRequestControl({ParentNode:o,StyleTheme:this._Theme===h.Theme.Theme1?_.StyleThemeEnum.THEME1:_.StyleThemeEnum.THEME2,SubmitClicked:new a.Delegate(this,this._onShowRequestForm,{Metrica:h.Metrica.HelpTour})}),this._helpRequestBlocks.push(t)}else t=this._helpRequestBlocks[1];if(this._helpRequestBlocks.length>1){var i=this._helpRequestBlocks[0].getParentNode(),r=(0,f.getChildNodes)(this._DomNode),n=r.indexOf(i),s=r.indexOf(t.getParentNode());(0,c.setVisible)(t.getParentNode(),s-n>e.MinDistanceToQuestionBlock)}}},e.prototype._getNodesPosition=function(t){var e=(0,c.cumulativeOffset)(t).top,o=(0,c.getScrolls)().Y;return e>o+document.documentElement.clientHeight?h.ViewPortPos.Under:e<o?h.ViewPortPos.Above:h.ViewPortPos.Visible},e.prototype._onItemExpandChanged=function(t){var e=t.Expand,o=t.Id;e?(0,c.insertUnique)(this._expandItems,o):this._expandItems=this._expandItems.filter(function(t){return t!==o}),0===this._expandItems.length&&(this._expand=!1)},e.prototype._onAvailableTourDateClicked=function(t){var e=t.Link,o={};(0,d.findSettingsFromUrl)(o,e),(0,g.runSearchWithUpdateFilter)(o)},e.prototype._onSearchRegularClicked=function(){(0,g.runSearchWithUpdateFilter)({Regular:h.RegularTours.On})},e.prototype._onShowRequestForm=function(t){var e=(0,g.getRequestTourComment)(),o=(0,g.getRequestAboutTour)();(0,p.showRequest)({Comment:e,Description:o,ModeView:h.ModeView.DescTop,SendClicked:new a.Delegate(this,this._onSendRequest,{Metrica:t.Metrica})})},e.prototype._onSendRequest=function(t){this.SendRequest.fire(t)},e.RenderedBlockCount=15,e.MinDistanceToQuestionBlock=5,e.UpdateDelay=50,e}(s.Control);e.ResultBuilder=m},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelsResortsMapController=void 0;var r=o(316),n=o(131),s=o(1099),a=o(41),l=o(56),u=o(17),c=o(9),h=o(5),d=o(1100),p=o(171),_=o(94),f=o(160),y=o(37),g=o(25),C=o(1101),v=o(1102),m=function(t){function e(e){var o=t.call(this,e)||this;return o._FilterSettings={},o._FlyMonth=0,o._ParentNode=null,o._Ref=null,o._ToursGroup=h.ToursGroupBy.Hotels,o._View=null,o._WindowClass="",o._Hide=null,o._MarkerClicked=null,o._mapController=null,o._queryCountryInfoInProccess=!1,o._queryInfoInProccess=!1,o._isInfoReceived=!1,o.__initSettings(e),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._mapController&&this._mapController.update(e)},e.prototype.show=function(){var t=this;if(!this._mapController){var e={FlyMonth:this._FlyMonth,FilterSettings:this._FilterSettings,ParentNode:this._ParentNode,ToursGroup:this._ToursGroup,View:this._View,WindowClass:this._WindowClass,Hide:this._Hide,MarkerClicked:this._MarkerClicked};this._ToursGroup===h.ToursGroupBy.Hotels?this._mapController=new C.HotelsMapController(e):this._mapController=new v.ResortsMapController(e)}if(!this._queryCountryInfoInProccess)if(this._hasCountryInfo())this._updateMapBounds(),this._mapController.show(),this._mapController.update({InfoRecieved:this._isInfoReceived}),this._updateAirports();else{var o=g.settingUtils.getCountryId(this._FilterSettings);this._queryCountryInfoInProccess=!0,p.countryService.read(o,{}).then(function(e){t._isDestroyed||(t._queryCountryInfoInProccess=!1,u.resultStore.setCountryInfo(o,e),t._updateMapBounds(),t._mapController.show(),t._mapController.update({InfoRecieved:t._isInfoReceived}),t._updateAirports())})}},e.prototype._queryHotelsResortsInfo=function(){var t=this;this._isInfoReceived=!1;var e=Promise.resolve(),o=Promise.resolve(),i=Promise.resolve(),r=Promise.resolve(),s=g.settingUtils.getCountryId(this._FilterSettings);return l.resortsStore.getResorts(s)||(e=_.regionService.all({countryId:s})),l.resortsStore.getSubResorts(s)||(o=f.subRegionService.all({countryId:s})),0===a.hotelsStore.getHotelsByCountry(s).length&&(i=(0,n.loadHotelsCatalog)(s)),u.resultStore.getCountryInfo(s)||(r=p.countryService.read(s,{})),Promise.all([e,o,i,r]).then(function(e){var o=e[0],i=e[1],r=(e[2],e[3]);o&&l.resortsStore.setResorts(s,o),i&&l.resortsStore.setSubResorts(s,i),r&&u.resultStore.setCountryInfo(s,r),t._isInfoReceived=!0})},e.prototype._hasInfo=function(){var t=g.settingUtils.getCountryId(this._FilterSettings),e=l.resortsStore.getResorts(t),o=l.resortsStore.getSubResorts(t),i=a.hotelsStore.getHotelsByCountry(t);return e&&o&&i.length>0},e.prototype._hasCountryInfo=function(){var t=g.settingUtils.getCountryId(this._FilterSettings);return!!u.resultStore.getCountryInfo(t)},e.prototype._updateMapBounds=function(){var t=this,e=null;this._queryInfoInProccess||(this._hasInfo()?(e=this._getHotelsResortsBounds(),this._isInfoReceived=!0):(this._queryInfoInProccess=!0,this._queryHotelsResortsInfo().then(function(){t._isDestroyed||(t._queryInfoInProccess=!1,t._updateHotelsResortsBounds())})));var o=g.settingUtils.getCountryId(this._FilterSettings),i=u.resultStore.getCountryInfo(o),r=y.searchMapUtils.getCountryBounds(i);this._mapController.update({Bounds:e||r,DefaultBounds:r})},e.prototype._getHotelsResortsBounds=function(){var t=u.resultStore.getGlobals(),e=t&&t.SearchBounds;if(e)return e;var o=(0,r.getHotelsResortsBounds)(this._FilterSettings);return o.length>0?y.searchMapUtils.getBoundsBorder(o):void 0},e.prototype._updateHotelsResortsBounds=function(){var t={InfoRecieved:!0},e=this._getHotelsResortsBounds();e&&(t.Bounds=e),this._mapController.update(t)},e.prototype._updateAirports=function(){var t=this,e=g.settingUtils.getCountryId(this._FilterSettings),o=s.additionsStore.getAirportsByCountry(e);o?this._updateAirportsMarkers(o):d.airportsService.all({country:e}).then(function(o){t._isDestroyed||(s.additionsStore.setAirportsByCountry(e,o),t._updateAirportsMarkers(o))})},e.prototype._updateAirportsMarkers=function(t){if(!t||0===t.length)return void this._mapController.update({IsNewAirportsItems:!0});var e=t.map(function(t){return y.searchMapUtils.airportForMap(t)});this._mapController.update({AirportsItems:e,IsNewAirportsItems:!0})},e}(c.Core);e.HotelsResortsMapController=m,t.HotelsResortsMapController=m}).call(e,o(0))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.CartManage=void 0;var o;!function(t){t.Save="save",t.Load="load",t.Mail="mail",t.Sms="sms",t.Clear="clear",t.Remove="remove",t.Discount="discount",t.Delete="delete",t.Detail="detail",t.Refresh="refresh",t.Print="print",t.GetMail="getmail",t.GetSms="getsms",t.AddHot="addhot",t.GetHot="gethot",t.Showcase="showcase",t.TrackPrice="track",t.Order="order",t.GetPrint="getprint",t.UpdateComment="updatecomment",t.UpdatePrice="updateprice",t.UpdateRecommend="updaterecommend",t.ExportToLM="exporttolm",t.UpdateProfile="updateprofile",t.UpdateCustomer="updatecustomer",t.CartListFull="cartlistfull",t.ShareLink="sharelink"}(o=e.CartManage||(e.CartManage={})),t.CartManage=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CountryListControl=void 0;var n=o(157),s=o(2),a=o(1),l=o(5),u=o(8),c=o(169),h=o(809),d=o(815),p=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVCountryList",o._IsAdaptive=!0,o._Items=[],o._ModeView=l.ModeView.DescTop,o._Permissions={},o._ShowOperator=!1,o._UpdatingTours=!1,o._Changed=null,o._controlItems=[],o._nodeWidth=0,o.__initSettings(e),o._onResize=o._onResize.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){if(void 0===e&&(e={}),t.prototype.update.call(this,e),this._rendered){var o=e.Items,i=e.Permissions;if((0,a.isDefined)(o))return this._renderItems(),void this._updateNodeWidth();(0,a.isDefined)(i)&&this._updateShowMyCartsControl();var r={Permissions:this._Permissions,ShowOperator:this._ShowOperator,UpdatingTours:this._UpdatingTours};this._controlItems.forEach(function(t){return t.update(r)})}},e.prototype.render=function(){t.prototype.render.call(this),this._renderItems(),this._updateNodeWidth(),(0,a.addEvent)(window,"resize",this._onResize)},e.prototype.destroy=function(){(0,a.removeEvent)(window,"resize",this._onResize),t.prototype.destroy.call(this)},e.prototype._renderItems=function(){var t=this;this._controlItems.length=0,(0,a.removeChildren)(this._DomNode);var e=this._DomNode.parentNode;(0,a.removeClass)(e,u.TV_EMPTY_LIST),this._Items&&this._Items.length>0?this._controlItems=this._Items.map(function(e){var o=e.Code,i=e.Name,s=e.Price,a=e.Currency,u=e.HotelsData,c=u.map(function(t){return r({},t)});c.forEach(function(t){n.imageCatalog.setHotelImage(t.Id,t.Picture),t.Tours.forEach(function(t){n.imageCatalog.setOperatorImage(t.OperatorId)})});var d=t._ModeView;if(t._IsAdaptive){var p=screen.width||window.innerWidth;d=p<480?l.ModeView.Mobile:t._ModeView===l.ModeView.Mobile&&p>600?l.ModeView.Adaptive:t._ModeView}return new h.CountryItemControl({Changed:t._Changed,Code:o,Currency:a,HotelsData:c,ModeView:d,Name:i,ParentNode:t._DomNode,Permissions:t._Permissions,Price:s,ShowOperator:t._ShowOperator,UpdatingTours:t._UpdatingTours})}):((0,a.addClass)(e,u.TV_EMPTY_LIST),this._updateShowMyCartsControl(),this._DomNode.appendChild(this._showMyCartsControl.getDomNode()))},e.prototype._onResize=function(){var t=this._getDomNodeWidth();this._nodeWidth!==t&&0!==t&&(this._renderItems(),this._updateNodeWidth())},e.prototype._updateShowMyCartsControl=function(){var t=this._Permissions.Menu.MyCartCollections===c.CartSettingsState.Enable;this._showMyCartsControl?this._showMyCartsControl.update({ButtonsVisible:t}):this._showMyCartsControl=new d.ShowMyCartsControl({ButtonsVisible:t,ButtonClicked:this._Changed})},e.prototype._getDomNodeWidth=function(){return this._DomNode.offsetWidth||0},e.prototype._updateNodeWidth=function(){this._nodeWidth=this._getDomNodeWidth()},e}(s.Control);e.CountryListControl=p,t.CountryListControl=p}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ShowcaseFormControl=e.ShowcaseType=void 0;var r,n=o(29),s=o(2),a=o(3);!function(t){t.Screen="screen",t.Print="print"}(r=e.ShowcaseType||(e.ShowcaseType={}));var l=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="showcase-form",o.Show=new a.UserEvent,o._checkBox=null,o._showHotelName=!0,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._checkBox=new n.CheckBox({Content:"Показывать название отеля",ParentNode:this._nodes.check,IsChecked:this._showHotelName})},e.prototype._onFire=function(t){this.Show.fire({ShowHotelName:this._checkBox.getIsChecked(),ShowcaseType:t})},e.prototype._onPrintClick=function(){this._onFire(r.Print)},e.prototype._onScreenClick=function(){this._onFire(r.Screen)},e}(s.Control);e.ShowcaseFormControl=l,t.ShowcaseFormControl=l,t.ShowcaseType=r}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)},n=this&&this.__rest||function(t,e){var o={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(o[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(o[i[r]]=t[i[r]]);return o},s=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var i,r=0,n=e.length;r<n;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.TabbedListControl=e.SearchInputMode=void 0;var a,l=o(409),u=o(8),c=o(2),h=o(4),d=o(1),p=o(6),_=o(408),f=o(83);!function(t){t[t.IN_BODY=0]="IN_BODY",t[t.IN_TABS=1]="IN_TABS",t[t.NONE=2]="NONE"}(a=e.SearchInputMode||(e.SearchInputMode={}));var y=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="tabbed-list",o._ListControl=null,o._Placeholder="",o._SearchInputMode=a.IN_BODY,o._Selected=[],o._SelectionTabEnabled=!1,o._TabsEnabled=!0,o._TabItems=[],o._FilterSearchedItemFunc=null,o._FilterSelectedItemFunc=null,o._activeTab=l.TabKey.All,o._listScrollTopPrev=0,o._searchInput=null,o._searchValue="",o._tabs=null,o._tabNames=[],o._tabReset=null,o._tabSelection=null,o._tabSelectionAmount=null,t.prototype.__initSettings.call(o,e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderSearchInput(),this._renderHeader(),this._renderBody(),this._updateControl()},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._rendered){var o=e.Reset,i=e.Selected,r=e.Placeholder,s=n(e,["Reset","Selected","Placeholder"]);o&&(this._activeTab=l.TabKey.All,this._resetSearch()),(0,d.isDefined)(r)&&this._updatePlaceholder(),(0,d.isDefined)(i)&&(this._updateSelected(),this._updateTabs()),(o||(0,p.isNotEmptyObject)(s))&&this._updateControl()}},e.prototype._checkFilterFunction=function(t){return(0,d.isFunction)(t)&&this._ListControl.getItems().some(function(e){return t(e)})},e.prototype._isEnabledSearchTab=function(){return this._SearchInputMode===a.IN_BODY},e.prototype._init=function(){this._isSelectedItemFunc=this._isSelectedItemFunc.bind(this),this._isSearchedItemFunc=this._isSearchedItemFunc.bind(this)},e.prototype._initTabs=function(){var t=this;if(this._tabNames=[],this._TabsEnabled&&(this._tabNames.push({Key:l.TabKey.All,Title:"Все"}),(0,d.isDefined)(this._TabItems)&&(0,d.isDefined)(this._TabItems.length)&&this._TabItems.forEach(function(e){var o=e.AlwaysShow,i=e.FilterFunction,n=e.Key;(o||t._checkFilterFunction(i))&&t._tabNames.push(r(r({},e),{Title:n}))}),0!==this._tabNames.length)){this._activeTab=l.TabKey.All;var e=(0,d.newDiv)("TVTabSelection");this._tabSelectionAmount=(0,d.newDiv)("TVTabSelectionSpan",e),this._tabSelection={Key:l.TabKey.Selection,Title:e},this._tabReset={Key:l.TabKey.Reset,Title:"Сброс"}}},e.prototype._isSearchedItemFunc=function(t){return(0,d.isFunction)(this._FilterSearchedItemFunc)?this._FilterSearchedItemFunc({Item:t,SearchValue:this._searchValue}):!t.name||t.name.toLowerCase().indexOf(this._searchValue.toLowerCase())>-1},e.prototype._isSelectedItemFunc=function(t){return(0,d.isFunction)(this._FilterSelectedItemFunc)?this._FilterSelectedItemFunc({Item:t}):this._Selected.indexOf(t.id)>-1},e.prototype._onListChanged=function(t){var e=t.Selected;this._Selected=e,this._activeTab===l.TabKey.Selection&&(0===this._Selected.length?(this._activeTab=l.TabKey.All,this._showItems()):this._showSelectedItems()),this._updateTabs(),this._updateSelected()},e.prototype._onSearch=function(t){var e=t.Value;this._showSearchedItems(e)},e.prototype._onSearchInputClicked=function(){this._activeTab!==l.TabKey.All&&(this._activeTab=l.TabKey.All,this._updateTabs(),this._showItems(this._isSearchedItemFunc))},e.prototype._onTabClicked=function(t){switch(this._activeTab===l.TabKey.All&&t!==l.TabKey.Search&&this._resetSearch(),t){case l.TabKey.All:this._activeTab=l.TabKey.All,this._showItems();break;case l.TabKey.Reset:this._activeTab=l.TabKey.All,this._resetSelected();break;case l.TabKey.Search:this._toggleSearch(),this._activeTab=l.TabKey.All;break;case l.TabKey.Selection:this._activeTab=l.TabKey.Selection,this._showSelectedItems();break;default:this._activeTab=t,this._showFilteredItems()}this._updateTabs()},e.prototype._renderBody=function(){this._ListControl.getIsRendered()?this._nodes.bodyNode.appendChild(this._ListControl.getDomNode()):(this._ListControl.setParentNode(this._nodes.bodyNode),this._ListControl.render()),(0,d.addClass)(this._ListControl,"TVTabbedList"),(0,d.addClass)(this._ListControl,u.TV_STYLE_SCROLL),this._ListControl.Changed.addOnce(new h.Delegate(this,this._onListChanged))},e.prototype._renderHeader=function(){this._tabs=new _.Tabs({ParentNode:this._nodes.headerNode,Render:!1,SearchTabEnabled:this._isEnabledSearchTab(),Click:new h.Delegate(this,this._onTabClicked)})},e.prototype._renderSearchInput=function(){if(this._SearchInputMode!==a.NONE){var t=this._SearchInputMode===a.IN_TABS,e=t?this._nodes.headerNode:this._nodes.bodyNode,o=new h.Delegate(this,this._onSearch);this._searchInput=new f.Input({IsVisible:t,ParentNode:e,Placeholder:this._Placeholder,Value:this._searchValue,Blur:o,ChangeValue:o,Click:new h.Delegate(this,this._onSearchInputClicked)}),t&&(0,d.addClass)(this._DomNode,"TVTabbedSearchInput")}},e.prototype._resetSearch=function(){this._SearchInputMode!==a.NONE&&(this._searchValue="",this._searchInput.setValue("",!1),this._SearchInputMode===a.IN_BODY&&(this._searchInput.hide(),this._updateHeight()))},e.prototype._resetSelected=function(){this._Selected=[],this._ListControl.clearSelection(),this._showItems()},e.prototype._showItems=function(t){var e=!(0,d.isFunction)(t),o=this._ListControl.getItems(),i=e?o:o.filter(function(e){return t(e)});this._ListControl.setItems(i);var r=this._nodes.bodyNode;0===i.length?(0,d.addClass)(r,u.TV_EMPTY_LIST):(0,d.removeClass)(r,u.TV_EMPTY_LIST),r.scrollTop=this._listScrollTopPrev},e.prototype._showFilteredItems=function(){var t=this;if((0,d.isArray)(this._TabItems)){var e=this._TabItems.find(function(e){return e.Key===t._activeTab});(0,d.isDefined)(e)&&this._showItems(e.FilterFunction)}},e.prototype._showSearchedItems=function(t){this._searchValue.toLowerCase()!==t.toLowerCase()&&(this._searchValue=t,this._showItems(this._isSearchedItemFunc))},e.prototype._showSelectedItems=function(){this._listScrollTopPrev=this._nodes.bodyNode.scrollTop,this._showItems(this._isSelectedItemFunc)},e.prototype._toggleSearch=function(){this._SearchInputMode!==a.NONE&&(this._searchInput.getIsVisible()?(this._searchValue="",this._searchInput.setValue("",!1),this._searchInput.hide(),this._showItems()):(this._searchInput.show(),this._searchInput.setFocus(),this._activeTab!==l.TabKey.All&&this._showItems()),this._updateHeight())},e.prototype._updateControl=function(){this._initTabs(),this._updateHeight(),this._updateTabs(),this._showItems(),this._resetSearch(),this._updateSelected()},e.prototype._updateHeight=function(){var t=this._nodes.bodyNode;this._isEnabledSearchTab()&&this._searchInput.getIsVisible()?(0,d.addClass)(t,"TVTabbedListBodyWithSearch"):(0,d.removeClass)(t,"TVTabbedListBodyWithSearch"),this._TabsEnabled?(0,d.addClass)(t,"TVTabbedListBodyWithTabs"):(0,d.removeClass)(t,"TVTabbedListBodyWithTabs")},e.prototype._updatePlaceholder=function(){this._searchInput.update({Placeholder:this._Placeholder})},e.prototype._updateSelected=function(){this._SearchInputMode===a.IN_TABS&&(this._Selected.length>0?(0,d.addClass)(this._DomNode,"TVSelectedItems"):(0,d.removeClass)(this._DomNode,"TVSelectedItems"))},e.prototype._updateTabs=function(){if(this._TabsEnabled){var t=s([],this._tabNames,!0);this._SelectionTabEnabled&&this._Selected.length>0&&(this._tabSelectionAmount.textContent=this._Selected.length.toString(),t.push(this._tabSelection),t.push(this._tabReset)),this._tabs.update({ActiveTab:this._activeTab,Names:t})}},e}(c.Control);e.TabbedListControl=y,t.TabbedListControl=y,t.SearchInputMode=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ConfirmPage=void 0;var r=o(36),n=o(4),s=o(3),a=o(14),l=o(189),u=o(418),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Confirm=new s.UserEvent,o._ButtonTemplate="",o._ContentHtml="",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._getContent().update(e)},e.prototype._getContent=function(){return this._confirmControl||(this._confirmControl=new u.ConfirmControl({ButtonTemplate:this._ButtonTemplate,ContentHtml:this._ContentHtml,ButtonClicked:new n.Delegate(this,this._onButtonClicked)})),this._confirmControl},e.prototype._onButtonClicked=function(t){a.router.back(),t.DialogResult===l.DialogResult.Yes&&this.Confirm.fire()},e}(r.Page);e.ConfirmPage=c,t.ConfirmPage=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.actionDataService=void 0;var i=o(143),r=o(7),n=o(1),s=o(13),a=o(45),l=o(229),u=o(33),c=function(){function t(){}return t.prototype.clearExpire=function(){var t=this;[r.LOCSTORAGE_HOTOFFERS_VIEWS,r.LOCSTORAGE_HOTOFFERS_LIKES,r.LOCSTORAGE_HOTOFFERS_SHARES].forEach(function(e){var o=t._getLocalStorageOffers(e);Object.keys(o).forEach(function(e){t._isRelevantAction(o[e])||delete o[e]}),(0,a.setLocalStorage)(e,JSON.stringify(o))})},t.prototype.clearCount=function(t,e){var o=this;void 0===e&&(e=[]),e.forEach(function(e){var i=o._getLocalStorageName(e),r=o._getLocalStorageOffers(i);r[t]="",(0,a.setLocalStorage)(i,JSON.stringify(r))})},t.prototype.updateCount=function(t){t.OfferId,t.Type;return this._udpateActionCount(t).then(function(e){(0,n.isNumber)(e)&&i.hotOffersStore.updateCount(t,e)}).catch(function(t){return console.log(t)})},t.prototype.isLiked=function(t){var e=this._getLocalStorageOffers(r.LOCSTORAGE_HOTOFFERS_LIKES),o=e[t]||"";return!!o&&this._isRelevantAction(o)},t.prototype._getLocalStorageOffers=function(t){var e={};try{e=JSON.parse((0,a.getLocalStorage)(t)||"{}")}catch(t){console.log(t)}return e},t.prototype._isRelevantAction=function(t){return!!t&&s.FormatDate.getDaysAgo(t)<7},t.prototype._udpateActionCount=function(t){var e=t.Action,o=t.OfferId,i=t.Type;if(!o)return Promise.reject("Missing offer id on action.");var r=this._getLocalStorageName(i),n=this._getLocalStorageOffers(r),c=n[o]||"";return c&&this._isRelevantAction(c)&&i!==u.HotOfferCounterType.Like?Promise.reject("Forbidden offer action."):l.hotOfferService.updateCount(o,i,e).then(function(t){return n[o]=e===u.HotOfferCounterAction.INC?s.FormatDate.getISOStringDate():"",(0,a.setLocalStorage)(r,JSON.stringify(n)),t})},t.prototype._getLocalStorageName=function(t){var e="";switch(t){case u.HotOfferCounterType.View:e=r.LOCSTORAGE_HOTOFFERS_VIEWS;break;case u.HotOfferCounterType.Like:e=r.LOCSTORAGE_HOTOFFERS_LIKES;break;case u.HotOfferCounterType.Share:e=r.LOCSTORAGE_HOTOFFERS_SHARES}return e},t}();e.actionDataService=new c,t.actionDataService=e.actionDataService}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.BaseButtonControl=e.TV_HOT_OFFER_BASE_BUTTON_COUNT=e.TV_HOT_OFFER_BASE_BUTTON=void 0;var r=o(143),n=o(2),s=o(4),a=o(1);e.TV_HOT_OFFER_BASE_BUTTON="TVHotOfferActionButton",e.TV_HOT_OFFER_BASE_BUTTON_COUNT="TVHotOfferActionCount";var l=function(t){function o(o){var i=t.call(this,o)||this;return i._Class=e.TV_HOT_OFFER_BASE_BUTTON,i._Count=0,i._countNode=null,i.__initSettings(o),i}return i(o,t),o.prototype.render=function(){t.prototype.render.call(this),this._countNode=(0,a.newDiv)(e.TV_HOT_OFFER_BASE_BUTTON_COUNT,this._DomNode),this._updateCount(),this._listenStore()},o.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Count;(0,a.isDefined)(o)&&this._updateCount()},o.prototype.destroy=function(){this._unlistenStore(),t.prototype.destroy.call(this)},o.prototype._updateCount=function(){var t=this._Count>0;this._countNode.textContent=t?""+this._Count:"",(0,a.setVisible)(this._countNode,t)},o.prototype._listenStore=function(){r.hotOffersStore&&r.hotOffersStore.Changed.addOnce(new s.Delegate(this,this._onStoreChanged))},o.prototype._unlistenStore=function(){r.hotOffersStore&&r.hotOffersStore.Changed.remove(this)},o.prototype._onStoreChanged=function(t){},o}(n.Control);e.BaseButtonControl=l,t.BaseButtonControl=l,t.TV_HOT_OFFER_BASE_BUTTON_COUNT=e.TV_HOT_OFFER_BASE_BUTTON_COUNT,t.TV_HOT_OFFER_BASE_BUTTON=e.TV_HOT_OFFER_BASE_BUTTON}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.PictureType=void 0;var o;!function(t){t[t.NONE=0]="NONE",t[t.COMMON=1]="COMMON",t[t.COUNTRY=2]="COUNTRY",t[t.HOTEL=3]="HOTEL",t[t.REGION=4]="REGION",t[t.USER=5]="USER"}(o=e.PictureType||(e.PictureType={})),t.PictureType=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.programUtils=void 0;var o=function(){function t(){}return t.prototype.getFull=function(t){return t&&t.full||""},t.prototype.getImages=function(t){return t&&t.images||[]},t.prototype.getName=function(t){return t&&t.name||""},t.prototype.getShort=function(t){return t&&t.short||""},t.prototype.hasProgram=function(t){return Boolean(t&&(t.short||t.full||t.images))},t.prototype.getTourContentData=function(t){return{Description:this.getShort(t),HotelId:0,Images:this.getImages(t).map(function(t){return t.url}),Rating:0,Title:this.getName(t)}},t}();e.programUtils=new o,t.programUtils=e.programUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TourBookingControl=void 0;var n=o(2),s=o(4),a=o(3),l=o(1),u=o(5),c=o(6),h=o(897),d=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="tour-booking",o.BookingClicked=new a.UserEvent,o._BookingItems=[],o._Class="TVTourBookingControl",o._IsEnableBooking=!0,o._ModeView=u.ModeView.DescTop,o._items=[],t.prototype.__initSettings.call(o,e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderItems()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.BookingItems,i=e.IsEnableBooking;(0,l.isDefined)(o)&&(this._clearItems(),this._renderItems()),(0,l.isDefined)(i)&&this._updateItems()},e.prototype._onBookingClicked=function(t){this.BookingClicked.fire(t)},e.prototype._clearItems=function(){var t=this._nodes.bookingItemsNode;(0,l.removeChildren)(t),this._items.forEach(function(t){return t.destroy()}),this._items=[]},e.prototype._renderItems=function(){var t=this,e=this._nodes.bookingItemsNode;this._BookingItems.forEach(function(o){var i=t._getItem(o,e);t._items.push(i)})},e.prototype._updateItems=function(){var t=this;(0,c.isEmptyArray)(this._items)||this._items.forEach(function(e){e.update({IsEnabled:t._IsEnableBooking})})},e.prototype._getItem=function(t,e){return new h.TourBookingItemControl(r(r({},t),{IsEnabled:this._IsEnableBooking,ModeView:this._ModeView,ParentNode:e,Clicked:new s.Delegate(this,this._onBookingClicked,{Booking:t.Id})}))},e}(n.Control);e.TourBookingControl=d,t.TourBookingControl=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.StarsControl=void 0;var r=o(8),n=o(2),s=o(1),a=o(16),l=o(10),u=o(15),c=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVStarsControl",o._Count=0,o._Limit=0,o._Size=a.SizeEnum.M,o._StyleTheme=l.StyleThemeEnum.THEME1,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderStars(),this._updateSize(),this._updateStyleTheme()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Count;(0,s.isDefined)(o)&&(this._clearStars(),this._renderStars())},e.prototype._clearStars=function(){(0,s.removeChildren)(this._DomNode)},e.prototype._renderStars=function(){for(var t,e=this._Limit>0?this._Limit:this._Count,o=0;o<e;o+=1){var i=(0,s.classNames)("TVStarsControlItem",(t={},t[r.TV_ACTIVE]=o<this._Count,t));(0,s.newDiv)(i,this._DomNode)}},e.prototype._updateSize=function(){var t=u.styleUtils.getClassBySize(this._Size);(0,s.addClass)(this._DomNode,t)},e.prototype._updateStyleTheme=function(){var t=u.styleUtils.getClassByTheme(this._StyleTheme);(0,s.addClass)(this._DomNode,t)},e}(n.Control);e.StarsControl=c,t.StarsControl=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.Accordion=void 0;var r=o(2),n=o(1),s=o(61),a=o(101),l=o(12),u=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="accordion",o._Color=s.ColorThemeEnum.DEFAULT,o._Content="",o._IsVisibleContent=!1,o._Title="",o._isTitleOnly=!1,o.__initSettings(e),o._init(),o._Render&&(o.render(),o._addEvents()),o}return i(e,t),e.prototype.update=function(e){var o=e.Title,i=e.Content,r=e.Color,s=e.IsVisibleContent,a=this._Color;t.prototype.update.call(this,e),(0,n.isDefined)(o)&&this._updateTitle(),(0,n.isDefined)(i)&&this._updateContent(),(0,n.isDefined)(r)&&this._updateColor(a),(0,n.isDefined)(s)&&this._updateVisibilityContent()},e.prototype.render=function(){t.prototype.render.call(this),this._updateTitle(),this._updateContent(),this._updateVisibilityContent(),this._updateColor()},e.prototype.destroy=function(){this._removeEvents(),t.prototype.destroy.call(this)},e.prototype._init=function(){this._onTransitionEnd=this._onTransitionEnd.bind(this)},e.prototype._addEvents=function(){(0,n.addEvent)(this._DomNode,"transitionend",this._onTransitionEnd)},e.prototype._removeEvents=function(){(0,n.removeEvent)(this._DomNode,"transitionend",this._onTransitionEnd)},e.prototype._updateTitle=function(){var t=this._nodes.titleNode,e=!!this._Title;if((0,n.removeChildren)(t),(0,n.setVisible)(t,e),e)return this._Title instanceof r.Control?void t.appendChild(this._Title.getDomNode()):void(t.innerHTML=(0,l.sanitizeHTML)(this._Title))},e.prototype._updateContent=function(){var t=this._nodes.contentNode;if(this._isTitleOnly=!this._Content,(0,n.removeChildren)(t),(0,n.setVisible)(t,!this._isTitleOnly),(0,n.updateClass)(this._DomNode,"TVTitleOnly",this._isTitleOnly),!this._isTitleOnly)return this._Content instanceof r.Control?void t.appendChild(this._Content.getDomNode()):void(t.innerHTML=(0,l.sanitizeHTML)(this._Content))},e.prototype._onTitleNodeClick=function(){this._isTitleOnly||(this._IsVisibleContent=!this._IsVisibleContent,this._animationResizeContent(),this._updateVisibilityContent())},e.prototype._animationResizeContent=function(){var t=this._nodes,e=t.contentBlock,o=t.contentNode,i=o.offsetHeight,r=this._IsVisibleContent?"0":i+"px",n=this._IsVisibleContent?i+"px":"0";e.style.height=r,setTimeout(function(){e.style.height=n},0)},e.prototype._updateVisibilityContent=function(){(0,n.updateClass)(this._DomNode,"TVAccordionContentVisible",this._IsVisibleContent)},e.prototype._updateColor=function(t){void 0===t&&(t=s.ColorThemeEnum.DEFAULT);var e=a.colorUtils.getClassByColor(t),o=a.colorUtils.getClassByColor(this._Color);(0,n.removeClass)(this._DomNode,e),(0,n.addClass)(this._DomNode,o)},e.prototype._onTransitionEnd=function(){this._nodes.contentBlock.style.height=""},e}(r.Control);e.Accordion=u,t.Accordion=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelGalleryControl=void 0;var r=o(2),n=o(4),s=o(3),a=o(1),l=o(6),u=o(423),c=o(906),h=function(t){function e(e){var o=t.call(this,e)||this;return o.MorePhotoClicked=new s.UserEvent,o.ShowReviewClicked=new s.UserEvent,o.templateName="hotel-gallery",o._Class="TVHotelGalleryControl",o._Items=[],o._Rating=0,o._ReviewsCount=0,o.__initSettings(e),o._onReviewsClicked=o._onReviewsClicked.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){(0,a.removeEvent)(this._nodes.ratingReviews,"click",this._onReviewsClicked),t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this),this._updatePhotoControls(),this._updateRating(),this._updateReviewScore(),(0,a.addEvent)(this._nodes.ratingReviews,"click",this._onReviewsClicked)},e.prototype.update=function(e){var o=e.Items,i=e.Rating,r=e.ReviewsCount;(0,a.isDefined)(i)&&this._updateRating(i),t.prototype.update.call(this,e),(0,a.isDefined)(o)&&this._updatePhotoControls(),(0,a.isDefined)(r)&&this._updateReviewScore()},e.prototype._onPhotoSelected=function(t){var e=t.PictureIndex;this._sliderControl.update({SelectedIndex:e})},e.prototype._onMorePhotoClicked=function(){this.MorePhotoClicked.fire()},e.prototype._onReviewsClicked=function(){this.ShowReviewClicked.fire()},e.prototype._onSliderChanged=function(t){var e=t.PictureIndex;this._previewControl.update({SelectedIndex:e})},e.prototype._updatePhotoControls=function(){var t=0!==this._Items.length,e=this._nodes,o=e.previewNode,i=e.sliderNode;(0,a.setVisible)(i,t),(0,a.setVisible)(o,t),this._sliderControl||(this._sliderControl=new u.PhotoSlider({ParentNode:i,Changed:new n.Delegate(this,this._onSliderChanged)})),this._previewControl||(this._previewControl=new c.PreviewGalleryControl({ParentNode:o,ItemSelected:new n.Delegate(this,this._onPhotoSelected),MoreClicked:new n.Delegate(this,this._onMorePhotoClicked)})),this._sliderControl.update({Items:this._Items}),this._previewControl.update({Items:this._Items})},e.prototype._updateRating=function(t){var o=this._nodes,i=o.ratingBlock,r=o.ratingNode;(0,a.isDefined)(t)&&((0,a.removeClass)(i,(0,l.getRatingClass)(this._Rating.toFixed(1))),this._Rating=t);var n=this._Rating>0;if((0,a.setVisible)(i,n),!n)return r.innerHTML="",void(0,a.addClass)(this._DomNode,e.TV_RATING_DISABLED);var s=this._Rating.toFixed(1);r.innerHTML=s,(0,a.addClass)(i,(0,l.getRatingClass)(s)),(0,a.removeClass)(this._DomNode,e.TV_RATING_DISABLED)},e.prototype._updateReviewScore=function(){var t=this._nodes,o=t.ratingBlock,i=t.ratingReviews;if(0===this._ReviewsCount)return i.innerHTML="",void(0,a.addClass)(o,e.TV_REVIEWS_DISABLED);i.innerHTML=this._ReviewsCount,this._ReviewsCount===e.ONE_REVIEW?(0,a.addClass)(i,e.TV_SINGLE_ITEM):(0,a.removeClass)(i,e.TV_SINGLE_ITEM),(0,a.removeClass)(o,e.TV_REVIEWS_DISABLED)},e.GROUP_COUNT=12,e.NONE_SELECTED=-1,e.ONE_REVIEW=1,e.TV_RATING_DISABLED="TVRatingDisabled",e.TV_REVIEWS_DISABLED="TVReviewsDisabled",e.TV_SINGLE_ITEM="TVSingle",e}(r.Control);e.HotelGalleryControl=h,t.HotelGalleryControl=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelDescriptionControl=void 0;var r=o(2),n=o(1),s=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="hotel-description",o._Animation="",o._Beach="",o._Child="",o._DateBuild="",o._DateRepair="",o._Description="",o._MealList="",o._MealTypes="",o._Placement="",o._Phone="",o._RoomTypes="",o._Services="",o._ServiceFree="",o._ServicePay="",o._Site="",o._Square="",o._StandartRoom="",o._Territory="",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateNodes()},e.prototype.update=function(t){this.apllyNewParams(t),this._rendered&&this._updateNodes()},e.prototype._updateNodes=function(){this._updateDescriptions()},e.prototype._updateDescriptions=function(){var t=this._nodes,e=t.animation,o=t.beach,i=t.build,r=t.child,s=t.description,a=t.inroom,l=t.meal,u=t.mealTypes,c=t.phone,h=t.placement,d=t.repair,p=t.roomTypes,_=t.square,f=t.serviceFree,y=t.servicePay,g=t.services,C=t.site,v=t.territory;this._updateDescriptionItem(i,this._DateBuild),this._updateDescriptionItem(s,this._Description),this._updateDescriptionItem(c,this._Phone),this._updateDescriptionItem(h,this._Placement),this._updateDescriptionItem(_,this._Square),this._updateDescriptionItem(d,this._DateRepair),this._updateDescriptionItem(C,this._Site),(0,n.setVisible)(s.parentElement,(0,n.isVisible)(i)||(0,n.isVisible)(s)||(0,n.isVisible)(d)||(0,n.isVisible)(h)||(0,n.isVisible)(_)||(0,n.isVisible)(c)||(0,n.isVisible)(C)),this._updateDescriptionItem(e,this._Animation),this._updateDescriptionItem(o,this._Beach),this._updateDescriptionItem(r,this._Child),this._updateDescriptionItem(a,this._StandartRoom),this._updateDescriptionItem(l,this._MealList),this._updateDescriptionItem(u,this._MealTypes),this._updateDescriptionItem(p,this._RoomTypes),this._updateDescriptionItem(f,this._ServiceFree),this._updateDescriptionItem(y,this._ServicePay),this._updateDescriptionItem(g,this._Services),this._updateDescriptionItem(v,this._Territory)},e.prototype._updateDescriptionItem=function(t,e){(0,n.isDefined)(e)&&e.length>0?(t.innerHTML=e,(0,n.show)(t)):(0,n.hide)(t)},e}(r.Control);e.HotelDescriptionControl=s,t.HotelDescriptionControl=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var i,r=0,n=e.length;r<n;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.HotelReviewsController=void 0;var n=o(31),s=o(78),a=o(34),l=o(9),u=o(4),c=o(3),h=o(1),d=o(5),p=o(477),_=o(32),f=o(108),y=o(913),g=o(914),C=o(915),v=function(t){function e(o){var i=t.call(this,o)||this;return i.AddReviewClicked=new c.UserEvent,i.DataLoaded=new c.UserEvent,i.MoreReviewClicked=new c.UserEvent,i.ReviewShow=new c.UserEvent,i._HotelId=0,i._InitReviewsCount=0,i._ModeView=d.ModeView.DescTop,i._MoreReviewsEnable=!0,i._ParentNode=null,i._ReviewMode=d.ReviewMode.DISABLE,i._ReviewsServicesLinks=null,i._currentPage=e.INIT_REVIEWS_PAGE,i._emptyReviewsMessage=null,i.__initSettings(o),i._init(),i}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),(0,h.isDefined)(e.HotelId)&&this._loadReviews()},e.prototype._getReviewsParams=function(){return{hotel_code:this._HotelId,limit:this._InitReviewsCount||e.INIT_REVIEWS_COUNT,page:this._currentPage}},e.prototype._init=function(){var t=a.clientCatalog.getClientData();this._ReviewMode=_.clientUtils.getReviewMode(t);var e=this._ModeView===d.ModeView.Mobile;this._hotelReviewsControl=new C.HotelReviewsControl({ParentNode:this._ParentNode,ReviewClickable:e,ReviewSelected:new u.Delegate(this,this._onReviewShow)}),this._reviewsButtonsControl=new g.HotelReviewsButtonsControl({AddReviewBottomEnable:e,MoreReviewsEnable:this._MoreReviewsEnable,ParentNode:this._ParentNode,ReviewMode:this._ReviewMode,ReviewsNode:this._hotelReviewsControl.getDomNode(),Click:new u.Delegate(this,this._onReviewsButtonsClicked)}),this._loadReviews()},e.prototype._loadMoreReviews=function(){var t=this;this._currentPage+=1;var e=this._getReviewsParams();p.reviewDataService.getHotelReviewsById(e).then(function(e){var o=f.reviewsUtils.getReviewsData(e),i=o.Items;t._hotelReviewsControl.update({Reviews:i}),t._reviewsButtonsControl.update({MoreButtonVisible:t._currentPage<o.Page})})},e.prototype._loadReviews=function(){var t=this;if(Boolean(this._HotelId)){this._hotelReviewsControl.update({IsNewReviews:!0}),this._reviewsButtonsControl.update({MoreButtonVisible:!1,ReviewsServicesLinks:this._ReviewsServicesLinks}),this._emptyReviewsMessage&&this._emptyReviewsMessage.hide(),this._currentPage=e.INIT_REVIEWS_PAGE;var o=this._getReviewsParams();p.reviewDataService.getHotelReviewsById(o).then(function(e){var o=f.reviewsUtils.getReviewsData(e),i=r([],o.Items,!0),n=i.length>0,s=t._currentPage<o.Page;t._hotelReviewsControl.update({Reviews:i}),t._reviewsButtonsControl.update({MoreButtonVisible:s}),n||t._showEmptyReviewsMessage(),t.DataLoaded.fire()})}},e.prototype._onReviewsButtonsClicked=function(t){switch(t.Type){case g.ReviewsButtonsType.MORE:this._loadMoreReviews(),this.MoreReviewClicked.fire();break;case g.ReviewsButtonsType.NEW:this.AddReviewClicked.fire();break;case g.ReviewsButtonsType.TOPHOTELS:(0,s.reachGoal)(n.ActionStatisticsSource.COMMON,n.ActionStatisticsType.REVIEW_TOPHOTELS);break;case g.ReviewsButtonsType.TRIPADVISOR:(0,s.reachGoal)(n.ActionStatisticsSource.COMMON,n.ActionStatisticsType.REVIEW_TRIPADVISOR)}},e.prototype._onReviewShow=function(t){this.ReviewShow.fire(t)},e.prototype._showEmptyReviewsMessage=function(){this._ReviewMode!==d.ReviewMode.DISABLE&&(this._emptyReviewsMessage||(this._emptyReviewsMessage=new y.EmptyReviewsMessageControl({ParentNode:this._ParentNode,ReviewMode:this._ReviewMode})),this._emptyReviewsMessage.update({ReviewsServicesLinks:this._ReviewsServicesLinks}),this._emptyReviewsMessage.show())},e.INIT_REVIEWS_COUNT=5,e.INIT_REVIEWS_PAGE=1,e}(l.Core);e.HotelReviewsController=v,t.HotelReviewsController=v}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__assign||function(){return i=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},i.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.tourCardOptionUtils=void 0;var r=o(4),n=o(7),s=o(1),a=o(6),l=o(13),u=o(35),c=o(184),h=o(40),d=o(28),p=o(8),_=o(481),f=function(){function t(){}return t.prototype.getClassByIconType=function(t){switch(t){case _.IconType.MAP_MARKER:return"TVMapMarkerIcon";case _.IconType.CALENDAR:return"TVCalendarIcon";case _.IconType.MEAL:return"TVMealIcon";case _.IconType.BED:return"TVBedIcon";case _.IconType.GEAR:return"TVGearIcon";case _.IconType.INFO:return"TVInfoIcon";case _.IconType.HOME:return"TVHomeIcon";case _.IconType.USERS:return"TVUsersIcon";case _.IconType.SEATS:return"TVSeatsIcon";case _.IconType.NONE:default:return""}},t.prototype.getOptions=function(t){return t=t||{},[[this.getCountryDepartureOptionSettings(t),this.getDateNightOptionSettings(t),this.getMealOptionSettings(t)],[this.getRoomTouristOptionSettings(t),this.getTourServiceOptionSettings(t),this.getInfoOptionSettings(t)]]},t.prototype.getMobileOptions=function(t){return t=t||{},[[this.getCountryDepartureOptionSettings(t),this.getDateNightOptionSettings(t),this.getMealOptionSettings(t),this.getRoomTouristOptionSettings(t),this.getTourServiceOptionSettings(t),this.getInfoOptionSettings(t),this.getOperatorOptionSettings(t)]]},t.prototype.getCraftTourOptions=function(t){return t=t||{},[[this.getCountryDepartureOptionSettings(t),this.getDateDaysOptionSettings(t),this.getMealOptionSettings(t)],[this.getAccommodationOptionSettings(t),this.getRoomTouristOptionSettings(t),this.getAgeLimitOptionSettings(t)]]},t.prototype.getCraftTourMobileOptions=function(t){return t=t||{},[[this.getCountryDepartureOptionSettings(t),this.getDateDaysOptionSettings(t),this.getMealOptionSettings(t),this.getAccommodationOptionSettings(t),this.getRoomTouristOptionSettings(t),this.getAgeLimitOptionSettings(t),this.getTextOperatorOptionSettings(t)]]},t.prototype.getCountryDepartureOptionSettings=function(t){var e=h.tourUtils.isNoFlight(t),o=h.tourUtils.isCraftTour(t),i=t||{},r=i.countryname,n=void 0===r?"":r,s=i.departurenamefrom,a=void 0===s?"":s,l=i.departurename,u=void 0===l?"":l,c=i.hotelregionname,d=void 0===c?"":c,p=Boolean(n)||Boolean(a)||Boolean(u);return{Footer:h.tourUtils.getDepartureText(t),Header:o&&d||n,IconType:e?_.IconType.HOME:_.IconType.MAP_MARKER,IsVisible:p}},t.prototype.getDateNightOptionSettings=function(t){var e=Number(t.nights),o=(t||{}).flydate,i=Boolean(o)||!!e&&e>0,r={Footer:"",Header:"",IconType:_.IconType.CALENDAR,IsVisible:i};if(!i)return r;var n=new Date,s=l.FormatDate.strToDate(o),u=n.getFullYear()!==s.getFullYear(),c=l.FormatDate.getFormatDate(s,u?"DD MMMM YYYY":"DD MMMM");return r.Header=c.toLowerCase(),r.Footer=(0,a.getStringNights)(e),r},t.prototype.getMealOptionSettings=function(t){var e=h.tourUtils.getMealOption(t);return{Footer:e,Header:"Питание",IconType:_.IconType.MEAL,IsVisible:!!e}},t.prototype.getRoomTouristOptionSettings=function(t){var e=t||{},o=e.adults,n=void 0===o?0:o,l=e.child,u=void 0===l?0:l,h=e.room,d=e.roominfocode,f=e.ShowRoom,y=e.roomdata,g=y||{},C=g.Description,v=void 0===C?"":C,m=g.Photos,T=void 0===m?[]:m,w=c.touristUtils.getChildAge(t||{},u),S=Boolean(d)||Boolean(v)||(0,a.isNotEmptyArray)(T),P=Boolean(h)||n>0||u>0,b=h||"";S&&(b=(0,s.newSpan)(p.TV_ROOM_INFO),b.textContent=h||"");var I=P?(0,a.getStringTourist)(n,u,w):"",O=new r.Delegate(this,function(){if(S){var t={Id:d};f.fire(t)}});return i({Footer:I,Header:b,IconType:_.IconType.BED,IsVisible:P},S?{HeaderClicked:O}:{})},t.prototype.getTourServiceOptionSettings=function(t){var e=(t||{}).contents,o=void 0===e?[]:e,i=o.map(function(t,e){return 0===e?t:t.toLowerCase()}).join(", ");return{Footer:i,Header:"Услуги",IconType:_.IconType.GEAR,IsVisible:!!i}},t.prototype.getInfoOptionSettings=function(t){var e=(t||{}).tourname,o=void 0===e?"":e;return{Footer:o,Header:"",IconType:_.IconType.INFO,IsVisible:!!o}},t.prototype.getOperatorOptionSettings=function(t){var e=t||{},o=e.operatorcode,i=void 0===o?0:o,r=e.IsVisibleOperator,n=void 0!==r&&r,s=i>0;return{Footer:"",Header:s?(0,u.createDomElement)("img",{className:"TVTourCardOptionOperator",src:d.pictureUtils.getOperatorMobileLogoLink(i)}):"",IconType:_.IconType.HOME,IsVisible:s&&n}},t.prototype.getTextOperatorOptionSettings=function(t){var e=t||{},o=e.operatorname,i=void 0===o?"":o,r=e.IsVisibleOperator,n=void 0!==r&&r;return{Footer:t.operatorname,Header:"Туроператор",IconType:_.IconType.INFO,IsVisible:Boolean(i)&&n}},t.prototype.getDateDaysOptionSettings=function(t){var e=t.dateFrom,o=t.dateTo,i=t.durationDays,r=Boolean(e),s=Boolean(o),u=Boolean(i),c=r||s||u,h=[];if(r){var d=l.FormatDate.strToDate(e);h.push(l.FormatDate.getFormatDate(d,"DD MMM"))}if(s){var d=l.FormatDate.strToDate(o);h.push(l.FormatDate.getFormatDate(d,"DD MMM"))}return{Footer:u?i+" "+(0,a.getDeclension)(i,n.DAY_DECLENSION):"",Header:h.join(" - ").toLowerCase(),IconType:_.IconType.CALENDAR,IsVisible:c}},t.prototype.getAccommodationOptionSettings=function(t){var e=t.accommodations[0],o=void 0===e?{}:e,i=o.name,r=void 0===i?"":i,n=o.stars,s=void 0===n?0:n,a=o.type,l=void 0===a?"":a,u=Boolean(r)||Boolean(l);return{Footer:l||"",Header:r+(s>0?" "+s+"*":""),IconType:_.IconType.HOME,IsVisible:u}},t.prototype.getSeatsOptionSettings=function(t){var e=t.freeSeats,o=void 0===e?0:e;return{Footer:"Осталось "+o,Header:"Наличие мест",IconType:_.IconType.SEATS,IsVisible:Boolean(o)}},t.prototype.getAgeLimitOptionSettings=function(t){var e=t.ageMax,o=void 0===e?0:e,i=t.ageMin,r=void 0===i?0:i,s=Boolean(o),l=Boolean(r),u="";switch(!0){case s&&l:u=r+" - "+o+" лет";break;case!s&&l:u="от "+r+" "+(0,a.getDeclension)(r,n.AGE_GENITIVE_DECLENSION);break;case s&&!l:u="до "+o+" "+(0,a.getDeclension)(o,n.AGE_GENITIVE_DECLENSION);break;default:u=""}return{Footer:u,Header:"Возраст участников",IconType:_.IconType.USERS,IsVisible:l||s}},t}();e.tourCardOptionUtils=new f,t.tourCardOptionUtils=e.tourCardOptionUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardPriceControl=void 0;var r=o(23),n=o(2),s=o(3),a=o(1),l=o(5),u=o(6),c=o(922),h=function(t){function e(e){var o=t.call(this,e)||this;return o.AddCartClicked=new s.UserEvent,o.ContinueClicked=new s.UserEvent,o.templateName="tour-card-price",o._Currency=l.Currency.Rub,o._IncludePrices=[],o._IsVisibleConfirmation=!1,o._IsVisibleWaiter=!1,o._Price=0,o._PriceType=l.PriceType.ForRoom,o._waiter=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updatePrice(),this._updateCurrency(),this._updatePriceType(),this._updateWaiter(),this._updateVisibleInstantConfirmation(),this._updateIncludePrices(),this._updateVisibleIncludePrices()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Currency,i=e.IncludePrices,r=e.IsVisibleConfirmation,n=e.IsVisiblePreview,s=e.IsVisibleWaiter,l=e.Price,u=e.PriceType;((0,a.isDefined)(r)||(0,a.isDefined)(n))&&this._updateVisibleInstantConfirmation(),((0,a.isDefined)(n)||(0,a.isDefined)(i))&&this._updateVisibleIncludePrices(),(0,a.isDefined)(l)&&this._updatePrice(),(0,a.isDefined)(o)&&this._updateCurrency(),(0,a.isDefined)(u)&&this._updatePriceType(),(0,a.isDefined)(i)&&this._updateIncludePrices(),(0,a.isDefined)(s)&&this._updateWaiter()},e.prototype._updateVisibleInstantConfirmation=function(){var t=this._nodes.confirmationNode;(0,a.setVisible)(t,this._IsVisibleConfirmation&&!this._IsVisiblePreview)},e.prototype._updatePrice=function(){this._nodes.priceNode.textContent=this._Price>0?(0,a.getPrice)(this._Price):""},e.prototype._updateCurrency=function(){this._nodes.currencyNode.textContent=(0,u.getCurrencyValue)(this._Currency)},e.prototype._updatePriceType=function(){this._nodes.priceTypeNode.textContent=(0,u.getPriceTypeStr)(this._PriceType,{withPreposition:!0})},e.prototype._updateIncludePrices=function(){var t=this,e=this._nodes.includePricesNode;(0,a.removeChildren)(e),this._IncludePrices.forEach(function(o){var i=o.amount,r=o.name,n=o.value;new c.TourIncludePriceControl({Currency:(0,u.getCurrencyValue)(t._Currency),Name:r,ParentNode:e,Price:Number(i||n)})})},e.prototype._updateVisibleIncludePrices=function(){var t=this._nodes.includePricesNode;(0,a.setVisible)(t,(0,u.isNotEmptyArray)(this._IncludePrices)&&!this._IsVisiblePreview)},e.prototype._updateWaiter=function(){this._waiter||(this._waiter=new r.Waiter({ParentNode:this._nodes.waiterNode})),this._IsVisibleWaiter?this._waiter.show():this._waiter.hide()},e}(n.Control);e.TourCardPriceControl=h,t.TourCardPriceControl=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.AgencyOrderAction=void 0;var o;!function(t){t[t.BUY_ONLINE=0]="BUY_ONLINE",t[t.REQUEST=1]="REQUEST"}(o=e.AgencyOrderAction||(e.AgencyOrderAction={})),t.AgencyOrderAction=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.tourRedirectionUtils=void 0;var i=o(5),r=function(){function t(){}return t.prototype.getLink=function(t){var e=t.SearchLink,o=t.TourId,r=t.OfficeId,n=t.IsRedirect,s=e+"#"+i.Hash.Tourid+"="+o;return r>0&&(s+="&"+i.Hash.OfficeId+"="+r),n&&(s+="&"+i.Hash.Redirect+"=1"),s},t}();e.tourRedirectionUtils=new r,t.tourRedirectionUtils=e.tourRedirectionUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.CustomerOrderViewMode=void 0;var o;!function(t){t[t.BUYONLINE=0]="BUYONLINE",t[t.REQUEST=1]="REQUEST",t[t.BUYINCREDIT=2]="BUYINCREDIT"}(o=e.CustomerOrderViewMode||(e.CustomerOrderViewMode={})),t.CustomerOrderViewMode=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.TourBuyTypeEnum=void 0;var o;!function(t){t[t.BUY=1]="BUY",t[t.BUY_IN_CREDIT=2]="BUY_IN_CREDIT",t[t.OPERATOR_BOOKING=3]="OPERATOR_BOOKING"}(o=e.TourBuyTypeEnum||(e.TourBuyTypeEnum={})),t.TourBuyTypeEnum=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardContentViewModeEnum=void 0;var o;!function(t){t[t.NONE=0]="NONE",t[t.HOTEL=1]="HOTEL",t[t.ORDER=2]="ORDER",t[t.BOOKING=3]="BOOKING"}(o=e.TourCardContentViewModeEnum||(e.TourCardContentViewModeEnum={})),t.TourCardContentViewModeEnum=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MapDecoratorBase=void 0;var r=o(2),n=function(t){function e(e){var o=t.call(this,e)||this;return o._Map=null,o.__initSettings(e),e.ParentNode||(o._ParentNode=o._Map.getParentNode()),o}return i(e,t),e.prototype.show=function(){this._Map.show()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._Map.update(e)},e.prototype.hide=function(){this._Map.hide()},e.prototype.addLayer=function(t){this._Map.addLayer(t)},e.prototype.createPane=function(t,e){return this._Map.createPane(t,e)},e.prototype.getInstance=function(){return this._Map&&this._Map.getInstance()||null},e.prototype.setViewPort=function(t,e){this._Map.setViewPort(t,e)},e}(r.Control);e.MapDecoratorBase=n,t.MapDecoratorBase=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.resultPriceUtils=void 0;var i=o(5),r=o(6),n=function(){function t(){}return t.prototype.getPriceType=function(t,e,o){if(e===i.Theme.Theme1)return(0,r.getPriceTypeStr)(t,{withPreposition:!0});var n=t===i.PriceType.ForTour,s=t===i.PriceType.ForRoom;return o===i.ModeView.DescTop&&(n||s)?"":(0,r.getPriceTypeStr)(t,{isShort:!0})},t}();e.resultPriceUtils=new n,t.resultPriceUtils=e.resultPriceUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ResultItem=void 0;var r=o(222),n=o(2),s=o(4),a=o(3),l=o(1),u=o(5),c=o(16),h=o(12),d=o(15),p=o(8),_=o(1005),f=o(1006),y=function(t){function e(e){var o=t.call(this,e)||this;return o.GoToClicked=new a.UserEvent,o.LikeClicked=new a.UserEvent,o.NavButtonClicked=new a.UserEvent,o.PictureClicked=new a.UserEvent,o.PriceClicked=new a.UserEvent,o.TitleClicked=new a.UserEvent,o._ActiveNavButton=null,o._AfterHeader="",o._BeforeDescription="",o._Currency="",o._Description="",o._DescriptionClampSize=c.SizeEnum.M,o._DescriptionTextIndent=0,o._GoToItemTitle="",o._GoToItemSubmitTitle="",o._IsActiveArrowButton=!1,o._IsEnabledPictureClick=!1,o._IsLiked=!1,o._IsVisibleGoToItem=!1,o._IsVisibleLike=!1,o._ModeView=u.ModeView.DescTop,o._NavButtons=[],o._Picture="",o._Pretitle="",o._Price=0,o._PriceOld=0,o._PriceType="",o._Subtitle="",o._Title="",o._navButtons=null,o._likeButton=null,o._goToResult=null,o._descriptionHeight=0,o._descriptionExpandedHeight=0,o._prevDescriptionClampSize=null,o.__initSettings(e),o.templateName=o._ModeView===u.ModeView.DescTop?"result-item":"result-item-mobile",o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._addPriceColorClass(),this._updatePicture(),this._updateEnabledPictureClick(),this._updateAfterHeader(),this._updateBeforeDescription(),this._updateDescription(),this._updateDescriptionLineClamp(),this._updateDescriptionTextIndent(),this._updatePrice(),this._updateCurrency(),this._updatePriceType(),this._updateVisiblePrice(),this._updatePretitle(),this._updateSubtitle(),this._updateTitle(),this._renderNavButtons(),this._updateNavButtons(),this._updateActiveNavButton(),this._updateActiveArrowButton(),this._renderLikeButton()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ActiveNavButton,i=e.AfterHeader,r=e.BeforeDescription,n=e.Description,s=e.DescriptionClampSize,a=e.DescriptionTextIndent,u=e.IsActiveArrowButton,c=e.IsLiked,h=e.IsVisibleGoToItem,d=e.NavButtons,p=e.Pretitle,_=e.PriceOld,f=e.Price,y=e.Subtitle,g=e.Title;(0,l.isDefined)(o)&&this._updateActiveNavButton(),(0,l.isDefined)(r)&&this._updateBeforeDescription(),(0,l.isDefined)(n)&&this._updateDescription(),(0,l.isDefined)(a)&&this._updateDescriptionTextIndent(),(0,l.isDefined)(s)&&this._updateDescriptionLineClamp(),(0,l.isDefined)(d)&&this._updateNavButtons(),((0,l.isDefined)(f)||(0,l.isDefined)(_))&&(this._updatePrice(),this._updateVisiblePrice()),(0,l.isDefined)(p)&&this._updatePretitle(),(0,l.isDefined)(y)&&this._updateSubtitle(),(0,l.isDefined)(g)&&this._updateTitle(),(0,l.isDefined)(i)&&this._updateAfterHeader(),(0,l.isDefined)(u)&&this._updateActiveArrowButton(),(0,l.isDefined)(c)&&this._likeButton&&this._likeButton.update({IsActive:this._IsLiked}),(0,l.isDefined)(h)&&this._updateVisibleGoToItem()},e.prototype._addPriceColorClass=function(){var t=this._nodes.priceWrapperNode;t&&(0,l.addClass)(t,p.TV_PRICE_COLOR)},e.prototype._renderNavButtons=function(){var t=this._nodes.navButtonsNode;t&&(this._navButtons=new f.ResultNavButtons({ParentNode:t,Theme:this._Theme,Clicked:new s.Delegate(this,this._onNavButtonClicked)}))},e.prototype._renderLikeButton=function(){var t=this._nodes.likeNode;if(t)return this._IsVisibleLike?void(this._likeButton=new r.LikeButtonControl({Color:"#c71111",ParentNode:t,Size:c.SizeEnum.XXXL,Changed:new s.Delegate(this,this._onLikeClicked)})):void(0,l.hide)(t)},e.prototype._updateEnabledPictureClick=function(){var t=this._nodes,e=t.loupeNode,o=t.imageNode;(0,l.setVisible)(e,this._IsEnabledPictureClick),(0,l.updateClass)(o,p.TV_CLICKABLE,this._IsEnabledPictureClick),!this._IsEnabledPictureClick&&e&&((0,l.removeEvent)(e,"click",this._onLoupeNodeClick),o&&(0,l.removeEvent)(o,"click",this._onImageNodeClick))},e.prototype._updatePicture=function(){var t=this._nodes.imageNode;t&&(t.style.backgroundImage=Boolean(this._Picture)?'url("'+this._Picture+'")':"")},e.prototype._updateBeforeDescription=function(){var t=this._nodes.beforeDescriptionNode;if(t){var e=Boolean(this._BeforeDescription);t.innerHTML=e?(0,h.sanitizeHTML)(this._BeforeDescription):""}},e.prototype._updateDescriptionTextIndent=function(){var t=this._nodes.descriptionNode;t&&(t.style.textIndent=this._DescriptionTextIndent>0?this._DescriptionTextIndent+"px":"")},e.prototype._updateDescription=function(){var t=this._nodes.descriptionNode;t&&(t.innerHTML=Boolean(this._Description)?(0,h.sanitizeHTML)(this._Description):"Описание временно отсутствует. Ведется добавление информации.")},e.prototype._updateDescriptionLineClamp=function(){var t=this._nodes.descriptionNode;if(t){var e=Boolean(this._DescriptionClampSize);if((0,l.updateClass)(t,"TVLineClampEnabled",e),this._prevDescriptionClampSize){var o=d.styleUtils.getClassByLineClamp(this._prevDescriptionClampSize);(0,l.removeClass)(o)}if(e){var i=d.styleUtils.getClassByLineClamp(this._DescriptionClampSize);(0,l.addClass)(t,i)}this._prevDescriptionClampSize=this._DescriptionClampSize}},e.prototype._updateNavButtons=function(){this._navButtons&&this._navButtons.update({Items:this._NavButtons})},e.prototype._updateActiveNavButton=function(){this._navButtons&&this._navButtons.update({Active:this._ActiveNavButton})},e.prototype._updateActiveArrowButton=function(){(0,l.updateClass)(this._nodes.arrowNode,p.TV_ACTIVE,this._IsActiveArrowButton)},e.prototype._updateCurrency=function(){var t=this._nodes.priceCurrencyNode;t&&(t.textContent=this._Currency,(0,l.setVisible)(t,Boolean(this._Currency)))},e.prototype._updatePrice=function(){var t=this._nodes,e=t.arrowNode,o=t.priceNode,i=t.oldPriceNode,r=this._PriceOld>0,n=this._Price>0;if(o&&(o.innerHTML=n?(0,l.getPrice)(this._Price):""),e){var s=n&&r?-(this._PriceOld-this._Price)/this._PriceOld*100:0,a=0!==s;e.textContent=a?s.toFixed()+"%":"",(0,l.updateClass)(e,"TVResultHotArrow",a)}i&&((0,l.setVisible)(i,r),i.innerHTML=r?(0,l.getPrice)(this._PriceOld):"")},e.prototype._updatePriceType=function(){var t=this._nodes.priceTypeNode;t&&(t.textContent=this._PriceType,(0,l.setVisible)(t,Boolean(this._PriceType)))},e.prototype._updateAfterHeader=function(){var t=this._nodes.afterHeaderNode;t&&(t.innerHTML=(0,h.sanitizeHTML)(this._AfterHeader))},e.prototype._updatePretitle=function(){var t=this._nodes.preTitleNode;t&&(t.innerHTML=(0,h.sanitizeHTML)(this._Pretitle))},e.prototype._updateSubtitle=function(){var t=this._nodes.subTitleNode;t&&(t.innerHTML=(0,h.sanitizeHTML)(this._Subtitle))},e.prototype._updateTitle=function(){var t=this._nodes.titleNode;t&&(t.innerHTML=(0,h.sanitizeHTML)(this._Title))},e.prototype._updateVisiblePrice=function(){var t=this._nodes.priceButtonNode;(0,l.updateClass)(t,p.TV_HIDDEN,0===this._Price)},e.prototype._updateVisibleGoToItem=function(){if(this._IsVisibleGoToItem){var t=this._nodes.footerNode;(0,l.removeChildren)(t),this._goToResult=new _.GoToResultControl({Class:"TVResultItemGoToResult",ModeView:this._ModeView,ParentNode:t,SubmitTitle:this._GoToItemSubmitTitle,Theme:this._Theme,Title:this._GoToItemTitle,SubmitClicked:new s.Delegate(this,this._onGoToClicked)})}},e.prototype._onNavButtonClicked=function(t){this.NavButtonClicked.fire(t)},e.prototype._onDescriptionNodeClick=function(){var t=this,e=this._nodes.descriptionNode;if(this._descriptionHeight||(this._descriptionHeight=e.clientHeight),this._descriptionExpandedHeight||((0,l.addClass)(e,"TVDescriptionExpanded"),this._descriptionExpandedHeight=e.clientHeight,(0,l.removeClass)(e,"TVDescriptionExpanded"),e.style.height=this._descriptionHeight+"px",e.style.maxHeight="none"),this._descriptionHeight!==this._descriptionExpandedHeight){(0,l.toggleClass)(e,"TVDescriptionExpanded");setTimeout(function(){var o=(0,l.hasClass)(e,"TVDescriptionExpanded")?t._descriptionExpandedHeight:t._descriptionHeight;e.style.height=o+"px"},10)}},e.prototype._onTitleNodeClick=function(t){this.TitleClicked.fire({Event:t})},e.prototype._onImageNodeClick=function(t){this.PictureClicked.fire({Event:t})},e.prototype._onLoupeNodeClick=function(t){this.PictureClicked.fire({Event:t})},e.prototype._onGoToClicked=function(){this.GoToClicked.fire()},e.prototype._onLikeClicked=function(t){t.Event.stopPropagation(),this.LikeClicked.fire()},e.prototype._onPriceButtonNodeClick=function(t){this.PriceClicked.fire({Event:t})},e}(n.Control);e.ResultItem=y,t.ResultItem=y}).call(e,o(0))},function(t,e,o){"use strict";var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ResultBuilderItem=void 0;var r=o(2),n=o(3),s=o(7),a=o(1),l=o(5),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.GoToItemClicked=new n.UserEvent,e.PriceChanged=new n.UserEvent,e._Price=0,e._PriceOld=0,e._PriceType=l.PriceType.None,e._descriptionHeight=0,e._descriptionExpandedHeight=0,e._closeTabTimeout=null,e}return i(e,t),e.prototype.update=function(e){var o=this._Price;t.prototype.update.call(this,e),(0,a.isDefined)(e.Price)&&o!==e.Price&&(this._updatePrice(),this.PriceChanged.fire({Id:this._Id}))},e.prototype.getPrice=function(){return this._Price},e.prototype.destroy=function(){clearTimeout(this._closeTabTimeout),t.prototype.destroy.call(this)},e.prototype._updatePrice=function(){this._nodes.priceNode.textContent=(0,a.getPrice)(this._Price)},e.prototype._closeTabsWithScroll=function(t){var e=this;if(t)return void this._closeTabs();var o=(0,a.getScrolls)().Y,i=(0,a.cumulativeOffset)(this._DomNode).top;if(o>i)return(0,a.scrollToTop)(s.SCROLL_DURATION_M,i-s.FIXED_TOOLBAR_HEIGHT),void(this._closeTabTimeout=setTimeout(function(){return e._closeTabs()},350));this._closeTabs()},e.prototype._closeTabs=function(){},e}(r.Control);e.ResultBuilderItem=u},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ResultMapController=e.MapDecorators=void 0;var n,s=o(55),a=o(56),l=o(17),u=o(2),c=o(4),h=o(3),d=o(1),p=o(5),_=o(20),f=o(37),y=o(25),g=o(172),C=o(376),v=o(278),m=o(62),T=o(1019),w=o(1023),S=o(521),P=o(507),b=o(519),I=o(316);!function(t){t[t.Card=0]="Card",t[t.Filter=1]="Filter"}(n=e.MapDecorators||(e.MapDecorators={}));var O=function(t){function e(e){var o=t.call(this,e)||this;return o.Hide=new h.UserEvent,o.ResortHotelsShow=new h.UserEvent,o.ViewTypeChanged=new h.UserEvent,o._ModeView=p.ModeView.DescTop,o._Ref=null,o._SearchMode=g.SearchResultMode.PREPARE,o._Theme=p.Theme.Theme2,o._ToursCount=0,o._ErrorReport=null,o._filterTimeout=null,o._mapController=null,o._mapWindow=null,o.__initSettings(e),o}return i(e,t),e.prototype.render=function(){switch(t.prototype.render.call(this),this._mapController=new b.MapController({ModeView:this._ModeView,ErrorReport:this._ErrorReport,HotelsSelected:new c.Delegate(this,this._onHotelsSelected),ResortsSelected:new c.Delegate(this,this._onResortsSelected)}),!0){case this._ModeView===p.ModeView.Mobile&&(0,d.isTablet)():this._mapController=new w.MapControllerFilterDecorator({MapController:this._mapController,Theme:this._Theme,Changed:new c.Delegate(this,this._onFilterChanged),FilterVisibilityChanged:new c.Delegate(this,this._onFilterVisibilityChanged)});break;case this._ModeView===p.ModeView.DescTop:this._mapWindow=new S.MapWindow({Hide:new c.Delegate(this,this._onWindowHide)});var e=this._mapWindow.getDomNode();this._mapController.setParentNode(e),this._mapController=new w.MapControllerFilterDecorator({MapController:this._mapController,ParentNode:e,Theme:this._Theme,Changed:new c.Delegate(this,this._onFilterChanged),FilterVisibilityChanged:new c.Delegate(this,this._onFilterVisibilityChanged)}),this._mapController=new T.MapControllerCardDecorator({MapController:this._mapController,ParentNode:e,Ref:this._Ref,RunSearchOnResort:new c.Delegate(this,this._onRunSearchOnResort),PopupHide:new c.Delegate(this,this._onMapWindowUnfix),PopupShow:new c.Delegate(this,this._onMapWindowFix)})}},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._rendered){if(this._mapController.update(e),(0,d.isDefined)(e.SearchMode))switch(this._SearchMode){case g.SearchResultMode.END:this._switchToEndMode()}P.updateNotificationWindow.Click.addOnce(new c.Delegate(this,this._onClosePopupEnd))}},e.prototype.hide=function(){l.resultStore.Changed.remove(this),this._mapController.hide(),P.updateNotificationWindow.Click.remove(this),this.Hide.fire()},e.prototype.show=function(){if(this._rendered||this.render(),this._mapWindow&&this._mapWindow.show(),this._ModeView===p.ModeView.Mobile){var t=s.layoutPageFactory.getPage();t instanceof C.SearchMapPage&&t.update({Content:this._mapController})}else this._mapController.show();l.resultStore.Changed.addOnce(new c.Delegate(this,this._onResultStoreChanged))},e.prototype._onResultStoreChanged=function(t){var e=t.SubType;if(t.Type===_.CatalogName.FilterHotels&&e!==_.CatalogName.Operators){var o=y.settingUtils.getResorts(l.resultStore.getActualSearchFilter());o&&o.length>0&&this._mapController.update({Decorator:n.Filter,HotelProps:{FilterRegion:o},Resorts:o})}},e.prototype._onRunSearchOnResort=function(t){var e=t.Id,o=t.ParentId,i=o?a.resortsStore.getSubResort(e):a.resortsStore.getResort(e),r=f.searchMapUtils.getBounds(i);if(!r){var n=l.resultStore.getCountryInfo();r=f.searchMapUtils.getCountryBounds(n)}this._mapController.update({Bounds:r,ToursGroup:p.ToursGroupBy.Hotels}),this.ResortHotelsShow.fire(t)},e.prototype._onFilterChanged=function(t){var e=this;l.resultStore.setSearchFilter(r(r({},l.resultStore.getActualSearchFilter()),t)),this._updateBoundsAfterFilterChanged(),clearTimeout(this._filterTimeout),this._filterTimeout=setTimeout(function(){e._filterTimeout=null,(0,m.runSearch)(r(r({},l.resultStore.getActualSearchSettings()),{DeepSearch:p.DeepSearchMode.Enable}))},v.SearchModule.FILTER_TIMEOUT)},e.prototype._updateBoundsAfterFilterChanged=function(){var t=l.resultStore.getActualSearchSettings(),e=(0,I.getHotelsResortsBounds)(t);if(e.length>0){var o=f.searchMapUtils.getBoundsBorder(e);(0,d.isDefined)(o)&&this._mapController.update({Bounds:o})}},e.prototype._onFilterVisibilityChanged=function(t){var e=this;t.IsVisible?clearTimeout(this._filterTimeout):this._filterTimeout&&(clearTimeout(this._filterTimeout),this._filterTimeout=setTimeout(function(){e._filterTimeout=null,(0,m.runSearch)(r(r({},l.resultStore.getActualSearchSettings()),{DeepSearch:p.DeepSearchMode.Enable}))},v.SearchModule.FILTER_TIMEOUT))},e.prototype._onHotelsSelected=function(t){var e=t.Hotels;if(l.resultStore.setSearchFilter(r(r({},l.resultStore.getActualSearchFilter()),{Hotels:e})),e.length>0){var o=l.resultStore.getActualSearchSettings();(0,m.runSearch)(r(r({},o),{DeepSearch:p.DeepSearchMode.Enable,Hotels:e}))}this._mapController.update({Decorator:n.Filter,Hotels:e})},e.prototype._onResortsSelected=function(t){var e=t.Resorts;if(e.length>0){var o=l.resultStore.getActualSearchSettings();(0,m.runSearch)(r(r({},o),{DeepSearch:p.DeepSearchMode.Enable,Resorts:e}))}},e.prototype._onMapWindowUnfix=function(){this._mapWindow.update({FixMap:!1})},e.prototype._onMapWindowFix=function(){this._mapWindow.update({FixMap:!0})},e.prototype._onWindowHide=function(){this.ViewTypeChanged.fire({ViewType:p.ResultViewType.List})},e.prototype._showPopupEnd=function(){P.updateNotificationWindow.update({ToursCount:this._ToursCount}),P.updateNotificationWindow.show()},e.prototype._switchToEndMode=function(){this._ModeView===p.ModeView.Mobile&&this._showPopupEnd()},e.prototype._onClosePopupEnd=function(){P.updateNotificationWindow.update({ShowButton:!1})},e}(u.Control);e.ResultMapController=O,t.ResultMapController=O,t.MapDecorators=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.getHotelsResortsBounds=void 0;var i=o(41),r=o(56),n=o(17),s=o(7),a=o(52),l=o(37),u=o(25),c=function(t){var e=t.Resorts,o=t.Hotels,c=[],h=u.settingUtils.getCountryId(t),d=n.resultStore.getCountryInfo(h);if(o&&o.length>0){var p=[];o.forEach(function(t){var e=i.hotelsStore.getHotel(t);if(e.coord&&l.searchMapUtils.hasCoords(e.coord)){var o=Number(e.regioncode||"");if(!p.some(function(t){return t===o})){p.push(o);var n=r.resortsStore.getResort(o),s=l.searchMapUtils.getBounds(n);if(s)c.push(s);else{var a=l.searchMapUtils.getCountryBounds(d);c.push(a)}}}})}else e&&e.length>0&&e.forEach(function(t){var e=r.resortsStore.getResort(t),o=l.searchMapUtils.getBounds(e);if(!o){var i=r.resortsStore.getSubResort(t-s.FIX_SUBRESORT_ID);if(!(o=l.searchMapUtils.getBounds(i))){var n=a.resortUtils.getResortById(t),u=n&&a.resortUtils.getParentId(n);e=u&&r.resortsStore.getResort(u),o=l.searchMapUtils.getBounds(e)}}if(o)c.push(o);else{var h=l.searchMapUtils.getCountryBounds(d);c.push(h)}});return c};e.getHotelsResortsBounds=c,t.getHotelsResortsBounds=e.getHotelsResortsBounds}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__awaiter||function(t,e,o,i){function r(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,n){function s(t){try{l(i.next(t))}catch(t){n(t)}}function a(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){t.done?o(t.value):r(t.value).then(s,a)}l((i=i.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){function o(t){return function(e){return i([t,e])}}function i(o){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,n=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){l.label=o[1];break}if(6===o[0]&&l.label<s[1]){l.label=s[1],s=o;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(o);break}s[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(t,l)}catch(t){o=[6,t],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var r,n,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(e,"__esModule",{value:!0}),e.RequestControl=void 0;var s=o(34),a=o(282),l=o(32),u=o(73),c=o(25),h=o(2),d=o(4),p=o(3),_=o(1),f=o(5),y=o(1038),g=function(t){function e(e){var o=t.call(this,e)||this;return o.Send=new p.UserEvent,o._Class="TVRequestControl",o._Description="",o._IsEnabledPromocode=!1,o._IsEnabledMultiOffice=!0,o._ModeView=f.ModeView.DescTop,o._PromocodeTourId=0,o._PromocodeTourPrice=0,o._UserEmail="",o._UserName="",o._UserPhone="",o._UserComment="",o._requestForm=null,o._multiOffice=null,o._isEnabledMultiOffice=!1,o._isOfficeSelectionRequired=!1,o._selectedOfficeId=0,o._showMultiOfficePromise=null,t.prototype.__initSettings.call(o,e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateEnabledMultiOffice(),this._renderRequestForTour(),this._updateVisible()},e.prototype.show=function(){return r(this,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return this._rendered||this.render(),this._updateEnabledMultiOffice(),this._showMultiOfficePromise=this._showMultiOffice(),[4,this._showMultiOfficePromise];case 1:return t.sent(),this._showMultiOfficePromise=null,this._updateSelectedOffice(),this._updateVisible(),this._clearUserData(),[2]}})})},e.prototype.update=function(e){var o=this;if(t.prototype.update.call(this,e),this._rendered){var i=e.Description,r=e.IsEnabledPromocode,n=e.IsEnabledMultiOffice,s=e.ModeView,a=e.PromocodeTourId,l=e.PromocodeTourPrice,u=e.UserEmail,c=e.UserName,h=e.UserPhone,d=e.UserComment;if((0,_.isDefined)(n)){(this._showMultiOfficePromise||Promise.resolve()).then(function(){o._updateEnabledMultiOffice(),o._updateSelectedOffice(),o._updateVisible()})}((0,_.isDefined)(i)||(0,_.isDefined)(r)||(0,_.isDefined)(s)||(0,_.isDefined)(a)||(0,_.isDefined)(l)||(0,_.isDefined)(u)||(0,_.isDefined)(c)||(0,_.isDefined)(h)||(0,_.isDefined)(d))&&this._requestForm.update(e)}},e.prototype._onOfficeSelected=function(t){if(this._updateSelectedOffice(),this._updateVisible(),this._ModeView===f.ModeView.DescTop&&this._selectedOfficeId){var e=this._multiOffice.getDomNode();e&&e.scrollIntoView()}},e.prototype._onResponse=function(t){if(this._multiOffice){this._multiOffice.setIsVisible(!1);c.settingUtils.getIsSuccessResponse(t)&&this._multiOffice.setBlockTimeSelectionOffice()}t.CallBack.fire(t)},e.prototype._onSendRequest=function(t){this._isOfficeSelectionRequired&&!this._selectedOfficeId||(t.UserOffice=this._isEnabledMultiOffice?this._selectedOfficeId:0,t.CallBack=new d.Delegate(this,this._onResponse,{CallBack:t.CallBack}),this.Send.fire(t))},e.prototype._updateVisible=function(){switch(!0){case!this._isEnabledMultiOffice:this._multiOffice&&this._multiOffice.setIsVisible(!1),this._requestForm.setIsVisible(!0);break;case this._isEnabledMultiOffice&&!this._isOfficeSelectionRequired:this._multiOffice&&this._multiOffice.setIsVisible(!0),this._requestForm.setIsVisible(!0);break;case this._isOfficeSelectionRequired&&!this._selectedOfficeId:this._multiOffice&&this._multiOffice.setIsVisible(!0),this._requestForm.setIsVisible(!1);break;case Boolean(this._selectedOfficeId):this._multiOffice&&this._multiOffice.setIsVisible(!0),this._requestForm.setIsVisible(!0)}},e.prototype._renderRequestForTour=function(){var t=s.clientCatalog.getClientData(),e=l.clientUtils.getFormRequiredFields(t);this._requestForm=new y.RequestForm({Class:"TVRequestControlForm",Description:this._Description,FormRequiredFields:e,IsEnabledPromocode:this._IsEnabledPromocode,ModeView:this._ModeView,ParentNode:this._DomNode,PromocodeTourId:this._PromocodeTourId,PromocodeTourPrice:this._PromocodeTourPrice,UserComment:this._UserComment,UserEmail:this._UserEmail,UserName:this._UserName,UserPhone:this._UserPhone,SendingClicked:new d.Delegate(this,this._onSendRequest)})},e.prototype._renderMultiOffice=function(){this._multiOffice=new a.MultiOfficeManager({Class:"TVRequestControlOffice",ModeView:this._ModeView,ParentNode:this._DomNode,OfficeSelected:new d.Delegate(this,this._onOfficeSelected)})},e.prototype._clearUserData=function(){this._requestForm.update({Discount:0,PromoCode:"",UserComment:this._UserComment,UserEmail:"",UserName:"",UserPhone:""})},e.prototype._updateEnabledMultiOffice=function(){var t=s.clientCatalog.getClientData(),e=l.clientUtils.getMultiOfficeSettings(t);this._isEnabledMultiOffice=this._IsEnabledMultiOffice&&u.officeUtils.getMultiOfficeEnable(e),this._isOfficeSelectionRequired=this._isEnabledMultiOffice&&u.officeUtils.getOfficeSelectionRequired(e)},e.prototype._showMultiOffice=function(){return this._isEnabledMultiOffice?(this._multiOffice||this._renderMultiOffice(),this._multiOffice.show()):Promise.resolve()},e.prototype._updateSelectedOffice=function(){this._selectedOfficeId=this._multiOffice?this._multiOffice.getSelectedOffice():0},e}(h.Control);e.RequestControl=g,t.RequestControl=g}).call(e,o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CalendarToursController=void 0;var s=o(2),a=o(4),l=o(3),u=o(7),c=o(5),h=o(529),d=o(64),p=function(e){function o(t){var o=e.call(this,t)||this;return o.MonthChanged=new l.UserEvent,o.ShowToursClicked=new l.UserEvent,o._CountryId=0,o._Currency=c.Currency.None,o._DepartureId=0,o._DescriptionEnable=!0,o._ModeView=c.ModeView.DescTop,o._Period=1,o._Regular=c.RegularTours.Off,o._Stars=1,o._TemperatureEnable=!0,o._calendarControl=null,o._isNewCalendar=!0,e.prototype.__initSettings.call(o,t),o._updateCalendar=o._updateCalendar.bind(o),o._Render&&o.render(),o}return r(o,e),o.prototype.render=function(){this._calendarControl=t.newCalendarToursControl({IsMobile:this._ModeView===c.ModeView.Mobile,ParentNode:this._ParentNode,MonthChanged:new a.Delegate(this,this._loadData),ShowToursClicked:new a.Delegate(this,this._onShowToursClicked)}),this._loadData({Month:this._Period})},o.prototype.update=function(t){e.prototype.update.call(this,t),this._calendarControl&&(this._isNewCalendar=!0,this._loadData({Month:this._Period}))},o.prototype._loadData=function(t){var e={city:this._DepartureId,country:this._CountryId,format:"json",period:t.Month,regular:this._Regular,state:c.ModuleTypes.Calendar};this._Stars>u.MIN_STARS&&(e.stars=this._Stars),this._Currency!==c.Currency.None&&(e.currency=this._Currency),h.calendarDataService.getTours(e).then(this._updateCalendar)},o.prototype._onShowToursClicked=function(t){this.ShowToursClicked.fire(t)},o.prototype._updateCalendar=function(t){var e=d.calendarUtils.getCalendarDays(t),o=d.calendarUtils.getCalendarData(t);this._calendarControl.update(n(n(n({},e),o),{CountryId:this._CountryId,DepartureId:this._DepartureId,DescriptionEnable:this._DescriptionEnable,IsNewCalendar:this._isNewCalendar,TemperatureEnable:this._TemperatureEnable})),this.MonthChanged.fire(o),this._isNewCalendar=!1},o}(s.Control);e.CalendarToursController=p,i.CalendarToursController=p}).call(e,o(11),o(0))},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){o.d(e,"Label",function(){return n});var i=o(2),r=(o.n(i),o(1)),n=(o.n(r),function(t){this._Caption="",n.baseClass.call(this,t),this._Class="TVLabel",this._Render&&this.render()});Object(r.initClass)(n,i.Control);var s=n.prototype;s.render=function(){n.base.render.call(this),this._DomNode.innerHTML=this._Caption},s.setCaption=function(t){this._Caption=t,this._rendered&&(this._DomNode.innerHTML=t)},s=null,t.Label=n}.call(e,o(0))},,function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RestFilter=void 0;var r=o(2),n=o(1),s=o(5),a=o(3),l=function(t){function e(e){var o=t.call(this,e)||this;return o.FilterChange=new a.UserEvent,o._Class="TVVerticalResortFilter",o._Items=[],o._Delay=500,o._ActiveFilters=[],t.prototype.__initSettings.call(o,e),o._timeoutHandler=o._onFiltered.bind(o),o.render(),o}return i(e,t),e.getClassById=function(t){switch(t){case s.RestType.SeaBeach:return"TVRestTypeSeaBeach";case s.RestType.Children:return"TVRestTypeChildren";case s.RestType.Shopping:return"TVRestTypeShopping";case s.RestType.Party:return"TVRestTypeParty";case s.RestType.Excursion:return"TVRestTypeExcursion";case s.RestType.Sky:return"TVRestTypeSky";case s.RestType.Health:return"TVRestTypeHealth";default:return""}},e.getTitleById=function(t){switch(t){case s.RestType.SeaBeach:return"Море пляж";case s.RestType.Children:return"С детьми";case s.RestType.Shopping:return"Прогулки";case s.RestType.Party:return"Вечеринки";case s.RestType.Excursion:return"Экскурсии";case s.RestType.Sky:return"Горные лыжи";case s.RestType.Health:return"Лечение";default:return""}},e.prototype.render=function(){t.prototype.render.call(this),this._renderItems()},e.prototype.refresh=function(t){this.__initSettings(t),this._Items.sort(),(0,n.removeChildren)(this._DomNode),this._renderItems()},e.prototype._renderItems=function(){var t;this._buttons=[];for(var o=0;o<this._Items.length;o++)t=(0,n.newDiv)("TVVRFItem "+e.getClassById(this._Items[o]),this._DomNode),(0,n.addEvent)(t,"click",this._onFIClicked.bind(this,{Type:this._Items[o],Index:o})),this._ActiveFilters.indexOf(this._Items[o])>-1&&(0,n.addClass)(t,"TVVRFActiveItem"),this._buttons.push(t),(0,n.newDiv)("TVVRFIcon",t),t=(0,n.newDiv)("",t),t.style.display="inline-block",t.style.verticalAlign="top",(0,n.newDiv)("TVVRFTitle",t),(0,n.newDiv)("TVVRFAbout",t)},e.prototype._onFIClicked=function(t){clearTimeout(this._toId),this._ActiveFilters.indexOf(t.Type)>-1?this._ActiveFilters.splice(this._ActiveFilters.indexOf(t.Type),1):this._ActiveFilters.push(t.Type),(0,n.toggleClass)(this._buttons[t.Index],"TVVRFActiveItem"),this._Delay>0?this._toId=setTimeout(this._timeoutHandler,this._Delay):this._onFiltered()},e.prototype._onFiltered=function(){this.FilterChange.fire({ActiveFilters:this._ActiveFilters})},e}(r.Control);e.RestFilter=l,t.RestFilter=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.getFilterSelectCity=void 0;var i=o(5),r=o(1094),n=o(537),s=function(t){var e=t.ModeView;return e&&e===i.ModeView.Mobile?new r.ListSelectCity(t):new n.TableSelectCity(t)};e.getFilterSelectCity=s,t.getFilterSelectCity=e.getFilterSelectCity}).call(e,o(0))},,,,,,,,,,function(t,e,o){"use strict";(function(t){var i=this&&this.__assign||function(){return i=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},i.apply(this,arguments)},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.averageColorUtils=e.AverageColorUtils=e.AveragePercent=e.AverageDirection=e.MAX_AVERAGE_COLOR_ALFA=void 0;var n=r(o(1201));e.MAX_AVERAGE_COLOR_ALFA=255;var s,a=[0,0,0,e.MAX_AVERAGE_COLOR_ALFA];!function(t){t.Simple="simple",t.Sqrt="sqrt",t.Dominant="dominant"}(s||(s={}));var l;!function(t){t.BOTTOM="to bottom",t.LEFT="to left",t.TOP="to top"}(l=e.AverageDirection||(e.AverageDirection={}));var u;!function(t){t[t.START=0]="START",t[t.MIDDLE=50]="MIDDLE",t[t.END=100]="END"}(u=e.AveragePercent||(e.AveragePercent={}));var c=function(){function t(){this._fastAverageColor=new n.default}return t.getGradient=function(e){var o=e.ColorEnd,i=void 0===o?t.DEFAULT_COLOR_END:o,r=e.ColorStart,n=void 0===r?t.DEFAULT_COLOR_START:r,s=e.Direction,a=void 0===s?l.BOTTOM:s,c=e.PercentEnd,h=void 0===c?u.END:c,d=e.PercentStart;return"linear-gradient("+a+", "+n+" "+(void 0===d?u.START:d)+"%, "+i+" "+h+"%)"},t.prototype.getTopGradient=function(e,o){void 0===o&&(o={});var r=e instanceof HTMLImageElement?this.getTopAverageColor(e):e,n=this.getOpacityColor(r,0),s=this.getOpacityColor(r);return t.getGradient(i(i({},o),{ColorEnd:s,ColorStart:n,Direction:l.TOP}))},t.prototype.getLeftGradient=function(e){var o=e instanceof HTMLImageElement?this.getLeftAverageColor(e):e,i=this.getOpacityColor(o,0),r=this.getOpacityColor(o);return t.getGradient({ColorEnd:r,ColorStart:i,Direction:l.LEFT})},t.prototype.getTopAverageColor=function(t){return this._getDarkAverageColor(t,{height:50})},t.prototype.getRightAverageColor=function(t){return this._getDarkAverageColor(t,{width:50,left:t.naturalWidth-50})},t.prototype.getBottomAverageColor=function(t){return this._getDarkAverageColor(t,{height:50,top:t.naturalHeight-50})},t.prototype.getBottomGradient=function(e,o){void 0===o&&(o={});var r=e instanceof HTMLImageElement?this.getBottomAverageColor(e):e,n=this.getOpacityColor(r,0),s=this.getOpacityColor(r);return t.getGradient(i(i({},o),{ColorEnd:s,ColorStart:n,Direction:l.BOTTOM}))},t.prototype.getVerticalGradient=function(e,o){void 0===o&&(o=1);var i=this.getOpacityColor(this.getTopAverageColor(e),o),r=this.getOpacityColor(this.getBottomAverageColor(e),o);return t.getGradient({ColorEnd:r,ColorStart:i,Direction:"180deg"})},t.prototype.getHorizontalGradient=function(e,o){void 0===o&&(o=1);var i=this.getOpacityColor(this.getLeftAverageColor(e),o),r=this.getOpacityColor(this.getRightAverageColor(e),o);return t.getGradient({ColorEnd:r,ColorStart:i,Direction:"90deg"})},t.prototype.getLeftAverageColor=function(t){return this._getDarkAverageColor(t,{width:50})},t.prototype.getAverageColor=function(t){return this._getDarkAverageColor(t)},t.prototype.getOpacityColor=function(t,e){return void 0===e&&(e=255),"rgba("+[].concat(t.value.slice(0,3),e).join(",")+")"},t.prototype.getAverageColors=function(t){return{Bottom:e.averageColorUtils.getBottomAverageColor(t),Left:e.averageColorUtils.getLeftAverageColor(t),Main:e.averageColorUtils.getAverageColor(t),Right:e.averageColorUtils.getRightAverageColor(t),Top:e.averageColorUtils.getTopAverageColor(t)}},t.prototype.getDarkerColorRgba=function(t){return this._getMixedColorRgba(t,a)},t.prototype.convertRgbaToRgbString=function(t){return"rgb("+t.slice(0,3).join(",")+")"},t.prototype._getLessGrayAverageColor=function(t,e){var o=this;void 0===e&&(e={});var r=[];return r.push(this._fastAverageColor.getColor(t,i({algorithm:s.Dominant},e))),r.push(this._fastAverageColor.getColor(t,i({algorithm:s.Simple},e))),r.push(this._fastAverageColor.getColor(t,i({algorithm:s.Sqrt},e))),r.sort(function(t,e){var i=o._getMaxDifference(t.value.slice(0,3)),r=o._getMaxDifference(e.value.slice(0,3));return i<r?1:i>r?-1:t.value[0]+t.value[1]+t.value[2]-(e.value[0]+e.value[1]+e.value[2])}),r[0]},t.prototype._getMaxDifference=function(t){return t.length<2?0:(t.sort(function(t,e){return t-e}),t[t.length-1]-t[0])},t.prototype._getDarkAverageColor=function(t,e){void 0===e&&(e={});var o=this._getLessGrayAverageColor(t,e);return o=o.isLight?this._getDarkColor(o):o,{hex:o.hex,value:o.value}},t.prototype._getDarkColor=function(t){return t.value=this._getMixedColorRgba(t.value,a),t.rgb=this.convertRgbaToRgbString(t.value),t.rgba="rgba("+t.value.join(",")+")",t},t.prototype._getMixedColorRgba=function(t,e){return this._fastAverageColor.getColorFromArray4(t.concat(e))},t.DEFAULT_COLOR_END="rgb(0, 0, 0)",t.DEFAULT_COLOR_START="rgba(0, 0, 0, 0)",t}();e.AverageColorUtils=c,e.averageColorUtils=new c,t.averageColorUtils=e.averageColorUtils,t.AverageColorUtils=c,t.AveragePercent=u,t.AverageDirection=l,t.MAX_AVERAGE_COLOR_ALFA=e.MAX_AVERAGE_COLOR_ALFA}).call(e,o(0))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ManagerInfoControl=void 0;var r=o(2),n=o(1),s=o(12),a=o(28),l=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="manager-info",o._Photo="",o._Name="",o._Phone="",o._Text="",o._Logo="",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._update()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._update()},e.prototype._update=function(){var t=this._nodes,e=t.photoNode,o=t.logoNode,i=t.textNode,r=t.photoPrintNode,l=t.logoPrintNode,u=t.photoBlock,c=t.logoBlock,h=t.name;e.style.backgroundImage="url("+this._Photo+")",o.style.backgroundImage="url("+a.pictureUtils.getNoCacheUrl(this._Logo)+")",r.src=this._Photo,l.src=this._Logo,i.innerHTML=(0,s.sanitizeHTML)(this._Text),(0,n.setVisible)(h,!!this._Name),(0,n.setVisible)(u,!!this._Photo),(0,n.setVisible)(c,!!this._Logo),this.setIsVisible(this._IsVisible)},e}(r.Control);e.ManagerInfoControl=l,t.ManagerInfoControl=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.cartShareUtils=e.CartShareUtils=void 0;var i=o(1),r=o(6),n=o(13),s=o(111),a=o(181),l=o(255),u=function(){function t(){}return t.prototype.getShareSettings=function(t,e,o){var i=e.share,r=void 0===i?"":i,n=this._getToursText(t);return{Info:{AddInfo:[n],MainInfo:["Подборка туров #"+o]},Link:r&&r.link||"",Text:l.shareUtils.removeFormatText(n)}},t.prototype._getToursText=function(t){void 0===t&&(t=[]);var e=[];return t.forEach(function(t){var o=t.Name,u=void 0===o?"":o,c=t.HotelsData,h=void 0===c?[]:c,d=[u+":"],p=[];h.forEach(function(t){var e=t.Accomodation,o=t.AccomodationName,u=void 0===o?"":o,c=t.Name,h=void 0===c?"":c,d=t.Stars,_=t.Tours,f=void 0===_?[]:_,y=[];f.forEach(function(t){var o=t.Adults,c=t.Child,p=t.Currency,_=t.DepartureId,f=t.DepartureNameFrom,g=void 0===f?"":f,C=t.FlyDate,v=t.Meal,m=t.Nights,T=t.Price,w=t.Room,S=[],P="";if(P=e>0?u?"("+u+")":"":d>0?d+"*":"",h){var b=h.toLocaleUpperCase();b=Boolean(P)?b+" "+P:b,S.push(l.shareUtils.getBoldText(b))}if(C){var I=n.FormatDate.strToDate(C);S.push(n.FormatDate.getFormatDate(I,"DD MMM"))}if(m&&S.push(m+"нч"),g){var O=a.departureUtils.isNoFlight(_)?g:s.cartUtils.getDepartureNameFrom(g);S.push(O)}w&&S.push(""+w);var M=o+"взр";M+=Number(c)>0?" "+c+"реб":"",S.push(M),S.push(v);var D=(0,i.getPrice)(T)+" "+(0,r.getCurrencyRusStr)(p).toLocaleLowerCase();y.push(S.join(", ")+"\n"+D)}),p.push(y.join("\n\n"))}),d.push(p.join("\n\n")),e.push(d.join("\n"))}),e.join("\n\n")},t}();e.CartShareUtils=u,e.cartShareUtils=new u,t.cartShareUtils=e.cartShareUtils,t.CartShareUtils=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.CartAction=void 0;var o;!function(t){t.Add="add",t.AddHot="addhot",t.CartList="cartlist",t.CartListFull="cartlistfull",t.ClientData="clientdata",t.Delete="delete",t.Email="email",t.ExportToLM="exporttolm",t.GetEmail="getemail",t.GetHot="gethot",t.GetPrint="getprint",t.GetSms="getsms",t.LinkManager="linkmanager",t.List="list",t.Refresh="refresh",t.Remove="remove",t.Save="save",t.SendAgency="sendagency",t.SendLog="sendlog",t.Sms="sms",t.Status="status",t.UpdateTour="updatetour"}(o=e.CartAction||(e.CartAction={})),t.CartAction=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.CartPreviewAlign=void 0;var o;!function(t){t[t.Right=0]="Right",t[t.Left=1]="Left"}(o=e.CartPreviewAlign||(e.CartPreviewAlign={})),t.CartPreviewAlign=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RegistrationController=void 0;var r=o(9),n=o(4),s=o(1),a=o(22),l=o(822),u=o(823),c=o(824),h=function(t){function e(e){var o=t.call(this,e)||this;return o._RegistrationNode=null,o._LoginClicked=null,o._email="",o._managerAccess=null,o._registerForm=null,o._shortLoginPassword=null,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.show=function(){this._showManagerAccess()},e.prototype.hide=function(){this._clear()},e.prototype.destroy=function(){a.authManager.RegisterSuccess.remove(this),a.authManager.RegisterFail.remove(this),a.authManager.LoginSuccess.remove(this),a.authManager.LoginFail.remove(this),a.authManager.Logout.remove(this),t.prototype.destroy.call(this)},e.prototype._init=function(){a.authManager.RegisterSuccess.addOnce(new n.Delegate(this,this._onRegister)),a.authManager.RegisterFail.addOnce(new n.Delegate(this,this._onRegisterFail)),a.authManager.LoginSuccess.addOnce(new n.Delegate(this,this._onLogin)),a.authManager.LoginFail.addOnce(new n.Delegate(this,this._onLoginFail)),a.authManager.Logout.addOnce(new n.Delegate(this,this._onLogout))},e.prototype._clear=function(){this._RegistrationNode&&(0,s.removeChildren)(this._RegistrationNode)},e.prototype._showRegisterForm=function(){this._RegistrationNode&&(this._clear(),this._RegistrationNode.appendChild(this._getRegisterForm().getDomNode()))},e.prototype._showShortLoginPassword=function(){if(this._RegistrationNode){this._clear();var t=this._getShortLoginPassword();t.update({IsError:!1,Updating:!1}),this._RegistrationNode.appendChild(t.getDomNode())}},e.prototype._showManagerAccess=function(){this._RegistrationNode&&(this._clear(),this._RegistrationNode.appendChild(this._getManagerAccess().getDomNode()))},e.prototype._getManagerAccess=function(){return this._managerAccess||(this._managerAccess=new l.ManagerAccessControl({LoginClicked:this._LoginClicked,RegisterClicked:new n.Delegate(this,this._showRegisterForm)})),this._managerAccess},e.prototype._getRegisterForm=function(){return this._registerForm||(this._registerForm=new u.RegisterFormControl({Submit:new n.Delegate(this,this._onRegisterFormSubmit)})),this._registerForm},e.prototype._onRegisterFormSubmit=function(t){this._getRegisterForm().update({Updating:!0}),this._email=t.Email,a.authManager.register(t.Email)},e.prototype._onRegister=function(){this._getRegisterForm().update({Updating:!1}),this._getShortLoginPassword().update({Updating:!1}),this._showShortLoginPassword()},e.prototype._onRegisterFail=function(t){this._getRegisterForm().update({Error:t.Error,Updating:!1}),this._getShortLoginPassword().update({Updating:!1})},e.prototype._onLogin=function(){this._getShortLoginPassword().update({Password:"",Updating:!1})},e.prototype._onLoginFail=function(){this._getShortLoginPassword().update({IsError:!0,Updating:!1})},e.prototype._onLogout=function(){this._getRegisterForm().update({Email:"",Error:""}),this._email="",this._showManagerAccess()},e.prototype._getShortLoginPassword=function(){return this._shortLoginPassword||(this._shortLoginPassword=new c.ShortLoginPassword({ChangeEmailClicked:new n.Delegate(this,this._onPasswordChangeEmailClicked),ResendClicked:new n.Delegate(this,this._onPasswordResendClicked),Submit:new n.Delegate(this,this._onPasswordSubmit)})),this._shortLoginPassword},e.prototype._onPasswordChangeEmailClicked=function(){this._getShortLoginPassword().update({IsError:!1,Updating:!1}),this._showRegisterForm()},e.prototype._onPasswordResendClicked=function(){var t=this;this._getShortLoginPassword().update({Updating:!0}),a.authManager.resendPassword(this._email).then(function(){t._getShortLoginPassword().update({Updating:!1})})},e.prototype._onPasswordSubmit=function(t){this._getShortLoginPassword().update({Updating:!0}),a.authManager.login(this._email,t.Password)},e}(r.Core);e.RegistrationController=h,t.RegistrationController=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.validationUtils=void 0;var i=o(8),r=o(1),n=o(5),s=function(){function t(){var t=this;this.getInvalidPhoneOrEmailNode=function(e,o,s){var a,l=t.getIsValidPhone(o.value),u=t.getIsValidEmail(s.value);switch(e){case n.FormRequiredFieldsType.PhoneAndEmail:case n.FormRequiredFieldsType.PhoneOnly:case n.FormRequiredFieldsType.EmailOnly:l||e===n.FormRequiredFieldsType.EmailOnly||(a=a||o,(0,r.addClass)(o,i.TV_WARNING)),u||e===n.FormRequiredFieldsType.PhoneOnly||(a=a||s,(0,r.addClass)(s,i.TV_WARNING));break;case n.FormRequiredFieldsType.PhoneOrEmail:default:l||u?s.value.length>0&&!u&&(a=s,(0,r.addClass)(s,i.TV_WARNING)):(a=a||o,(0,r.addClass)(o,i.TV_WARNING),(0,r.addClass)(s,i.TV_WARNING))}return a}}return t.prototype.getIsValidPhone=function(t){return 0!==t.length},t.prototype.getIsValidEmail=function(t){return t.length>4&&t.indexOf("@")>-1},t}();e.validationUtils=new s,t.validationUtils=e.validationUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ProActivationControl=void 0;var r=o(2),n=o(30),s=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="pro-activation",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes,o=e.link,i=e.button;o.href=n.CoreLinks.PromoTourcartLink,i.href=n.CoreLinks.ProActivationLink},e}(r.Control);e.ProActivationControl=s,t.ProActivationControl=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartMenuControl=void 0;var n=o(23),s=o(2),a=o(4),l=o(3),u=o(1),c=o(8),h=o(227),d=o(191),p=o(169),_=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="cart-menu",o.ClickMenu=new l.UserEvent,o._MenuItemsState={},o._ManagerInfo=null,o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._update()},e.prototype.update=function(e){e.MenuItemsState&&(e.MenuItemsState=r(r({},this._MenuItemsState),e.MenuItemsState)),t.prototype.update.call(this,e),this._update()},e.prototype._onMenuClick=function(t){this.ClickMenu.fire(t)},e.prototype._init=function(){this._onSaveCartClick=this._onMenuClick.bind(this,{Item:d.CartMenu.SaveCart}),this._onLoadCartClick=this._onMenuClick.bind(this,{Item:d.CartMenu.LoadCart}),this._onNewCartClick=this._onMenuClick.bind(this,{Item:d.CartMenu.NewCart}),this._onMailClick=this._onMenuClick.bind(this,{Item:d.CartMenu.Mail}),this._onSmsClick=this._onMenuClick.bind(this,{Item:d.CartMenu.Sms}),this._onShareLinkClick=this._onMenuClick.bind(this,{Item:d.CartMenu.ShareLink}),this._onDiscountClick=this._onMenuClick.bind(this,{Item:d.CartMenu.Discount}),this._onPrintClick=this._onMenuClick.bind(this,{Item:d.CartMenu.Print}),this._onUpdatePriceClick=this._onMenuClick.bind(this,{Item:d.CartMenu.Update}),this._onLoginClick=this._onMenuClick.bind(this,{Item:d.CartMenu.Login}),this._onLogoutClick=this._onMenuClick.bind(this,{Item:d.CartMenu.Logout}),this._onShowcaseClick=this._onMenuClick.bind(this,{Item:d.CartMenu.Showcase}),this._onMyCartCollectionsClick=this._onMenuClick.bind(this,{Item:d.CartMenu.MyCartCollections}),this._MenuItemsState=h.TOURIST_GUEST.Menu},e.prototype._onOpenLMClick=function(){var t=this._nodes,e=t.openLMWaiter,o=t.openLM;this._waiter||(this._waiter=new n.Waiter({ParentNode:e}),this._waiter.show()),(0,u.addClass)(o,"TVMenuWaiterVisible"),this._onMenuClick({Item:d.CartMenu.OpenLM,Callback:new a.Delegate(this,this._onRecieved)})},e.prototype._onRecieved=function(){(0,u.removeClass)(this._nodes.openLM,"TVMenuWaiterVisible")},e.prototype._update=function(){var t=this._nodes,e=t.discount,o=t.loadCart,i=t.login,r=t.logout,n=t.mail,s=t.myCartCollections,a=t.newCart,l=t.openLM,h=t.print,d=t.saveCart,_=t.shareLink,f=t.showcase,y=t.sms,g=t.updatePrice,C=this._MenuItemsState,v=C.Discount,m=C.Load,T=C.Login,w=C.Logout,S=C.MyCartCollections,P=C.NewCart,b=C.OpenLM,I=C.CreateLM,O=C.Print,M=C.Save,D=C.SendEmail,E=C.SendSms,k=C.ShareLink,R=C.Showcase,A=C.UpdatePrice,V=p.CartSettingsState.Enable,L=p.CartSettingsState.Hidden,N=p.CartSettingsState.Disable;this._updateTitle(),(0,u.setVisible)(e,v!==L),(0,u.setVisible)(o,m!==L),(0,u.setVisible)(i,T),(0,u.setVisible)(r,w),(0,u.setVisible)(s,S!==L),(0,u.setVisible)(a,P!==L),(0,u.setVisible)(l,b!==L||I===V),(0,u.setVisible)(h,O!==L),(0,u.setVisible)(d,M!==L),(0,u.setVisible)(n,D!==L),(0,u.setVisible)(y,E!==L),(0,u.setVisible)(_,k!==L),(0,u.setVisible)(f,R!==L),(0,u.setVisible)(g,A!==L),(0,u.updateClass)(e,c.TV_DISABLED,v===N),(0,u.updateClass)(o,c.TV_DISABLED,m===N),(0,u.updateClass)(s,c.TV_DISABLED,S===N),(0,u.updateClass)(a,c.TV_DISABLED,P===N),(0,u.updateClass)(l,c.TV_DISABLED,b===N),(0,u.updateClass)(l,"TVCreateLMMenuItem",I===V),(0,u.updateClass)(h,c.TV_DISABLED,O===N),(0,u.updateClass)(d,c.TV_DISABLED,M===N),(0,u.updateClass)(n,c.TV_DISABLED,D===N),(0,u.updateClass)(y,c.TV_DISABLED,E===N),(0,u.updateClass)(_,c.TV_DISABLED,k===N),(0,u.updateClass)(f,c.TV_DISABLED,R===N),(0,u.updateClass)(g,c.TV_DISABLED,A===N)},e.prototype._updateTitle=function(){var t=this._ManagerInfo,e=!1,o="",i="";if(this._MenuItemsState.Title&&t){var r=t.currentmanagername,n=t.currentmanagerlogin;e=!!n||!!r,o=n,i=r}this._changeManagerTitle(o,i),this._changeTitleClass(e)},e.prototype._changeManagerTitle=function(t,e){void 0===t&&(t=""),void 0===e&&(e="");var o=this._nodes,i=o.managerLogin,r=o.managerName;i.textContent=t,r.textContent=e},e.prototype._changeTitleClass=function(t){var e=this._nodes.title,o=this._MenuItemsState.Title;(0,u.updateClass)(e,"TVManagerTitle",o&&!t),(0,u.updateClass)(e,"TVStrangerTitle",!o)},e}(s.Control);e.CartMenuControl=_,t.CartMenuControl=_}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.DiscountFormControl=void 0;var r=o(228),n=o(2),s=o(4),a=o(3),l=o(1),u=o(6),c=0,h=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="discount-form",o.Submit=new a.UserEvent,o._Class="TVDiscountForm",o._Value=c,o._input=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=""+this._Value;this._input=new r.InputPro({CheckValid:!1,DomNode:this._nodes.discount,IsAnimateFixedLabel:!0,Label:"Укажите скидку в процентах",NumberOnly:!0,Value:e,Blur:new s.Delegate(this,this._onChange)}),(0,r.addResetDecorator)(this._input,e,""+c),this._nodes.text.textContent="Скидка будет применена ко всем турам в подборке. Мин. значение = -20, макс. значение = 10"},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Value;(0,l.isDefined)(o)&&this._input.update({Value:""+this._Value})},e.prototype._getNumberValue=function(t){return(0,u.convertToDecimal)(t,2)||0},e.prototype._onChange=function(t){var e=t.Value;this._Value=this._getNumberValue(e),this._updateValid(e)},e.prototype._updateValid=function(t){var e=this._getNumberValue(t),o=0===t.length||(0,l.isNumeric)(t)&&e>=-20&&e<=10;(0,l.setVisible)(this._nodes.error,!o),this._input.update({IsValid:o})},e.prototype._onSubmitNodeClick=function(){this._input.getSettings().IsValid&&this.Submit.fire({Discount:this._Value})},e}(n.Control);e.DiscountFormControl=h,t.DiscountFormControl=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartCollectionsControl=void 0;var n=o(2),s=o(1),a=o(111),l=o(829),u=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVCartCollectionsControl TVStyleScroll",o._IsEnabled=!1,o._Items=[],o._ItemClick=null,o._ItemDelete=null,o._itemCollections=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderItems()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&(0,s.isDefined)(e.Items)&&(this._clear(),this._renderItems())},e.prototype._clear=function(){this._itemCollections.forEach(function(t){t.destroy()}),this._itemCollections=[],(0,s.removeChildren)(this._DomNode)},e.prototype._renderItems=function(){var t,e=this;this._Items.forEach(function(o){if(t!==o.cartdate){t=o.cartdate;(0,s.newDiv)("TVCartCollectionsDate",e._DomNode).textContent=a.cartUtils.getCartCollectionDate(t)}e._itemCollections.push(new l.CartCollectionItem(r(r({},a.cartUtils.getCartCollectionItem(o)),{ParentNode:e._DomNode,Click:e._ItemClick,Delete:e._ItemDelete})))}),this._Items.length>0?(0,s.removeClass)(this._DomNode,"TVCartCollectionsEmpty"):(0,s.addClass)(this._DomNode,"TVCartCollectionsEmpty")},e}(n.Control);e.CartCollectionsControl=u,t.CartCollectionsControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.EditCustomerControl=void 0;var n=o(129),s=o(162),a=o(2),l=o(4),u=o(3),c=o(1),h=o(8),d=function(e){function o(t){var o=e.call(this,t)||this;return o.templateName="edit-customer",o.Changed=new u.UserEvent,o.Submit=new u.UserEvent,o._Comment="",o._Email="",o._IsAutocomplete=!1,o._Name="",o._Phone="",o._dropPanel=null,o._customersList=null,o._customerId=0,o.__initSettings(t),o._Render&&o.render(),o}return r(o,e),o.prototype.render=function(){e.prototype.render.call(this),this._dropPanel=new n.DropPanel({Class:"TVAutoCompleteCustomersDropPanel "+h.TV_STYLE_SCROLL}),this._customersList=new s.ListBox({Class:"TVCustomersList",ItemSelected:new l.Delegate(this,this._customerSelected)}),this._dropPanel.addChild(this._customersList)},o.prototype.update=function(t){if(e.prototype.update.call(this,t),this._rendered){var o=this._nodes,i=o.comment,r=o.commentBtn,n=Boolean(this._Comment);(0,c.setVisible)(i,n),(0,c.setVisible)(r,!n)}},o.prototype._customerSelected=function(t){var e=t.Item;if((0,c.isDefined)(e)&&(0,c.isDefined)(e.Data)){var o=this._nodes,i=o.email,r=o.name,n=o.phone;r.value=e.Data.fullName||"",n.value=e.Data.telephone||"",i.value=e.Data.email||"",this._Name=r.value,this._Phone=n.value,this._Email=i.value,this._customerId=e.Id}this._dropPanel.hide()},o.prototype._onCommentBtnClick=function(){var t=this._nodes,e=t.comment,o=t.commentBtn;(0,c.show)(e),(0,c.hide)(o)},o.prototype._onSaveClick=function(){var t=this._nodes,e=t.comment,o=t.phone,i=t.email,r=t.name;this._Phone=o.value,this._Email=i.value,this._Name=r.value,this._Comment=e.value,this.Submit.fire({Comment:this._Comment,Email:this._Email,Id:this._customerId,Name:this._Name,Phone:this._Phone}),this._customerId=0},o.prototype._onPhoneInput=function(t){this._inputChanged(this._nodes.phone)},o.prototype._onEmailInput=function(t){this._inputChanged(this._nodes.email)},o.prototype._inputChanged=function(e){var o=this;if(this._IsAutocomplete){var i=this._nodes,r=i.phone,n=i.email,s=r.value,a=n.value;if(s.length>2&&e===r||a.length>2&&e===n){var l="?fullName=&telephone="+encodeURIComponent(s)+"&email="+encodeURIComponent(a);return void t.leadManagerService.getCustomers(l).then(function(t){o._updateCustomersList(t),t.length>0?(o._dropPanel.show(),o._updatePosition(e)):o._dropPanel.hide()})}this._updateCustomersList([]),this._dropPanel.hide()}},o.prototype._updateCustomersList=function(t){var e=t||[];this._customersList.setItems(this._convertItems(e)),this._customersList.redraw()},o.prototype._convertItems=function(t){return t.map(function(t){return{Content:"<div>"+t.fullName+"</div><div>"+t.telephone+"</div><div>"+t.email+"</div>",Data:t||{},Id:t.id}})},o.prototype._updatePosition=function(t){var e=(0,c.cumulativeOffset)(t);this._dropPanel.setWidth(t.offsetWidth),this._dropPanel.updatePosition(e.left+5,t.offsetWidth,e.top,t.offsetHeight,(0,c.getCoords)(t))},o}(a.Control);e.EditCustomerControl=d,i.EditCustomerControl=d}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.EditProfileControl=void 0;var n=o(834),s=o(2),a=o(4),l=o(3),u=o(28),c=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="edit-profile",o.Submit=new l.UserEvent,o._FullName="",o._Info="",o._Logo="",o._Photo="",o._PhotoFile=null,o._LogoFile=null,o._сhangedData={},o._loadPhotoControl=null,o._loadLogoControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._update()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._update()},e.prototype._update=function(){var t=this._nodes.imgBlock;this._loadPhotoControl?this._loadPhotoControl.update({Image:this._Photo}):this._loadPhotoControl=new n.LoadImageControl({Class:"TVEditProfilePhoto",Image:this._Photo,ParentNode:t,Change:new a.Delegate(this,this._onPhotoChange)}),this._loadLogoControl?this._loadLogoControl.update({Image:u.pictureUtils.getNoCacheUrl(this._Logo)}):this._loadLogoControl=new n.LoadImageControl({Class:"TVEditProfileLogo",Image:u.pictureUtils.getNoCacheUrl(this._Logo),ParentNode:t,Change:new a.Delegate(this,this._onLogoChange)}),this._сhangedData={}},e.prototype._onPhotoChange=function(t){this._сhangedData=r(r({},this._сhangedData),{PhotoFile:t.ImageFile})},e.prototype._onLogoChange=function(t){this._сhangedData=r(r({},this._сhangedData),{LogoFile:t.ImageFile})},e.prototype._onFullNameChange=function(){this._FullName=this._nodes.fullName.value,this._сhangedData=r(r({},this._сhangedData),{FullName:this._FullName})},e.prototype._onInfoChange=function(){this._Info=this._nodes.info.value,this._сhangedData=r(r({},this._сhangedData),{Info:this._Info})},e.prototype._onSubmitClick=function(){this.Submit.fire(this._сhangedData),this._сhangedData={}},e.WARNING="При сохранении данных произошла ошибка, обратитесь в техподдержку.",e}(s.Control);e.EditProfileControl=c,t.EditProfileControl=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.LoaderImage=void 0;var r=o(9),n=o(3),s=o(1),a=["png","jpg","jpeg"],l=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new n.UserEvent,o._ParentNode=null,o._loader=null,o.__initSettings(e),o._onChanged=o._onChanged.bind(o),o._onClicked=o._onClicked.bind(o),o._init(),o}return i(e,t),e.prototype.destroy=function(){this._loader&&((0,s.removeEvent)(this._loader,"change",this._onChanged),(0,s.removeEvent)(this._loader,"click",this._onClicked)),t.prototype.destroy.call(this)},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Reset;(0,s.isDefined)(o)&&this._loader&&(this._loader.value="")},e.prototype._getFile=function(){var t=this._loader.files;return t&&t[0]&&new RegExp(a.join("|")).test(t[0].type)?t[0]:null},e.prototype._init=function(){var t=a.map(function(t){return"."+t}).join(",");this._loader=(0,s.newDomNode)("input","TVLoaderImage",this._ParentNode),this._loader.title="",this._loader.type="file",this._loader.accept=t,(0,s.addEvent)(this._loader,"change",this._onChanged),(0,s.addEvent)(this._loader,"click",this._onClicked)},e.prototype._onChanged=function(){var t=this._getFile();this.Changed.fire({ImageFile:t})},e.prototype._onClicked=function(){this._loader.value=""},e}(r.Core);e.LoaderImage=l,t.LoaderImage=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.SelectCartControl=void 0;var r=o(292),n=o(2),s=o(4),a=o(3),l=o(1),u=o(8),c=o(836),h=o(837),d=[{AlwaysShow:!1,FilterFunction:function(t){return t.cartdatetype===c.CartDateType.Today},Key:"Сегодня"},{AlwaysShow:!1,FilterFunction:function(t){return t.cartdatetype===c.CartDateType.Week},Key:"Неделя"},{AlwaysShow:!1,FilterFunction:function(t){return t.cartdatetype===c.CartDateType.Month},Key:"Месяц"}],p=function(t){function e(e){var o=t.call(this,e)||this;return o.Delete=new a.UserEvent,o.Load=new a.UserEvent,o.templateName="select-cart",o._Items=[],o._listCarts=null,o._selectedItemId=0,o._tabbedListControl=null,t.prototype.__initSettings.call(o,e),o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateList(),this._tabbedListControl=new r.TabbedListControl({ListControl:this._listCarts,ParentNode:this._nodes.listNode,Placeholder:"Введите название подборки",TabItems:d})},e.prototype.update=function(e){t.prototype.update.call(this,e),(0,l.isDefined)(e.Items)&&(this._selectedItemId=0,this._updateActionButtons(),this._updateList(),this._tabbedListControl.update({Reset:!0}))},e.prototype._onActionDeleteClick=function(){this._selectedItemId&&this.Delete.fire({Id:this._selectedItemId})},e.prototype._onActionLoadClick=function(){this._selectedItemId&&this.Load.fire({Id:this._selectedItemId})},e.prototype._onListChanged=function(t){this._selectedItemId=Number(t.Selected)||0,this._updateActionButtons()},e.prototype._updateActionButtons=function(){this._selectedItemId?((0,l.removeClass)(this._nodes.actionDelete,u.TV_DISABLED),(0,l.removeClass)(this._nodes.actionLoad,u.TV_DISABLED)):((0,l.addClass)(this._nodes.actionDelete,u.TV_DISABLED),(0,l.addClass)(this._nodes.actionLoad,u.TV_DISABLED))},e.prototype._updateList=function(){this._listCarts?this._listCarts.update({Items:this._Items}):this._listCarts=new h.ListCarts({Items:this._Items,Changed:new s.Delegate(this,this._onListChanged)})},e}(n.Control);e.SelectCartControl=p,t.SelectCartControl=p}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CartSaveFormControl=void 0;var r=o(189),n=o(29),s=o(2),a=o(3),l=o(1),u=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="cart-save-form",o.Submit=new a.UserEvent,o._ActionClicked=null,o._Comment="",o._Message="",o._Name="",o._ShowToClient=!0,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes.check;this._checkBox=new n.CheckBox({Content:"Показать комментарий клиенту",IsChecked:this._ShowToClient,ParentNode:e}),this._confirmButtons=new r.ConfirmButtonsControl({ParentNode:this._DomNode,Template:"cart-new-confirm-buttons",Clicked:this._ActionClicked})},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&(e.Message?(this._confirmButtons.show(),(0,l.show)(this._nodes.message),(0,l.hide)(this._nodes.form)):(this._confirmButtons.hide(),(0,l.hide)(this._nodes.message),(0,l.show)(this._nodes.form)),this._checkBox.setChecked(this._ShowToClient))},e.prototype._onButtonClick=function(){var t=this._nodes,o=t.name,i=t.comment;(0,l.removeClass)(o,e.TV_WARNING),this._isValid()&&this.Submit.fire({Comment:i.value||"",Name:o.value||"",ShowToClient:this._checkBox.getIsChecked()})},e.prototype._isValid=function(){var t=this._nodes.name,o=!0;return 0===t.value.length&&((0,l.addClass)(t,e.TV_WARNING),o=!1),o},e.TV_WARNING="TVWarning",e}(s.Control);e.CartSaveFormControl=u,t.CartSaveFormControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.SEND_EMAIL_ERROR_MESSAGE=e.SEND_EMAIL_SUCCESS_MESSAGE=void 0,e.SEND_EMAIL_SUCCESS_MESSAGE="Письмо успешно отправлено",e.SEND_EMAIL_ERROR_MESSAGE="Не удалось отправить сообщение. Проверьте настройки почты",t.SEND_EMAIL_ERROR_MESSAGE=e.SEND_EMAIL_ERROR_MESSAGE,t.SEND_EMAIL_SUCCESS_MESSAGE=e.SEND_EMAIL_SUCCESS_MESSAGE}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ConfigureMailControl=void 0;var r=o(2),n=o(3),s=function(t){function e(e){var o=t.call(this,e)||this;return o.LinkClicked=new n.UserEvent,o.templateName="сonfigure-mail",o._Class="TVConfigureMailControl TVCartForm",o._DocLink="",o._ProfileLink="",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateLinks()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._updateLinks()},e.prototype._updateLinks=function(){var t=this._nodes,e=t.docLink,o=t.configureLink;e.href=this._DocLink,o.href=this._ProfileLink},e.prototype._onLinkClick=function(){this.LinkClicked.fire()},e}(r.Control);e.ConfigureMailControl=s,t.ConfigureMailControl=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MailFormControl=void 0;var r=o(29),n=o(2),s=o(3),a=o(1),l=o(8),u=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="mail-form",o.Submit=new s.UserEvent,o._Mail="",o._Subject="",o._Text="",o._CopyCheck=!0,o._Signature="",o._ShowEmail=!0,o._ShowCopyCheck=!0,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes,o=e.check,i=e.mail;this._checkBox=new r.CheckBox({Content:"Отправить копию себе",IsChecked:this._CopyCheck,ParentNode:o}),(0,a.setVisible)(i,this._ShowEmail),(0,a.setVisible)(o,this._ShowCopyCheck)},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&this._checkBox.setChecked(this._CopyCheck)},e.prototype._onButtonClick=function(){var t=this._nodes,e=t.mail,o=t.subject,i=t.text,r=t.signature;(0,a.removeClass)(e,l.TV_WARNING),(0,a.removeClass)(o,l.TV_WARNING),(0,a.removeClass)(i,l.TV_WARNING),this._isValid()&&this.Submit.fire({Mail:e.value,Subject:o.value,Text:i.value,Signature:r.value,CopyCheck:this._checkBox.getIsChecked()})},e.prototype._isValid=function(){var t=this._nodes,e=t.mail,o=t.subject,i=t.text,r=!0;return 0===e.value.length&&((0,a.addClass)(e,l.TV_WARNING),r=!1),0===o.value.length&&((0,a.addClass)(o,l.TV_WARNING),r=!1),0===i.value.length&&((0,a.addClass)(i,l.TV_WARNING),r=!1),r},e}(n.Control);e.MailFormControl=u,t.MailFormControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.SmsFormControl=void 0;var r=o(29),n=o(2),s=o(4),a=o(3),l=o(1),u=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="sms-form",o.Submit=new a.UserEvent,o._LongLink="",o._ShortLink="",o._Phone="",o._IsShortLink=!0,o._Limit=0,o._Class="TVSmsFormControl",o._ShowPhone=!0,o._ShowShortlnk=!0,o._checkbox=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._updateData()},e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes,o=e.checkbox,i=e.counter,n=e.smsCounter,a=e.phone;this._checkbox=new r.CheckBox({Content:"Короткая ссылка",IsChecked:this._IsShortLink,ParentNode:o,Checked:new s.Delegate(this,this._updateMessage)}),(0,l.setVisible)(o,this._ShowShortlnk),(0,l.setVisible)(a,this._ShowPhone),i.textContent=0,n.textContent=0},e.prototype._updateData=function(){if(this._rendered){this._checkbox.setChecked(this._IsShortLink);var t=this._nodes,o=t.phone,i=t.message;o.value=this._Phone,i.value=e.DEFAULT_MESSAGE+(this._IsShortLink?this._ShortLink:this._LongLink),this._onMessageInput()}},e.prototype._updateMessage=function(){var t=this._nodes.message;this._IsShortLink=this._checkbox.getIsChecked(),this._IsShortLink?t.value=t.value.replace(this._LongLink,this._ShortLink):t.value=t.value.replace(this._ShortLink,this._LongLink),this._onMessageInput()},e.prototype._onPhoneClick=function(){var t=this._nodes,e=t.message,o=t.error,i=t.phone;(0,l.hasClass)(i,"TVWarning")&&(i.value="",(0,l.removeClass)(i,"TVWarning"),(0,l.hasClass)(e,"TVWarning")||(0,l.hide)(o))},e.prototype._onMessageClick=function(){var t=this._nodes,e=t.message,o=t.error,i=t.phone;(0,l.hasClass)(e,"TVWarning")&&((0,l.removeClass)(e,"TVWarning"),(0,l.hasClass)(i,"TVWarning")||(0,l.hide)(o))},e.prototype._onSubmitClick=function(){var t=this._nodes,e=t.phone,o=t.message,i=t.error,r=this._checkbox.getIsChecked(),n=e.value,s=o.value;return this._checkNumber(n)?s.length>0?((0,l.removeClass)(e,"TVWarning"),(0,l.removeClass)(o,"TVWarning"),(0,l.hide)(i),this.Submit.fire({Phone:n,Message:s,ShortLink:r}),void 0):((0,l.addClass)(o,"TVWarning"),void(0,l.show)(i)):((0,l.addClass)(e,"TVWarning"),(0,l.show)(i),void(0===s.length&&(0,l.addClass)(o,"TVWarning")))},e.prototype._checkNumber=function(t){return t.length>=e.PHONE_NUMBER_LENGTH},e.prototype._onMessageInput=function(){var t=this._nodes,o=t.counter,i=t.message,r=t.smsCounter,n=i.value.length;o.textContent=n,r.textContent=Math.ceil(n/e.SMS_LIMIT)},e.PHONE_NUMBER_LENGTH=10,e.SMS_LIMIT=70,e.DEFAULT_MESSAGE="Подборка туров: ",e}(n.Control);e.SmsFormControl=u,t.SmsFormControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.HotOfferManager=void 0;var s=o(31),a=o(34),l=o(143),u=o(9),c=o(4),h=o(3),d=o(7),p=o(1),_=o(30),f=o(5),y=o(22),g=o(109),C=o(229),v=o(450),m=o(32),T=o(151),w=o(223),S=o(285),P=o(33),b=o(294),I=o(125),O=o(230),M=o(231),D=o(857),E=o(872),k=o(453),R=o(873),A=o(874),V=o(126);o(875);var L=function(e){function o(t){var o=e.call(this,t)||this;return o.BeforeShow=new h.UserEvent,o.Hide=new h.UserEvent,o.OfferSaved=new h.UserEvent,o.RunSearch=new h.UserEvent,o._Currency=f.Currency.Rub,o._Departure=d.DEFAULT_DEPARTURE_ID,o._SearchLink="",o._Id=0,o._ModeView=f.ModeView.DescTop,o._Mode=P.HotOfferCardMode.View,o._OfferId=0,o._OfferApiData=null,o._Ref=null,o._instance=null,o._updateInstanceFunction=null,o._editAction=P.HotOfferEditAction.NONE,o._isShareChangePicture=!1,o._clientId=0,o.__initSettings(t),o._init(),o}return r(o,e),o.prototype.showOffer=function(t){this._updateSettings(),this.__initSettings(t),this._updateMode(t),this._updateCurrency(t),this._updateClientId(),this._initInstance(),this._showInstance(),this._requestData()},o.prototype.hideOffer=function(){this._instance.hide()},o.prototype.hideWindow=function(){this._instance instanceof D.HotOfferDesktopController&&this.hideOffer()},o.prototype._init=function(){var t=a.clientCatalog.getClientData();this._Departure=m.clientUtils.getFlyFrom(t),this._actualizeData=this._actualizeData.bind(this),this._onOfferReaded=this._onOfferReaded.bind(this),this._onOfferActualized=this._onOfferActualized.bind(this),this._onOfferSaved=this._onOfferSaved.bind(this),this._onOfferSavedError=this._onOfferSavedError.bind(this)},o.prototype._updateSettings=function(){var t=this._isEnabledSearchLink();this._SearchLink=t?this._getSearchLink():""},o.prototype._initInstance=function(){var t={ActionClicked:new c.Delegate(this,this._onActionClicked),Hide:new c.Delegate(this,this._onInstanceHided),SendRequest:new c.Delegate(this,this._onSendRequest),ShowShare:new c.Delegate(this,this._onShowShare)};this._ModeView===f.ModeView.Mobile?this._initMobileController(t):this._initDesktopController(t)},o.prototype._initMobileController=function(t){if(this._instance instanceof E.HotOfferMobileController)return this._instance;this._instance=new E.HotOfferMobileController(n({},t))},o.prototype._initDesktopController=function(t){var e=this;if(this._instance instanceof D.HotOfferDesktopController)return this._instance;this._instance&&this._instance.destroy(),this._instance=new D.HotOfferDesktopController(n(n({},t),{BeforeShow:new c.Delegate(this,function(){return e.BeforeShow.fire()})}))},o.prototype._showInstance=function(){this._instance.show(this._OfferId),this._instance.update({PreviewVisibled:!0,ActualizeVisibled:!1})},o.prototype._onInstanceHided=function(){var t=this._Mode;this._Mode=P.HotOfferCardMode.View,(t!==this._Mode||this._updateInstanceFunction)&&this._instance.update({Mode:this._Mode,WaiterVisibled:!1}),this.Hide.fire({Action:this._editAction,Id:this._OfferId}),this._updateInstanceFunction=null,this._editAction=P.HotOfferEditAction.NONE,this._OfferApiData=null,this._OfferId=0,this._Id=0,this._isShareChangePicture=!1},o.prototype._getMenuItems=function(t){return this._isMenuEnabled()?R.hotOfferMenuUtils.getMenuItems(t):[]},o.prototype._getPriceMenuItems=function(t){var e=this._isEnabledSearchLink();return this._isPriceMenuEnabled()&&(0,p.isDefined)(t)?A.hotOfferPriceMenuUtils.getItems(t,e):[]},o.prototype._getSearchLink=function(){var t=a.clientCatalog.getClientData();return m.clientUtils.getSearchLink(t)},o.prototype._requestData=function(){if(V.hotOfferUtils.isCreatingOffer(this._Mode,this._OfferId))return void this._createOffer({PreviewVisibled:!1});var t={currency_id:this._Currency},e=y.authManager.getId();return e>0&&(t.tsmng=e),C.hotOfferService.read(this._OfferId,t).then(this._onOfferReaded).then(this._actualizeData).catch(T.errorCatched)},o.prototype._onActionClicked=function(t){var e=t.Action,o=t.CallBack;switch(e){case P.HotOfferAction.Save:this._saveOffer(t);break;case P.HotOfferAction.Copy:this._copyOffer();break;case P.HotOfferAction.Create:this._createOffer();break;case P.HotOfferAction.Edit:this._editOffer();break;case P.HotOfferAction.Delete:this._deleteOffer(o);break;case P.HotOfferAction.Like:this._updateLikeCount();break;case P.HotOfferAction.Share:this._updateShareCount();break;case P.HotOfferAction.SearchLink:this._onSearchLinkClick(t);break;case P.HotOfferAction.Cancel:this._cancelEditOffer()}},o.prototype._editOffer=function(){this._Mode=P.HotOfferCardMode.Edit,this._instance.update({MenuItems:this._getMenuItems(),Mode:this._Mode,PriceItems:this._getPriceMenuItems()})},o.prototype._deleteOffer=function(t){var e=this;C.hotOfferService.delete(this._OfferId,{tsmng:y.authManager.getId()}).then(function(o){e._editAction=P.HotOfferEditAction.DELETE,l.hotOffersStore.deleteItem(e._OfferId),(0,p.isDefined)(t)&&t.fire()}).catch(T.errorCatched)},o.prototype._saveOffer=function(t){var e=this;this._Mode=P.HotOfferCardMode.View,this._instance.update({WaiterVisibled:!0}),this._updateInstanceFunction=this._updateInstance,this._saveOfferPicture(t).then(function(o){return e._onSaveOffer(t,o)}).then(this._onOfferSaved).catch(this._onOfferSavedError)},o.prototype._saveOfferPicture=function(t){var e=t.PictureFile,o=t.PictureId,i=t.PictureLink,r={tsmng:y.authManager.getId()},n=e||i;return!o&&n?v.pictureService.post(n,r).then(function(t){return{PictureId:t&&t.id||0}}):o||n?Promise.resolve({PictureId:o}):Promise.reject(new Error("Empty arguments"))},o.prototype._actualizeData=function(){return l.hotOffersStore.getItem(this._OfferId).TourId?(this._instance.update({ActualizeVisibled:!0}),C.hotOfferService.actualize(this._OfferId,{currency_id:this._Currency}).then(this._onOfferActualized)):Promise.resolve(null)},o.prototype._onOfferActualized=function(t){if(this._instance.update({ActualizeVisibled:!1}),!t||t.error)throw new Error("Feed module: can't actualize offer");if(this._OfferId===t.hot_offer_id){var e=l.hotOffersStore.getItem(this._OfferId),o=V.hotOfferUtils.isSameOffersPrice(t,e),i=V.hotOfferUtils.isSameOffersStatus(t,e);if(!o||!i)return this._editAction=P.HotOfferEditAction.ACTUALIZE,this._onOfferReaded(t)}},o.prototype._onOfferReaded=function(t){if(!t||t.error)throw this._instance.update({ErrorEnabled:!0}),new Error("Feed module: can't read offer");if(this._OfferId===t.hot_offer_id){this._Id=M.hotOffersUtils.getId(t);var e=n(n({},M.hotOffersUtils.getItem(t,this._SearchLink)),{IsLiked:b.actionDataService.isLiked(this._OfferId)});return l.hotOffersStore.setItem(e),this._updateInstance(this._OfferId,e,{ErrorEnabled:!1,PreviewVisibled:!1}),this._updateViewCount(),t}},o.prototype._onSaveOffer=function(t,e){var o=this._isManualOffer();this._OfferId&&!o&&this._clearActionCount();var i={tsmng:y.authManager.getId()},r=V.hotOfferUtils.getApiOfferData(n(n({},t),e),this._OfferId,this._Currency);return this._editAction=this._OfferId?P.HotOfferEditAction.UPDATE:P.HotOfferEditAction.CREATE,this._OfferId&&o?C.hotOfferService.put(this._OfferId,n(n({},r),{id:this._Id}),i):C.hotOfferService.post(r,i)},o.prototype._onOfferSaved=function(t){this._Id=M.hotOffersUtils.getId(t);var e=M.hotOffersUtils.getOfferId(t),o=n(n({},M.hotOffersUtils.getItem(t,this._SearchLink)),{IsLiked:b.actionDataService.isLiked(e)});l.hotOffersStore.setItem(o),this._updateInstanceFunction&&this._updateInstanceFunction(e,o,{WaiterVisibled:!1}),this._isShareChangePicture&&(this._isShareChangePicture=!1,this._onShowShare()),this.OfferSaved.fire()},o.prototype._updateInstance=function(t,e,o){void 0===o&&(o={}),this._OfferId=t,this._instance.update(n({HotOfferData:e,MenuItems:this._getMenuItems(e),Mode:this._Mode,PriceItems:this._getPriceMenuItems(e)},o))},o.prototype._onOfferSavedError=function(t){this._instance.update({ErrorEnabled:!0,WaiterVisibled:!1}),console.log(t)},o.prototype._createOffer=function(t){void 0===t&&(t={}),this._Mode=P.HotOfferCardMode.Edit;var e=this._OfferApiData?M.hotOffersUtils.getItem(this._OfferApiData,this._SearchLink):k.hotOfferFilterUtils.getDefaultOfferData(this._Currency,this._Departure);this._updateInstance(0,n(n({},e),{Id:0}),t)},o.prototype._copyOffer=function(){this._Mode=P.HotOfferCardMode.Edit;var t=l.hotOffersStore.getItem(this._OfferId);this._updateInstance(0,n(n({},t),{Id:0}))},o.prototype._onSearchLinkClick=function(t){},o.prototype._cancelEditOffer=function(){if(this._OfferId){this._Mode=P.HotOfferCardMode.View;var t=l.hotOffersStore.getItem(this._OfferId);this._updateInstance(this._OfferId,t)}},o.prototype._updateViewCount=function(){b.actionDataService.updateCount({Action:P.HotOfferCounterAction.INC,OfferId:this._OfferId,Type:P.HotOfferCounterType.View})},o.prototype._updateLikeCount=function(){var t=b.actionDataService.isLiked(this._OfferId);b.actionDataService.updateCount({Action:t?P.HotOfferCounterAction.DEC:P.HotOfferCounterAction.INC,OfferId:this._OfferId,Type:P.HotOfferCounterType.Like})},o.prototype._updateShareCount=function(){b.actionDataService.updateCount({Action:P.HotOfferCounterAction.INC,OfferId:this._OfferId,Type:P.HotOfferCounterType.Share})},o.prototype._clearActionCount=function(){b.actionDataService.clearCount(this._OfferId,[P.HotOfferCounterType.Like,P.HotOfferCounterType.Share,P.HotOfferCounterType.View])},o.prototype._updateCurrency=function(t){var e=S.urlUtils.getHashValue(f.Hash.Currency,"[0-9]*");if((0,p.isDefined)(e))return void(this._Currency=e);var o=t.Currency;if((0,p.isDefined)(o))return void(this._Currency=I.hotOffersFilterUtils.getPureCurrency(o));var i=a.clientCatalog.getClientData(),r=m.clientUtils.getCurrency(i);r=I.hotOffersFilterUtils.getPureCurrency(r),this._Currency=r!==f.Currency.None?r:f.Currency.Rub},o.prototype._updateClientId=function(){var t=S.urlUtils.isTourCartSite();this._clientId=t&&S.urlUtils.getHashValue(f.Hash.ClientId,"[0-9]*")||0},o.prototype._updateMode=function(t){var e=t.OfferId,o=t.Mode;if((0,p.isDefined)(o))return void(this._Mode=o);this._Mode=0===e?P.HotOfferCardMode.Edit:P.HotOfferCardMode.View},o.prototype._onSendRequest=function(e){var o=e.CallBack,i=l.hotOffersStore.getItem(this._OfferId),r=V.hotOfferUtils.getSearchLink(i);if(!r){var s=a.clientCatalog.getClientData();r=V.hotOfferUtils.generateSearchLink(s,i,this._Currency)}var u=w.OrderUtils.getHotOfferRequestParams(n(n({},e),{Currency:this._Currency,Price:V.hotOfferUtils.getActualPrice(i),SearchLink:r,TourId:this._OfferId}),this._clientId),c=(0,p.newFormData)(u);t.orderService.post(c,_.CoreLinks.SendRequest).then(function(t){o&&o.fire(t)})},o.prototype._onShowShare=function(){var t=l.hotOffersStore.getItem(this._OfferId),e=O.hotOffersShareUtils.getShareSettings(t);(0,g.showShare)(n(n({},e),{ActionSource:s.ActionStatisticsSource.HOTOFFER,Currency:this._Currency,IsEnabledAddClientId:!0,IsEnabledSharePicture:!0,ModeView:this._ModeView,ChangePictureClicked:new c.Delegate(this,this._onShareChangePictureClicked),Shared:new c.Delegate(this,this._onShared)}))},o.prototype._onShareChangePictureClicked=function(){this._isShareChangePicture=!0,(0,g.hideShare)(),this._onActionClicked({Action:P.HotOfferAction.Edit})},o.prototype._onShared=function(){this._onActionClicked({Action:P.HotOfferAction.Share})},o.prototype._isEnabledSearchLink=function(){var t=this._getSearchLink();return!(Boolean(t)&&t.indexOf(d.TOUR_CART_LINK)>-1)},o.prototype._isManualOffer=function(){var t=l.hotOffersStore.getItem(this._OfferId);return Boolean(t&&t.IsManual)},o.prototype._isMenuEnabled=function(){return y.authManager.isManager()&&V.hotOfferUtils.isViewMode(this._Mode)},o.prototype._isPriceMenuEnabled=function(){return V.hotOfferUtils.isViewMode(this._Mode)},o}(u.Core);e.HotOfferManager=L,i.HotOfferManager=L}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.pictureService=void 0;var i=o(46),r=o(28),n=o(47),s="/api/v1.1/hot-offer-informations",a=function(){function t(){this.url="//tourvisor.ru"+s,this._storeLoadedPictures={}}return t.prototype.post=function(t,e){i.cors.update({Url:this.url+"/pictures"});var o=r.pictureUtils.getQueryBody(t),s=r.pictureUtils.getQueryContentType(t);return i.cors.post(o,{ContentType:s,Query:e}).then(function(t){if(t&&t.error){var e="Can not post picture";throw n.logService.error(new Error(e)),new Error(e)}return t})},t.prototype.query=function(t){var e=this,o=Object.keys(t).reduce(function(e,o){return e+"&"+o.charAt(0)+"="+t[o]},"");return o.length>0&&this._storeLoadedPictures[o]?Promise.resolve(this._storeLoadedPictures[o]):(i.cors.update({Url:this.url+"/matching-pictures"}),i.cors.get(t).then(function(t){return e._storeLoadedPictures[o]=t,t}).then(function(t){if(t&&t.error){var e="Can not query picture";throw n.logService.error(new Error(e)),new Error(e)}return t}))},t}();e.pictureService=new a,t.pictureService=e.pictureService}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.HotOffersContentUtils=void 0;var i=o(1),r=function(){function t(){}return t.formatStr=function(t){return(0,i.capitalizeFirstLetter)((0,i.trim)(t))},t}();e.HotOffersContentUtils=r,t.HotOffersContentUtils=r}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.OfferCard=void 0;var n=o(2),s=o(4),a=o(3),l=o(7),u=o(1),c=o(5),h=o(6),d=o(42),p=o(8),_=o(33),f=o(453),y=o(126),g=o(86),C=o(125),v=o(860),m=o(456),T=o(458),w=o(866),S=o(867),P=function(t){function e(e){var o=t.call(this,e)||this;return o.ActionClicked=new a.UserEvent,o.templateName="offer-card",o._ActualizeVisibled=!1,o._Date="",o._Description="",o._FilterSettings={},o._Id=0,o._IsLiked=!1,o._LikeCount=0,o._Mode=_.HotOfferCardMode.View,o._ModeView=c.ModeView.DescTop,o._PictureFile=null,o._PictureId=0,o._PictureLink="",o._Price={},o._ScrollNode=null,o._SearchLink="",o._ShareCount=0,o._Status=_.HotOfferStatus.ACTUAL,o._Title="",o._TourLink="",o._ViewCount="",o._WaiterVisibled=!1,o._buttons=null,o._contentControl=null,o._dateControl=null,o._filter=null,o._pictureControl=null,o._isValid=!1,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderPictureControl(),this._updatePicture(),this._renderContent(),this._updateContent(),this._renderDate(),this._updateDate(),this._updateFilter(),this._updatePictureBySettings(),this._renderActionButtons(),this._updateActionButtons(),this._updateDomNodeClass(),this._addCustomClasses()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ActualizeVisibled,i=e.Date,r=e.Description,n=e.FilterSettings,s=e.IsLiked,a=e.LikeCount,l=e.PictureLink,c=e.Price,h=e.SearchLink,d=e.ShareCount,p=e.Status,_=e.Title,f=e.TourLink,y=e.ViewCount,g=e.WaiterVisibled;(0,u.isDefined)(l)&&this._updatePicture(),((0,u.isDefined)(_)||(0,u.isDefined)(r)||(0,u.isDefined)(c)||(0,u.isDefined)(o))&&this._updateContent(),((0,u.isDefined)(d)||(0,u.isDefined)(s)||(0,u.isDefined)(a)||(0,u.isDefined)(h)||(0,u.isDefined)(g))&&this._updateActionButtons(),((0,u.isDefined)(n)||(0,u.isDefined)(f))&&(this._updateFilter(),this._updatePictureBySettings()),((0,u.isDefined)(i)||(0,u.isDefined)(y))&&this._updateDate(),(0,u.isDefined)(p)&&this._updateStatus()},e.prototype.getContentNode=function(){return this._nodes.content},e.prototype.getDateNode=function(){return this._dateControl&&this._dateControl.getDomNode()},e.prototype.destroy=function(){this._FilterSettings=null,this._Price=null,this._ScrollNode=null,t.prototype.destroy.call(this)},e.prototype._renderPictureControl=function(){this._pictureControl=new S.OfferPictureControl({Mode:this._Mode,ParentNode:this._nodes.picture,Changed:new s.Delegate(this,this._onContentChanged)})},e.prototype._updatePicture=function(){this._pictureControl.update({PictureLink:this._PictureLink})},e.prototype._renderContent=function(){var t=this._nodes.content;this._contentControl=new m.OfferContentControl({Mode:this._Mode,ParentNode:t,Changed:new s.Delegate(this,this._onContentChanged)})},e.prototype._updateContent=function(){this._contentControl.update({ActualizeVisibled:this._ActualizeVisibled,Date:this._Date,Description:this._Description,Price:this._Price,Title:this._Title,ViewCount:this._ViewCount})},e.prototype._renderDate=function(){var t=this._nodes.content,e=this._ModeView===c.ModeView.Mobile?this._DomNode:t;this._dateControl=new T.OfferDateControl({ParentNode:e})},e.prototype._updateDate=function(){this._dateControl.update({Date:this._Date,Id:this._Id,ViewCount:this._ViewCount})},e.prototype._renderActionButtons=function(){var t=this._nodes.content;this._buttons=new v.OfferButtonsController({ActionBtnsNode:t,EditBtnsNode:this._DomNode,Mode:this._Mode,Clicked:new s.Delegate(this,this._onActionClicked)})},e.prototype._updateActionButtons=function(){this._buttons.update({Id:this._Id,IsLiked:this._IsLiked,LikeCount:this._LikeCount,SearchLink:this._SearchLink,ShareCount:this._ShareCount,WaiterVisibled:this._WaiterVisibled})},e.prototype._updateDomNodeClass=function(){(0,u.updateClass)(this._DomNode,g.TV_EDIT_MODE,y.hotOfferUtils.isEditMode(this._Mode)),(0,u.updateClass)(this._DomNode,p.TV_EMPTY,y.hotOfferUtils.isCreatingOffer(this._Mode,this._Id))},e.prototype._updateFilter=function(){if(!y.hotOfferUtils.isViewMode(this._Mode)){var t=C.hotOffersFilterUtils.getModuleFilterSettings(this._FilterSettings);this._filter?this._filter.update({Link:this._TourLink,Settings:t}):this._filter=new w.OfferFilterControl({Link:this._TourLink,ModeView:this._ModeView,ParentNode:this._DomNode,Settings:t,LinkChanged:new s.Delegate(this,this._onFilterLinkChanged),SettingsChanged:new s.Delegate(this,this._onFilterSettingsChanged)})}},e.prototype._onActionClicked=function(t){switch(t.Action){case _.HotOfferAction.Save:if(this._validateContent(),!this._isValid)return;t=r(r({},t),{Description:this._Description,FilterSettings:r({},this._FilterSettings),PictureFile:this._PictureFile,PictureId:this._PictureId,PictureLink:this._PictureLink,Price:this._Price,Title:this._Title,TourLink:this._TourLink})}this.ActionClicked.fire(t)},e.prototype._onContentChanged=function(t){var e=this._PictureFile,o=this._PictureLink;this.__updateSettings(t);var i=t.PictureFile,r=t.PictureLink,n=t.Title,s=t.Price;(0,u.isDefined)(n)&&(0,u.removeClass)(this._DomNode,"TVHotOfferInvalidTitle"),(0,u.isDefined)(i)&&e!==i&&(i?(0,u.removeClass)(this._DomNode,"TVHotOfferInvalidPicture"):this._PictureLink="",this._PictureId=0),(0,u.isDefined)(r)&&o!==r&&(r?(0,u.removeClass)(this._DomNode,"TVHotOfferInvalidPicture"):this._PictureFile=null,this._PictureId=0),(0,u.isObject)(s)&&s.New>0&&(0,u.removeClass)(this._DomNode,"TVHotOfferInvalidNewPrice")},e.prototype._onFilterSettingsChanged=function(t){this._FilterSettings=r(r({},this._FilterSettings),t);var e=t.FlyDates,o=t.Countries,i=t.Hotels,n=t.Resorts,s=f.hotOfferFilterUtils.isValidFlyDate;((0,u.isDefined)(o)||(0,u.isDefined)(i)||(0,u.isDefined)(n))&&this._updatePictureBySettings(),(0,u.isDefined)(e)&&s(this._FilterSettings)&&(0,u.removeClass)(this._DomNode,"TVHotOfferInvalidFlyDate")},e.prototype._onFilterLinkChanged=function(t){var e=t.Link;this._TourLink=e},e.prototype._updatePictureBySettings=function(){if(!y.hotOfferUtils.isViewMode(this._Mode)){var t=this._FilterSettings,e=t.Countries,o=t.Hotels,i=t.Resorts;this._pictureControl.update({PictureSettings:{CountryId:(0,h.getFirstOrDefault)(e,0),HotelId:(0,h.getFirstOrDefault)(o,0),ResortId:(0,h.getFirstOrDefault)(i,0)}})}},e.prototype._validateContent=function(){var t=this._Title.length>0,e=this._PictureLink.length>0||Boolean(this._PictureFile),o=!!this._Price&&this._Price.New>0,i=f.hotOfferFilterUtils.isValidFlyDate(this._FilterSettings);(0,u.updateClass)(this._DomNode,"TVHotOfferInvalidTitle",!t),(0,u.updateClass)(this._DomNode,"TVHotOfferInvalidPicture",!e),(0,u.updateClass)(this._DomNode,"TVHotOfferInvalidNewPrice",!o),(0,u.updateClass)(this._DomNode,"TVHotOfferInvalidFlyDate",!i),this._scrollToInvalid({IsValidFlyDate:i,IsValidNewPrice:o,IsValidPicture:e,IsValidTitle:t}),this._isValid=t&&e&&o&&i},e.prototype._scrollToInvalid=function(t){if(this._ScrollNode&&this._ModeView===c.ModeView.Mobile){var e,o=t.IsValidTitle,i=t.IsValidPicture,r=t.IsValidNewPrice,n=t.IsValidFlyDate;switch(!0){case!i:e=0;break;case!o||!r:e=this._contentControl.getDomNode().offsetTop-l.MOBILE_PAGE_OFFSET_TOP;break;case!n:e=this._filter.getDomNode().offsetTop}(0,u.isDefined)(e)&&(0,u.setSmoothScrollTo)(this._ScrollNode,e,l.SCROLL_DURATION_M)}},e.prototype._updateStatus=function(){(0,u.updateClass)(this._DomNode,g.TV_HOT_OFFER_SOLD,this._Status===_.HotOfferStatus.SOLD)},e.prototype._addCustomClasses=function(){d.customClassUtils.addHotOfferCardContentClass(this._nodes.content)},e}(n.Control);e.OfferCard=P,t.OfferCard=P}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.hotOfferFilterUtils=void 0;var i=o(1),r=o(6),n=o(231),s=function(){function t(){}return t.prototype.getDefaultOfferData=function(t,e){var o=new Date;return{Date:n.hotOffersUtils.getDateWithDayAndHours(o.toISOString()),Title:"",Description:"",FilterSettings:this.getDefaultFilterData(t,e),ViewCount:"",LikeCount:0,ShareCount:0,PictureLink:"",Price:{Currency:t,New:0,Old:0},TourLink:""}},t.prototype.getDefaultFilterData=function(t,e){return{Countries:[],Currency:t,Departure:e,FlyDates:[],Hotels:[],HotelsCollections:[],Nights:[],Resorts:[]}},t.prototype.isValidFlyDate=function(t){return(0,i.isDefined)(t)&&(0,r.isNotEmptyArray)(t.FlyDates)},t}();e.hotOfferFilterUtils=new s,t.hotOfferFilterUtils=e.hotOfferFilterUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferLikesButtonControl=void 0;var r=o(143),n=o(222),s=o(1),a=o(20),l=o(16),u=o(86),c=o(295),h=function(t){function e(e){var o=t.call(this,e)||this;return o._Class=c.TV_HOT_OFFER_BASE_BUTTON+" "+u.TV_HOT_OFFER_LIKE,o._IsActive=!1,o._Size=l.SizeEnum.S,o._likeControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderLikeControl(),this._updateLikeControl()},e.prototype.update=function(e){var o=this._Count;t.prototype.update.call(this,e);var i=e.Animated,r=e.Count,n=e.IsActive;((0,s.isDefined)(n)||(0,s.isDefined)(i))&&this._likeControl.update(e),((0,s.isDefined)(n)||(0,s.isDefined)(r)&&o!==r)&&this._updateLikeFromStorage()},e.prototype._renderLikeControl=function(){this._likeControl=new n.LikeButtonControl({IsActive:this._IsActive,IsEnabled:!1,ParentNode:this._DomNode,Size:this._Size})},e.prototype._updateLikeControl=function(t){this._likeControl.update({Animated:t,IsActive:this._IsActive})},e.prototype._updateLikeFromStorage=function(){var t=r.hotOffersStore.getItem(this._Id);if(t&&(0,s.isDefined)(t.LikeCount)&&(0,s.isDefined)(t.IsLiked)){var e=t.LikeCount,o=t.IsLiked;this._Count=e,this._IsActive=o,this._updateCount(),this._updateLikeControl()}},e.prototype._onClicked=function(e){t.prototype._onClicked.call(this,e),this._IsActive=!this._IsActive,this._Count+=this._IsActive?1:-1,this._updateCount(),this._updateLikeControl(!0)},e.prototype._onStoreChanged=function(t){var e=t.Type,o=t.Id;if(e===a.CatalogName.HotOffers&&o&&this._Id===o){var i=r.hotOffersStore.getItem(this._Id);(i.LikeCount!==this._Count||i.IsLiked!==this._IsActive)&&this._updateLikeFromStorage()}},e}(c.BaseButtonControl);e.OfferLikesButtonControl=h,t.OfferLikesButtonControl=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.SharesButtonControl=void 0;var r=o(143),n=o(1),s=o(20),a=o(86),l=o(295),u=function(t){function e(e){var o=t.call(this,e)||this;return o._Class=l.TV_HOT_OFFER_BASE_BUTTON+" "+a.TV_HOT_OFFER_SHARE,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){var o=this._Count;t.prototype.update.call(this,e);var i=e.Count;(0,n.isDefined)(i)&&o!==i&&this._updateShareFromStorage()},e.prototype._updateShareFromStorage=function(){var t=r.hotOffersStore.getItem(this._Id);if(t&&(0,n.isDefined)(t.ShareCount)){var e=t.ShareCount;this._Count=e,this._updateCount()}},e.prototype._onStoreChanged=function(t){var e=t.Type,o=t.Id;if(e===s.CatalogName.HotOffers&&o&&this._Id===o){var i=r.hotOffersStore.getItem(this._Id);this._Count=i.ShareCount,this.update({Count:this._Count})}},e}(l.BaseButtonControl);e.SharesButtonControl=u,t.SharesButtonControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferContentControl=void 0;var r=o(410),n=o(23),s=o(2),a=o(4),l=o(3),u=o(1),c=o(6),h=o(863),d=o(12),p=o(33),_=o(126),f=o(86),y=o(451),g=o(457),C=o(864),v=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new l.UserEvent,o.templateName="offer-content",o._ActualizeVisibled=!1,o._Description="",o._Mode=p.HotOfferCardMode.View,o._Price={},o._Title="",o._titleInput=null,o._descriptionInput=null,o._priceControl=null,o._waiter=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),_.hotOfferUtils.isEditMode(this._Mode)&&(this._renderTitleInput(),this._renderDesciptionInput()),this._renderPrice(),this._updatePrice(),this._renderWaiter(),this._setVisibleWaiter(),this._updateTitle(),this._updateDescription()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ActualizeVisibled,i=e.Description,r=e.Price,n=e.Title,s=e.SetClamp;if((0,u.isDefined)(o)&&this._setVisibleWaiter(),(0,u.isDefined)(n)&&this._updateTitle(),(0,u.isDefined)(i)&&this._updateDescription(),(0,u.isDefined)(r)&&this._updatePrice(),(0,u.isDefined)(s)){var a=this._nodes,l=a.titleNode,c=a.descriptionNode;this._setClamp(l),this._setClamp(c)}},e.prototype.destroy=function(){this._Price=null,t.prototype.destroy.call(this)},e.prototype._renderTitleInput=function(){this._titleInput=new r.ResponsiveTextareaControl({ParentNode:this._nodes.titleNode,Placeholder:"Введите заголовок",Rows:3,Changed:new a.Delegate(this,this._onTitleChanged)})},e.prototype._renderDesciptionInput=function(){this._descriptionInput=new r.ResponsiveTextareaControl({ParentNode:this._nodes.descriptionNode,Placeholder:"Краткое описание",Rows:10,Changed:new a.Delegate(this,this._onDescriptionChanged)})},e.prototype._renderPrice=function(){var t=this._nodes.priceNode;this._priceControl=_.hotOfferUtils.isEditMode(this._Mode)?new C.OfferPriceInputControl({ParentNode:t,Changed:new a.Delegate(this,this._onPriceChanged)}):new g.OfferPriceControl({ParentNode:t})},e.prototype._renderWaiter=function(){var t=this._nodes.priceNode;this._waiter=new n.Waiter({ParentNode:t})},e.prototype._updatePrice=function(){this._priceControl.update(this._Price)},e.prototype._updateTitle=function(){var t=y.HotOffersContentUtils.formatStr(this._Title);_.hotOfferUtils.isEditMode(this._Mode)?this._titleInput.update({Value:(0,c.br2nl)(t)}):this._nodes.titleNode.innerHTML=(0,d.sanitizeHTML)(t)},e.prototype._updateDescription=function(){var t=this._nodes.descriptionNode,e=_.hotOfferUtils.isEditMode(this._Mode);(0,u.updateClass)(t,f.TV_EDIT_MODE,e);var o=y.HotOffersContentUtils.formatStr(this._Description);e?this._descriptionInput.update({Value:(0,c.br2nl)(o)}):t.innerHTML=(0,d.sanitizeHTML)(o)},e.prototype._setVisibleWaiter=function(){this._ActualizeVisibled?this._waiter.show():this._waiter.hide()},e.prototype._setClamp=function(t){if(!_.hotOfferUtils.isEditMode(this._Mode)){t.style.overflow="hidden";var e=t.offsetHeight+"px";(0,h.setClamp)(t,{clamp:e})}},e.prototype._onTitleChanged=function(t){var e=t.Value;this.Changed.fire({Title:y.HotOffersContentUtils.formatStr((0,c.nl2br)(e))})},e.prototype._onDescriptionChanged=function(t){var e=t.Value;this.Changed.fire({Description:y.HotOffersContentUtils.formatStr((0,c.nl2br)(e))})},e.prototype._onPriceChanged=function(t){this.Changed.fire({Price:t})},e}(s.Control);e.OfferContentControl=v,t.OfferContentControl=v}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferPriceControl=e.TV_OFFER_PRICE_CONTROL=void 0;var r=o(2),n=o(1),s=o(5),a=o(6);e.TV_OFFER_PRICE_CONTROL="TVOfferPriceControl";var l=function(t){function o(o){var i=t.call(this,o)||this;return i.templateName="offer-price",i._Class=e.TV_OFFER_PRICE_CONTROL,i._Currency=s.Currency.Rub,i._New=0,i._Old=0,i.__initSettings(o),i._Render&&i.render(),i}return i(o,t),o.prototype.render=function(){t.prototype.render.call(this),this._updateNewPrice(),this._updateOldPrice(),this._updateCurrency(),this._updateDiscount()},o.prototype.update=function(e){var o=this._Currency;t.prototype.update.call(this,e);var i=e.New,r=e.Old,s=e.Currency;((0,n.isDefined)(i)||(0,n.isDefined)(r))&&this._updateDiscount(),(0,n.isDefined)(i)&&this._updateNewPrice(),(0,n.isDefined)(r)&&this._updateOldPrice(),(0,n.isDefined)(s)&&s!==o&&this._updateCurrency(o)},o.prototype._updateNewPrice=function(){var t=this._nodes,e=t.newPrice,o=t.newPriceContainer;e.textContent=(0,n.getPrice)(this._New),(0,n.setVisible)(o,this._New>0)},o.prototype._updateOldPrice=function(){var t=this._nodes,e=t.oldPrice,o=t.oldPriceContainer;e.textContent=(0,n.getPrice)(this._Old),(0,n.setVisible)(o,this._Old>0)},o.prototype._updateCurrency=function(t){t&&(0,n.removeClass)(this._DomNode,(0,a.getCurrencyCssClass)(t)),(0,n.addClass)(this._DomNode,(0,a.getCurrencyCssClass)(this._Currency))},o.prototype._updateDiscount=function(){var t=this._nodes.discount,e=(0,n.getDiscount)(this._New,this._Old);t.textContent=e,(0,n.setVisible)(t,e.length>0)},o}(r.Control);e.OfferPriceControl=l,t.OfferPriceControl=l,t.TV_OFFER_PRICE_CONTROL=e.TV_OFFER_PRICE_CONTROL}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferDateControl=void 0;var r=o(143),n=o(2),s=o(4),a=o(3),l=o(1),u=o(20),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new a.UserEvent,o.templateName="offer-date",o._Date="",o._ViewCount="",o.__initSettings(e),o._Render&&o.render(),o._listenStore(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ViewCount,i=this._nodes.viewCount;(0,l.isDefined)(o)&&(0,l.setVisible)(i,!!o)},e.prototype.destroy=function(){this._unlistenStore(),t.prototype.destroy.call(this)},e.prototype._listenStore=function(){r.hotOffersStore&&r.hotOffersStore.Changed.addOnce(new s.Delegate(this,this._onStoreChanged))},e.prototype._unlistenStore=function(){r.hotOffersStore&&r.hotOffersStore.Changed.remove(this)},e.prototype._onStoreChanged=function(t){var e=t.Type,o=t.Id;if(e===u.CatalogName.HotOffers&&o&&this._Id===o){var i=r.hotOffersStore.getItem(this._Id);this.update({ViewCount:i.ViewCount})}},e}(n.Control);e.OfferDateControl=c,t.OfferDateControl=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.tourService=void 0;var i=o(46),r=o(30),n=o(47),s=function(){function t(){this.url=r.CoreLinks.ModAct}return t.prototype.get=function(t){return i.cors.update({Url:this.url}),i.cors.get(t).catch(function(t){return n.logService.error(t)})},t}();e.tourService=new s,t.tourService=e.tourService}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferMenuDropPanel=void 0;var r=o(215),n=o(9),s=o(461),a=function(t){function e(e){var o=t.call(this,e)||this;return o._MenuItems=[],o._ParentNode=null,o._MenuClicked=null,o._menu=null,o._droppanel=null,o.__initSettings(e),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._menu&&this._menu.update(e)},e.prototype.destroy=function(){this._MenuClicked=null,t.prototype.destroy.call(this)},e.prototype.show=function(){this._droppanel||this._render(),this._droppanel.show()},e.prototype.hide=function(){this._droppanel.hide()},e.prototype._render=function(){this._renderPriceMenu(),this._renderDropPanel()},e.prototype._renderDropPanel=function(){this._droppanel=new s.OfferDropPanel({Class:"TVHotOfferMenuDropPanel",ParentNode:this._ParentNode}),this._droppanel.addChild(this._menu)},e.prototype._renderPriceMenu=function(){this._menu=new r.MenuControl({MenuItems:this._MenuItems,MenuClicked:this._MenuClicked})},e}(n.Core);e.OfferMenuDropPanel=a,t.OfferMenuDropPanel=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferDropPanel=void 0;var r=o(2),n=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="offer-droppanel",o._overlay=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.addChild=function(t){var e=this._nodes.body;t instanceof r.Control&&(t.setParentNode(e),t.getIsRendered()&&this.getIsRendered()&&e.appendChild(t.getDomNode())),t instanceof HTMLElement&&e.appendChild(t)},e.prototype._onCancelClick=function(){this.hide()},e.prototype._onOverlayClick=function(){this.hide()},e}(r.Control);e.OfferDropPanel=n,t.OfferDropPanel=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferPriceDropPanel=void 0;var r=o(9),n=o(1),s=o(461),a=o(870),l=function(t){function e(e){var o=t.call(this,e)||this;return o._Items=[],o._ParentNode=null,o._Clicked=null,o._title=null,o._priceMenu=null,o._droppanel=null,o.__initSettings(e),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._priceMenu&&this._priceMenu.update(e)},e.prototype.destroy=function(){this._Clicked=null,t.prototype.destroy.call(this)},e.prototype.show=function(){this._droppanel||this._render(),this._droppanel.show(),this._priceMenu.update({ScrollToCurrent:!0})},e.prototype.hide=function(){this._droppanel.hide()},e.prototype._render=function(){this._renderTitle(),this._renderPriceMenu(),this._renderDropPanel()},e.prototype._renderDropPanel=function(){this._droppanel=new s.OfferDropPanel({Class:"TVHotOfferPriceDropPanel",ParentNode:this._ParentNode}),this._droppanel.addChild(this._title),this._droppanel.addChild(this._priceMenu)},e.prototype._renderPriceMenu=function(){this._priceMenu=new a.OfferPriceMenu({Items:this._Items,Clicked:this._Clicked})},e.prototype._renderTitle=function(){this._title=(0,n.newDiv)("TVHotOfferPriceDropPanelTitle")},e}(r.Core);e.OfferPriceDropPanel=l,t.OfferPriceDropPanel=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferSubscribeControl=void 0;var r,n=o(93),s=o(411),a=o(23),l=o(2),u=o(4),c=o(3),h=o(7),d=o(1),p=o(5),_=o(270),f=o(8),y=o(883),g=o(884);!function(t){t[t.Filter=0]="Filter",t[t.Messenger=1]="Messenger"}(r||(r={}));var C=function(t){function e(e){var o=t.call(this,e)||this;return o.FilterChanged=new c.UserEvent,o.MessengerClicked=new c.UserEvent,o._Class="TVHotOfferSubscribe",o._FilterSettings={},o._MessengerCustomerLink="",o._MessengerLink="",o._ModeView=p.ModeView.DescTop,o._copyLinkTimeout=null,o._filterPanel=null,o._messengerPanel=null,o._selectedMessenger=p.MessengerType.None,o._stepLayerSwitch=null,o._subscribeLink=null,o._subscribeCopyButton=null,o._subscribeCopyHint=null,o._waiter=null,o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderFilterPanel(),this._renderMessengerPanel(),this._renderSubscribeLink(),this._renderCopySubscribeButton(),this._renderCopySubscribeHint(),this._updateLink(),this._renderStepSwitch(),this._addSteps(),this._setVisibleCopyButton()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.FilterSettings,i=e.MessengerLink,n=e.MessengerCustomerLink,s=e.Reset,a=e.ShowPreviousStep,l=e.ShowWaiter;(0,d.isDefined)(o)&&this._filterPanel.update({FilterSettings:o}),(0,d.isDefined)(s)&&(this._stepLayerSwitch.update({ViewStepId:r.Filter}),this._selectMessenger(p.MessengerType.None)),(0,d.isDefined)(a)&&this._stepLayerSwitch.previousStep(),(0,d.isDefined)(i)&&this._updateLink(),(0,d.isDefined)(n)&&this._setVisibleCopyButton(),(0,d.isDefined)(l)&&this._setVisibleWaiter(l)},e.prototype.getStep=function(){return this._stepLayerSwitch?this._stepLayerSwitch.getStep():void 0},e.prototype._init=function(){this._onCopyClicked=this._onCopyClicked.bind(this),this._onLinkCopied=this._onLinkCopied.bind(this)},e.prototype._renderFilterPanel=function(){this._filterPanel=new y.OfferSubscribeFilterPanel({FilterSettings:this._FilterSettings,ModeView:this._ModeView,FilterChanged:new u.Delegate(this,this._onFilterChanged)})},e.prototype._renderMessengerPanel=function(){this._messengerPanel=new g.OfferSubscribeMessengerPanel({Messenger:this._selectedMessenger,MessengerClicked:new u.Delegate(this,this._onMessengerClicked)})},e.prototype._renderSubscribeLink=function(){this._subscribeLink=(0,d.newLinkNode)(s.TV_STEP_BUTTON+" TVHotOfferSubscribeLink "+f.TV_BUTTON_HOVER)},e.prototype._renderCopySubscribeButton=function(){this._subscribeCopyButton=(0,d.newDiv)(s.TV_STEP_BUTTON+" TVHotOfferSubscribeCopyButton "+f.TV_BUTTON_HOVER),(0,d.hide)(this._subscribeCopyButton),(0,d.addEvent)(this._subscribeCopyButton,"click",this._onCopyClicked)},e.prototype._renderCopySubscribeHint=function(){this._subscribeCopyHint=new n.Hint({Anchor:this._subscribeCopyButton,Class:"TVHotOfferSubscribeCopyHint",Position:n.HintPosition.TOP})},e.prototype._renderStepSwitch=function(){this._stepLayerSwitch=new s.StepLayerSwitch({FinishButtons:[this._subscribeCopyButton,this._subscribeLink],ParentNode:this._DomNode,Changed:new u.Delegate(this,this._onStepChanged)})},e.prototype._addSteps=function(){this._stepLayerSwitch.addStep({Panel:this._filterPanel,Type:r.Filter}),this._stepLayerSwitch.addStep({Panel:this._messengerPanel,Type:r.Messenger})},e.prototype._hasSelectedMessenger=function(){return this._selectedMessenger!==p.MessengerType.None},e.prototype._onCopyClicked=function(){_.clipboardService.copyText(this._MessengerCustomerLink).then(this._onLinkCopied)},e.prototype._onFilterChanged=function(t){this.FilterChanged.fire(t),this._hasSelectedMessenger()&&this._selectMessenger(p.MessengerType.None)},e.prototype._onLinkCopied=function(t){var e=this;t&&((0,d.addClass)(this._subscribeCopyButton,f.TV_COPY_LINK_SUCCESS),this._copyLinkTimeout=setTimeout(function(){(0,d.removeClass)(e._subscribeCopyButton,f.TV_COPY_LINK_SUCCESS)},h.SUCCESS_COPY_MESSAGE_TIMEOUT))},e.prototype._onMessengerClicked=function(t){var e=t.Messenger;this._selectMessenger(e)},e.prototype._onStepChanged=function(){this._setVisibleCopyButton()},e.prototype._selectMessenger=function(t){this._selectedMessenger=t===this._selectedMessenger?p.MessengerType.None:t,this._messengerPanel.update({Messenger:this._selectedMessenger}),this._MessengerLink="",this._MessengerCustomerLink="",this._updateLink(),this._updateSelectedMessengerClass(),this._setVisibleCopyButton(),this._setVisibleWaiter(!1),this._hasSelectedMessenger()&&this.MessengerClicked.fire({Messenger:this._selectedMessenger})},e.prototype._setVisibleWaiter=function(t){this._waiter||(this._waiter=new a.Waiter({ParentNode:this._subscribeLink})),t?this._waiter.show():this._waiter.hide(),(0,d.updateClass)(this._subscribeLink,"TVHotOfferSubscribeVisibled",t)},e.prototype._updateLink=function(){var t=this._hasSelectedMessenger()?this._MessengerLink:"";this._subscribeLink.href=t,(0,d.updateClass)(this._subscribeLink,f.TV_DISABLED,0===t.length)},e.prototype._setVisibleCopyButton=function(){var t=this._hasSelectedMessenger()?this._MessengerCustomerLink:"",e=this._stepLayerSwitch.getStepType();(0,d.setVisible)(this._subscribeCopyButton,Boolean(t)&&e===r.Messenger)},e.prototype._updateSelectedMessengerClass=function(){(0,d.updateClass)(this._subscribeLink,"TVHotOfferMessengerSelected",this._hasSelectedMessenger())},e}(l.Control);e.OfferSubscribeControl=C,t.OfferSubscribeControl=C}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.SubscribeBasePanel=void 0;var r=o(2),n=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="subscribe-panel",o.__initSettings(e),o}return i(e,t),e}(r.Control);e.SubscribeBasePanel=n,t.SubscribeBasePanel=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},n.apply(this,arguments)},s=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var i,r=0,n=e.length;r<n;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.OrderManager=void 0;var a=o(31),l=o(78),u=o(34),c=o(41),h=o(120),d=o(9),p=o(4),_=o(3),f=o(1),y=o(30),g=o(5),C=o(6),v=o(110),m=o(22),T=o(355),w=o(232),S=o(459),P=o(32),b=o(891),I=o(892),O=o(118),M=o(18),D=o(73),E=o(223),k=o(40),R=o(893),A=o(949),V=o(194),L=o(72),N=o(310);o(953);var B=function(e){function o(t){var o=e.call(this,t)||this;return o.AfterShow=new _.UserEvent,o.BeforeShow=new _.UserEvent,o.Hide=new _.UserEvent,o.RunSearch=new _.UserEvent,o.Show=new _.UserEvent,o.TourDataLoaded=new _.UserEvent,o.UserSent=new _.UserEvent,o._Currency=g.Currency.None,o._CustomData="",o._HashUserOfficeId=0,o._HotelDescriptionVisibility=!0,o._IsAvailableBuyInCredit=!1,o._IsAvailableBuyOnline=!1,o._IsAvailableCart=!1,o._IsEnabledSetHash=!0,o._ModeView=g.ModeView.DescTop,o._Ref=null,o._SearchLink="",o._ShortId=0,o._ShowOperator=g.Operator.Hide,o._TourId=0,o._UserMode=g.UserMode.Default,o._TourData=null,o._instance=null,o.__initSettings(t),o._init(),o}return r(o,e),o.prototype.showTour=function(t){this._updateSettings(t),this._updateUserMode(t),this._updateCurrency(t),this._updateModeView(t),this._updateShowOperator(),this._subscribeCartManager(),this._initInstance(),this._updateFavoriteHotels(t),this._requestTourData(t)},o.prototype.showTourByShortId=function(t,e){void 0===e&&(e={}),!1===t||this._instance instanceof R.TourDesktopController&&this._ShortId===t||(this._ShortId=Number(t),e.TourId=0,e.Ref={SourceId:0,ModuleId:0,Url:document.referrer},this.showTour(e))},o.prototype.hideWindow=function(){this._instance instanceof R.TourDesktopController&&this._instance.hide()},o.prototype.getShortId=function(){return this._ShortId},o.prototype.getTourId=function(){return this._TourId},o.prototype.sendRequest=function(t){this._onSendRequest(t)},o.prototype._init=function(){this._ModeView=(0,f.isMobile)()?g.ModeView.Mobile:g.ModeView.DescTop},o.prototype._initInstance=function(){this._instance=this._getInstance()},o.prototype._getInstance=function(){var t=this._isMobileInstance(),e={IsVisibleAddToCart:this._IsAvailableCart,IsVisibleBuyOnline:this._IsAvailableBuyOnline,ShowOperator:this._ShowOperator,TourId:this._TourId,AddToCart:new p.Delegate(this,this._onAddToCartClicked),ContractClicked:new p.Delegate(this,this._onContractClicked),Hide:new p.Delegate(this,this._onInstanceHided),MoreFlightsClicked:new p.Delegate(this,this._onMoreFlightsClicked),RunSearch:new p.Delegate(this,this._onRunSearch),SendRequest:new p.Delegate(this,this._onSendRequest)};return t?this._getMobileInstance(e):this._getDeskTopInstance(e)},o.prototype._getMobileInstance=function(t){return this._instance instanceof A.TourMobileController?this._instance:new A.TourMobileController(t)},o.prototype._getDeskTopInstance=function(t){var e=this;return this._instance instanceof R.TourDesktopController?this._instance:(this._instance&&this._instance.destroy(),new R.TourDesktopController(n(n({},t),{IsEnabledSetHash:this._IsEnabledSetHash,IsVisibleBuyInCredit:this._IsAvailableBuyInCredit,AfterShow:new p.Delegate(this,function(){return e.AfterShow.fire()}),BeforeShow:new p.Delegate(this,function(){return e.BeforeShow.fire()})})))},o.prototype._updateFavoriteHotels=function(t){void 0===t&&(t={});var e=t.IsVisibleFavoriteHotels,o=void 0===e||e;this._instance instanceof R.TourDesktopController||this._instance.update({IsVisibleFavoriteHotels:o})},o.prototype._updateSettings=function(t){var e=t.CustomData,o=t.HashUserOfficeId,i=t.Ref,r=t.TourId;this._TourId=Number(r),this._Ref=i,this._CustomData=(0,f.isDefined)(e)?e:"",this._HashUserOfficeId=(0,f.isDefined)(o)?o:0;var n=u.clientCatalog.getClientData();this._SearchLink=P.clientUtils.getSearchLink(n)},o.prototype._onRunSearch=function(t){if(this._instance instanceof A.TourMobileController){var e=t.Event;(0,f.preventDefault)(e),this.RunSearch.fire(n(n({},t),{Ref:this._Ref}))}},o.prototype._onSendRequest=function(t){switch(t.Type){case L.RequestType.SimpleRequest:this._sendSimpleRequest(t);break;case L.RequestType.OnlineRequest:this._sendOnlineRequest(t);break;case L.RequestType.CreditRequest:this._sendOnlineRequest(n(n({},t),{IsCredit:!0}));break;case L.RequestType.ExportRequest:this._sendExportCrmRequest(t)}},o.prototype._getOrderRequestParams=function(t){var e,o=t.Currency,i=t.CustomData,r=t.TourId,s=t.UserOffice,a=t.IsFromTourvisor,l=n({},t);return(0,f.isDefined)(o)||this._Currency===g.Currency.None||(l.Currency=this._Currency),(0,f.isDefined)(r)||(l.TourId=this._TourId||(null===(e=this._TourData)||void 0===e?void 0:e.tourid)||0),!i&&this._CustomData.length>0&&(l.CustomData=this._CustomData),!s&&a&&this._HashUserOfficeId>0&&(l.UserOffice=this._HashUserOfficeId),E.OrderUtils.getOrderRequestParams(l)},o.prototype._getSimpleRequestParams=function(t){var e,o=t.Currency,i=t.CustomData,r=t.TourId,s=t.UserOffice,a=t.IsFromTourvisor,l=n({},t);return(0,f.isDefined)(o)||this._Currency===g.Currency.None||(l.Currency=this._Currency),(0,f.isDefined)(r)||(l.TourId=this._TourId||(null===(e=this._TourData)||void 0===e?void 0:e.tourid)||0),this._ShortId&&(l.ShortId=this._ShortId),!i&&this._CustomData.length>0&&(l.CustomData=this._CustomData),!s&&a&&this._HashUserOfficeId>0&&(l.UserOffice=this._HashUserOfficeId),E.OrderUtils.getSimpleRequestParams(l)},o.prototype._sendSimpleRequest=function(e){var o=this,i=e.CallBack,r=e.Metrica,n=e.UserEmail,s=e.UserName,a=e.UserPhone,l=this._getSimpleRequestParams(e),u=(0,f.newFormData)(l);t.orderService.post(u,y.CoreLinks.SendRequest).then(function(t){i&&i.fire(t);var e=JSON.parse(t.Response),r=e&&e.tour||{};o._logTour({Tour:r,Ref:o._Ref},g.ActionLogQuery.ORDER)});var c=k.tourUtils.isCraftTour(this._TourData),h=r||(c?g.Metrica.OrderCraftTour:g.Metrica.OrderTour);v.analiticManager.reachGoal(h);var d={UserEmail:n||"",UserName:s||"",UserPhone:a||""};this.UserSent.fire(d),this._logUser(d)},o.prototype._sendOnlineRequest=function(e){var o=this,i=e.CallBack,r=this._getOrderRequestParams(e),n=(0,f.newFormData)(r);t.orderService.post(n,y.CoreLinks.SendRequest).then(function(t){i&&i.fire(t),o._onOnlineRequestProccess(t)}),v.analiticManager.reachGoal(g.Metrica.BookTour)},o.prototype._sendExportCrmRequest=function(e){var o=this,i=e.CallBack,r=this._getOrderRequestParams(e),n=(0,f.newFormData)(r);t.orderService.post(n,y.CoreLinks.ExportRequest).then(function(t){o._updateCrmUrl(t,i)})},o.prototype._onOnlineRequestProccess=function(t){var e=t.Response,o=JSON.parse(e);this._onlinePayProccess(o)},o.prototype._onlinePayProccess=function(e){t.payService.onlinePayProccess(e,this._Ref);var o=e.operationtype;(void 0===o?"":o).toLocaleLowerCase()===g.PayOperationType.Text&&this._showInstructionMessage(e)},o.prototype._requestTourData=function(t){var e=this;this._instance.show(this._TourId),this._instance.update({IsLoadingTour:!0});var o=this._getRequestTourParams(t);S.tourService.get(o).then(function(t){var o;if(Boolean(t&&t.error))throw e._instance.update({ErrorEnabled:!0,IsLoadingTour:!1,TourEnable:!1}),new Error(t.error.errormessage);e._loadTourData(t);var i=(null===(o=t.data)||void 0===o?void 0:o.tour)||{};return e.TourDataLoaded.fire({Tour:i,Ref:e._Ref}),e._logTour({Tour:i,Ref:e._Ref},g.ActionLogQuery.TOUR),t}).catch(function(t){return console.warn(t),e._instance.update({ErrorEnabled:!0,IsLoadingTour:!1,TourEnable:!1}),t})},o.prototype._getRequestTourParams=function(t){var e=t.TourId,o=(0,f.isDefined)(e)&&Boolean(e),i=this._isManagerMode(),r={currency:this._Currency};return this._ShortId>0&&!o&&(r.shortid=this._ShortId),o&&(r.tourid=Number(e)),i&&(r.manager=this._getManagerId()),r},o.prototype._requestDetailTourData=function(t,e){var o=this,i=this._getRequestDetailTourParams(t,e);S.tourService.get(i).then(function(e){var i=n(n({},e),{TourId:t});return o._loadDetailTourData(i),i}).catch(function(t){return console.warn(t),t})},o.prototype._getRequestDetailTourParams=function(t,e){var o={currency:this._Currency,detailed:1,tourid:t};return e&&(o.extraflights=1),this._isManagerMode()&&(o.manager=this._getManagerId()),o},o.prototype._loadTourData=function(t){var e=(null===t||void 0===t?void 0:t.data)||{},o=(null===e||void 0===e?void 0:e.client)||{},i=(null===e||void 0===e?void 0:e.hotel)||{},r=(null===e||void 0===e?void 0:e.program)||null,s=(null===e||void 0===e?void 0:e.result)||{},a=k.tourUtils.getTourCardData(e),l=k.tourUtils.getDetailTourData(s);this._TourData=n(n({},a),l),this._TourData.share=k.tourUtils.getDetailTourShare(this._TourData,s);var u=this._TourData,d=u.shortid,p=u.tourid,_=u.currency,f=this._isMobileInstance(),y=1===Number(o.detailed),g=(0,C.isEmptyObject)(l)&&y,v=k.tourUtils.isCraftTour(this._TourData),m=k.tourUtils.isFromTourvisorTour(o);m&&w.fromTourvisorService.setFlag();var T=this._IsAvailableBuyOnline&&!v,S=k.tourUtils.hasBookingCenters(o)&&!v,P=k.tourUtils.isShowRequest(o),b=Boolean(k.tourUtils.getOperatorLink(this._TourData)),I=this._getOrderMode(o);h.orderCatalog.setTourData(p,this._TourData),h.orderCatalog.setExcursionProgramData(p,r),h.orderCatalog.setClientData(o),this._updateTouristsData(),this._updateCurrency({Currency:_});var O=M.hotelUtils.getHotelId(i);if(O>0&&c.hotelsStore.setHotelData(O,i),0!==this._TourId||0!==this._ShortId){this._TourId=p,this._ShortId=d;var D={ClientData:o,ErrorEnabled:!1,HotelData:i,IsActualizing:y,IsEnabledAddToCart:this._isEnabledAddToCart(),IsEnabledMultiOffice:this._isEnabledMultiOffice({tourClientData:o,tourData:this._TourData}),IsLoadingFlights:g,IsLoadingTour:!1,IsVisibleBooking:S,IsVisibleBuyOnline:T,IsVisibleCreateContract:!v,IsVisibleCrm:!v,IsVisibleOperatorBooking:v,IsVisibleOperatorLink:b,IsVisibleRequest:P,OrderMode:I,ProgramData:r,Ref:this._Ref,SearchLink:this._SearchLink,TourData:this._TourData,TourEnable:!0,TourId:this._TourId};this._instance instanceof R.TourDesktopController&&(D.IsVisibleBuyInCredit=this._IsAvailableBuyInCredit&&!v),this._instance instanceof A.TourMobileController&&(D.IsSetTourHash=!0),m&&!f&&!y&&T&&I!==V.OrderModeEnum.AGENCY&&(D.ContentViewMode=N.TourCardContentViewModeEnum.ORDER),this._instance.update(D),d&&this.Show.fire({Id:d}),y&&this._requestDetailTourData(p)}},o.prototype._loadDetailTourData=function(t){var e,o,i=t.TourId;if(this._TourId===i){if(!(null===t||void 0===t?void 0:t.data))return void this._instance.update({IsActualizing:!1,IsLoadingExtraFlights:!1,IsLoadingFlights:!1,TourEnable:!1});var r=null===(e=null===t||void 0===t?void 0:t.data)||void 0===e?void 0:e.error;if(!(0,f.isDefined)(r)||!1!==r&&2===Number(r.code))return void this._instance.update({IsActualizing:!1,IsLoadingExtraFlights:!1,IsLoadingFlights:!1,TourEnable:!1});if(i){var s=null===(o=null===t||void 0===t?void 0:t.data)||void 0===o?void 0:o.result;this._TourData=n(n(n({},this._TourData),k.tourUtils.getDetailTourData(s)),{share:k.tourUtils.getDetailTourShare(this._TourData,s)}),h.orderCatalog.setTourData(i,this._TourData);var a={IsActualizing:!1,IsLoadingExtraFlights:!1,IsLoadingFlights:!1,TourData:this._TourData},l=Boolean(k.tourUtils.getOperatorLink(this._TourData));l&&(a.IsVisibleOperatorLink=l),this._instance.update(a)}}},o.prototype._showInstructionMessage=function(t){var e=t.operationmessage,o=e||"";this._instance.update({InstructionMessage:o})},o.prototype._onAddToCartClicked=function(e){t.cartManager&&(t.cartManager.addTour(this._TourId,this._Ref,n(n({},e),{Currency:this._Currency})),(0,l.reachGoal)(a.ActionStatisticsSource.TOURCARD,a.ActionStatisticsType.TOUR_ADDED))},o.prototype._onCartManagerChanged=function(){var t=this._isEnabledAddToCart();this._instance.update({IsEnabledAddToCart:t})},o.prototype._onContractClicked=function(){var t={type:g.ContractType.Offer,tourid:this._TourId};T.contractService.send(t,new p.Delegate(this,this._onReceiveContract))},o.prototype._onInstanceHided=function(){this._TourId=0,this._ShortId=0,this._CustomData="",this._HashUserOfficeId=0,this._unsubscribeCartManager(),this.Hide.fire()},o.prototype._onReceiveContract=function(t){var e=h.orderCatalog.getUserData(),o=h.orderCatalog.getTouristsData(),i=b.contractUtils.getSettings(e,o,t);this._instance.update({ContractData:i})},o.prototype._onMoreFlightsClicked=function(){var t=this._TourData,e=t.flights,o=t.tourid;if(O.flightUtils.getExtraQuery(e)){var i={IsLoadingExtraFlights:!0};this._instance.update(i),this._requestDetailTourData(o,!0)}},o.prototype._subscribeCartManager=function(){this._IsAvailableCart&&t.cartManager&&t.cartManager.Changed.addOnce(new p.Delegate(this,this._onCartManagerChanged))},o.prototype._unsubscribeCartManager=function(){t.cartManager&&t.cartManager.Changed.remove(this)},o.prototype._updateCurrency=function(t){var e=t.Currency;if((0,f.isDefined)(e))return void(this._Currency=e);var o=u.clientCatalog.getClientData(),i=P.clientUtils.getCurrency(o);this._Currency=i!==g.Currency.None?i:g.Currency.Rub},o.prototype._updateModeView=function(t){var e=t.ModeView,o=e===g.ModeView.Mobile;this._ModeView=o?g.ModeView.Mobile:g.ModeView.DescTop},o.prototype._updateCrmUrl=function(t,e){var o=I.exportCrmUtils.isSuccessExport(t),i={CrmError:o?"":I.exportCrmUtils.getCrmError(t),CrmUrl:o?I.exportCrmUtils.getCrmUrl(t):""};o||console.warn(I.exportCrmUtils.getCrmError(t)),(0,f.isDefined)(e)&&e.fire(i)},o.prototype._updateShowOperator=function(){if(this._isMobileInstance())return void(this._ShowOperator=this._isManager()?g.Operator.Show:this._ShowOperator);this._ShowOperator=this._isManagerMode()?g.Operator.Show:this._ShowOperator},o.prototype._updateUserMode=function(t){var e=t.UserMode;this._UserMode=(0,f.isDefined)(e)?e:g.UserMode.Default},o.prototype._updateTouristsData=function(){var t=this._TourData.adults+this._TourData.child,e=h.orderCatalog.getTouristsData()||[],o=s([],e,!0);o.length=Math.min(o.length,t),h.orderCatalog.setTouristsData(o)},o.prototype._getOrderMode=function(t){var e=u.clientCatalog.getClientData(),o=P.clientUtils.getAgencyOrderEnabled(e),i=k.tourUtils.isWhereBuyOnline(t),r=this._isManagerMode();switch(!0){case r:return V.OrderModeEnum.MANAGER;case o&&i:return V.OrderModeEnum.AGENCY;case this._UserMode===g.UserMode.Customer:default:return V.OrderModeEnum.CUSTOMER}},o.prototype._isMobileInstance=function(){return this._ModeView===g.ModeView.Mobile},o.prototype._isEnabledAddToCart=function(){return Boolean(t.cartManager)&&!t.cartManager.hasTour(this._TourId)},o.prototype._isEnabledMultiOffice=function(t){var e=t.tourClientData,o=t.tourData,i=u.clientCatalog.getClientData(),r=P.clientUtils.getMultiOfficeSettings(i),n=o&&k.tourUtils.isCraftTour(o),s=k.tourUtils.isShowRequestOffice(e);return D.officeUtils.getMultiOfficeEnable(r)&&!n&&s},o.prototype._isManager=function(){return m.authManager.isManager()},o.prototype._isManagerMode=function(){return this._isManager()&&this._UserMode!==g.UserMode.Customer},o.prototype._getManagerId=function(t){return void 0===t&&(t=!1),m.authManager.getId(t)},o.prototype._logTour=function(e,o){t.actionLogService.log(g.ActionLog.TOUR,e,o)},o.prototype._logUser=function(e){t.actionLogService.log(g.ActionLog.USER,e)},o}(d.Core);e.OrderManager=B,i.OrderManager=B}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ContractControl=void 0;var r=o(2),n=o(1),s=o(13),a=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="contract",o._Class="TVContractControl",o._ContractText="",o._UserName="",o._Tourists=[],t.prototype.__initSettings.call(o,e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._clearText(),this._updateText()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ContractText;(0,n.isDefined)(o)&&(this._clearText(),this._updateText())},e.prototype._clearText=function(){var t=this._nodes,e=t.dateNode,o=t.textNode;(0,n.removeChildren)(e),(0,n.removeChildren)(o)},e.prototype._updateText=function(){if(this._ContractText){var t=this._nodes,o=t.dateNode,i=t.textNode,r=new Date;o.innerHTML=s.FormatDate.getFormatDate(r,"DD MMMM YYYY г.");var n=this._UserName||e.USER_NAME_DEFAULT,a=this._ContractText.replace(new RegExp(e.USER_NAME_TEMPLATE,"g"),n),l=this._Tourists?this._Tourists.map(function(t){return t.Surname+" "+t.Name}):[];i.innerHTML=a.replace(new RegExp(e.TOURISTS_TEMPLATE,"g"),l.join("<br>"))}},e.USER_NAME_DEFAULT="Имя заказчика",e.USER_NAME_TEMPLATE="%CLIENT_NAME%",e.TOURISTS_TEMPLATE="%TOURIST_LIST%",e}(r.Control);e.ContractControl=a,t.ContractControl=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.VideoControl=void 0;var r=o(1),n=o(2),s=o(1),a=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVVideoControl",o._Link="",o._videoFrame=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateVideoFrame()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Link,i=e.Reset;(0,s.isDefined)(o)&&(this._clear(),this._updateVideoFrame()),(0,s.isDefined)(i)&&this._clear()},e.prototype._updateVideoFrame=function(){this._videoFrame=this._getVideoFrame(this._Link),this._videoFrame&&this._DomNode.appendChild(this._videoFrame)},e.prototype._getVideoFrame=function(t){if(!t)return null;var e=(0,s.newIframe)("TVVideoFrame");return e.src=t,e.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",e.allowFullscreen=!0,e.loading="lazy",e},e.prototype._clear=function(){(0,r.removeChildren)(this._DomNode),this._videoFrame=null},e}(n.Control);e.VideoControl=a,t.VideoControl=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.AccommodationList=void 0;var n=o(168),s=o(2),a=o(1),l=o(899),u=function(t){return new l.AccommodationItem(r({},t))},c=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVAccommodationList",o._IsEnabledClampText=!1,o._IsVisibleFullText=!0,o._Items=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._list=(0,n.newTableView)({ItemFactory:u,Items:this._Items,Margin:15,ParentNode:this._DomNode})},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._rendered){var o=e.Items;(0,a.isDefined)(o)&&this._updateItems()}},e.prototype._updateItems=function(){var t=this;this._Items=this._Items.map(function(e){return r(r({},e),{IsVisibleFullText:t._IsVisibleFullText,IsEnabledClampText:t._IsEnabledClampText})}),this._list.update({Items:this._Items})},e}(s.Control);e.AccommodationList=c,t.AccommodationList=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.PhotoSliderGallery=void 0;var n=o(2),s=o(4),a=o(1),l=o(5),u=o(135),c=o(76),h=o(288),d=o(900),p=function(t){return new d.Photo(r({},t))},_=190,f=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVPhotoSliderGallery",o._Items=[],o._ItemWidth=_,o._imageSlider=null,o._nodeWidth=0,o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._imageSlider=(0,h.newSliderView)({ItemFactory:p,ItemWidth:this._ItemWidth,Items:this._getItems(),Margin:15,ParentNode:this._DomNode,Width:this._DomNode.offsetWidth}),this._observe()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Items;(0,a.isDefined)(o)&&this._updateItems()},e.prototype.destroy=function(){this._disconnectObserver(),t.prototype.destroy.call(this)},e.prototype._init=function(){this._updateWidth=this._updateWidth.bind(this)},e.prototype._observe=function(){this._observer&&this._disconnectObserver(),this._observer=(0,c.newResizeObserver)(this._updateWidth,this._DomNode)},e.prototype._disconnectObserver=function(){this._observer&&((0,c.removeResizeObserver)(this._observer),this._observer=null)},e.prototype._updateWidth=function(){var t=this._DomNode.offsetWidth;!this._ParentNode||t<=0||this._nodeWidth===t||(this._nodeWidth=t,this._imageSlider.update({Items:this._getItems(),Width:t}))},e.prototype._updateItems=function(){this._imageSlider&&this._imageSlider.update({Items:this._getItems(),Width:this._DomNode.offsetWidth})},e.prototype._getItems=function(){var t=this;return this._Items.map(function(e,o){return{Id:o,Url:e,Click:new s.Delegate(t,t._imageClick,{Id:o})}})},e.prototype._imageClick=function(t){this._showPhotoGallery(t.Id||0)},e.prototype._showPhotoGallery=function(t){this._Items&&0!==this._Items.length&&(0,u.showGallery)({ActiveIndex:t,Items:this._Items,ModeView:l.ModeView.DescTop,Title:""})},e}(n.Control);e.PhotoSliderGallery=f,t.PhotoSliderGallery=f}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.NodeResizeObserver=void 0;var r=o(9),n=o(76),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.destroy=function(){this.unobserve(),t.prototype.destroy.call(this)},e.prototype.observe=function(t,e){this._observer&&this.unobserve(),t&&(this._observer=(0,n.newResizeObserver)(e,t))},e.prototype.unobserve=function(){this._observer&&((0,n.removeResizeObserver)(this._observer),this._observer=null)},e}(r.Core);e.NodeResizeObserver=s,t.NodeResizeObserver=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.AccordionList=void 0;var n=o(2),s=o(1),a=o(61),l=o(168),u=o(300),c=function(t){return new u.Accordion(r({},t))},h=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVAccordionListList",o._Color=a.ColorThemeEnum.DEFAULT,o._Items=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateColor(),this._list=(0,l.newTableView)({ItemFactory:c,Items:this._Items,Margin:8,ParentNode:this._DomNode})},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._rendered){var o=e.Items,i=e.Color;((0,s.isDefined)(i)||(0,s.isDefined)(o))&&this._updateColor(),(0,s.isDefined)(o)&&this._list.update({Items:this._Items})}},e.prototype._updateColor=function(){var t=this;this._Items=this._Items.map(function(e){return r(r({},e),{Color:t._Color})})},e}(n.Control);e.AccordionList=h,t.AccordionList=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.AttractionList=void 0;var n=o(288),s=o(168),a=o(2),l=o(1),u=o(10),c=o(470),h=o(902),d=o(473),p=function(t){return new h.AttractionItem(r({},t))},_=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVAttractionList",o._Items=[],o._StyleTheme=u.StyleThemeEnum.THEME1,o._View=d.AttractionListView.TABLE,o._domNodeWidth=0,o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderList(),this._updateObserver()},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._rendered){var o=e.Items;(0,l.isDefined)(o)&&this._updateItems()}},e.prototype._init=function(){this._resize=this._resize.bind(this),this._resizeObserver=new c.NodeResizeObserver},e.prototype._renderList=function(){var t={ItemFactory:p,Items:this._Items,Margin:15,ParentNode:this._DomNode};this._list=this._View===d.AttractionListView.SLIDER?(0,n.newSliderView)(r(r({},t),{ItemWidth:280,Width:this._DomNode.offsetWidth})):(0,s.newTableView)(t)},e.prototype._updateItems=function(){var t=this;this._Items=this._Items.map(function(e){return r(r({},e),{StyleTheme:t._StyleTheme})}),this._list.update({Items:this._Items,Width:this._DomNode.offsetWidth})},e.prototype._updateObserver=function(){if(this._View===d.AttractionListView.SLIDER)return void this._resizeObserver.observe(this._DomNode,this._resize);this._resizeObserver.unobserve()},e.prototype._resize=function(){var t=this._DomNode.offsetWidth;t<=0||this._domNodeWidth===t||(this._domNodeWidth=t,this._list.update({Width:t}))},e}(a.Control);e.AttractionList=_,t.AttractionList=_}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.AttractionListView=void 0;var o;!function(t){t[t.TABLE=1]="TABLE",t[t.SLIDER=2]="SLIDER"}(o=e.AttractionListView||(e.AttractionListView={})),t.AttractionListView=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CraftTourConditions=void 0;var r=o(2),n=o(1),s=o(6),a=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVCraftTourConditions",o._Includes=[],o._NotIncludes=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._render()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Includes,i=e.NotIncludes;((0,n.isDefined)(o)||(0,n.isDefined)(i))&&this._redraw()},e.prototype._render=function(){this._renderIncludes(),this._renderNotIncludes()},e.prototype._redraw=function(){(0,n.removeChildren)(this._DomNode),this._render()},e.prototype._renderIncludes=function(){this._renderConditions(this._Includes,"TVCraftTourIncludesConditions")},e.prototype._renderNotIncludes=function(){this._renderConditions(this._NotIncludes,"TVCraftTourNotIncludesConditions")},e.prototype._renderConditions=function(t,e){if((0,s.isNotEmptyArray)(t)){var o=(0,n.newDiv)(e,this._DomNode);t.map(function(t){(0,n.newDiv)("TVCraftTourCondition",o).textContent=t})}},e}(r.Control);e.CraftTourConditions=a,t.CraftTourConditions=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TourProgramList=void 0;var n=o(168),s=o(2),a=o(1),l=o(10),u=o(903),c=o(233),h=function(t){return new u.CraftTourProgram(r({},t))},d=function(t){function e(e){var o=t.call(this,e)||this;return o._GalleryType=c.TourProgramGalleryType.SLIDER,o._Items=[],o._StyleTheme=l.StyleThemeEnum.THEME1,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._list=(0,n.newTableView)({ItemFactory:h,Items:this._Items,Margin:8,ParentNode:this._DomNode})},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._rendered){var o=e.Items;(0,a.isDefined)(o)&&(this._updateItems(),this._list.update({Items:this._Items}))}},e.prototype._updateItems=function(){var t=this;this._Items=this._Items.map(function(e){return r(r({},e),{GalleryType:t._GalleryType,StyleTheme:t._StyleTheme})}),this._list.update({Items:this._Items})},e}(s.Control);e.TourProgramList=d,t.TourProgramList=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CreateHotelReviewControl=void 0;var r=o(116),n=o(63),s=o(2),a=o(4),l=o(1),u=o(30),c=o(5),h=o(13),d=o(16),p=o(10),_=o(164),f=o(92),y=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="create-hotel-review",o._HotelId=0,o._HotelTitleSettings=null,o._ModeView=c.ModeView.DescTop,o._rating=3,o._restTimeMonth=0,o._restTimeYear=0,o.__initSettings(e),o._onStarsChanged=o._onStarsChanged.bind(o),o._onSendReview=o._onSendReview.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._hotelTitleControl=new f.HotelTitleControl({ParentNode:this._nodeTitle}),this._starsControl=new _.StarsSelect({IsVisibleTitle:!1,ParentNode:this._nodeStars,StarSize:d.SizeEnum.L,StyleTheme:p.StyleThemeEnum.THEME4,Changed:new a.Delegate(this,this._onStarsChanged)});var o=[];h.FormatDate.Month.forEach(function(t,e){return o.push({Content:t,Id:e,Index:e})}),this._restTimeMonthComboBox=new n.ComboBox({Items:o,ModeView:this._ModeView,SelectionChanged:new a.Delegate(this,this._onRestTimeMonthChanged),ParentNode:this._nodeRestTimeMonth});var i=[],r=(new Date).getFullYear();this._restTimeYear=r;for(var s=r;s>r-e.YEAR_COUNT;s--)i.push({Content:s,Id:s,Index:s});this._restTimeYearComboBox=new n.ComboBox({Items:i,ModeView:this._ModeView,SelectionChanged:new a.Delegate(this,this._onRestTimeYearChanged),ParentNode:this._nodeRestTimeYear}),(0,l.addEvent)(this._nodeSendButton,"click",this._onSendReview)},e.prototype.update=function(e){t.prototype.update.call(this,e),(0,l.hide)(this._nodeWaiter),(0,l.hide)(this._nodeResultSend);var o=e.HotelTitleSettings;if((0,l.isDefined)(o))return void this._updateControl();(0,l.hide)(this._nodeReviewForm)},e.prototype.destroy=function(){(0,l.removeEvent)(this._nodeSendButton,"click",this._onSendReview),t.prototype.destroy.call(this)},e.prototype._updateControl=function(){this._hotelTitleControl.update(this._HotelTitleSettings),this._starsControl.update({Selected:this._rating}),(0,l.show)(this._nodeReviewForm)},e.prototype._onStarsChanged=function(t){this._rating=t.Selected},e.prototype._onRestTimeMonthChanged=function(t){this._restTimeMonth=t.Item.Id},e.prototype._onRestTimeYearChanged=function(t){this._restTimeYear=t.Item.Id},e.prototype._onSendReview=function(){(0,l.hide)(this._nodeReviewForm),(0,l.show)(this._nodeWaiter);var t={action:"submitreview",review:this._nodeReview.value,month:this._restTimeMonth+1,year:this._restTimeYear,name:this._nodeName.value,stars:this._rating,hotcode:this._HotelId},e=(0,l.newFormData)(t);r.corsNative.update({Url:u.CoreLinks.AddReview}),r.corsNative.send(e,new a.Delegate(this,this._afterSend))},e.prototype._afterSend=function(){(0,l.hide)(this._nodeWaiter),(0,l.show)(this._nodeResultSend)},e.YEAR_COUNT=5,e}(s.Control);e.CreateHotelReviewControl=y,t.CreateHotelReviewControl=y}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__awaiter||function(t,e,o,i){function r(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,n){function s(t){try{l(i.next(t))}catch(t){n(t)}}function a(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){t.done?o(t.value):r(t.value).then(s,a)}l((i=i.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){function o(t){return function(e){return i([t,e])}}function i(o){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,n=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){l.label=o[1];break}if(6===o[0]&&l.label<s[1]){l.label=s[1],s=o;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(o);break}s[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(t,l)}catch(t){o=[6,t],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var r,n,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(e,"__esModule",{value:!0}),e.reviewDataService=e.ReviewDataService=void 0;var n=o(218),s=o(912),a=function(){function t(){this._cashedPromises={}}return t.prototype.getHotelReviewsById=function(t){return void 0===t&&(t={}),i(this,void 0,void 0,function(){var e;return r(this,function(o){return e=n.serviceUtils.getHash(t),this._cashedPromises[e]||(this._cashedPromises[e]=s.reviewService.query(t)),[2,this._cashedPromises[e]]})})},t.prototype.getReviewById=function(t){return i(this,void 0,void 0,function(){return r(this,function(e){return this._cashedPromises[t]||(this._cashedPromises[t]=s.reviewService.read(t)),[2,this._cashedPromises[t]]})})},t}();e.ReviewDataService=a,e.reviewDataService=new a,t.reviewDataService=e.reviewDataService,t.ReviewDataService=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelReviewItemControl=void 0;var r=o(12),n=o(2),s=o(3),a=o(1),l=o(35),u=function(t){function e(e){var o=t.call(this,e)||this;return o.Clicked=new s.UserEvent,o._Class="TVHotelReviewItemControl",o._Content="",o._ExpandEnable=!1,o._Id=0,o._IsEnabled=!0,o._Name="",o._NegativeReview="",o._PositiveReview="",o._Rating=0,o._hasExpandableContent=!1,t.prototype.__initSettings.call(o,e),o._onClickReview=o._onClickReview.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var o=(0,a.newDiv)("TVReviewTitleContainer",this._DomNode);if(this._Name.length>0){var i=(0,l.createDomElement)("div",{className:"TVReviewName"},this._Name);o.appendChild(i)}if(0!==this._Rating)for(var n=(0,a.newDiv)("TVReviewRate",o),s=(0,a.newDiv)("TVReviewStar TVStarEnable",n),u=1;u<e.REVIEW_STARS_COUNT;u+=1){var c=s.cloneNode();n.appendChild(c),u<this._Rating||(0,a.removeClass)(c,"TVStarEnable")}if(this._reviewContent=(0,a.newDiv)("TVReviewContent",this._DomNode),this._reviewContent.innerHTML=(0,r.sanitizeHTML)(this._Content),this._PositiveReview.length>0){(0,a.newDiv)("TVReviewPositive",this._reviewContent).innerHTML=(0,r.sanitizeHTML)(this._PositiveReview)}if(this._NegativeReview.length>0){(0,a.newDiv)("TVReviewNegative",this._reviewContent).innerHTML=(0,r.sanitizeHTML)(this._NegativeReview)}this._hasExpandableContent=this._ExpandEnable&&(0,a.getTextHeight)(this._reviewContent.innerHTML,this._reviewContent,void 0,e.ITEM_WIDTH)>e.ITEM_MAX_HEIGHT,this._hasExpandableContent&&((0,a.addClass)(this._reviewContent,e.TV_REVIEW_ALL),this._readAll=(0,l.createDomElement)("div",{className:"TVReviewShowAll"},e.READ_ALL),(0,a.addEvent)(this._readAll,"click",this._onClickReview),this._DomNode.appendChild(this._readAll))},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&((0,a.removeChildren)(this._DomNode),this.render())},e.prototype.destroy=function(){this._hasExpandableContent&&(0,a.removeEvent)(this._readAll,"click",this._onClickReview),t.prototype.destroy.call(this)},e.prototype._onClickReview=function(){if(this._IsEnabled)return void this.Clicked.fire({ReviewId:this._Id});this._hasExpandableContent&&((0,a.removeClass)(this._reviewContent,e.TV_REVIEW_ALL),(0,a.hide)(this._readAll))},e.ITEM_WIDTH=890,e.ITEM_MAX_HEIGHT=145,e.REVIEW_STARS_COUNT=5,e.READ_ALL="читать отзыв полностью...",e.TV_REVIEW_ALL="TVReviewAll",e}(n.Control);e.HotelReviewItemControl=u,t.HotelReviewItemControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.unlistenOfferManagerSaved=e.listenOfferManagerSaved=e.unlistenOfferManagerHided=e.listenOfferManagerHided=e.updateHotOffer=e.hideHotOffer=e.showHotOffer=void 0;var i=function(e){t.hotOfferManager&&t.hotOfferManager.showOffer(e)};e.showHotOffer=i;var r=function(){t.hotOfferManager&&t.hotOfferManager.hideOffer()};e.hideHotOffer=r;var n=function(e){t.hotOfferManager&&t.hotOfferManager.update(e)};e.updateHotOffer=n;var s=function(e){t.hotOfferManager&&t.hotOfferManager.Hide.addOnce(e)};e.listenOfferManagerHided=s;var a=function(e){t.hotOfferManager&&t.hotOfferManager.Hide.remove(e)};e.unlistenOfferManagerHided=a;var l=function(e){t.hotOfferManager&&t.hotOfferManager.OfferSaved.addOnce(e)};e.listenOfferManagerSaved=l;var u=function(e){t.hotOfferManager&&t.hotOfferManager.OfferSaved.remove(e)};e.unlistenOfferManagerSaved=u,o.unlistenOfferManagerSaved=e.unlistenOfferManagerSaved,o.listenOfferManagerSaved=e.listenOfferManagerSaved,o.unlistenOfferManagerHided=e.unlistenOfferManagerHided,o.listenOfferManagerHided=e.listenOfferManagerHided,o.updateHotOffer=e.updateHotOffer,o.hideHotOffer=e.hideHotOffer,o.showHotOffer=e.showHotOffer}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardAction=void 0;var o;!function(t){t.ADDHOTOFFER="AddHotOffer",t.BOOKING="Booking",t.SHARE="Share",t.SEARCHLINK="SearchLink",t.OPERATORLINK="OperatorLink",t.SENDERROR="SendError"}(o=e.TourCardAction||(e.TourCardAction={})),t.TourCardAction=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.IconType=void 0;var o;!function(t){t[t.NONE=0]="NONE",t[t.MAP_MARKER=1]="MAP_MARKER",t[t.CALENDAR=2]="CALENDAR",t[t.MEAL=3]="MEAL",t[t.BED=4]="BED",t[t.GEAR=5]="GEAR",t[t.INFO=6]="INFO",t[t.HOME=7]="HOME",t[t.USERS=8]="USERS",t[t.SEATS=9]="SEATS"}(o=e.IconType||(e.IconType={})),t.IconType=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.FlightDetailListControl=void 0;var n=o(2),s=o(1),a=o(920),l="TVFlightDetailListControl",u=function(t){function e(e){var o=t.call(this,e)||this;return o._Class=l,o._Items=[],o._flightDetails=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){this._clear(),t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this),this._renderItems()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Items;(0,s.isDefined)(o)&&(this._clear(),this._renderItems())},e.prototype._clear=function(){this._flightDetails.forEach(function(t){t.destroy()}),this._flightDetails=[],(0,s.removeChildren)(this._DomNode)},e.prototype._createFlightDetail=function(t){return new a.FlightDetailControl(r(r({},t),{ParentNode:this._DomNode}))},e.prototype._renderItems=function(){var t=this;this._Items.forEach(function(e){var o=e.ConnectionDuration;if((0,s.isDefined)(o))return void t._renderConnectionDuration(o);var i=t._createFlightDetail(e);t._flightDetails.push(i)})},e.prototype._renderConnectionDuration=function(t){(0,s.newDiv)("TVFlightDetailDurationTime",this._DomNode).textContent=t},e}(n.Control);e.FlightDetailListControl=u,t.FlightDetailListControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardOptionsControl=void 0;var n=o(2),s=o(1),a=o(923),l=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVTourCardOptionsControl",o._Items=[],o._options=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderOptions(this._Items,this._DomNode)},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsVisiblePreview,i=e.Items;(0,s.isDefined)(o)&&this._updatePreview(),(0,s.isDefined)(i)&&this._redrawOptions()},e.prototype._renderOptions=function(t,e){var o=this;if(Array.isArray(t))return void t.forEach(function(t){var i=Array.isArray(t)?(0,s.newDiv)("TVTourCardOptionsWrapper",e):e;o._renderOptions(t,i)});var i=new a.TourCardOptionControl(r({},t));e.appendChild(i.getDomNode()),this._options.push(i)},e.prototype._removeOptions=function(){this._options.forEach(function(t){return t.destroy()}),this._options=[],(0,s.removeChildren)(this._DomNode)},e.prototype._redrawOptions=function(){this._removeOptions(),(this._Items||0!==this._Items.length)&&this._renderOptions(this._Items,this._DomNode)},e.prototype._updatePreview=function(){var t=this;this._options.forEach(function(e){e.update({IsVisiblePreview:t._IsVisiblePreview}),e.setIsVisible(t._IsVisiblePreview||e.getIsVisible())})},e}(n.Control);e.TourCardOptionsControl=l,t.TourCardOptionsControl=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.FlightSelectionList=void 0;var n=o(23),s=o(2),a=o(4),l=o(3),u=o(1),c=o(5),h=o(925),d=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new l.UserEvent,o._Currency=c.Currency.Rub,o._IsVisibleWaiter=!1,o._Items=[],o._ModeView=c.ModeView.DescTop,o._listItems=[],o._waiter=null,o.__initSettings(e),o.templateName=o._ModeView===c.ModeView.Mobile?"mobile-flight-selection-list":"flight-selection-list",o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsVisibleWaiter,i=e.Items;(0,u.isDefined)(i)&&this._updateItems(),(0,u.isDefined)(o)&&this._updateWaiterVisibility()},e.prototype.render=function(){t.prototype.render.call(this),this._renderItems()},e.prototype._renderItems=function(){var t=this,e=this._nodes.list,o=new a.Delegate(this,this._onSelectionChanged);this._listItems=this._Items.map(function(i){return new h.FlightSelectionControl(r(r({},i),{Currency:t._Currency,ModeView:t._ModeView,ParentNode:e,Selected:o}))})},e.prototype._clearItems=function(){this._listItems.forEach(function(t){return t.destroy()}),this._listItems=[]},e.prototype._updateItems=function(){this._clearItems(),this._renderItems()},e.prototype._updateWaiterVisibility=function(){if(!this._waiter){var t=this._nodes.list;this._waiter=new n.Waiter({IsRelative:!0,ParentNode:t})}this._IsVisibleWaiter?this._waiter.show():this._waiter.hide()},e.prototype._onSelectionChanged=function(t){this.Changed.fire(t)},e}(s.Control);e.FlightSelectionList=d,t.FlightSelectionList=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourFlightsListControl=void 0;var r=o(2),n=o(4),s=o(3),a=o(1),l=o(5),u=o(118),c=o(364),h=o(927),d=function(t){function e(e){var o=t.call(this,e)||this;return o.DetailClicked=new s.UserEvent,o.MoreButtonClicked=new s.UserEvent,o._FlightData=null,o._IsVisibleMoreButton=!0,o._ModeView=l.ModeView.DescTop,o._Regular=l.RegularTours.Off,o.__initSettings(e),o.templateName=o._ModeView===l.ModeView.Mobile?"mobile-tour-flight-list":"tour-flight-list",o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes.flights,o={Direction:c.FlightDirection.Forward};this._forwardTourFlightControl=new h.TourFlightControl({ModeView:this._ModeView,ParentNode:e,DetailClicked:new n.Delegate(this,this._onDetailClicked,o)});var i={Direction:c.FlightDirection.Reverse};this._reverseTourFlightControl=new h.TourFlightControl({Class:"TVTourFlightReverse",ModeView:this._ModeView,ParentNode:e,DetailClicked:new n.Delegate(this,this._onDetailClicked,i)}),this._updateFlights()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._updateFlights()},e.prototype._updateFlights=function(){var t,e=u.flightUtils.extractData(this._FlightData,c.FlightDirection.Forward,this._Regular),o=u.flightUtils.extractData(this._FlightData,c.FlightDirection.Reverse,this._Regular),i=this._nodes,r=i.moreButton,n=i.dummyFlight,s=i.unknownFlight,l=!this._IsVisiblePreview,h=l&&Boolean(null===(t=this._FlightData)||void 0===t?void 0:t.isDummy);(0,a.setVisible)(n,h);var d=Boolean(e),p=l&&!h&&d;this._forwardTourFlightControl.setIsVisible(p);var _=Boolean(o),f=l&&!h&&_;this._reverseTourFlightControl.setIsVisible(f);var y=l&&!(d&&_);(0,a.setVisible)(s,y);var g=l&&this._IsVisibleMoreButton&&(d||_);(0,a.setVisible)(r,g),d&&this._forwardTourFlightControl.update(e),_&&this._reverseTourFlightControl.update(o)},e.prototype._onDetailClicked=function(t){this.DetailClicked.fire(t)},e.prototype._onMoreButtonClick=function(){this.MoreButtonClicked.fire()},e}(r.Control);e.TourFlightsListControl=d,t.TourFlightsListControl=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.AgencyOrderViewMode=void 0;var o;!function(t){t[t.ACTIONS=0]="ACTIONS",t[t.BUY_ONLINE=1]="BUY_ONLINE",t[t.BUY_ONLINE_OFFICE=2]="BUY_ONLINE_OFFICE",t[t.REQUEST=3]="REQUEST"}(o=e.AgencyOrderViewMode||(e.AgencyOrderViewMode={})),t.AgencyOrderViewMode=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.AgencyOrderActionsControl=void 0;var r=o(2),n=o(3),s=o(1),a=o(5),l=o(8),u=o(306),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Clicked=new n.UserEvent,o._Actions=[],o._Class="TVAgencyOrderActionsControl",o._ModeView=a.ModeView.DescTop,o._actionNodes=[],t.prototype.__initSettings.call(o,e),o.templateName=o._ModeView===a.ModeView.DescTop?"agency-order-actions":"agency-order-actions-mobile",o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderActions()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Actions;(0,s.isDefined)(o)&&(this._clearActions(),this._renderActions())},e.prototype._clearActions=function(){this._actionNodes.forEach(function(t){(0,s.removeEvent)(t.node,"click",t.handle)}),this._actionNodes=[];var t=this._nodes.actionsNode;(0,s.removeChildren)(t)},e.prototype._renderActions=function(){var t=this,e=this._nodes.actionsNode;this._Actions.forEach(function(o){return t._renderAction(o,e)})},e.prototype._renderAction=function(t,e){var o,i=t.Action,r=t.IsEnabled,n=this._getActionClass(i),u=(0,s.newDiv)((0,s.classNames)("TVAgencyOrderAction",n),e),c=this._getActionButtonClass(i),h=(0,s.classNames)("TVAgencyOrderActionButton",c,(o={},o[l.TV_DISABLED]=!r,o)),d=(0,s.newDiv)(h,u);d.textContent=this._getButtonContent(i);var p=this._onActionClicked.bind(this,{Action:i});if(r&&(0,s.addEvent)(d,"click",p),this._actionNodes.push({action:i,node:d,handle:p}),this._ModeView!==a.ModeView.Mobile){(0,s.newDiv)("TVAgencyOrderActionDescription",u).textContent=this._getDescription(i)}},e.prototype._getActionClass=function(t){switch(t){case u.AgencyOrderAction.BUY_ONLINE:return"TVAgencyOrderBuyOnline";case u.AgencyOrderAction.REQUEST:return"TVAgencyOrderRequest";default:return""}},e.prototype._getActionButtonClass=function(t){switch(t){case u.AgencyOrderAction.BUY_ONLINE:return"TVAgencyOrderActionGreen";case u.AgencyOrderAction.REQUEST:default:return""}},e.prototype._getButtonContent=function(t){switch(t){case u.AgencyOrderAction.BUY_ONLINE:return"Купить онлайн";case u.AgencyOrderAction.REQUEST:return this._ModeView===a.ModeView.Mobile?"Отправить запрос":"Купить в офисе";default:return""}},e.prototype._getDescription=function(t){switch(t){case u.AgencyOrderAction.BUY_ONLINE:return"Купить тур онлайн у представителя туроператора или в одном из надежных онлайн турагентств";case u.AgencyOrderAction.REQUEST:return"Выберите офис, менеджер агентства свяжется с вами для консультации и обсуждения деталей покупки тура";default:return""}},e.prototype._onActionClicked=function(t){this.Clicked.fire(t)},e}(r.Control);e.AgencyOrderActionsControl=c,t.AgencyOrderActionsControl=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),n=this&&this.__awaiter||function(t,e,o,i){function r(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,n){function s(t){try{l(i.next(t))}catch(t){n(t)}}function a(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){t.done?o(t.value):r(t.value).then(s,a)}l((i=i.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){function o(t){return function(e){return i([t,e])}}function i(o){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,n=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){l.label=o[1];break}if(6===o[0]&&l.label<s[1]){l.label=s[1],s=o;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(o);break}s[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(t,l)}catch(t){o=[6,t],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var r,n,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(e,"__esModule",{value:!0}),e.TourBuyFromAgencyOfficeControl=void 0;var a=o(34),l=o(2),u=o(4),c=o(1),h=o(30),d=o(5),p=o(425),_=o(307),f=o(224),y=o(277),g=o(282),C=o(73),v=o(25),m=o(8),T=o(85),w=function(e){function o(t){var o=e.call(this,t)||this;return o.templateName="tour-buy-from-agency-office",o._Class="TVTourBuyFromAgencyOfficeControl",o._ModeView=d.ModeView.DescTop,o._ShortTourId=0,o._multiOffice=null,o._linkButton=null,o._selectedOfficeId=0,e.prototype.__initSettings.call(o,t),o._Render&&o.render(),o}return r(o,e),o.prototype.render=function(){e.prototype.render.call(this),this._renderMultiOffice(),this._updateInfoTitle(),this._updatуInfoTitleVisibility(),this._updateInfoSubtitle(),this._renderLinkButton(),this._updateAgencyLinkVisibility(),this._updateAgencyLinkModeViewClass()},o.prototype.update=function(t){e.prototype.update.call(this,t)},o.prototype.show=function(){return n(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this._rendered||this.render(),[4,this._showMultiOffice()];case 1:return t.sent(),this._updateSelectedOffice(),this._updateAgencyLinkVisibility(),[2]}})})},o.prototype._renderMultiOffice=function(){var t=this._nodes.officeNode;this._multiOffice=new g.MultiOfficeManager({ExpandedTitle:"",Mode:y.MultiOfficeModeEnum.WHEREBUY_ONLINE,ModeView:this._ModeView,Subtitle:"Специалисты выбранного агентства забронируют тур, выдадут документы и проконсультируют перед поездкой",Title:"Выберите турагентство для покупки тура",ParentNode:t,OfficeSelected:new u.Delegate(this,this._onOfficeSelected)})},o.prototype._renderLinkButton=function(){var t=this._nodes.linkButtonNode;this._linkButton=new T.ButtonWaiter({Class:(0,c.classNames)(m.TV_BUTTON_HOVER),Content:"Купить тур на сайте агентства",ParentNode:t,Click:new u.Delegate(this,this._onLinkClicked)})},o.prototype._showMultiOffice=function(){return this._multiOffice||this._renderMultiOffice(),this._multiOffice.show()},o.prototype._resetSelectedOffice=function(){var t=v.settingUtils.getUserData();t.SelectedOfficeId=0,v.settingUtils.setUserData(t)},o.prototype._onOfficeSelected=function(t){this._updateSelectedOffice(),this._updateAgencyLinkVisibility()},o.prototype._onLinkClicked=function(){var e=this._getAgencyLink();if(!Boolean(e))return void(0,p.showTourRedirection)({ModeView:this._ModeView,ViewMode:f.TourRedirectionViewModeEnum.ERROR,ErrorClicked:new u.Delegate(this,this._onErrorRedirectClicked)});var o=_.tourRedirectionUtils.getLink({IsRedirect:!0,OfficeId:this._selectedOfficeId,SearchLink:h.CoreLinks.TourvisorRedirect,TourId:this._ShortTourId});t.windowOpen(o,"_blank")},o.prototype._onErrorRedirectClicked=function(){(0,p.hideTourRedirection)(),this._resetSelectedOffice(),this.show()},o.prototype._updateInfoTitle=function(){this._nodes.infoTitleNode.textContent="Купить тур онлайн"},o.prototype._updatуInfoTitleVisibility=function(){var t=this._nodes.infoTitleNode;(0,c.setVisible)(t,this._ModeView!==d.ModeView.Mobile)},o.prototype._updateInfoSubtitle=function(){this._nodes.infoSubtitleNode.textContent="Бронирование и оплата тура производятся на сайте выбранного агентства. Нажмите на кнопку, чтобы перейти к бронированию"},o.prototype._updateSelectedOffice=function(){this._selectedOfficeId=this._multiOffice?this._multiOffice.getSelectedOffice():0},o.prototype._updateAgencyLinkVisibility=function(){var t=this._nodes.linkNode;(0,c.setVisible)(t,this._selectedOfficeId>0)},o.prototype._updateAgencyLinkModeViewClass=function(){var t=this._nodes.linkNode;(0,c.updateClass)(t,m.TV_MOBILE,this._ModeView===d.ModeView.Mobile)},o.prototype._getAgencyLink=function(){var t=this._getSelectedOfficeData();return C.officeUtils.getOfficeSearchLink(t)},o.prototype._getSelectedOfficeData=function(){var t=a.clientCatalog.getOfficeData(),e=C.officeUtils.getOffices(t);return C.officeUtils.getOfficeById(e,this._selectedOfficeId)},o}(l.Control);e.TourBuyFromAgencyOfficeControl=w,i.TourBuyFromAgencyOfficeControl=w}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourBuyFromAgencyControl=void 0;var r=o(2),n=o(4),s=o(3),a=o(1),l=o(30),u=o(5),c=o(307),h=o(235),d=o(16),p=o(931),_=function(t){function e(e){var o=t.call(this,e)||this;return o.ActionClicked=new s.UserEvent,o._Class="TVTourBuyFromAgency",o._ModeView=u.ModeView.DescTop,o._Items=[],o._ShortTourId=0,o._itemGroupHash=[],t.prototype.__initSettings.call(o,e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderItems()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Items,i=e.ShortTourId;((0,a.isDefined)(o)||(0,a.isDefined)(i))&&(this._clear(),this._renderItems())},e.prototype._clear=function(){this._itemGroupHash.forEach(function(t){return t.destroy()}),this._itemGroupHash=[]},e.prototype._renderItems=function(){var t=this;this._itemGroupHash=this._Items.map(function(e){var o=e.caption,i=void 0===o?"":o,r=t._getItems(e),n=t._getSubtitle(e);return new p.TourBuyFromAgencyGroup({Items:r,ParentNode:t._DomNode,Subtitle:n,Title:i})})},e.prototype._getItems=function(t){var e=this,o=t.items;return(void 0===o?[]:o).map(function(t){var o=t.action,i=t.logo,r=void 0===i?"":i,s=t.title,a=void 0===s?"":s,l=e._getLink(t);return{Action:o,Detail:e._getDetail(t),Link:l,Logo:r,Name:a,PaddingSize:e._getPaddingSize(),ActionClicked:new n.Delegate(e,e._onActionClicked)}})},e.prototype._getLink=function(t){var e=t.action,o=t.link,i=void 0===o?"":o,r=t.officeid,n=void 0===r?0:r;if(!i)return"";switch(e){case h.OnlinePartnerActionEnum.REDIRECT:return c.tourRedirectionUtils.getLink({IsRedirect:!0,OfficeId:n,SearchLink:l.CoreLinks.TourvisorRedirect,TourId:this._ShortTourId});case h.OnlinePartnerActionEnum.DIRECT:default:return i}},e.prototype._getDetail=function(t){var e=t.detail,o=void 0===e?"":e;return this._ModeView===u.ModeView.DescTop?o:""},e.prototype._getSubtitle=function(t){var e=t.detail,o=void 0===e?"":e;return this._ModeView===u.ModeView.Mobile?o:""},e.prototype._getPaddingSize=function(){return this._ModeView===u.ModeView.Mobile?d.SizeEnum.S:d.SizeEnum.M},e.prototype._onActionClicked=function(t){this.ActionClicked.fire(t)},e}(r.Control);e.TourBuyFromAgencyControl=_,t.TourBuyFromAgencyControl=_}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CustomerContactsForm=void 0;var r=o(228),n=o(2),s=o(4),a=o(3),l=o(7),u=o(1),c=o(5),h=o(435),d=o(8),p=o(193),_=o(936),f=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new a.UserEvent,o.ContractClicked=new a.UserEvent,o.PromocodeChanged=new a.UserEvent,o._Class="TVCustomerContactsForm",o._FormRequiredFields=c.FormRequiredFieldsType.PhoneOrEmail,o._IsEnabledPromocode=!1,o._IsRequiredAddress=!0,o._IsVisibleContract=!1,o._Price=0,o._TourId=0,o._TourPrice=0,o._Value={NAME:"",PHONE:"",EMAIL:"",ADDRESS:"",Comment:""},o._UserInputFields=[p.UserInputType.NAME,p.UserInputType.PHONE,p.UserInputType.EMAIL,p.UserInputType.ADDRESS],o._UserInputLabels={ADDRESS:l.ADDRESS_LABEL,EMAIL:l.EMAIL_LABEL,NAME:l.FULL_NAME_LABEL,PHONE:l.MOBILE_PHONE_LABEL},o._inputsHash=[],o._isValid=!1,o._isVisibleCommentInput=!1,o._isVisiblePromocodeControl=!1,t.prototype.__initSettings.call(o,e),o._onCommentBlur=o._onCommentBlur.bind(o),o._onCommentBtnClicked=o._onCommentBtnClicked.bind(o),o._onContractClicked=o._onContractClicked.bind(o),o._onPromocodeBtnClicked=o._onPromocodeBtnClicked.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){this._clear(),t.prototype.destroy.call(this)},e.prototype.scrollToInvalid=function(){var t=this._findInvalidInput();if(t){var o=(0,u.cumulativeOffset)(t.getDomNode());(0,u.scrollToTop)(l.SCROLL_DURATION_S,o.top-e.SCROLL_TOP)}},e.prototype.render=function(){t.prototype.render.call(this),this._renderInputs(),this._renderButtons(),this._setVisibleButtons(),this._renderComment()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsRequiredAddress,i=e.IsEnabledPromocode,r=e.TourId,n=e.TourPrice,s=e.Value;if((0,u.isDefined)(r)&&(this._promocodeControl&&(this._promocodeControl.update({PromoCode:"",TourId:r}),this._isVisiblePromocodeControl=!1,this._updateVisiblePromocodeControl()),this._inputsHash.forEach(function(t){t.update({ClearValid:!0})})),(0,u.isDefined)(s)){this._inputsHash.forEach(function(t,e){var o=s[p.UserInputType[e]];t.update({ClearValid:!0,Value:o||""})});var a=(0,u.isDefined)(s.Comment)&&s.Comment||"";this._commentInput.value=a,this._isVisibleCommentInput=a.length>0,this._updateVisibleComment()}(0,u.isDefined)(i)&&this._setVisibleButtons(),(0,u.isDefined)(n)&&this._promocodeControl&&this._promocodeControl.update({TourPrice:n}),(0,u.isDefined)(o)&&this._updateRequiredAddress()},e.prototype.validate=function(){return this._isValid=this._inputsHash.reduce(function(t,e){return e.validate()&&t},!0),this._isValid},e.prototype._clear=function(){(0,u.removeEvent)(this._commentBtn,"click",this._onCommentBtnClicked),(0,u.removeEvent)(this._promocodeBtn,"click",this._onPromocodeBtnClicked),(0,u.removeEvent)(this._contractBtn,"click",this._onContractClicked),(0,u.removeEvent)(this._commentInput,"blur",this._onCommentBlur),(0,u.removeChildren)(this._DomNode)},e.prototype._checkForm=function(){this._isValid=!this._inputsHash.some(function(t){return!t.getSettings().IsValid}),this.Changed.fire({IsValid:this._isValid,Value:this._Value})},e.prototype._checkInput=function(t){var e=t.Value,o=t.Type;if(e.toLowerCase()===l.TEST_HELP)return void this._fillInputs();var i=p.UserInputType[o];this._Value[i]=e,this._validateInput(t),this._checkForm()},e.prototype._fillInputs=function(){var t=this._inputsHash[p.UserInputType.NAME],e=this._inputsHash[p.UserInputType.PHONE],o=this._inputsHash[p.UserInputType.EMAIL],i=this._inputsHash[p.UserInputType.ADDRESS];if(t){var r=l.TEST_SURNAME+" "+l.TEST_NAME;t.update({Value:r}),this._Value.NAME=r}e&&(e.update({Value:l.TEST_PHONE}),this._Value.PHONE=l.TEST_PHONE),o&&(o.update({Value:l.TEST_MAIL}),this._Value.EMAIL=l.TEST_MAIL),i&&(i.update({Value:l.TEST_ADDRESS}),this._Value.ADDRESS=l.TEST_ADDRESS),this._checkForm()},e.prototype._findInvalidInput=function(){for(var t=0;t<this._inputsHash.length;t+=1){var e=this._inputsHash[t];if(!e.getSettings().IsValid)return e}},e.prototype._onCommentBlur=function(){this._Value.Comment=this._commentInput.value,this.Changed.fire({IsValid:this._isValid,Value:this._Value})},e.prototype._onCommentBtnClicked=function(){this._isVisibleCommentInput=!this._isVisibleCommentInput,this._updateVisibleComment(),this._commentInput.focus()},e.prototype._onContractClicked=function(){this.ContractClicked.fire()},e.prototype._onPromocodeChanged=function(t){this.PromocodeChanged.fire(t)},e.prototype._onPromocodeBtnClicked=function(){if(this._IsEnabledPromocode){this._promocodeControl||this._renderPromocode();var t=this._promocodeControl.getDomNode();if(this._isVisiblePromocodeControl=!this._isVisiblePromocodeControl,this._updateVisiblePromocodeControl(),this._isVisiblePromocodeControl){var e=(0,u.getViewPort)();if((0,u.getCoords)(t).bottom>e.y){t.scrollIntoView(!1)}}}},e.prototype._renderButtons=function(){this._buttonsContainer=(0,u.newDiv)("TVUserFormButtons",this._DomNode),this._commentBtn=(0,u.newDiv)("TVUserFormComment TVButtonHover",this._buttonsContainer),this._promocodeBtn=(0,u.newDiv)("TVUserFormPromocode TVButtonHover",this._buttonsContainer),this._contractBtn=(0,u.newDiv)("TVUserFormContract",this._buttonsContainer),(0,u.addEvent)(this._commentBtn,"click",this._onCommentBtnClicked),(0,u.addEvent)(this._promocodeBtn,"click",this._onPromocodeBtnClicked),(0,u.addEvent)(this._contractBtn,"click",this._onContractClicked)},e.prototype._renderInputs=function(){var t=this;this._inputsContainer=(0,u.newDiv)("TVUserFormInputs",this._DomNode),this._inputsHash=this._UserInputFields.map(function(e){var o=p.UserInputType[e];return new r.InputPro({Class:"TV"+o,IsAnimateFixedLabel:!0,Label:t._UserInputLabels[o],ParentNode:t._inputsContainer,Value:t._Value[o],Blur:new s.Delegate(t,t._checkInput,{Type:p.UserInputType[o]}),Validating:new s.Delegate(t,t._validateInput,{Type:p.UserInputType[o]})})})},e.prototype._renderComment=function(){this._commentInput=(0,u.newDomNode)("textarea","TVComment TVInputPro TVHide"),this._commentInput.placeholder=l.COMMENT_LABEL,(0,u.addEvent)(this._commentInput,"blur",this._onCommentBlur),this._inputsContainer.appendChild(this._commentInput)},e.prototype._renderPromocode=function(){this._promocodeControl=new _.Promocode({ParentNode:this._buttonsContainer,TourId:this._TourId,TourPrice:this._TourPrice,Changed:new s.Delegate(this,this._onPromocodeChanged)})},e.prototype._setVisibleButtons=function(){(0,u.setVisible)(this._promocodeBtn,this._IsEnabledPromocode),(0,u.setVisible)(this._contractBtn,this._IsVisibleContract)},e.prototype._updateRequiredAddress=function(){var t=this._inputsHash.find(function(t,e){return e===p.UserInputType.ADDRESS});t&&t.update({CheckValid:this._IsRequiredAddress})},e.prototype._updateVisibleComment=function(){(0,u.setVisible)(this._commentInput,this._isVisibleCommentInput),(0,u.updateClass)(this._commentBtn,d.TV_ACTIVE,this._isVisibleCommentInput)},e.prototype._updateVisiblePromocodeControl=function(){(0,u.setVisible)(this._promocodeControl,this._isVisiblePromocodeControl),(0,u.updateClass)(this._promocodeBtn,d.TV_ACTIVE,this._isVisiblePromocodeControl)},e.prototype._validateInput=function(t){var e=t.Type;if(e===p.UserInputType.PHONE||e===p.UserInputType.EMAIL)switch(this._FormRequiredFields){case c.FormRequiredFieldsType.PhoneAndEmail:break;case c.FormRequiredFieldsType.PhoneOnly:this._inputsHash[p.UserInputType.EMAIL].update({IsValid:!0});break;case c.FormRequiredFieldsType.EmailOnly:this._inputsHash[p.UserInputType.PHONE].update({IsValid:!0});break;case c.FormRequiredFieldsType.PhoneOrEmail:var o=this._inputsHash[p.UserInputType.PHONE],i=this._inputsHash[p.UserInputType.EMAIL],r=h.validationUtils.getIsValidPhone(o.getSettings().Value),n=h.validationUtils.getIsValidEmail(i.getSettings().Value),s=r||n;o.update({IsValid:s}),i.update({IsValid:s}),i.getSettings().Value.length>0&&!n&&i.update({IsValid:n})}},e.SCROLL_TOP=70,e}(n.Control);e.CustomerContactsForm=f,t.CustomerContactsForm=f}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourBuyCustomerButtonsControl=void 0;var r=o(2),n=o(4),s=o(1),a=o(5),l=o(6),u=o(939),c=o(941),h=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVTourCustomerButtonsControl",o._Currency=a.Currency.Rub,o._IsEnableBuy=!1,o._IsVisiblePrePayment=!1,o._IsVisibleWaiter=!1,o._ModeView=a.ModeView.DescTop,o._PrePaymentTypes=[],o._Price=0,o._Reset=!1,o._BuyClicked=null,o._PrePaymentChanged=null,o._ContractClicked=null,o._sendingControl=null,o._prePaymentControl=null,o._isCheckedAgree=!1,t.prototype.__initSettings.call(o,e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderPrePayment(),this._renderSending()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Currency,i=e.IsVisiblePrePayment,r=e.IsEnableBuy,n=e.Price,a=e.PrePaymentTypes,l=e.Reset,u=e.IsVisibleWaiter;(0,s.isDefined)(i)&&(this._renderPrePayment(),this._updateVisiblePrePayment()),(0,s.isDefined)(r)&&this._updateEnableBuyButton(),(0,s.isDefined)(a)&&(this._updatePrePaymentTypes(),this._updateVisiblePrePayment()),(0,s.isDefined)(n)&&this._updatePrice(),(0,s.isDefined)(o)&&this._updateCurrency(),(0,s.isDefined)(l)&&this._reset(),(0,s.isDefined)(u)&&this._updateVisibleWaiter()},e.prototype.validate=function(){return this._sendingControl.update({IsValidAgree:this._isCheckedAgree}),this._isCheckedAgree},e.prototype.destroy=function(){this._BuyClicked=null,this._PrePaymentChanged=null,this._ContractClicked=null,t.prototype.destroy.call(this)},e.prototype._renderPrePayment=function(){this._IsVisiblePrePayment&&!this._prePaymentControl&&(this._prePaymentControl=new u.PrePaymentControl({IsVisible:!1,ParentNode:this._DomNode,PriceValue:this._Price,Changed:this._PrePaymentChanged}))},e.prototype._renderSending=function(){this._sendingControl=new c.TourBuySendingControl({IsCheckedAgree:this._isCheckedAgree,IsEnableBuy:this._IsEnableBuy,ModeView:this._ModeView,ParentNode:this._DomNode,AgreeChecked:new n.Delegate(this,this._onAgreeChecked),BuyClicked:this._BuyClicked,ContractClicked:this._ContractClicked})},e.prototype._reset=function(){this._isCheckedAgree=!1,this._sendingControl.update({IsCheckedAgree:this._isCheckedAgree,IsValidAgree:!0,IsVisibleWaiter:!1})},e.prototype._onAgreeChecked=function(t){var e=t.IsChecked;this._isCheckedAgree=e,this._sendingControl.update({IsCheckedAgree:this._isCheckedAgree,IsValidAgree:!0})},e.prototype._updatePrePaymentTypes=function(){this._prePaymentControl&&this._prePaymentControl.update({PaymentTypes:this._PrePaymentTypes})},e.prototype._updatePrice=function(){this._prePaymentControl&&this._prePaymentControl.update({PriceValue:this._Price})},e.prototype._updateCurrency=function(){this._prePaymentControl&&this._prePaymentControl.update({Currency:(0,l.getCurrencyValue)(this._Currency)})},e.prototype._updateEnableBuyButton=function(){this._sendingControl.update({IsEnableBuy:this._IsEnableBuy})},e.prototype._updateVisiblePrePayment=function(){var t=this._IsVisiblePrePayment&&this._PrePaymentTypes.length>1;(0,s.setVisible)(this._prePaymentControl,t)},e.prototype._updateVisibleWaiter=function(){this._sendingControl.update({IsVisibleWaiter:this._IsVisibleWaiter})},e}(r.Control);e.TourBuyCustomerButtonsControl=h,t.TourBuyCustomerButtonsControl=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.ExportCrmCallbackType=void 0;var o;!function(t){t[t.BUY=0]="BUY",t[t.REQUEST=1]="REQUEST"}(o=e.ExportCrmCallbackType||(e.ExportCrmCallbackType={})),t.ExportCrmCallbackType=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.ManagerOrderViewMode=void 0;var o;!function(t){t[t.ACTIONS=0]="ACTIONS",t[t.CREATE_CONTRACT=1]="CREATE_CONTRACT",t[t.BOOKING=2]="BOOKING",t[t.OPERATOR_BOOKING=3]="OPERATOR_BOOKING"}(o=e.ManagerOrderViewMode||(e.ManagerOrderViewMode={})),t.ManagerOrderViewMode=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ManagerOrderActionsControl=void 0;var r=o(2),n=o(4),s=o(3),a=o(1),l=o(5),u=o(35),c=o(8),h=o(237),d=o(85),p=function(t){function e(e){var o=t.call(this,e)||this;return o.Clicked=new s.UserEvent,o._Class="TVManagerOrderActionsControl",o._CrmError="",o._CrmName=l.ExportCrmName.NONE,o._CrmStatus=l.ExportCrmStatus.DISABLE,o._CrmUrl="",o._IsEnableBooking=!0,o._IsEnableCreateContract=!0,o._IsVisibleBooking=!0,o._IsVisibleCreateContract=!0,o._IsVisibleCrm=!0,o._IsVisibleOperatorBooking=!0,o._IsVisibleOperatorLink=!0,o._ModeView=l.ModeView.DescTop,o._OperatorLink={href:""},o._TourLink={href:""},o._crmButton=null,t.prototype.__initSettings.call(o,e),o.templateName=o._ModeView===l.ModeView.DescTop?"manager-order-actions":"manager-order-actions-mobile",o._onBookingClick=o._onActionClicked.bind(o,{Action:h.ManagerOrderAction.BOOKING}),o._onCreateContractClick=o._onActionClicked.bind(o,{Action:h.ManagerOrderAction.CREATE_CONTRACT}),o._onOperatorLinkClick=o._onActionClicked.bind(o,{Action:h.ManagerOrderAction.OPEN_TO}),o._onOperatorBookingClick=o._onActionClicked.bind(o,{Action:h.ManagerOrderAction.OPERATOR_BOOKING}),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderExportCrmButton(),this._updateVisibleCreateContract(),this._updateVisibleDomNode()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.CrmError,i=e.CrmName,r=e.CrmStatus,n=e.CrmUrl,s=e.IsEnableBooking,l=e.IsEnableCreateContract,u=e.IsVisibleBooking,c=e.IsVisibleCreateContract,h=e.IsVisibleCrm,d=e.IsVisibleOperatorBooking,p=e.IsVisibleOperatorLink,_=e.OperatorLink;(0,a.isDefined)(c)&&this._updateVisibleCreateContract(),(0,a.isDefined)(l)&&this._updateEnableCreateContract(),(0,a.isDefined)(s)&&this._updateEnableBooking(),(0,a.isDefined)(u)&&this._updateVisibleBooking(),((0,a.isDefined)(_)||(0,a.isDefined)(p))&&this._updateVisibleOperatorLink(),(0,a.isDefined)(d)&&this._updateVisibleOperatorBooking(),(0,a.isDefined)(h)&&this._updateVisibleCrm(),(0,a.isDefined)(i)&&(this._updateCrmName(),this._updateVisibleCrm()),(0,a.isDefined)(n)&&(this._crmButton.update({WaiterVisible:!1}),this._updateCrmUrl()),(0,a.isDefined)(o)&&this._updateCrmError(),(0,a.isDefined)(r)&&this._updateEnableCrmButton(),this._updateVisibleDomNode()},e.prototype._renderExportCrmButton=function(){this._crmButton=new d.ButtonWaiter({Content:(0,a.newSpan)().outerHTML,DomNode:this._nodes.crmLink,Click:new n.Delegate(this,this._onCrmClicked)})},e.prototype._onActionClicked=function(t){(t.Action!==h.ManagerOrderAction.CREATE_CONTRACT||this._IsVisibleCreateContract)&&this.Clicked.fire(t)},e.prototype._onCrmClicked=function(t){if(!(this._CrmUrl.length>0)){var e=t.Event;(0,a.preventDefault)(e),this._crmButton.update({WaiterVisible:!0}),(0,a.removeClass)(this._crmButton,c.TV_CRM_EXPORT_ERROR);var o={Action:h.ManagerOrderAction.EXPORT_CRM};this.Clicked.fire(o)}},e.prototype._updateVisibleCrm=function(){var t=this._nodes.crmAction;(0,a.setVisible)(t,this._IsVisibleCrm&&this._CrmName!==l.ExportCrmName.NONE)},e.prototype._updateCrmName=function(){var t=this._nodes.crmAction;(0,a.updateClass)(t,c.TV_CRM_UON,this._CrmName===l.ExportCrmName.UON),(0,a.updateClass)(t,c.TV_CRM_MY_DOCUMENTS,this._CrmName===l.ExportCrmName.MY_DOCUMENTS)},e.prototype._updateCrmUrl=function(){var t,e=(null===(t=this._CrmUrl)||void 0===t?void 0:t.length)>0;this._crmButton.update({Link:e?this._CrmUrl:""}),(0,a.updateClass)(this._crmButton,c.TV_CRM_EXPORT_LINK,e)},e.prototype._updateEnableCreateContract=function(){var t=this._nodes.createContract;(0,a.updateClass)(t,c.TV_DISABLED,!this._IsEnableCreateContract)},e.prototype._updateEnableBooking=function(){var t=this._nodes.booking;t&&(0,a.updateClass)(t,c.TV_DISABLED,!this._IsEnableBooking)},e.prototype._updateEnableCrmButton=function(){var t=this._CrmStatus===l.ExportCrmStatus.ENABLE;this._crmButton.update({IsEnabled:t})},e.prototype._updateCrmError=function(){var t,e=(null===(t=this._CrmError)||void 0===t?void 0:t.length)>0;(0,a.updateClass)(this._crmButton,c.TV_CRM_EXPORT_ERROR,e)},e.prototype._updateVisibleCreateContract=function(){var t=this._nodes.createContractAction;(0,a.setVisible)(t,this._IsVisibleCreateContract)},e.prototype._updateVisibleBooking=function(){var t=this._nodes.bookingAction;(0,a.setVisible)(t,this._IsVisibleBooking)},e.prototype._updateVisibleOperatorLink=function(){var t,e,o=this._nodes.operatorAction,i=this._IsVisibleOperatorLink&&(null===(e=null===(t=this._OperatorLink)||void 0===t?void 0:t.href)||void 0===e?void 0:e.length)>0;(0,a.setVisible)(o,i)},e.prototype._updateVisibleOperatorBooking=function(){var t=this._nodes.operatorBookingAction;(0,a.setVisible)(t,this._IsVisibleOperatorBooking)},e.prototype._updateVisibleDomNode=function(){var t=this._nodes.actions,e=(0,u.getChildNodes)(t),o=e.some(function(t){return(0,a.isVisible)(t)});this.setIsVisible(o)},e}(r.Control);e.ManagerOrderActionsControl=p,t.ManagerOrderActionsControl=p}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ContractPage=void 0;var r=o(36),n=o(1),s=o(466),a=function(t){function e(e){var o=t.call(this,e)||this;return o._LayoutClass="TVContractPage",o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ContractText,i=e.UserName,r=e.Tourists;((0,n.isDefined)(o)||(0,n.isDefined)(i)||(0,n.isDefined)(r))&&(this._hideWaiter(),this._contractControl.update({ContractText:o,Tourists:r,UserName:i}))},e.prototype._getContent=function(){return this._showWaiter(),this._contractControl||(this._contractControl=new s.ContractControl),this._contractControl},e.displayName="ContractPage",e}(r.Page);e.ContractPage=a,t.ContractPage=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.FlightSelectionListPage=void 0;var r=o(4),n=o(3),s=o(1),a=o(5),l=o(484),u=o(79),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new n.UserEvent,o._Currency=a.Currency.Rub,o._IsVisibleWaiter=!1,o._Items=[],o._LayoutClass="TVFlightSelectionListPage",o._flightList=null,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Currency,i=e.IsVisibleWaiter,r=e.Items;((0,s.isDefined)(o)||(0,s.isDefined)(r))&&this._updateFlightList(),(0,s.isDefined)(i)&&this._updateWaiterVisibility()},e.prototype._updateFlightList=function(){this._flightList.update({Currency:this._Currency,Items:this._Items})},e.prototype._updateWaiterVisibility=function(){this._flightList.update({IsVisibleWaiter:this._IsVisibleWaiter})},e.prototype._getContent=function(){return this._flightList||(this._flightList=new l.FlightSelectionList({Currency:this._Currency,Items:this._Items,ModeView:a.ModeView.Mobile,Changed:new r.Delegate(this,this._onChanged)})),this._flightList},e.prototype._onChanged=function(t){this.Changed.fire(t)},e.displayName="FlightSelectionListPage",e}(u.BaseOrderPage);e.FlightSelectionListPage=c,t.FlightSelectionListPage=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OperatorBookingPage=void 0;var r=o(4),n=o(3),s=o(7),a=o(1),l=o(5),u=o(22),c=o(236),h=o(309),d=o(193),p=o(72),_=o(79),f=function(t){function e(e){var o=t.call(this,e)||this;return o.SendRequest=new n.UserEvent,o._AddPayments=[],o._IncludePrices=[],o._LayoutClass="TVOperatorBookingPage",o._Price=0,o._PriceType=l.PriceType.ForRoom,o._SelectedFlight=null,o._TourId=null,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o=this._getContent();o&&o.update(e)},e.prototype._getContent=function(){return this._tourBuyForm||(this._tourBuyForm=new c.TourBuyControl({CrmName:l.ExportCrmName.NONE,CrmStatus:l.ExportCrmStatus.DISABLE,IncludePrices:this._IncludePrices,IsManager:u.authManager.isManager(),IsVisibleConfirmation:!1,IsVisibleContract:!1,ModeView:l.ModeView.Mobile,Price:this._Price,PriceType:this._PriceType,PromocodeEnabled:!1,TourBuyType:h.TourBuyTypeEnum.OPERATOR_BOOKING,UserInputFields:[d.UserInputType.NAME,d.UserInputType.PHONE,d.UserInputType.EMAIL],UserInputLabels:{ADDRESS:s.ADDRESS_LABEL,EMAIL:s.EMAIL_LABEL,NAME:s.AGENCY_NAME_LABEL,PHONE:s.PHONE_LABEL},SendingClicked:new r.Delegate(this,this._onSendingClicked,{Type:p.RequestType.OnlineRequest})})),this._tourBuyForm.update({IsManager:u.authManager.isManager(),TourId:this._TourId}),this._tourBuyForm},e.prototype._onSendingClicked=function(t){var e=t.UserData||{},o={AddPayments:this._AddPayments,Fly:this._SelectedFlight,IsMobile:!0,Manager:u.authManager.getId(!0),PayType:t.PayType,Price:t.Price,Tourists:t.Tourists,Type:t.Type,UserData:e,PromoCode:e.PromoCode,PromoDiscount:e.PromoDiscount,UserComment:e.UserComment,UserEmail:e.UserEmail,UserName:e.UserName,UserPhone:e.UserPhone};(0,a.isDefined)(t.CallBack)&&(o.CallBack=t.CallBack),(0,a.isDefined)(t.Prepay)&&(o.Prepay=t.Prepay),this.SendRequest.fire(o)},e.displayName="OperatorBookingPage",e}(_.BaseOrderPage);e.OperatorBookingPage=f,t.OperatorBookingPage=f}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OrderFromAgencyPage=void 0;var r=o(36),n=o(4),s=o(3),a=o(5),l=o(489),u=function(t){function e(e){var o=t.call(this,e)||this;return o.ActionClicked=new s.UserEvent,o._Items=[],o._LayoutClass="TVOrderFromAgencyPage",o._ShortTourId=0,o._tourBuyFromAgencyControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.show=function(){t.prototype.show.call(this),this._tourBuyFromAgencyControl&&this._tourBuyFromAgencyControl.show()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._tourBuyFromAgencyControl&&this._tourBuyFromAgencyControl.update(e)},e.prototype._getContent=function(){return this._tourBuyFromAgencyControl||(this._tourBuyFromAgencyControl=new l.TourBuyFromAgencyControl({Items:this._Items,ModeView:a.ModeView.Mobile,ShortTourId:this._ShortTourId,ActionClicked:new n.Delegate(this,this._onActionClicked)})),this._tourBuyFromAgencyControl},e.prototype._onActionClicked=function(t){this.ActionClicked.fire(t)},e.displayName="OrderFromAgencyPage",e}(r.Page);e.OrderFromAgencyPage=u,t.OrderFromAgencyPage=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OrderCreatePage=void 0;var r=o(4),n=o(3),s=o(1),a=o(5),l=o(22),u=o(232),c=o(32),h=o(40),d=o(236),p=o(72),_=o(79),f=function(t){function e(e){var o=t.call(this,e)||this;return o.ContractClicked=new n.UserEvent,o.SendRequest=new n.UserEvent,o._ClientData=null,o._AddPayments=[],o._IncludePrices=[],o._IsVisibleConfirmation=!1,o._LayoutClass="TVOrderCreatePage",o._Price=0,o._PriceType=a.PriceType.ForRoom,o._SelectedFlight=null,o._TourId=null,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o=this._getContent();o&&o.update(e)},e.prototype._getContent=function(){var t=h.tourUtils.getManagerExportCrmName(this._ClientData),e=t===a.ExportCrmName.NONE?a.ExportCrmStatus.DISABLE:a.ExportCrmStatus.ENABLE;if(!this._tourBuyForm){var o=c.clientUtils.getPromocodeEnabled(this._ClientData);this._tourBuyForm=new d.TourBuyControl({CrmName:t,CrmStatus:e,IncludePrices:this._IncludePrices,IsManager:l.authManager.isManager(),IsVisibleConfirmation:this._IsVisibleConfirmation,ModeView:a.ModeView.Mobile,Price:this._Price,PriceType:this._PriceType,PromocodeEnabled:o,ContractClicked:new r.Delegate(this,this._onContractClicked),ExportCrmClicked:new r.Delegate(this,this._onExportCrmClicked),SendingClicked:new r.Delegate(this,this._onSendingClicked,{Type:p.RequestType.OnlineRequest})})}return this._tourBuyForm.update({CrmError:"",CrmName:t,CrmStatus:e,CrmUrl:"",IsManager:l.authManager.isManager(),TourId:this._TourId}),this._tourBuyForm},e.prototype._onContractClicked=function(){this.ContractClicked.fire()},e.prototype._onExportCrmClicked=function(t){t.Type=p.RequestType.ExportRequest,t.CallBack=new r.Delegate(this,this._updateCrmUrl),t.Manager=l.authManager.getId(!0),t.Fly=this._SelectedFlight,this.SendRequest.fire(t)},e.prototype._onSendingClicked=function(t){var e=t.UserData||{},o=h.tourUtils.isFromTourvisorTour(this._ClientData),i=u.fromTourvisorService.hasFlag(),r={AddPayments:this._AddPayments,Fly:this._SelectedFlight,IsMobile:!0,Manager:l.authManager.getId(!0),PayType:t.PayType,Price:t.Price,Tourists:t.Tourists,Type:t.Type,UserData:e,PromoCode:e.PromoCode,PromoDiscount:e.PromoDiscount};(0,s.isDefined)(t.CallBack)&&(r.CallBack=t.CallBack),(0,s.isDefined)(t.Prepay)&&(r.Prepay=t.Prepay),o?r.IsFromTourvisor=o:i&&(r.IsFromTourvisorCookie=i),this.SendRequest.fire(r)},e.prototype._updateCrmUrl=function(t){var e=t.CrmUrl,o=t.CrmError;this._tourBuyForm.update({CrmError:o,CrmUrl:e})},e.displayName="OrderCreatePage",e}(_.BaseOrderPage);e.OrderCreatePage=f,t.OrderCreatePage=f}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TourPage=void 0;var n=o(4),s=o(3),a=o(1),l=o(5),u=o(22),c=o(40),h=o(950),d=o(72),p=o(79),_=function(t){function e(e){var o=t.call(this,e)||this;return o.AddToCart=new s.UserEvent,o.HotelTabClicked=new s.UserEvent,o.RedirectLinkClicked=new s.UserEvent,o.SendRequest=new s.UserEvent,o.ShowBuy=new s.UserEvent,o.ShowFlightDetail=new s.UserEvent,o.ShowFlights=new s.UserEvent,o.ShowOperatorBooking=new s.UserEvent,o.ShowRequest=new s.UserEvent,o.ShowRoom=new s.UserEvent,o.ShowTrackPrice=new s.UserEvent,o.ShowVideo=new s.UserEvent,o.ShowWhereBuy=new s.UserEvent,o._Content=null,o._ClientData=null,o._IsEnabledAddToCart=!1,o._IsVisibleAddToCart=!1,o._IsVisibleBooking=!0,o._IsVisibleBuyOnline=!1,o._IsVisibleCreateContract=!0,o._IsVisibleCrm=!0,o._IsVisibleFavoriteHotels=!0,o._IsVisibleOperatorBooking=!0,o._IsVisibleOperatorLink=!0,o._IsVisibleRequest=!1,o._LayoutClass="TVTourPage",o._SelectedFlight=null,o._ShowOperator=l.Operator.Hide,o._TourId=0,o.__initSettings(e),o._init(),o.render(),o}return i(e,t),e.prototype.show=function(){t.prototype.show.call(this),this._Content.update({IsEnabledAddToCart:this._IsEnabledAddToCart}),this._layoutControl.update({ShowFavoriteHotels:this._IsVisibleFavoriteHotels})},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.HotelData;this._Content&&(this._Content.update(r({IsEnabledAddToCart:this._IsEnabledAddToCart,IsVisibleAddToCart:this._IsVisibleAddToCart,IsVisibleBooking:this._IsVisibleBooking,IsVisibleBuyOnline:this._IsVisibleBuyOnline,IsVisibleCreateContract:this._IsVisibleCreateContract,IsVisibleCrm:this._IsVisibleCrm,IsVisibleOperatorBooking:this._IsVisibleOperatorBooking,IsVisibleOperatorLink:this._IsVisibleOperatorLink,IsVisibleOperatorLogo:this._isVisibleOperatorLogo(),IsVisibleRequest:this._IsVisibleRequest,IsVisibleWhereBuyOnline:this._isVisibleWhereBuyOnline(),SelectedFlight:this._SelectedFlight},e)),this._layoutControl.addChild(this._waiter),(0,a.isDefined)(o)&&this._Content.enable())},e.prototype._init=function(){this._Content&&this._Content.update({IsEnabledAddToCart:this._IsEnabledAddToCart,IsVisibleAddToCart:this._IsVisibleAddToCart,IsVisibleBooking:this._IsVisibleBooking,IsVisibleBuyOnline:this._IsVisibleBuyOnline,IsVisibleCreateContract:this._IsVisibleCreateContract,IsVisibleCrm:this._IsVisibleCrm,IsVisibleOperatorBooking:this._IsVisibleOperatorBooking,IsVisibleOperatorLink:this._IsVisibleOperatorLink,IsVisibleOperatorLogo:this._isVisibleOperatorLogo(),IsVisibleRequest:this._IsVisibleRequest,IsVisibleWhereBuyOnline:this._isVisibleWhereBuyOnline(),TourId:this._TourId})},e.prototype._getContent=function(){return this._Content?this._Content:new h.TourCardControl({ScrollNode:this._layoutControl.getPanel(),ClickAddToCart:new n.Delegate(this,this._onAddToCart),ClickBuy:new n.Delegate(this,this._onShowBuyControl),ClickExportCrm:new n.Delegate(this,this._onExportCrmClicked),ClickFlightDetail:new n.Delegate(this,this._onShowFlightDetail),ClickFlights:new n.Delegate(this,this._onShowFlights),ClickOperatorBooking:new n.Delegate(this,this._onShowOperatorBooking),ClickRedirectLink:new n.Delegate(this,this._onRedirectLinkClicked),ClickRequest:new n.Delegate(this,this._onShowRequestControl),ClickTab:new n.Delegate(this,this._onTabClicked),ClickTrackPrice:new n.Delegate(this,this._onShowTrackPriceControl),ClickVideo:new n.Delegate(this,this._onShowVideoControl),ClickWhereBuy:new n.Delegate(this,this._onShowWhereBuyControl),ShowRoom:new n.Delegate(this,this._onShowRoom)})},e.prototype._onRedirectLinkClicked=function(){this.RedirectLinkClicked.fire()},e.prototype._onTabClicked=function(t){this.HotelTabClicked.fire(t)},e.prototype._onShowRequestControl=function(t){this.ShowRequest.fire(t)},e.prototype._onShowBuyControl=function(t){this.ShowBuy.fire(t)},e.prototype._onShowWhereBuyControl=function(t){this.ShowWhereBuy.fire(t)},e.prototype._onShowVideoControl=function(t){this.ShowVideo.fire(t)},e.prototype._onShowOperatorBooking=function(t){this.ShowOperatorBooking.fire(t)},e.prototype._onAddToCart=function(){this.AddToCart.fire()},e.prototype._onExportCrmClicked=function(){var t={};t.Type=d.RequestType.ExportRequest,t.Manager=u.authManager.getId(!0),t.Fly=this._SelectedFlight,t.CallBack=new n.Delegate(this,this._updateCrmUrl),this.SendRequest.fire(t)},e.prototype._onShowTrackPriceControl=function(){this.ShowTrackPrice.fire()},e.prototype._onShowRoom=function(t){this.ShowRoom.fire(t)},e.prototype._onShowFlightDetail=function(t){this.ShowFlightDetail.fire(t)},e.prototype._onShowFlights=function(){this.ShowFlights.fire()},e.prototype._updateCrmUrl=function(t){var e=t.CrmUrl,o=t.CrmError;this._Content.update({CrmError:o,CrmUrl:e})},e.prototype._isVisibleOperatorLogo=function(){return this._ShowOperator===l.Operator.Show},e.prototype._isVisibleWhereBuyOnline=function(){return c.tourUtils.isWhereBuyOnline(this._ClientData)},e.displayName="TourPage",e}(p.BaseOrderPage);e.TourPage=_,t.TourPage=_}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelMapControl=void 0;var r,n=o(2),s=o(1),a=o(84),l=o(42),u=o(18),c=o(92);!function(t){t[t.COUNTRY=0]="COUNTRY",t[t.RESORT=1]="RESORT",t[t.HOTEL=2]="HOTEL"}(r||(r={}));var h=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVHotelMapControl",o._ModuleId=0,o._SourceId=0,o._HotelData=null,o._zoomOptions=[],t.prototype.__initSettings.call(o,e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._hotelTitleControl=new c.HotelTitleControl({ParentNode:this._DomNode}),this._renderButtons(),this._mapContainer=(0,s.newDiv)("TVHotelMapContainer",this._DomNode),this._addEvents(),this._addCustomClasses()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._updateHotelTitle(),this._updateCoords()},e.prototype.destroy=function(){this._removeEvents(),t.prototype.destroy.call(this)},e.prototype._init=function(){this._handleClickCountry=this._onZoomMap.bind(this,{Zoom:r.COUNTRY}),this._handleClickResort=this._onZoomMap.bind(this,{Zoom:r.RESORT}),this._handleClickHotel=this._onZoomMap.bind(this,{Zoom:r.HOTEL}),a.resourceManager.loadYandexMap({ModuleId:parseInt(this._ModuleId.toString(),0),SourceId:this._SourceId,Url:window.location.href})},e.prototype._updateHotelTitle=function(){var t=(0,s.getProperty)(this._HotelData,"actype"),e=(0,s.getProperty)(this._HotelData,"hotel_name"),o=u.hotelUtils.getStars(this._HotelData),i=(0,s.getProperty)(this._HotelData,"region.region_name"),r=(0,s.getProperty)(this._HotelData,"subregion.name");this._hotelTitleControl.update({Accomodation:t,Name:e,Region:i,Stars:o,SubRegion:r})},e.prototype._updateCoords=function(){this._updateMapHeight();var t=(0,s.getProperty)(this._HotelData,"region"),o=(0,s.getProperty)(t,"country.coord"),i=(0,s.getProperty)(t,"coord"),n=[this._HotelData.coord1,this._HotelData.coord2];this._zoomOptions[r.COUNTRY]={zoom:o?o.zoom:e.HOTEL_ZOOM,coords:o?[o.lat,o.lng]:n},this._zoomOptions[r.RESORT]={zoom:i?i.hotelzoom:e.HOTEL_ZOOM,coords:i?[i.lat,i.lng]:n},this._zoomOptions[r.HOTEL]={zoom:e.HOTEL_ZOOM,coords:n},this._updateHotelMap()},e.prototype._renderButtons=function(){this._buttonsContainer=(0,s.newDiv)("TVHotelMapButtons",this._DomNode),this._countryZoomBtn=(0,s.newDiv)("TVMobileResultBtn TVHotelMapCountry",this._buttonsContainer),this._resortZoomBtn=(0,s.newDiv)("TVMobileResultBtn TVHotelMapResort",this._buttonsContainer),this._hotelZoomBtn=(0,s.newDiv)("TVMobileResultBtn TVHotelMapHotel",this._buttonsContainer)},e.prototype._applyMap=function(){this._map=new ymaps.Map(this._mapContainer,{center:this._zoomOptions[r.HOTEL].coords,zoom:this._zoomOptions[r.HOTEL].zoom,type:e.YANDEX_MAP_TYPE,controls:e.YANDEX_MAP_CONTROLS}),this._markerHotel=new ymaps.Placemark(this._zoomOptions[r.HOTEL].coords,{}),this._map.geoObjects.add(this._markerHotel)},e.prototype._updateMapHeight=function(){var t=this._hotelTitleControl.getDomNode().clientHeight+this._buttonsContainer.clientHeight+e.MARGIN_TOP;this._mapContainer.style.height="calc(100% - "+t+"px)"},e.prototype._addEvents=function(){(0,s.addEvent)(this._countryZoomBtn,"click",this._handleClickCountry),(0,s.addEvent)(this._resortZoomBtn,"click",this._handleClickResort),(0,s.addEvent)(this._hotelZoomBtn,"click",this._handleClickHotel)},e.prototype._removeEvents=function(){(0,s.removeEvent)(this._countryZoomBtn,"click",this._handleClickCountry),(0,s.removeEvent)(this._resortZoomBtn,"click",this._handleClickResort),(0,s.removeEvent)(this._hotelZoomBtn,"click",this._handleClickHotel)},e.prototype._updateHotelMap=function(){if(!this._map)return void a.resourceManager.onYandexMapLoad({CallBack:this._applyMap,Context:this});this._map.setCenter(this._zoomOptions[r.HOTEL].coords),this._map.setZoom(this._zoomOptions[r.HOTEL].zoom),this._markerHotel.geometry.setCoordinates(this._zoomOptions[r.HOTEL].coords),this._map.container.fitToViewport()},e.prototype._onZoomMap=function(t){this._map&&(this._map.setCenter(this._zoomOptions[t.Zoom].coords),this._map.setZoom(this._zoomOptions[t.Zoom].zoom),this._map.container.fitToViewport())},e.prototype._addCustomClasses=function(){l.customClassUtils.addHotelMapClass(this._DomNode)},e.MARGIN_TOP=20,e.YANDEX_MAP_TYPE="yandex#hybrid",e.YANDEX_MAP_CONTROLS=["zoomControl"],e.HOTEL_ZOOM=14,e}(n.Control);e.HotelMapControl=h,t.HotelMapControl=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ResultManager=void 0;var s=o(66),a=o(120),l=o(56),u=o(17),c=o(966),h=o(9),d=o(4),p=o(7),_=o(1),f=o(5),y=o(13),g=o(22),C=o(359),v=o(84),m=o(20),T=o(209),w=o(171),S=o(94),P=o(160),b=o(247),I=o(503),O=o(967),M=o(24),D=o(25),E=o(172),k=o(968),R=o(71),A=function(e){function o(t){var o=e.call(this,t)||this;return o._ParentNode=null,o._Ref=null,o._PriceType=0,o._ShowOperator=0,o._ShowCart=0,o._ScrollOnStart=!0,o._Theme=f.Theme.Theme1,o._ExpandAll=!1,o._ModeView=f.ModeView.DescTop,o._NavigationPanelEnable=!0,o._ShowTimeoutDialog=!0,o._ShowHelpForm=!0,o._Width=p.DEFAULT_RESULT_WIDTH,o._ToursOnly=!1,o._SearchId=0,o._ResultViewChanged=null,o._OperatorsFilterEnable=!1,o._Timeout=null,o._ShowTrack=!1,o._HasResults=!1,o._searchSession=[],e.prototype.__initSettings.call(o,t),u.resultStore.Changed.add(new d.Delegate(o,o._onStoreChanged)),T.favoriteHotelsService.Changed.addOnce(new d.Delegate(o,o._onFavoriteHotelsChanged)),(0,R.listenSearches)({BeforeStart:new d.Delegate(o,o._beforeSearch),ResultsUpdating:new d.Delegate(o,o._onResultsUpdating),SearchExpired:new d.Delegate(o,o._onSearchExpired),SearchStart:new d.Delegate(o,o._onSearchStart)}),o}return r(o,e),o.prototype.sleep=function(){this._Timeout&&clearTimeout(this._Timeout),this._resultViewController.update({FixOnScroll:!1,SearchMode:E.SearchResultMode.END,ShowPopupResultDisable:!0})},o.prototype.destroy=function(){(0,R.unlistenSearches)(this),u.resultStore.Changed.remove(this),T.favoriteHotelsService.Changed.remove(this),e.prototype.destroy.call(this)},o.prototype._beforeSearch=function(t){var e=t.SearchId;this._searchSession[e]=u.resultStore.getSearchSessionId(),this._resultViewController||this._createControls(),this._resultViewController.update({HasResults:this._HasResults,SearchMode:E.SearchResultMode.PREPARE}),v.resourceManager.loadYandexMap(this._Ref),this._ShowTimeoutDialog&&(this._Timeout&&clearTimeout(this._Timeout),this._Timeout=setTimeout(function(){var t=u.resultStore.getActualSearchSettings();new c.TimeoutDialog({UpdateUrl:M.searchUtils.getSearchURL(t)}).show()},o.EXPIRE_RESULTS))},o.prototype._createControls=function(){this._resultViewController=new k.ResultViewController({ExpandAll:this._ExpandAll,ModeView:this._ModeView,NavigationPanelEnable:this._NavigationPanelEnable,OperatorsFilterEnable:this._OperatorsFilterEnable,ParentNode:this._ParentNode,PriceType:this._PriceType,Ref:this._Ref,ScrollOnStart:this._ScrollOnStart,ShowCart:this._ShowCart,ShowHelpForm:this._ShowHelpForm,ShowOperator:!!this._ShowOperator,ShowTrack:this._ShowTrack,Theme:this._Theme,ToursOnly:this._ToursOnly,Width:this._Width,ResultViewChanged:this._ResultViewChanged})},o.prototype._onSearchStart=function(t){var e=(0,R.getCountryIdBySearchId)(t.SearchId);if(0!==e){var o=(0,_.getProperty)(t,"result"),i=(0,_.getProperty)(o,"links"),r=g.authManager.getUser()instanceof C.Manager,c=I.operatorUtils.getOperators(o);this._logSearch(e),i&&u.resultStore.setLinks(e,i),this._OperatorsFilterEnable=!!(0,_.getProperty)(o,"operatorsfilter")||r||!1,this._ShowTrack=!!(0,_.getProperty)(o,"showtrack")||!1,this._ShowCart=(0,_.getProperty)(o,"showcart")||this._ShowCart,this._ShowCart=Number(this._ShowCart);var h=s.countryGate.getSearchSettings(e);u.resultStore.setSearchSettingsByCountryId(e,n(n({},h),{Currency:D.settingUtils.getSearchCurrency(t)})),u.resultStore.setOperatorsByCountry(e,c),a.orderCatalog.setClientData(o.client);l.resortsStore.getResorts(e)||S.regionService.all({countryId:e}).then(function(t){l.resortsStore.setResorts(e,t)});l.resortsStore.getSubResorts(e)||P.subRegionService.all({countryId:e}).then(function(t){l.resortsStore.setSubResorts(e,t)});u.resultStore.getCountryInfo(e)||w.countryService.read(e,{}).then(function(t){t&&!t.error&&u.resultStore.setCountryInfo(e,t)});var d=u.resultStore.getActualCountryId(),p=0===d,f=this._getFavoriteHotelsSettings(),y=n(n({},f),{OperatorsFilterEnable:this._OperatorsFilterEnable,Ref:this._Ref,SearchMode:E.SearchResultMode.START,ShowCart:this._ShowCart,ShowTours:this._ToursOnly,ShowTrack:!p&&this._ShowTrack});this._resultViewController.update(y)}},o.prototype._onResultsUpdating=function(t){var e=t.SearchId;if(this._searchSession[e]===u.resultStore.getSearchSessionId()){var o=(0,R.getCountryIdBySearchId)(e);if(0!==o){var i=t.data,r=i||{},n=r.block,a=void 0===n?[]:n,l=r.decode,c=r.status,h=r.tourdates,d=void 0===h?[]:h,p=Boolean(null===c||void 0===c?void 0:c.finished),f=I.operatorUtils.getOperators(i),y=Boolean(null===c||void 0===c?void 0:c.nomoretours);(0,_.isDefined)(l)&&u.resultStore.addData(o,l),u.resultStore.setSearchResultData(o,a),u.resultStore.setFinishedSearchByCountry(o,p),u.resultStore.setOperatorsByCountry(o,f);var g=u.resultStore.getActualCountryId(),C=0===g,v=u.resultStore.getGlobals().SearchId;if(C||v===e){var m=s.countryGate.getCityToItems(o),T=C&&0===m.length,w=D.settingUtils.getCityTo(s.countryGate.getSearchFilter(o)),S=T?0:O.resultUtils.getTourCount(a,w),P=T?0:O.resultUtils.getMinPrice(a,w);this._HasResults=this._HasResults||!T&&a.length>0;var b=g===o;(C||b)&&this._resultViewController.update({AddToursCount:S,AvailableTourDateLinks:d,HasResults:this._HasResults,MinPrice:P,NoMoreTours:y,SearchMode:!p||(0,R.hasSearchInProgress)()&&!b?E.SearchResultMode.SEARCH:E.SearchResultMode.END})}}}},o.prototype._onStoreChanged=function(t){switch(t.Type){case m.CatalogName.ActualCountryId:this._HasResults=!1;break;case m.CatalogName.ResultActualCountryId:this._onFavoriteHotelsChanged()}},o.prototype._onFavoriteHotelsChanged=function(){var t=this._getFavoriteHotelsSettings();this._resultViewController.update(t)},o.prototype._getFavoriteHotelsSettings=function(){var t=u.resultStore.getActualCountryId(),e=s.countryGate.getSearchSettings(t),o=b.favoriteHotelsUtils.isEnabled(t,e),i=o?T.favoriteHotelsService.getHotels(t):[];return{FavoriteHotels:i,ShowFavoriteHotels:i.length>0}},o.prototype._onSearchExpired=function(){},o.prototype._logSearch=function(e){var o=u.resultStore.getActualSearchSettings(),i=isNaN(this._Ref.ModuleId)?0:parseInt(this._Ref.ModuleId,10),r=this._Ref.SourceId,n={uri:this._Ref.Url},s=M.searchUtils.getChildren(o),a={actype:o.Accomodation||[],adultsCount:o.Tourists.Adults||0,childAge1:s[0]||0,childAge2:s[1]||0,childAge3:s[2]||0,childrenCount:s.length,countryId:e,currencyCode:M.searchUtils.getCurrency(o),dateFrom:y.FormatDate.convertToUTCDate(o.FlyDates[0]),dateTo:y.FormatDate.convertToUTCDate(o.FlyDates[1]),departureId:o.Departure,directOnly:M.searchUtils.getDirectOnly(o),hotelServices:o.HotelServices||[],hotelStars:o.HotelClass||0,hotelsIdList:o.Hotels||[],hotelsTypesList:o.HotelTypes||[],meal:o.Feed||0,moduleId:i,nightsFrom:o.Nights[0],nightsTo:o.Nights[1]||o.Nights[0],operatorsIdList:o.Operators||[],pageTitle:document.title,priceFrom:M.searchUtils.getPriceFrom(o),priceTo:M.searchUtils.getPriceTo(o),rating:o.HotelRating||0,regionsIdList:o.Resorts||[],regular:o.Regular,searchId:(0,R.getRequestId)(),sourceId:r,url:n};return t.actionLogService.log(f.ActionLog.SEARCH,a)},o.EXPIRE_RESULTS=72e5,o}(h.Core);e.ResultManager=A,i.ResultManager=A}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.operatorUtils=void 0;var i=o(1),r=function(){function t(){}return t.prototype.getOperators=function(t){return((0,i.getProperty)(t,"operators")||[]).map(function(t){return{Id:Number(t.id),Name:t.name,Price:Number(t.minprice),Status:t.status}})},t.prototype.sort=function(t,e){return 0===e.Price?-1:0===t.Price?1:t.Price<e.Price?-1:t.Price>e.Price?1:0},t}();e.operatorUtils=new r,t.operatorUtils=e.operatorUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var i,r=0,n=e.length;r<n;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.SelectReadyHotelsCollectionsController=void 0;var n=o(34),s=o(106),a=o(17),l=o(9),u=o(4),c=o(3),h=o(1),d=o(6),p=o(22),_=o(20),f=o(32),y=o(280),g=o(971),C=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new c.UserEvent,o._CountryId=0,o._HasResults=!1,o._MngId=0,o._ParentNode=null,o._readyCollections=null,o._readyCollectionsIsVisible=!0,o._selected=[],o.__initSettings(e),o._render(),o}return i(e,t),e.prototype.update=function(e){var o=this._CountryId,i=this._MngId;t.prototype.update.call(this,e);var r=e.HasResults,n=i!==this._MngId;(o!==this._CountryId||n)&&this._updateReadyCollections(),((0,h.isDefined)(r)||n)&&this._readyCollections.setIsVisible(this._isVisibleReadyCollections())},e.prototype.destroy=function(){a.resultStore.Changed.remove(this),s.hotelsCollectionsStore.Changed.remove(this),t.prototype.destroy.call(this)},e.prototype._render=function(){this._readyCollections=new g.ReadyHotelsCollections({IsVisible:!1,ParentNode:this._ParentNode,HideBtnClicked:new u.Delegate(this,this._onHideReadyCollectionsClicked),Changed:new u.Delegate(this,this._onCollectionsChanged)}),this._updateReadyCollections(),a.resultStore.Changed.addOnce(new u.Delegate(this,this._onResultStoreChanged)),s.hotelsCollectionsStore.Changed.addOnce(new u.Delegate(this,this._onHotelsCollectionsStoreChanged))},e.prototype._onResultStoreChanged=function(t){if(t.Type===_.CatalogName.FilterHotels){var e=a.resultStore.getActualSearchSettings();this._selected=e.HotelsCollections?r([],e.HotelsCollections,!0):[],this._readyCollections.update({Selected:this._selected})}},e.prototype._onHotelsCollectionsStoreChanged=function(t){t.Type===_.CatalogName.HotelsCollections&&(this._readyCollections.setIsVisible(this._isVisibleReadyCollections()),this._updateReadyCollections())},e.prototype._updateReadyCollections=function(){var t=a.resultStore.getActualSearchSettings();this._selected=t.HotelsCollections?r([],t.HotelsCollections,!0):[],this._readyCollections.update({Items:this._getCollectionsWithAllAccess(),Selected:this._selected})},e.prototype._onHideReadyCollectionsClicked=function(){var t=this;this._readyCollectionsIsVisible=!1,setTimeout(function(){t._readyCollectionsIsVisible=!0},6e5)},e.prototype._onCollectionsChanged=function(t){var e=t.IsChecked,o=t.Item;e?(0,h.insertUnique)(this._selected,o.Id):this._selected=this._selected.filter(function(t){return t!==o.Id}),this.Changed.fire({Selected:r([],this._selected,!0)})},e.prototype._isVisibleReadyCollections=function(){var t=this._getCollectionsWithAllAccess(),e=n.clientCatalog.getClientData();return f.clientUtils.getReadyHotelsListEnabled(e)&&!p.authManager.isManager()&&this._HasResults&&this._readyCollectionsIsVisible&&(0,d.isNotEmptyArray)(t)},e.prototype._getCollectionsWithAllAccess=function(){var t=s.hotelsCollectionsStore.getCollections(this._CountryId)||[];return y.hotelsCollectionsUtils.getCollectionsWithAllAccess(t)},e}(l.Core);e.SelectReadyHotelsCollectionsController=C,t.SelectReadyHotelsCollectionsController=C}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.AvailableTourDates=void 0;var r=o(2),n=o(4),s=o(1),a=o(6),l=o(972),u=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVAvailableTourDates",o._Items=[],o._Clicked=null,o._linkItems=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){this._Clicked=null,t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this),this._renderItems(),this._updateVisibility()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Items;(0,s.isDefined)(o)&&(this._clear(),this._renderItems(),this._updateVisibility())},e.prototype._clear=function(){this._linkItems.forEach(function(t){t.destroy()}),this._linkItems=[],(0,s.removeChildren)(this._DomNode)},e.prototype._onAvailableTourDateClicked=function(t){this._Clicked.fire(t)},e.prototype._renderItems=function(){var t=this,e=new n.Delegate(this,this._onAvailableTourDateClicked);this._Items.forEach(function(o){var i={};(0,a.findSettingsFromUrl)(i,o);var r=i.FlyDates,n=void 0===r?[]:r,s=i.Nights,u=void 0===s?[]:s,c=(0,a.isNotEmptyArray)(n),h=(0,a.isNotEmptyArray)(u);if(c||h){var d=new l.AvailableTourDate({FlyDate:n[0],Night:u[0],ParentNode:t._DomNode,Url:o,Click:e});t._linkItems.push(d)}})},e.prototype._updateVisibility=function(){(0,s.setVisible)(this._DomNode,this._Items.length>0)},e}(r.Control);e.AvailableTourDates=u,t.AvailableTourDates=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.NavigationResultPanel=e.NavigationResultPanelMenuType=void 0;var r,n=o(2),s=o(3),a=o(1),l=o(5),u=o(8);!function(t){t.Countries="Countries",t.Hotels="Hotels",t.Map="Map",t.Resorts="Resorts"}(r=e.NavigationResultPanelMenuType||(e.NavigationResultPanelMenuType={}));var c=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="navigation-result-panel",o.MenuClick=new s.UserEvent,o._IsCountriesSearch=!1,o._IsDisabledGrouping=!1,o._IsDisabledMap=!1,o._IsSelectedResort=!1,o._ToursGroup=l.ToursGroupBy.Hotels,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes,o=e.resorts,i=e.hotels;(0,a.hide)(i),(0,a.show)(o),this._updateCountryButton(),this._updateResortButton(),this._updateButtonGroups()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsCountriesSearch,i=e.IsDisabledGrouping,n=e.IsDisabledMap,s=e.IsSelectedResort,u=e.MenuClickDisabled,c=e.ToursGroup;if((0,a.isDefined)(o)&&this._updateCountryButton(),(0,a.isDefined)(s)&&(0,a.updateClass)(this._DomNode,"TVHotelsByResort",this._IsSelectedResort),(0,a.isDefined)(c)&&(this._updateButtonGroups(),!u)){var h=this._ToursGroup===l.ToursGroupBy.Hotels?r.Hotels:r.Resorts;this.MenuClick.fire({Type:h})}(0,a.isDefined)(i)&&(this._updateResortButton(),this._IsDisabledGrouping&&this._ToursGroup===l.ToursGroupBy.Resorts&&this.MenuClick.fire({Type:r.Hotels})),(0,a.isDefined)(n)&&this._updateMapButton()},e.prototype._onCountriesClick=function(t){this.MenuClick.fire({Type:r.Countries})},e.prototype._onMapClick=function(t){this._IsDisabledMap||this.MenuClick.fire({Type:r.Map})},e.prototype._onResortsClick=function(t){if(!this._IsDisabledGrouping){var e=this._nodes,o=e.resorts,i=e.hotels;(0,a.hide)(o),(0,a.show)(i),(0,a.removeClass)(this._DomNode,"TVHotelsByResort"),this.MenuClick.fire({Type:r.Resorts})}},e.prototype._onHotelsClick=function(t){var e=this._nodes,o=e.resorts,i=e.hotels;(0,a.hide)(i),(0,a.show)(o),this.MenuClick.fire({Type:r.Hotels})},e.prototype._updateButtonGroups=function(){var t=this._nodes,e=t.resorts,o=t.hotels;(0,a.setVisible)(o,this._ToursGroup===l.ToursGroupBy.Resorts),(0,a.setVisible)(e,this._ToursGroup===l.ToursGroupBy.Hotels)},e.prototype._updateCountryButton=function(){(0,a.updateClass)(this._DomNode,"TVCountriesSearch",this._IsCountriesSearch),this._updateButtonGroups()},e.prototype._updateMapButton=function(){var t=this._nodes.map;(0,a.updateClass)(t,u.TV_DISABLED,this._IsDisabledMap)},e.prototype._updateResortButton=function(){var t=this._nodes,e=t.resorts,o=t.hotels;this._IsDisabledGrouping?((0,a.hide)(o),(0,a.show)(e),(0,a.addClass)(e,u.TV_DISABLED),(0,a.removeClass)(this._DomNode,"TVHotelsByResort")):(0,a.removeClass)(e,u.TV_DISABLED)},e}(n.Control);e.NavigationResultPanel=c,t.NavigationResultPanel=c,t.NavigationResultPanelMenuType=r}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.updateNotificationWindow=e.UpdateNotificationWindow=void 0;var r=o(2),n=o(1),s=o(12),a=o(508),l=function(t){function e(e){var o=t.call(this,e)||this;return o._ShowButton=!1,o._ToursCount=0,o._window=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),(0,n.isDefined)(e.ToursCount)&&this._updateToursCount()},e.prototype.show=function(t){this._window||this._render(),(0,n.isDefined)(t)&&this.update(t),this._window.show()},e.prototype.hide=function(){this._window&&this._window.hide()},e.prototype._render=function(){this._window=new a.NotificationWindow({DomNode:this._DomNode});var t=this._window.getContentNode();(0,n.newDiv)("TVREndSearchLbl",t).innerHTML="Поиск завершен";var e=(0,n.newDiv)("TVRToursLbl",t);e.innerHTML="найдено туров:",this._tours=(0,n.newDiv)("TVRToursNumberLbl",e),this._updateToursCount(),this._button=(0,n.newDiv)("TVRUpdateImg TVHide",t)},e.prototype._updateToursCount=function(){this._tours&&(this._tours.innerHTML=(0,s.sanitizeHTML)(""+this._ToursCount))},e}(r.Control);e.UpdateNotificationWindow=l,e.updateNotificationWindow=new l({}),t.updateNotificationWindow=e.updateNotificationWindow,t.UpdateNotificationWindow=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.NotificationWindow=void 0;var r=o(2),n=o(1),s=o(42),a=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVMobileNotificationWindow",o._content=null,o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._content=(0,n.newDiv)("TVMobileNotificationContent",this._DomNode),this._addCustomClasses()},e.prototype.destroy=function(){clearTimeout(this._handlerTimeout),t.prototype.destroy.call(this)},e.prototype.show=function(){var t=this;this._setVisibleNotification(!0),this._updateHeight(),clearTimeout(this._handlerTimeout),this._handlerTimeout=setTimeout(function(){return t.hide()},2e3)},e.prototype.hide=function(){this._setVisibleNotification(!1),this._resetHeight()},e.prototype.getContentNode=function(){return this._content},e.prototype._updateHeight=function(){this._DomNode.style.height="auto";var t=this._DomNode.offsetHeight;this._DomNode.style.height=t+"px"},e.prototype._resetHeight=function(){this._DomNode.style.height=""},e.prototype._setVisibleNotification=function(t){(0,n.updateClass)(this._DomNode,"TVShowNotification",t)},e.prototype._addCustomClasses=function(){s.customClassUtils.addMobileNotificationClass(this._DomNode)},e}(r.Control);e.NotificationWindow=a,t.NotificationWindow=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.isDisabledGrouping=void 0;var o=function(t){var e=t.Hotels,o=t.Cities;return e&&e.length>0||o&&o.length>0};e.isDisabledGrouping=o,t.isDisabledGrouping=e.isDisabledGrouping}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.ToolType=void 0;var o;!function(t){t[t.Draw=0]="Draw",t[t.Ruler=1]="Ruler"}(o=e.ToolType||(e.ToolType={})),t.ToolType=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.mouseMarker=e.rulerTooltip=e.rulerPolyline=e.MapRulerControl=e.MapMoveType=void 0;var n,s=o(80),a=o(9),l=o(4),u=o(1),c=o(6),h=o(37),d=o(113),p=o(512),_=o(989),f=o(990);!function(t){t[t.Start=0]="Start",t[t.End=1]="End"}(n=e.MapMoveType||(e.MapMoveType={}));var y=function(t){function o(e){var o=t.call(this,e)||this;return o._LinePane="",o._Map=null,o._MarkerPane="",o._actualResultId=0,o._distance=0,o._isMobile=!1,o._mapMoving=!1,o._map=null,o._mapDomNode=null,o._mapParentNode=null,o._markerId=0,o._mouseClickedCoords=null,o._mousePolyline=null,o._mouseMarker=null,o._clickedPopupCoords=null,o._resultId=0,o._rulerEnable=!1,o._targetTouches=null,o._mapRulerResults={},o._markerPopup=null,o.__initSettings(e),o._init(),o._isMobile=(0,u.isMobile)(),o._map=o._Map.getInstance(),o._mapDomNode=o._Map.getDomNode(),o._mapParentNode=o._Map.getParentNode(),o}return i(o,t),o.prototype.show=function(){this._rulerEnable=!0,this._addEvents(),(0,u.addClass)(this._mapDomNode,o.RULER_ENABLED_CLASS)},o.prototype.hide=function(){this._markerPopup&&this._markerPopup.hide(),this._rulerEnable=!1,this._removeEvents(),this._clearMouseRuler(),(0,u.removeClass)(this._mapDomNode,o.RULER_ENABLED_CLASS)},o.prototype.clear=function(){this._clearRuler()},o.prototype.destroy=function(){this._removeEvents(),this._Map=null,t.prototype.destroy.call(this)},o.prototype._init=function(){this._onMapClicked=this._onMapClicked.bind(this),this._onMapTouchStart=this._onMapTouchStart.bind(this),this._onFinishedRuler=this._onFinishedRuler.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMapMoveEnd=this._onMapMove.bind(this,{Type:n.End}),this._onMapMoveStart=this._onMapMove.bind(this,{Type:n.Start}),this._onMapZoomEnd=this._onMapMove.bind(this,{Type:n.End}),this._onMapZoomStart=this._onMapMove.bind(this,{Type:n.Start})},o.prototype._addEvents=function(){this._map.on("movestart",this._onMapMoveStart),this._map.on("zoomstart",this._onMapZoomStart),this._map.on("zoomend",this._onMapZoomEnd),this._isMobile?((0,u.addEvent)(this._mapDomNode,"touchstart",this._onMapTouchStart),(0,u.addEvent)(this._mapDomNode,"touchend",this._onMapClicked),this._map.on("moveend",this._onMapMoveEnd)):((0,u.addEvent)(this._mapDomNode,"click",this._onMapClicked),(0,u.addEvent)(this._mapDomNode,"mouseup",this._onMouseUp),(0,u.addEvent)(this._mapDomNode,"mousemove",this._onMouseMove),(0,u.addEvent)(this._mapDomNode,"contextmenu",this._onFinishedRuler))},o.prototype._removeEvents=function(){this._map.off("movestart",this._onMapMoveStart),this._map.off("zoomstart",this._onMapZoomStart),this._map.off("zoomend",this._onMapZoomEnd),this._isMobile?((0,u.removeEvent)(this._mapDomNode,"touchend",this._onMapTouchStart),(0,u.removeEvent)(this._mapDomNode,"touchend",this._onMapClicked),this._map.off("moveend",this._onMapMoveEnd)):((0,u.removeEvent)(this._mapDomNode,"click",this._onMapClicked),(0,u.removeEvent)(this._mapDomNode,"mouseup",this._onMouseUp),(0,u.removeEvent)(this._mapDomNode,"mousemove",this._onMouseMove),(0,u.removeEvent)(this._mapDomNode,"contextmenu",this._onFinishedRuler))},o.prototype._clearMouseRuler=function(){this._mouseMarker&&p.rulerUtils.removeElement(this._mouseMarker,this._map),this._mousePolyline&&p.rulerUtils.removeElement(this._mousePolyline,this._map),this._mousePolyline=null,this._mouseMarker=null,this._mouseClickedCoords=null,this._distance=0,this._actualResultId=0},o.prototype._clearRuler=function(){var t=this;Object.keys(this._mapRulerResults).forEach(function(e){t._mapRulerResults[e]&&t._mapRulerResults[e].destroy()}),this._mapRulerResults={},this._markerPopup&&this._markerPopup.getIsVisible()&&this._markerPopup.hide()},o.prototype._onFinishedRuler=function(t){if(this._actualResultId){1===this._mapRulerResults[this._actualResultId].getMarkers().length&&(this._mapRulerResults[this._actualResultId].destroy(),delete this._mapRulerResults[this._actualResultId]),this._clearMouseRuler(),t.preventDefault()}},o.prototype._onMapMove=function(t){switch(t.Type){case n.Start:this._mapMoving=!0,this._markerPopup&&this._markerPopup.getIsVisible()&&this._markerPopup.hide();break;case n.End:this._mapMoving=!1}},o.prototype._onMapTouchStart=function(t){this._targetTouches=t.targetTouches},o.prototype._onMapClicked=function(t){if(this._mapMoving)return void(this._mapMoving=!1);if(this._isMobile){if(t.changedTouches.length>=2||this._targetTouches.length>=2)return}if(this._markerPopup&&this._markerPopup.getIsVisible()){this._markerPopup.hide();var e=this._getMouseCoords(t);return void this._updateMouseElements(e)}if(this._rulerEnable){var o=this._mouseClickedCoords,i=this._getMouseCoords(t);if(o&&(this._distance+=p.rulerUtils.getDistance(o,i,this._map)),!this._actualResultId){var r=(new Date).getTime();this._mapRulerResults[r]=new _.MapRulerResult({ResultId:r,IsMobile:this._isMobile,Map:this._map,MarkerClicked:new l.Delegate(this,this._onMarkerClicked),MarkerRemoved:new l.Delegate(this,this._onMarkerRemoved)}),this._actualResultId=r}this._mapRulerResults[this._actualResultId].addMarker({Coords:i}),this._mouseClickedCoords=i,t.stopPropagation()}},o.prototype._onMarkerClicked=function(t){this._markerPopup||(this._markerPopup=new f.RulerMarkerPopup({IsVisible:!1,ParentNode:this._mapParentNode,Hide:new l.Delegate(this,this._onPopupHide),PopupClicked:new l.Delegate(this,this._onPopupClicked),Show:new l.Delegate(this,this._onPopupShow)}));var e=t.MarkerId,o=t.MarkerCoords,i=t.ResultId,r=this._map.latLngToContainerPoint(o);this._resultId=i,this._markerId=e,this._markerPopup.show(),this._markerPopup.update({IsActual:this._resultId===this._actualResultId,Position:{left:r.x,top:r.y}})},o.prototype._onMouseUp=function(t){this._mapMoving&&t.which===o.MOUSE_WHEEL_BUTTON&&(this._onMapClicked(t),(0,u.stopPropagation)(t))},o.prototype._onPopupClicked=function(t){var e=t.Event,o=t.Type;this._clickedPopupCoords=this._isMobile?null:this._getMouseCoords(e);var i=this._actualResultId===this._resultId,r=this._mapRulerResults[this._resultId];switch(o){case f.PopupClickType.DeleteMarker:r.removeMarker(this._markerId),!i&&r.getMarkers().length<=1&&(r.destroy(),delete this._mapRulerResults[this._resultId]);break;case f.PopupClickType.DeletePath:this._isMobile?i&&(this._actualResultId=0):i?this._clearMouseRuler():this._updateMouseElements(this._clickedPopupCoords),r.destroy(),delete this._mapRulerResults[this._resultId];break;case f.PopupClickType.FinishedPath:this._isMobile?this._actualResultId=0:this._clearMouseRuler(),1===r.getMarkers().length&&(r.destroy(),delete this._mapRulerResults[this._resultId])}if(this._markerPopup.hide(),!this._isMobile){var n=this._getMouseCoords(e);this._updateMouseElements(n)}},o.prototype._onPopupShow=function(){if(!this._rulerEnable)return void this._addEvents();if(!this._isMobile){var t=this._mouseMarker?this._mouseMarker.getTooltip():null;t&&t.setContent(" ")}},o.prototype._onPopupHide=function(){if(!this._rulerEnable)return void this._removeEvents()},o.prototype._onMarkerRemoved=function(t){var e=t.LastMarkerCoords,o=t.LastMarkerDistance,i=t.ResultId;if(this._actualResultId!==i)return void this._updateMouseElements(this._clickedPopupCoords);this._distance=o,this._mouseClickedCoords=e,0===this._distance&&this._mousePolyline&&(p.rulerUtils.removeElement(this._mousePolyline,this._map),this._mousePolyline=null),this._updateMouseElements(this._clickedPopupCoords)},o.prototype._onMouseMove=function(t){var e=this._getMouseCoords(t);this._updateMouseElements(e)},o.prototype._updateMouseElements=function(t){this._isMobile||(this._updateMouseMarker(t),this._markerPopup&&this._markerPopup.getIsVisible()||(this._updateMouseMarkerPolyline(t),this._updateMouseMarkerTooltip(t)))},o.prototype._updateMouseMarker=function(t){this._mouseMarker?this._mouseMarker.setLatLng(t):(this._mouseMarker=(0,e.mouseMarker)([t.lat,t.lng]),this._mouseMarker.addTo(this._map))},o.prototype._updateMouseMarkerPolyline=function(t){if(this._mouseClickedCoords){var i=[this._mouseClickedCoords,t];this._mousePolyline&&p.rulerUtils.removeElement(this._mousePolyline,this._map),this._mousePolyline=(0,e.rulerPolyline)(i,{dashArray:o.LINE_DASH_ARRAY}),this._mousePolyline.addTo(this._map)}},o.prototype._updateMouseMarkerTooltip=function(t){if(this._mouseClickedCoords){var o=this._distance+p.rulerUtils.getDistance(this._mouseClickedCoords,t,this._map),i=this._mouseMarker.getTooltip();if(i)i.setContent((0,c.convertDistance)(o));else{var r=(0,e.rulerTooltip)((0,c.convertDistance)(o));this._mouseMarker.bindTooltip(r)}}},o.prototype._getMouseCoords=function(t){var e=p.rulerUtils.getMousePosition(t,this._mapDomNode,this._isMobile);return h.searchMapUtils.convertCoordsFromMap([new s.Point(e.posX,e.posY)],this._map)[0]},o.LINE_COLOR="#185584",o.LINE_WIDTH=2,o.LINE_DASH_ARRAY="4",o.MOUSE_WHEEL_BUTTON=2,o.RULER_ENABLED_CLASS="TVRulerEnabled",o}(a.Core);e.MapRulerControl=y;var g=function(t,e){return new s.Polyline(t,r({color:y.LINE_COLOR,pane:d.MapPaneType.RulerLine,weight:y.LINE_WIDTH},e))};e.rulerPolyline=g;var C=function(t){return(0,s.tooltip)({className:"TVRulerTooltip",direction:"right",permanent:!0}).setContent(t)};e.rulerTooltip=C;var v=function(t){return new s.Marker(t,{icon:new s.DivIcon({className:"TVMapMouseMarker"}),opacity:0,pane:d.MapPaneType.RulerMouseMarker})};e.mouseMarker=v,t.mouseMarker=e.mouseMarker,t.rulerTooltip=e.rulerTooltip,t.rulerPolyline=e.rulerPolyline,t.MapRulerControl=y,t.MapMoveType=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.rulerUtils=e.RulerUtils=void 0;var o=function(){function t(){}return t.prototype.getDistance=function(t,e,o){return o.distance(t,e)},t.prototype.getMousePosition=function(t,e,o){var i=e.getBoundingClientRect(),r=-i.left,n=-i.top;return o?(r+=t.changedTouches[0].clientX,n+=t.changedTouches[0].clientY):(r+=t.clientX,n+=t.clientY),{posX:r,posY:n}},t.prototype.removeElement=function(t,e){t.removeFrom(e),t.remove()},t}();e.RulerUtils=o,e.rulerUtils=new o,t.rulerUtils=e.rulerUtils,t.RulerUtils=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.tvMarker=e.TVMarker=void 0;var r=o(80),n=function(t){function e(e,o){return t.call(this,e,o)||this}return i(e,t),e.prototype.getId=function(){return this.options.id},e.prototype.getLayerType=function(){return this.options.layerType},e.prototype.getPaneName=function(){return this.options.pane},e.prototype.getParentId=function(){return this.options.parentId},e.prototype.getPrice=function(){return this.options.price},e.prototype.getType=function(){return this.options.type},e.prototype.setClassName=function(t){this.options.icon.options.className=t},e.prototype.setPaneName=function(t){this.options.pane=t},e}(r.Marker);e.TVMarker=n;var s=function(t,e){return new n(t,e)};e.tvMarker=s,t.tvMarker=e.tvMarker,t.TVMarker=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__assign||function(){return i=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},i.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.markerUtils=e.MarkerUtils=e.CLUSTER_ICON_ANCHOR=e.HOTEL_ICON_ANCHOR=void 0;var r=o(80),n=o(1),s=o(144);e.HOTEL_ICON_ANCHOR=[9,9],e.CLUSTER_ICON_ANCHOR=[15,15];var a=function(){function t(){}return t.prototype.getMarkerIcon=function(t,e){return(0,r.divIcon)(i(i({html:this._getMarkerNode(e)},t),{iconSize:[-1,-1]}))},t.prototype._getMarkerNode=function(t){var e=(0,n.newDiv)("TVLeafletMarkerContainer"),o=(0,n.newDiv)("TVMarkerChildCount",e),i=(0,n.newDiv)("TVMarkerContent",e);if(t.ChildsCount>0&&(o.textContent=t.ChildsCount.toString(),(0,n.addClass)(e,"TVMarkerChildsCountEnabled")),t.Title){(0,n.newDiv)("TVMarkerTitle",i).textContent=t.Title,(0,n.addClass)(e,"TVMarkerTitleEnabled")}if(t.Type===s.MarkerType.Active){if(t.Price>0){(0,n.newDiv)("TVMarkerPrice",i).textContent=(0,n.getPrice)(t.Price)}(0,n.addClass)(e,"TVMarkerPriceAvailable")}return e.outerHTML},t}();e.MarkerUtils=a,e.markerUtils=new a,t.markerUtils=e.markerUtils,t.MarkerUtils=a,t.CLUSTER_ICON_ANCHOR=e.CLUSTER_ICON_ANCHOR,t.HOTEL_ICON_ANCHOR=e.HOTEL_ICON_ANCHOR}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.LeafletCommonClusterControl=void 0;var r=o(80),n=o(2),s=function(t){function e(e){var o=t.call(this,e)||this;return o._Map=null,o._cluster=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),!this._cluster&&this._Map&&(this._cluster=(0,r.layerGroup)([],{}),this._Map.addLayer(this._cluster))},e.prototype.clear=function(){this._cluster.clearLayers()},e.prototype.destroy=function(){this.clear(),t.prototype.destroy.call(this)},e.prototype.addMarker=function(t){this._cluster.addLayer(t)},e.prototype.removeMarker=function(t){this._cluster.removeLayer(t)},e}(n.Control);e.LeafletCommonClusterControl=s,t.LeafletCommonClusterControl=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ResultClusterBuilder=void 0;var n=o(80),s=o(196),a=o(113),l=o(144),u=o(9),c=o(4),h=o(3),d=o(1),p=o(5),_=o(167),f=function(t){function e(e){var o=t.call(this,e)||this;return o.MarkerClicked=new h.UserEvent,o._ActiveItems=[],o._InactiveItems=[],o._PolygonParams={Bounds:[],Polygon:[]},o._Map=null,o._ModeView=p.ModeView.DescTop,o._ToursGroup=p.ToursGroupBy.Hotels,o.__initSettings(e),o}return i(e,t),e.prototype.destroy=function(){this._Map=null,t.prototype.destroy.call(this)},e.prototype._createMarkers=function(t,e,o){},e.prototype._checkMarkerInPolygon=function(t){var e=t instanceof n.Marker?t.getLatLng():{lat:t[0],lng:t[1]},o=this._PolygonParams.Bounds,i=this._PolygonParams.Polygon;return _.mapUtils.inBounds(o,e)&&_.mapUtils.inPolygon(i,e)},e.prototype._createMarker=function(t,e,o){var i=r(r({},t),{ToursGroup:o,Type:e,Click:new c.Delegate(this,this._onMarkerClicked)});switch(o){case p.ToursGroupBy.Hotels:switch(e){case l.MarkerType.Active:i.Pane=a.MapPaneType.ActiveHotelsMarkers;break;case l.MarkerType.InActive:i.Pane=a.MapPaneType.InactiveHotelsMarkers}break;case p.ToursGroupBy.Resorts:switch(e){case l.MarkerType.Active:i.Pane=a.MapPaneType.ActiveResortsMarkers;break;case l.MarkerType.InActive:i.Pane=a.MapPaneType.InactiveResortsMarkers}}return new s.LeafletMarkerControl(i)},e.prototype._onMarkerClicked=function(t){var e=t.sourceTarget;this.MarkerClicked.fire({Id:e.getId()||0,ParentId:e.getParentId()||0,ToursGroup:e.getLayerType()})},e.prototype._setViewPort=function(t){if(this._ModeView!==p.ModeView.Mobile){var e=(0,d.getProperty)(t,"containerPoint.x"),o=(0,d.getViewPort)();if(!(e&&e>o.x-200)){var i=t.isMarkerDeselected,r=0;r=i?50:e<320?e-320-50:-50,this._Map.setViewPort(r,0)}}},e.TV_MARKER_SELECTED="TVMarkerSelected",e}(u.Core);e.ResultClusterBuilder=f,t.ResultClusterBuilder=f}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MapCardControl=void 0;var r=o(2),n=o(4),s=o(3),a=o(5),l=o(1020),u=o(1021),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Hide=new s.UserEvent,o.Show=new s.UserEvent,o._Class="TVMapCardController",o._Content=null,o._Id=0,o._IsVisibleRequestButton=!0,o._IsVisibleSearchButton=!0,o._IsVisibleTours=!0,o._ParentId=0,o._ToursGroup=a.ToursGroupBy.Hotels,o._RequestPopupHide=null,o._RequestPopupShow=null,o._RunSearchOnResort=null,o._TourClicked=null,o._card=null,o._closeBtn=null,o._viewPanel=null,o.__initSettings(e),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._card=new l.CardController({IsVisibleRequestButton:this._IsVisibleRequestButton,IsVisibleSearchButton:this._IsVisibleSearchButton,IsVisibleTours:this._IsVisibleTours,Id:this._Id,ParentId:this._ParentId,ToursGroup:this._ToursGroup,RequestPopupHide:this._RequestPopupHide,RequestPopupShow:this._RequestPopupShow,RunSearchOnResort:this._RunSearchOnResort,TourClicked:this._TourClicked}),this._viewPanel=new u.ViewPanel({Content:this._card,ParentNode:this._DomNode,Hide:new n.Delegate(this,this.hide)})},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&this._card.update(e)},e.prototype.show=function(){this._rendered||this.render(),t.prototype.show.call(this)},e.prototype.hide=function(){t.prototype.hide.call(this),this._card&&this._card.hide(),this.Hide.fire()},e.prototype.destroy=function(){this._RequestPopupHide=null,this._RequestPopupShow=null,this._RunSearchOnResort=null,this._TourClicked=null,t.prototype.destroy.call(this)},e}(r.Control);e.MapCardControl=c,t.MapCardControl=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MapControllerDecoratorBase=void 0;var r=o(4),n=o(3),s=o(519),a=function(t){function e(e){var o=t.call(this,e)||this;o.HotelsSelected=new n.UserEvent,o.LayerChanged=new n.UserEvent,o.MarkerClicked=new n.UserEvent,o.ResortsSelected=new n.UserEvent,o._MapController=null,o.__initSettings(e);var i=o.getController();return i.HotelsSelected.addOnce(new r.Delegate(o,function(t){return o.HotelsSelected.fire(t)})),i.LayerChanged.addOnce(new r.Delegate(o,function(t){return o.LayerChanged.fire(t)})),i.MarkerClicked.addOnce(new r.Delegate(o,function(t){return o.MarkerClicked.fire(t)})),i.ResortsSelected.addOnce(new r.Delegate(o,function(t){return o.ResortsSelected.fire(t)})),o}return i(e,t),e.prototype.getController=function(){return this._MapController instanceof s.MapController?this._MapController:this._MapController.getController()},e.prototype.hide=function(){this._MapController.hide()},e.prototype.setParentNode=function(e){t.prototype.setParentNode.call(this,e),this.getController().setParentNode(e)},e.prototype.show=function(){this._MapController.show(),this._rendered||this.render()},e.prototype.update=function(t){this._MapController.update(t)},e}(s.MapControllerBase);e.MapControllerDecoratorBase=a,t.MapControllerDecoratorBase=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)},n=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var i,r=0,n=e.length;r<n;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.MapController=e.MapControllerBase=void 0;var s=o(105),a=o(41),l=o(159),u=o(56),c=o(17),h=o(54),d=o(155),p=o(2),_=o(4),f=o(3),y=o(1),g=o(5),C=o(6),v=o(20),m=o(94),T=o(160),w=o(18),S=o(167),P=o(37),b=o(25),I=o(114),O=o(131),M=o(1022),D=o(316),E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e}(p.Control);e.MapControllerBase=E;var k=function(t){function e(e){var o=t.call(this,e)||this;return o.HotelsSelected=new f.UserEvent,o.LayerChanged=new f.UserEvent,o.MarkerClicked=new f.UserEvent,o.ResortsSelected=new f.UserEvent,o._ModeView=g.ModeView.DescTop,o._ToursGroup=g.ToursGroupBy.Hotels,o._ErrorReport=null,o._activeItemsIds=[],o._countryId=0,o._filterSettings={},o._inactiveItemsIds=[],o._prevSelectedHotels=[],o._selectedBounds=[],o._selectedPolygon=[],o._selectedViewType=I.ViewType.Scheme,o._zoomLevel=0,o._boundsActiveItemsEnable=!1,o._resortsIdsOnMap=[],o._subResortsIdsOnMap=[],o.__initSettings(e),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e={ErrorReport:this._ErrorReport,ModeView:this._ModeView,LayerChanged:new _.Delegate(this,this._onLayerChanged),MarkerClicked:new _.Delegate(this,this._onMarkerClicked),MapZoomChanged:new _.Delegate(this,this._onMapZoomChanged),ToolDrawChanged:new _.Delegate(this,this._onToolDrawChanged)};this._ParentNode&&this._ModeView===g.ModeView.DescTop?e.ParentNode=this._ParentNode:e.DomNode=this._DomNode,this._searchMap=new M.SearchMapControl(e)},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.NoMoreTours,i=e.SelectionDisable,r=e.ToursGroup,n=e.Bounds;(0,y.isDefined)(o)&&this._searchMap.update({NoMoreTours:o}),(0,y.isDefined)(i)&&this._searchMap.update({SelectionDisable:i}),(0,y.isDefined)(r)&&(this._updateSearchMapLayers(),this._onLayerChanged({LayerType:I.LayerTypes.ToursGroup,Type:r})),n&&(this._clearPolygonOnChangingHotels(),this._hasPolygon()||this._searchMap.update({Bounds:n}))},e.prototype.hide=function(){c.resultStore.Changed.remove(this),this._searchMap.hide(),this._boundsActiveItemsEnable=!1,this._filterSettings=c.resultStore.getActualSearchSettings()},e.prototype.show=function(){var t=this;this._rendered||this.render(),this._clearPolygonOnChangingHotels(),this._ToursGroup=(0,c.getActualToursGroup)(),this._countryId=c.resultStore.getActualCountryId(),c.resultStore.Changed.addOnce(new _.Delegate(this,this._onResultStoreChanged)),this._searchMap.show(),this._updateSearchMapLayers(),this._updateSearchMapBounds(),this._querySubResorts(),setTimeout(function(){t._updateSearchMap()},0)},e.prototype._clearPolygonOnChangingHotels=function(){var t=this;if(0!==this._prevSelectedHotels.length){var e=b.settingUtils.getHotels(c.resultStore.getActualSearchFilter()),o=e.filter(function(e){return-1!==t._prevSelectedHotels.indexOf(e)});0!==o.length&&o.sort().toString()===e.sort().toString()||(this._selectedPolygon=[],this._selectedBounds=[],this._searchMap.update({IsClearPolygon:!0,PolygonParams:{Bounds:[],Polygon:[]}}))}},e.prototype._getInactiveHotels=function(){for(var t=a.hotelsStore.getFilteredInactiveHotels(),e=this._filterHotelItems(t),o=this._getHotelItemsForMap(e),i=[],r=0;r<o.length;r++){var n=o[r];-1===this._activeItemsIds.indexOf(n.Id)&&i.push(n)}return i},e.prototype._getFilterInactiveResorts=function(){for(var t=u.resortsStore.getResorts(this._countryId)||[],e=u.resortsStore.getInactiveResorts(),o=Object.keys(e).map(function(t){return e[t]}),i=P.searchMapUtils.getResortItemsForMap(o,t),r=[],n=this,s=0;s<i.length;s++)!function(t){var e=i[t];n._activeItemsIds.some(function(t){return t===e.Id})||r.push(e)}(s);return r},e.prototype._hasPolygon=function(){return this._selectedPolygon.length>0},e.prototype._onLayerChanged=function(t){var e=t.LayerType,o=t.Type,i=t.Zoom;switch(e){case I.LayerTypes.ToursGroup:this._ToursGroup=o,this._zoomLevel=i,this._updateSearchMap(),c.resultStore.setGlobals({ToursGroup:o});break;case I.LayerTypes.View:this._selectedViewType=o}this.LayerChanged.fire(t)},e.prototype._onMarkerClicked=function(t){this.MarkerClicked.fire(t)},e.prototype._onResultStoreChanged=function(t){var e=t.Type,o=t.IsPassedFilteringFunction;if(e===v.CatalogName.Hotel&&o){var i=t.Id;switch(this._ToursGroup){case g.ToursGroupBy.Hotels:var a=s.hotelGate.getItem(i);if(0===d.tourGate.getItems(i).length)return;var h=this._getHotelItemsForMap([a]);h.length>0&&((0,y.insertUnique)(this._activeItemsIds,i),this._searchMap.update({ActiveItems:h,IsNewActiveItems:!1,ToursGroup:g.ToursGroupBy.Hotels}));break;case g.ToursGroupBy.Resorts:var p=s.hotelGate.getItemData(i);if(!(0,y.isDefined)(p)||(0,y.isDefined)(p)&&!(0,y.isDefined)(p.regioncode))return;var _=Number(p.regioncode||""),f=Number(p.subregioncode||""),C=this._resortsIdsOnMap.some(function(t){return t===_}),m=!C&&this._subResortsIdsOnMap.some(function(t){return t===f}),T=u.resortsStore.getResort(_),w=P.searchMapUtils.getSubRegionZoom(T),S=this._zoomLevel<w,b=this._zoomLevel>=w,I=null,O=null,M=null,D=0;C||S?(D=_,I=u.resortsStore.getResort(_),O=u.resortsStore.getInactiveResort(_)||[],M=l.resortGate.getItem(_)||{},(0,y.insertUnique)(this._activeItemsIds,_),(0,y.insertUnique)(this._resortsIdsOnMap,_)):(m||b)&&(D=f,I=u.resortsStore.getSubResort(f),O=u.resortsStore.getInactiveSubResort(f)||{},M=l.resortGate.getChildItem(f)||{},(0,y.insertUnique)(this._activeItemsIds,f),(0,y.insertUnique)(this._subResortsIdsOnMap,f));if(!(I&&P.searchMapUtils.hasCoords(I.coord)))return;var E=M.hotels||[],k=O.hotels||[],R=(0,y.getUniqueKeysFromArray)(n(n([],E,!0),k,!0)),A=P.searchMapUtils.resortForMap(r(r({},I),{childrenCount:R.length||0,id:D,minprice:M.minprice||0}));this._searchMap.update({ActiveItems:[A],IsNewActiveItems:!1,ToursGroup:g.ToursGroupBy.Resorts})}}if(e===v.CatalogName.FilterHotels)switch(this._ToursGroup){case g.ToursGroupBy.Hotels:var R=s.hotelGate.getItems()||[],h=this._getHotelItemsForMap(R);this._activeItemsIds=h.map(function(t){return t.Id});var V=c.resultStore.getActualSearchSettings(),L=P.searchMapUtils.hasPriceInSettings(V)?[]:this._getInactiveHotels();this._searchMap.update({ActiveItems:h,InactiveItems:L,IsNewActiveItems:!0,IsNewInactiveItems:!0,ToursGroup:g.ToursGroupBy.Hotels});break;case g.ToursGroupBy.Resorts:this._updateResortsMarkers()}},e.prototype._onToolDrawChanged=function(t){var e=t.Coords,o=e.length>0;if(o||this._hasPolygon()){this._selectedPolygon=e,this._selectedBounds=o?S.mapUtils.getBounds(this._selectedPolygon):[];var i=[];if(o){this._ToursGroup!==g.ToursGroupBy.Hotels&&(this._ToursGroup=g.ToursGroupBy.Hotels,this._updateSearchMapLayers(),this._onLayerChanged({LayerType:I.LayerTypes.ToursGroup,Type:this._ToursGroup}));for(var r=a.hotelsStore.getHotelsByCountry(this._countryId),n=this._filterHotelItems(r),s=c.resultStore.getHotelsFilterFunction(),l=Boolean(s),u=0;u<n.length;u+=1){var h=n[u],d=h.id,p=h.coord;if(p&&((!l||s(h))&&S.mapUtils.inBounds(this._selectedBounds,p)&&S.mapUtils.inPolygon(this._selectedPolygon,p))){if(i.push(d)>=P.filterLimit){i.length=0;break}}}i.length>0&&(this._prevSelectedHotels=i,this.HotelsSelected.fire({Hotels:i})),this._searchMap.update({Bounds:P.searchMapUtils.getBoundsFromDraw(this._selectedBounds),PolygonParams:{Bounds:this._selectedBounds,Polygon:this._selectedPolygon}})}else this._prevSelectedHotels.length>0&&(this._prevSelectedHotels=[],this.HotelsSelected.fire({Hotels:[]})),this._searchMap.update({PolygonParams:{Bounds:[],Polygon:[]}})}},e.prototype._updateHotelsMarkers=function(){var t=s.hotelGate.getItems()||[],e=this._getHotelItemsForMap(t),o=this._activeItemsIds;this._activeItemsIds=e.map(function(t){return t.Id});var i=c.resultStore.getActualSearchSettings(),r=P.searchMapUtils.hasPriceInSettings(i)?[]:this._getInactiveHotels();this._inactiveItemsIds=r.map(function(t){return t.Id});var n={ActiveItems:e,InactiveItems:r,IsNewActiveItems:!0,IsNewInactiveItems:!0,ToursGroup:this._ToursGroup};this._boundsActiveItemsEnable&&o.sort().toString()!==this._activeItemsIds.sort().toString()&&(n.BoundsActiveItemsEnabled=!0),this._searchMap.update(n)},e.prototype._updateResortsMarkers=function(){var t=u.resortsStore.getResorts(this._countryId)||[],e=l.resortGate.getItems()||[],o=u.resortsStore.getInactiveResorts(),i=c.resultStore.getActualSearchSettings(),r=P.searchMapUtils.getResortItemsForMap(e,t,o),s=this._convertResortsFromActiveResorts(r),a=P.searchMapUtils.hasPriceInSettings(i);a&&(s.InactiveSubResorts=[]);var h=a?[]:this._getFilterInactiveResorts(),d=this._convertResortsFromInactiveResorts(h),p=n(n([],s.ActiveResorts,!0),s.ActiveSubResorts,!0),_=n(n(n([],s.InactiveSubResorts,!0),d.InactiveResorts,!0),d.InactiveSubResorts,!0);this._inactiveItemsIds=h.map(function(t){return t.Id}),this._searchMap.update({ActiveItems:p,InactiveItems:_,IsNewActiveItems:!0,IsNewInactiveItems:!0,ToursGroup:this._ToursGroup}),this._resortsIdsOnMap=n(n([],s.ActiveResorts.map(function(t){return t.Id}),!0),d.InactiveResorts.map(function(t){return t.Id}),!0),this._subResortsIdsOnMap=n(n(n([],s.ActiveSubResorts.map(function(t){return t.Id}),!0),s.InactiveSubResorts.map(function(t){return t.Id}),!0),d.InactiveSubResorts.map(function(t){return t.Id}),!0)},e.prototype._separateResortsToExpanding=function(t){var e=this,o=[],i=[];return t.forEach(function(t){if(e._zoomLevel>=t.Zoom){u.resortsStore.getSubResortsByResort(t.Id).length>0?o.push(t):i.push(t)}else i.push(t)}),{Expand:o,NoExpand:i}},e.prototype._convertResortsFromActiveResorts=function(t){var e=this,o=l.resortGate.getChildItems()||[],i=u.resortsStore.getInactiveSubResorts(),r=this._separateResortsToExpanding(t),s=[],a=[];r.Expand.forEach(function(t){s=n(n([],s,!0),u.resortsStore.getSubResortsByResort(t.Id),!0);var e=Object.keys(i).map(function(t){return i[t]}).filter(function(e){return e.resortId===t.Id});a=n(n([],a,!0),e,!0)});var c=P.searchMapUtils.getResortItemsForMap(o,s,i);this._activeItemsIds=n(n([],t.map(function(t){return t.Id}),!0),c.map(function(t){return t.Id}),!0),a=a.filter(function(t){return-1===e._activeItemsIds.indexOf(t.id)});var h=P.searchMapUtils.getResortItemsForMap(a,s);return{ActiveResorts:r.NoExpand,ActiveSubResorts:c,InactiveSubResorts:h}},e.prototype._convertResortsFromInactiveResorts=function(t){var e=u.resortsStore.getInactiveSubResorts(),o=this._separateResortsToExpanding(t),i=[],r=[];o.Expand.forEach(function(t){i=n(n([],i,!0),u.resortsStore.getSubResortsByResort(t.Id),!0);var o=Object.keys(e).map(function(t){return e[t]}).filter(function(e){return e.resortId===t.Id});r=n(n([],r,!0),o,!0)});var s=P.searchMapUtils.getResortItemsForMap(r,i);return{InactiveResorts:o.NoExpand,InactiveSubResorts:s}},e.prototype._updateBoundsActiveItemsEnabled=function(){this._boundsActiveItemsEnable=c.resultStore.getFinishedSearching()},e.prototype._updateSearchMap=function(){var t=this;switch(this._ToursGroup){case g.ToursGroupBy.Hotels:var e=a.hotelsStore.getHotelsByCountry(this._countryId);this._filterHotelItems(e).length>0?this._updateHotelsMarkers():(0,O.loadHotelsCatalog)(this._countryId).then(function(){t._updateHotelsMarkers()});break;case g.ToursGroupBy.Resorts:var o=u.resortsStore.getResorts(this._countryId),i=u.resortsStore.getSubResorts(this._countryId);switch(!0){case!o&&!i:var r=m.regionService.all({countryId:this._countryId}),n=T.subRegionService.all({countryId:this._countryId});Promise.all([r,n]).then(function(e){var o=e[0],i=e[1];u.resortsStore.setResorts(t._countryId,o),u.resortsStore.setSubResorts(t._countryId,i),t._updateResortsMarkers()});break;case!!o&&!i:T.subRegionService.all({countryId:this._countryId}).then(function(e){u.resortsStore.setSubResorts(t._countryId,e),t._updateResortsMarkers()});break;case!!o&&!!i:this._updateResortsMarkers()}}},e.prototype._updateSearchMapBounds=function(){if(!this._hasPolygon()){var t=c.resultStore.getGlobals().SearchBounds;if((0,y.isDefined)(t))return this._searchMap.update({Bounds:t}),void c.resultStore.setGlobals({SearchBounds:void 0});var e=c.resultStore.getActualSearchSettings();if((0,C.isEqualsSettings)(e,this._filterSettings))return void this._updateBoundsActiveItemsEnabled();this._filterSettings=c.resultStore.getActualSearchSettings();var o=(0,D.getHotelsResortsBounds)(e);if(o.length>0){var i=P.searchMapUtils.getBoundsBorder(o);if((0,y.isDefined)(i))return void this._searchMap.update({Bounds:i})}this._updateBoundsActiveItemsEnabled();var r=c.resultStore.getCountryInfo(),n=P.searchMapUtils.getCountryBounds(r);this._searchMap.update({Bounds:n})}},e.prototype._updateSearchMapLayers=function(){this._searchMap.update({SelectedLayers:[{Item:this._ToursGroup,LayerType:I.LayerTypes.ToursGroup},{Item:this._selectedViewType,LayerType:I.LayerTypes.View}]})},e.prototype._filterHotelItems=function(t){var e=h.searchCatalog.getResorts();return w.hotelUtils.getItemsByAirport(t,e,c.resultStore.getActualSearchSettings())},e.prototype._getHotelItemsForMap=function(t){for(var e=[],o=0;o<t.length;o++){var i=t[o];if(i){var n=a.hotelsStore.getHotel(i.id);(0,y.isDefined)(n)&&P.searchMapUtils.hasCoords(n.coord)&&e.push(P.searchMapUtils.hotelForMap(r(r({},i),n)))}}return e},e.prototype._onMapZoomChanged=function(t){this._zoomLevel=t.Zoom,this._ToursGroup===g.ToursGroupBy.Resorts&&this._updateResortsMarkers()},e.prototype._querySubResorts=function(){var t=this;u.resortsStore.getSubResorts(this._countryId)||T.subRegionService.all({countryId:this._countryId}).then(function(e){u.resortsStore.setSubResorts(t._countryId,e)})},e}(E);e.MapController=k,t.MapController=k}).call(e,o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MapFilterControl=void 0;var n=o(17),s=o(2),a=o(4),l=o(3),u=o(1),c=o(5),h=o(6),d=o(24),p=function(e){function o(t){var o=e.call(this,t)||this;return o.Changed=new l.UserEvent,o.FilterVisibilityChanged=new l.UserEvent,o.templateName="map-filter",o._Currency=c.Currency.Rub,o._FormType=c.FormType.HotelFilter,o._ModeView=c.ModeView.DescTop,o._PriceType=c.PriceType.ForPerson,o._Theme=c.Theme.Theme2,e.prototype.__initSettings.call(o,t),o.render(),o}return r(o,e),o.prototype.render=function(){e.prototype.render.call(this);var o=t.newSearchForm;this._filter=o({ModeView:this._ModeView,ParentNode:this._nodes.body,Theme:this._Theme,Type:this._FormType,FilterVisibilityChanged:new a.Delegate(this,this._onFilterVisibilityChanged),ResetClicked:new a.Delegate(this,this._onResetBtnClick),SettingsChanged:new a.Delegate(this,this._onSearchFormChanged)})},o.prototype.update=function(t){e.prototype.update.call(this,t),this._checkResetBtnDisabling(),this._filter.update(t)},o.prototype._onFilterVisibilityChanged=function(t){this.FilterVisibilityChanged.fire(t)},o.prototype._onHeaderClick=function(t){t.preventDefault(),(0,u.toggleVisible)(this._nodes.body),(0,u.toggleClass)(this._nodes.header,o.TV_ACTIVE)},o.prototype._onSearchFormChanged=function(t){this.Changed.fire(t),this._checkResetBtnDisabling()},o.prototype._onResetBtnClick=function(){this._isDefaultFilterSettings()||(this.Changed.fire(d.searchUtils.defaultFilterSettings()),this._checkResetBtnDisabling())},o.prototype._isDefaultFilterSettings=function(){var t=d.searchUtils.defaultFilterSettings(),e=n.resultStore.getActualSearchSettings();return(0,h.isEqualsFilterSettings)(e,t)},o.prototype._checkResetBtnDisabling=function(){this._isDefaultFilterSettings()?(0,u.addClass)(this._filter,"TVResetBtnDisabled"):(0,u.removeClass)(this._filter,"TVResetBtnDisabled")},o.TV_ACTIVE="TVActive",o}(s.Control);e.MapFilterControl=p,i.MapFilterControl=p}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MapWindow=void 0;var r=o(43),n=o(1),s=o(15),a=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVMapWindowBody",o._FixMap=!1,o._popUpOffsetTop=20,o._fixMapScrollTop=0,o._mapScrollTop=0,o._prevCssOverflow="",o._prevOffsetTop=0,o.__initSettings(e),o._onResize=o._onResize.bind(o),o._onScroll=o._onScroll.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),(0,n.addClass)(this._mainContainer,""+e.MAP_WINDOW_CLASS)},e.prototype.show=function(){t.prototype.show.call(this),this._prevCssOverflow=document.body.style.overflow,(0,n.addClass)(document.body,e.MAP_VISIBLE_CLASS),(0,n.addEvent)(window,"resize",this._onResize),this._onResize(),this._mapScrollTop=document.documentElement.scrollTop,(0,n.addEvent)(document,"scroll",this._onScroll)},e.prototype.update=function(o){t.prototype.update.call(this,o);var i=o.FixMap;(0,n.isDefined)(i)&&((0,n.removeEvent)(document,"scroll",this._onScroll),i?((0,n.addClass)(this._ParentNode,e.MAP_WINDOW_FIX_CLASS),(0,n.addClass)(document.body,e.MAP_TOUR_CARD_VISIBLE_CLASS),this._prevOffsetTop=this._ParentNode.offsetTop,this._ParentNode.style.top=this._popUpOffsetTop+"px",this._fixMapScrollTop=window.scrollY):((0,n.removeClass)(this._ParentNode,e.MAP_WINDOW_FIX_CLASS),(0,n.removeClass)(document.body,e.MAP_TOUR_CARD_VISIBLE_CLASS),this._ParentNode.style.top=this._prevOffsetTop+"px",window.scrollTo(0,this._fixMapScrollTop),this._fixMapScrollTop=0))},e.prototype._hide=function(){t.prototype._hide.call(this),(0,n.removeClass)(document.body,e.MAP_VISIBLE_CLASS),document.body.style.overflow=this._prevCssOverflow,(0,n.removeEvent)(window,"resize",this._onResize),(0,n.removeEvent)(document,"scroll",this._onScroll)},e.prototype._onResize=function(){var t=.01*window.innerHeight;s.styleUtils.setDocumentStyleProperty([{Property:e.MAP_WINDOW_VH_PROPERTY,Value:t+"px"}])},e.prototype._onScroll=function(t){document.documentElement.scrollTop=this._mapScrollTop,t.preventDefault()},e.MAP_TOUR_CARD_VISIBLE_CLASS="TVTourCardWindowVisible",e.MAP_VISIBLE_CLASS="TVMapVisible",e.MAP_WINDOW_FIX_CLASS="TVMapWindowFix",e.MAP_WINDOW_VH_PROPERTY="--tvMapWindowVH",e.MAP_WINDOW_CLASS="TVMapWindow",e}(r.PopUpBase);e.MapWindow=a,t.MapWindow=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorMessage=void 0;var r=o(117),n=o(23),s=o(133),a=o(2),l=o(3),u=o(1),c=o(5),h=o(8),d=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="error-message",o.SendMessage=new l.UserEvent,o._Email="",o._IsManager=!1,o._Message="",o._ModeView=c.ModeView.DescTop,t.prototype.__initSettings.call(o,e),o._onSend=o._onSend.bind(o),o._onInput=o._onInput.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){this._removeEvents(),t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this),this._agreement=new s.AgreementControl({IsMobile:this._ModeView===c.ModeView.Mobile,ParentNode:this._nodes.link}),this._addEvents()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ShowResult,i=e.ShowWaiter;(0,u.isDefined)(o)&&((0,u.setVisible)(this._nodes.result,o),(0,u.setVisible)(this._nodes.panel,!o)),(0,u.isDefined)(i)&&(this._waiter||(this._waiter=this._ModeView!==c.ModeView.DescTop?new r.MobileLoaderControl({ParentNode:this._DomNode}):new n.Waiter({ParentNode:this._nodes.result})),i?this._waiter.show():this._waiter.hide())},e.prototype._onSend=function(){var t=this._nodes,e=t.email,o=t.message;if(this._IsManager)return o.value?void this.SendMessage.fire({Email:e.value,Message:o.value}):void(0,u.addClass)(o,h.TV_WARNING)},e.prototype._onInput=function(){var t=this._nodes.message;t.value&&(0,u.removeClass)(t,h.TV_WARNING)},e.prototype._addEvents=function(){(0,u.addEvent)(this._nodes.button,"click",this._onSend),(0,u.addEvent)(this._nodes.message,"input",this._onInput)},e.prototype._removeEvents=function(){(0,u.removeEvent)(this._nodes.button,"click",this._onSend),(0,u.removeEvent)(this._nodes.message,"input",this._onInput)},e.displayName="ErrorMessage",e.SUCCESS_TIMEOUT=5e3,e}(a.Control);e.ErrorMessage=d,t.ErrorMessage=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.GalleryPage=void 0;var r=o(134),n=o(136),s=o(4),a=o(3),l=o(7),u=o(1),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Change=new a.UserEvent,o._ActiveIndex=0,o._LayoutClass="TVGalleryPage",o._Items=[],o._Title="",o._count=0,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._layoutControl.update({ShowMenu:!1,ShowProgress:!1})},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._photoGallery){this._photoGallery.update(e);var o=e.ActiveIndex,i=e.Items,r=e.Title;(0,u.isDefined)(r)&&this._layoutControl.update({Caption:r}),((0,u.isDefined)(i)||(0,u.isDefined)(o))&&(this._count=this._Items.length,this._updateHeader(this._ActiveIndex))}},e.prototype._getContent=function(){if(!this._photoGallery){var t=(0,u.getViewPort)(),e=t.x,o=t.y,i=o>=l.MAX_PHONE_HEIGHT&&e>=l.MAX_PHONE_WIDTH,r=i?n.PhotoSwitching.Opacity:n.PhotoSwitching.Transform;this._photoGallery=new n.PhotoGalleryControl({PhotoSwitching:r,Change:new s.Delegate(this,this._onChanged),Click:new s.Delegate(this,this._onClick)})}return this._photoGallery},e.prototype._onClick=function(){this._layoutControl.setVisibleHeader(!this._layoutControl.getVisibleHeader())},e.prototype._onChanged=function(t){var e=t.ActiveIndex;this._updateHeader(e),this.Change.fire(t)},e.prototype._updateHeader=function(t){this._countNode&&this._countNode.parentNode||(this._countNode=(0,u.newDiv)("TVGalleryPageCount",this._layoutControl.getHeader())),this._countNode.textContent=t+1+"/"+this._count},e.displayName="GalleryPage",e}(r.LayoutPage);e.GalleryPage=c,t.GalleryPage=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RequestPage=void 0;var r=o(36),n=o(5),s=o(317),a=function(t){function e(e){var o=t.call(this,e)||this;return o._LayoutClass="TVRequestPage",o._SendClicked=null,o._requestControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.show=function(){t.prototype.show.call(this),this._requestControl&&this._requestControl.show()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._requestControl&&this._requestControl.update(e)},e.prototype.destroy=function(){this._SendClicked=null,t.prototype.destroy.call(this)},e.prototype._getContent=function(){return this._requestControl||(this._requestControl=new s.RequestControl({ModeView:n.ModeView.Mobile,Send:this._SendClicked})),this._requestControl},e.displayName="RequestPage",e}(r.Page);e.RequestPage=a,t.RequestPage=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RoomControl=void 0;var r=o(8),n=o(2),s=o(7),a=o(1),l=o(1049),u=o(76),c=o(12),h=o(136),d=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="room",o._Area="",o._Title="",o._Description="",o._Photos=[],o._resizeObserver=null,o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.disable=function(){this._disconnectObserver()},e.prototype.enable=function(){this._observeResize(this._DomNode)},e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes,o=e.description,i=e.photo;o.innerHTML=this._Description,this._photoGallery=new h.PhotoGalleryControl({ParentNode:i,PhotoSwitching:h.PhotoSwitching.Transform,TemplateName:h.PhotoGalleryTemplate.ROOM}),this._updatePhotoGallery(),this._observeResize(this._DomNode)},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Description,i=e.Photos,n=e.IsVisiblePreview;(0,a.isDefined)(o)&&this._updateDescription(),(0,a.isDefined)(i)&&this._updatePhotoGallery(),(0,a.isDefined)(n)&&(0,a.updateClass)(this._DomNode,r.TV_PREVIEW,n)},e.prototype.destroy=function(){this._disconnectObserver(),t.prototype.destroy.call(this)},e.prototype._init=function(){this._onResize=(0,l.throttle)(this._onResize.bind(this),s.DEFAULT_RESIZE_THROTTLE)},e.prototype._updateDescription=function(){this._nodes.description.innerHTML=(0,c.sanitizeHTML)(this._Description)},e.prototype._updatePhotoGallery=function(){this._photoGallery.update({ActiveIndex:0,Items:this._Photos});var t=this._nodes.photo;this._Photos.length>0?((0,a.show)(t),(0,a.removeClass)(this._DomNode,"TVRoomNoPhoto")):((0,a.hide)(t),(0,a.addClass)(this._DomNode,"TVRoomNoPhoto"))},e.prototype._onResize=function(){(0,a.updateClass)(this._DomNode,"TVWideRoom",this._DomNode.offsetWidth>700)},e.prototype._disconnectObserver=function(){this._resizeObserver&&((0,u.removeResizeObserver)(this._resizeObserver),this._resizeObserver=null)},e.prototype._observeResize=function(t){this._resizeObserver&&this._disconnectObserver(),this._resizeObserver=(0,u.newResizeObserver)(this._onResize,t)},e}(n.Control);e.RoomControl=d,t.RoomControl=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.RoomPage=void 0;var n=o(36),s=o(525),a=o(1),l=function(t){function e(e){var o=t.call(this,e)||this;return o._Content=null,o._IsVisiblePreview=!1,o._LayoutClass="TVRoomPage",o._RoomInfo={},o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._Content){var o=e.IsVisiblePreview,i=e.RoomInfo;((0,a.isDefined)(i)||(0,a.isDefined)(o))&&this._Content.update(r(r({},this._RoomInfo),{IsVisiblePreview:this._IsVisiblePreview}))}},e.prototype._getContent=function(){return this._Content?this._Content:new s.RoomControl(this._RoomInfo)},e.displayName="RoomPage",e}(n.Page);e.RoomPage=l,t.RoomPage=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourRedirectionInfoControl=void 0;var r=o(8),n=o(2),s=o(3),a=o(1),l=o(5),u=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="tour-redirection-info",o.Submit=new s.UserEvent,o._ModeView=l.ModeView.DescTop,o._ToAddress="",o._ToLogo="",o._ToName="",o._ToPhone="",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateModeViewClass(),this._updateToLogo(),this._updateToInfo(),this._updateDescription(),this._updateSteps(),this._updateSubmitContent()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ToLogo,i=e.ToName,r=e.ToAddress,n=e.ToPhone;(0,a.isDefined)(o)&&this._updateToLogo(),((0,a.isDefined)(i)||(0,a.isDefined)(r)||(0,a.isDefined)(n))&&this._updateToInfo()},e.prototype._renderSteps=function(){var t=this,e=this._nodes.stepsNode;this._getSteps().forEach(function(o){return t._renderStep(o,e)})},e.prototype._renderStep=function(t,e){var o=t.Order,i=t.Subtitle,r=t.Title,n=(0,a.newDiv)("TVTourRedirectionInfoStep",e);(0,a.newDiv)("TVTourRedirectionInfoStepOrder",n).textContent=""+o;var s=(0,a.newDiv)("TVTourRedirectionInfoStepContent",n);(0,a.newDiv)("TVTourRedirectionInfoStepTitle",s).textContent=r,(0,a.newDiv)("TVTourRedirectionInfoStepSubtitle",s).textContent=i},e.prototype._onSubmitNodeClick=function(){this.Submit.fire()},e.prototype._updateModeViewClass=function(){(0,a.updateClass)(this._DomNode,r.TV_MOBILE,this._ModeView===l.ModeView.Mobile)},e.prototype._updateDescription=function(){this._nodes.descriptionNode.textContent="Вы выбрали нашу компанию для бронирования тура, найденного в системе поиска туров tourvisor.ru"},e.prototype._updateSteps=function(){var t=this._nodes.stepsNode;(0,a.removeChildren)(t),this._renderSteps()},e.prototype._updateSubmitContent=function(){this._nodes.submitNode.textContent="Продолжить"},e.prototype._updateToInfo=function(){var t=this._nodes,e=t.toNameNode,o=t.toAddressNode,i=t.toPhoneNode;e.textContent=this._ToName||"",o.textContent=this._ToAddress||"",i.textContent=this._ToPhone||""},e.prototype._updateToLogo=function(){var t=this._nodes.toLogoNode,e=Boolean(this._ToLogo);t.style.backgroundImage=e?'url("'+this._ToLogo+'")':"",(0,a.setVisible)(t,e||this._IsVisiblePreview)},e.prototype._getSteps=function(){return[{Order:1,Subtitle:"Внимательно проверьте даты тура, отель, питание, тип номера, рейсы",Title:"Проверьте параметры тура"},{Order:2,Subtitle:"Укажите паспортные данные туристов, а также ваши контакты для связи и получения документов на тур",Title:"Введите данные туристов"},{Order:3,Subtitle:"Введите данные карты на странице банка, платежные данные надежно защищены",Title:"Оплатите тур"},{Order:4,Subtitle:"После оплаты мы забронируем выбранный тур, сообщим о его подтверждении, выдадим документы и проконсультируем по всем возникающим вопросам",Title:"Получите документы"}]},e}(n.Control);e.TourRedirectionInfoControl=u,t.TourRedirectionInfoControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__rest||function(t,e){var o={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(o[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(o[i[r]]=t[i[r]]);return o};Object.defineProperty(e,"__esModule",{value:!0}),e.TourRedirectionWindow=void 0;var n=o(8),s=o(44),a=o(224),l=o(2),u=o(4),c=o(3),h=o(1),d=o(5),p=o(6),_=o(1067),f=o(1068),y=function(t){function e(e){var o=t.call(this,e)||this;return o.ErrorClicked=new c.UserEvent,o.Hide=new c.UserEvent,o._Class="TVTourRedirectionWindow",o._ModeView=d.ModeView.DescTop,o._ViewMode=a.TourRedirectionViewModeEnum.SUCCESS,o._redirectionControl=null,o._errorRedirectionControl=null,o._switcher=null,o.__initSettings(e),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderRedirectionControl(),this._renderErrorRedirectionControl(),this._renderSwitcher(),this._updateViewMode()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ViewMode,i=r(e,["ViewMode"]);(0,h.isDefined)(o)&&this._updateViewMode(),(0,p.isNotEmptyObject)(i)&&this._redirectionControl.update(i)},e.prototype.show=function(){this._rendered||this.render(),t.prototype.show.call(this),this._show()},e.prototype.hide=function(){t.prototype.hide.call(this),this._hide()},e.prototype._show=function(){document.body.appendChild(this._DomNode),(0,h.addClass)(document.body,n.TV_BODY_SCROLL_DISABLED)},e.prototype._hide=function(){(0,h.remove)(this._DomNode),(0,h.removeClass)(document.body,n.TV_BODY_SCROLL_DISABLED),this.Hide.fire()},e.prototype._renderRedirectionControl=function(){this._redirectionControl=new f.TourRedirectionControl({ModeView:this._ModeView,ParentNode:this._DomNode})},e.prototype._renderErrorRedirectionControl=function(){this._errorRedirectionControl=new _.TourErrorRedirectionControl({ModeView:this._ModeView,ParentNode:this._DomNode,Clicked:new u.Delegate(this,this._onErrorClicked)})},e.prototype._renderSwitcher=function(){this._switcher=new s.LayerSwitch,this._switcher.add(this._redirectionControl.getDomNode(),a.TourRedirectionViewModeEnum.SUCCESS),this._switcher.add(this._errorRedirectionControl.getDomNode(),a.TourRedirectionViewModeEnum.ERROR)},e.prototype._updateViewMode=function(){this._switcher.showById(this._ViewMode)},e.prototype._onErrorClicked=function(){this.ErrorClicked.fire()},e}(l.Control);e.TourRedirectionWindow=y,t.TourRedirectionWindow=y}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__awaiter||function(t,e,o,i){function r(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,n){function s(t){try{l(i.next(t))}catch(t){n(t)}}function a(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){t.done?o(t.value):r(t.value).then(s,a)}l((i=i.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){function o(t){return function(e){return i([t,e])}}function i(o){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,n=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){l.label=o[1];break}if(6===o[0]&&l.label<s[1]){l.label=s[1],s=o;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(o);break}s[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(t,l)}catch(t){o=[6,t],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var r,n,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(e,"__esModule",{value:!0}),e.calendarDataService=e.CalendarDataService=void 0;var n=o(218),s=o(1077),a=function(){function t(){this._cashedPromises={}}return t.prototype.getTours=function(t){return void 0===t&&(t={}),i(this,void 0,void 0,function(){var e;return r(this,function(o){return e=n.serviceUtils.getHash(t),this._cashedPromises[e]||(this._cashedPromises[e]=s.calendarService.query(t)),[2,this._cashedPromises[e]]})})},t}();e.CalendarDataService=a,e.calendarDataService=new a,t.calendarDataService=e.calendarDataService,t.CalendarDataService=a}).call(e,o(0))},,,,,,,,function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TableSelectCity=void 0;var n=o(8),s=o(2),a=o(4),l=o(3),u=o(7),c=o(1),h=o(91),d=o(96),p=o(396),_=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new l.UserEvent,o._ContentNode=null,o._Items=[],o._ParentVoice=!0,o._Selected=[],o._adaptiveCore=null,o._prevSelected=[],o._tableCity=null,t.prototype.__initSettings.call(o,e),o.render(),o}return i(e,t),e.prototype.getDropPanel=function(){return this._adaptiveCore},e.prototype.render=function(){t.prototype.render.call(this),this._ContentNode=this._ContentNode?this._ContentNode:this._DomNode,this._adaptiveCore=new d.AdaptiveCore({Class:"TVCityPanel",Control:this._DomNode,FooterFixed:!0,Hide:new a.Delegate(this,this._onAdaptiveCoreHide),Show:new a.Delegate(this,this._onAdaptiveCoreShow)}),this._tableCity=new p.TableCities({HasWithoutCity:h.cityUtils.hasNoFlight(this._Items),Items:this._getItems(),ParentNode:this._DomNode,Render:!1,Selected:this._Selected,Changed:new a.Delegate(this,this._onTableCitiesChanged),CloseClicked:new a.Delegate(this._adaptiveCore,this._adaptiveCore.hide)}),this._adaptiveCore.addChild(this._tableCity),this._updateContent()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&(this._tableCity.update(r(r({},e),{HasWithoutCity:h.cityUtils.hasNoFlight(this._Items),Items:this._getItems()})),this._updateContent())},e.prototype._getItems=function(){return h.cityUtils.getCitiesWithoutNoFlight(this._Items)},e.prototype._onTableCitiesChanged=function(t){this._Selected=t.Selected,this._updateContent(),this._adaptiveCore.hide()},e.prototype._onAdaptiveCoreHide=function(){this._tableCity.finish(),this._prevSelected.toString()===this._Selected.toString()||this.Changed.fire({Selected:this._Selected})},e.prototype._onAdaptiveCoreShow=function(){this._prevSelected=this._Selected},e.prototype._updateContent=function(){var t=this,e="";if(this._Items&&this._Selected.length>0)switch(this._Selected.length){case 1:var o=this._Selected[0],i=this._Items.find(function(t){return Number(t.id)===o});i&&(e=this._ParentVoice?i.namefrom:i.name,Number(i.id)===u.DEPARTURE_NO_FLIGHT_ID?(0,c.addClass)(this._ContentNode.parentNode,n.TV_CITY_NO_FLIGHT):(0,c.removeClass)(this._ContentNode.parentNode,n.TV_CITY_NO_FLIGHT));break;default:e=this._Items.filter(function(e){return t._Selected.indexOf(Number(e.id))>-1}).map(function(e){return t._ParentVoice?e.namefrom:e.name}).join(", ")}this._ContentNode.textContent=e,(0,c.updateClass)(this._DomNode,n.TV_NOT_SELECTED,!e)},e}(s.Control);e.TableSelectCity=_,t.TableSelectCity=_}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RestCombo=void 0;var r=o(4),n=o(3),s=o(1),a=o(5),l=o(275),u=o(321),c=function(t){function e(e){var o=t.call(this,e)||this;return o.SelectionChanged=new n.UserEvent,o.ItemSelected=new n.UserEvent,o._DropPanelClass="TVRestComboPanel",o._Items=[a.RestType.SeaBeach,a.RestType.Sky,a.RestType.Excursion],o._ActiveFilters=[],o._tempFilters=[],t.prototype.__initSettings.call(o,e),e=e||{},o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._render(),this._updateContent()},e.prototype.setItems=function(t){this._Items=t,this._restFilter.refresh({Items:this._Items}),this._updateContent()},e.prototype.update=function(e){t.prototype.update.call(this,e),e.ActiveFilters&&(this._restFilter.refresh({ActiveFilters:this._ActiveFilters}),this._updateContent())},e.prototype.setSelectedById=function(t,e){if(!(0,s.isDefined)(e)||e){if(this._ActiveFilters.indexOf(t)>-1)return;this._ActiveFilters.push(t)}else{if(-1===this._Items.indexOf(t))return;this._ActiveFilters=this._ActiveFilters.filter(function(e){return e!==t}.bind(this))}this._restFilter.refresh({ActiveFilters:this._ActiveFilters}),this._updateContent()},e.prototype._render=function(){this._restFilter=new u.RestFilter({ActiveFilters:this._ActiveFilters,Delay:0,Items:this._Items,FilterChange:new r.Delegate(this,this._onFilterChanged)});var t=(0,s.newDiv)("TVOkeyButton");(0,s.addEvent)(t,"click",this._onOkClicked.bind(this)),this._AdaptiveCore.addChild(this._restFilter),this._AdaptiveCore.addChild(t),this._AdaptiveCore.Show.add(new r.Delegate(this,this._onShow)),this._AdaptiveCore.Hide.add(new r.Delegate(this,this._onHide))},e.prototype._onOkClicked=function(){this.SelectionChanged.fire({IdArr:this._ActiveFilters}),this._updateContent(),this._AdaptiveCore.hide({type:"submit"})},e.prototype._onFilterChanged=function(t){this._ActiveFilters=t.ActiveFilters},e.prototype._onShow=function(){this._tempFilters=this._ActiveFilters.slice()},e.prototype._onHide=function(t){t&&"submit"===t.type||(this._ActiveFilters=this._tempFilters.slice(),this._tempFilters=[],this._restFilter.refresh({ActiveFilters:this._ActiveFilters}))},e.prototype._updateContent=function(){for(var t=[],e=0;e<this._ActiveFilters.length;e++)t.push(u.RestFilter.getTitleById(this._ActiveFilters[e]));0===t.length?this._setContent("Любой"):this._setContent(t.join(", "))},e.prototype._onItemSelected=function(t){this.ItemSelected.fire(t)},e.prototype._onSelectionChanged=function(t){this._updateContent(),this._AdaptiveCore.hide(),this.SelectionChanged.fire()},e}(l.ComboBoxBase);e.RestCombo=c,t.RestCombo=c}).call(e,o(0))},,,function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.MapCardController=void 0;var n=o(114),s=o(520),a=o(517),l=o(521),u=o(56),c=o(9),h=o(4),d=o(3),p=o(1),_=o(5),f=o(107),y=o(167),g=o(70),C=o(24),v=o(195),m=function(t){function e(e){var o=t.call(this,e)||this;return o.MarkerClicked=new d.UserEvent,o._Bounds=[],o._FilterProps={},o._FlyMonth=0,o._FormType=_.FormType.HotelSmallFilter,o._FilterSettings={},o._Layers=[n.LayerTypes.View],o._ParentNode=null,o._Ref=null,o._SelectedLayers=[{Item:n.ViewType.Scheme,LayerType:n.LayerTypes.View}],o._ToursGroup=_.ToursGroupBy.Hotels,o._View=null,o._WindowClass="",o._Hide=null,o._FilterChanged=null,o._MapZoomChanged=null,o._cardId=0,o._card=null,o._filter=null,o._map=null,o._mapWindow=null,o.__initSettings(e),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.HideCard,i=e.FilterProps;o&&this._card&&(this._card.hide(),this._resetSelectionMarker()),i&&this._filter&&this._filter.update(this._FilterProps),this._map&&this._map.update(e)},e.prototype.show=function(){this._map||this._render(),this._mapWindow&&this._mapWindow.show(),this._map.show(),this._map.update({Bounds:this._Bounds,SelectedLayers:this._SelectedLayers,View:this._View}),this._filter&&this._filter.update(this._FilterProps)},e.prototype._render=function(){var t=this._ParentNode;t||(this._mapWindow=new l.MapWindow({WindowClass:this._WindowClass,Hide:this._Hide}),t=this._mapWindow.getDomNode()),this._map=new v.MapControl({Layers:this._Layers,ParentNode:t,ShowMapInWindow:!1,ToursGroup:this._ToursGroup,ErrorReport:new h.Delegate(this,this._onErrorReport),MarkerClicked:new h.Delegate(this,this._onMarkerClicked),MapZoomChanged:this._MapZoomChanged}),this._card=new a.MapCardControl({IsVisibleRequestButton:!1,IsVisibleSearchButton:!1,IsVisibleTours:!1,ParentNode:t,Hide:new h.Delegate(this,this._onHideCardPanel)}),this._filter=new s.MapFilterControl({FormType:this._FormType,ParentNode:t,Theme:_.Theme.Theme2,Changed:this._FilterChanged})},e.prototype._onErrorReport=function(){},e.prototype._onHideCardPanel=function(){this._resetSelectionMarker()},e.prototype._onMarkerClicked=function(t){var e=this,o=t.Id,i=t.ToursGroup;if((0,p.isDefined)(o)&&(0,p.isDefined)(i)){this._cardId===o?(this._card.hide(),this._resetSelectionMarker()):f.settingsService.getSettings().then(function(o){e._updateCard(t,o)})}this.MarkerClicked.fire(t)},e.prototype._updateCard=function(t,e){var o=t.Id,i=t.ParentId,n=t.ToursGroup,s={};switch(n){case _.ToursGroupBy.Resorts:var a=C.searchUtils.defaultSearchSettings(),l=!i&&u.resortsStore.getResort(o);s.AboutLink=l?g.routeUtils.getRegionLink(l):"",s.SearchLink=y.mapUtils.getResortSearchLink(l,e.client,a);break;case _.ToursGroupBy.Hotels:}this._card.show(),this._card.update(r(r({},t),{Links:s,FlyMonth:this._FlyMonth})),this._cardId=o},e.prototype._resetSelectionMarker=function(){this._cardId&&(this._map.update({SelectionDisable:!0}),this._cardId=0)},e}(c.Core);e.MapCardController=m,t.MapCardController=m}).call(e,o(0))},,,,,,,function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){o.d(e,"MobileFilterBase",function(){return n});var i=o(2),r=(o.n(i),o(1)),n=(o.n(r),function(t){this.defineEvents(["PropertyChanged"]),n.baseClass.call(this,t)});Object(r.initClass)(n,i.Control);var s=n.prototype;s.templateName="mobfilterbase",s.render=function(){n.base.render.call(this);var t;t=this._FragmentObject.getNodeByType("filtertoggle"),Object(r.addEvent)(t,"click",this._onFilterTogle.bind(this)),t=this._FragmentObject.getNodeByType("filterbody"),Object(r.addClass)(t,"TVHide")},s._onFilterTogle=function(){var t=this._FragmentObject.getNodeByType("filtertoggle");Object(r.toggleClass)(t,"TVHideFilter"),t=this._FragmentObject.getNodeByType("filterbody"),Object(r.toggleClass)(t,"TVHide")},s._onPropertyChanged=function(t){this.PropertyChanged.fire(t)},s=null,t.MobileFilterBase=n}.call(e,o(0))},,,,,,,,,,,,,,,function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.imageService=e.ImageService=void 0;var r=o(46),n=o(206),s=o(27),a=function(t){function e(e){var o=t.call(this,e)||this;return o.url="//tourvisor.ru"+e,o}return i(e,t),e.prototype.send=function(t){r.cors.update({Url:this.url}),r.cors.post("data="+JSON.stringify(t.AverageColors)+"&id="+t.Id+"&type="+t.Type,{ContentType:n.ContentType.FORM_URLENCODED})},e}(s.ApiService);e.ImageService=a,e.imageService=new a("/xml/modpictureupdate.php"),t.imageService=e.imageService,t.ImageService=a}).call(e,o(0))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,o){o(799),o(465),o(226),o(502),t.exports=o(449)},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=o(226),r=o(845),n=o(449),s=o(879),a=o(465),l=o(502),u=o(351),c=o(1024),h=o(1025),d=o(1026),p=o(1033),_=o(317),f=o(1039),y=o(1044),g=o(1052),C=o(1059),v=o(1065);t.newTrackPrice=function(t){return new u.TrackPriceControl(t)},t.newResultManager=function(t){return new l.ResultManager(t)},t.newCartManager=function(t){return new i.CartManager(t)},t.newCartService=function(){return new c.CartService},t.cartService=t.newCartService(),t.newLeadManagerService=function(){return new h.LeadManagerService},t.leadManagerService=t.newLeadManagerService(),t.newDesctopCartController=function(t){return new r.DesctopCartController(t)},t.newHotOfferManager=function(t){return new n.HotOfferManager(t)},t.newHotOfferSubscribeManager=function(){return new s.HotOfferSubscribeManager},t.newShareManager=function(t){return new g.ShareManager(t)},t.newErrorManager=function(t){return new d.ErrorManager(t)},t.newRoomManager=function(t){return new y.RoomManager(t)},t.newGalleryManager=function(t){return new p.GalleryManager(t)},t.newOrderManager=function(t){return new a.OrderManager(t)},t.newRequestControl=function(t){return new _.RequestControl(t)},t.newRequestManager=function(t){return new f.RequestManager(t)},t.newTourRedirectionManager=function(t){return new v.TourRedirectionManager(t)},t.newTourRedirectionInfoManager=function(t){return new C.TourRedirectionInfoManager(t)}}).call(e,o(11))},function(t,e,o){"use strict";(function(t){var i=this&&this.__awaiter||function(t,e,o,i){function r(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,n){function s(t){try{l(i.next(t))}catch(t){n(t)}}function a(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){t.done?o(t.value):r(t.value).then(s,a)}l((i=i.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){function o(t){return function(e){return i([t,e])}}function i(o){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,n=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){l.label=o[1];break}if(6===o[0]&&l.label<s[1]){l.label=s[1],s=o;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(o);break}s[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(t,l)}catch(t){o=[6,t],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var r,n,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(e,"__esModule",{value:!0}),e.printUtils=void 0;var n=o(1),s=function(){function t(){this._trueBody=null,this._scrollAfterPrint=0,this._windowEvent="",this._afterPrint=this._afterPrint.bind(this),this._windowEvent=window.hasOwnProperty("onafterprint")?"afterprint":"focus"}return t.prototype.printTours=function(t){t&&(this._trueBody=document.body,(0,n.addEvent)(window,this._windowEvent,this._afterPrint),this._beforePrint(t,this._trueBody),this._printDelayed())},t.prototype.screenTours=function(t){t&&(this._trueBody=document.body,this._beforePrint(t,this._trueBody))},t.prototype.hidePrintBody=function(){this._replaceNodes(document.body,this._trueBody),window.scrollTo(0,this._scrollAfterPrint)},t.prototype._printDelayed=function(){return i(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,this._delay(t.TIMEOUT_PRINT)];case 1:return e.sent(),window.print(),[2]}})})},t.prototype._delay=function(t){return new Promise(function(e){return setTimeout(e,t)})},t.prototype._afterPrint=function(){this._replaceNodes(document.body,this._trueBody),window.scrollTo(0,this._scrollAfterPrint),(0,n.removeEvent)(window,this._windowEvent,this._afterPrint)},t.prototype._replaceNodes=function(t,e){var o=t.parentNode;o.removeChild(t),o.appendChild(e)},t.prototype._beforePrint=function(t,e){var o=(0,n.newDomNode)("body");o.appendChild(t),this._scrollAfterPrint=window.scrollY,this._replaceNodes(e,o)},t.TIMEOUT_PRINT=500,t}();e.printUtils=new s,t.printUtils=e.printUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.cartRoleManager=e.CartRoleManager=void 0;var i=o(1),r=o(227),n=function(){function t(e){var o=i.initSinglton.call(this,t);if(o)return o;this._Permissions=e.Permissions}return t.prototype.update=function(t){this._Permissions=t.Permissions},t.prototype.get=function(t){return(0,i.getProperty)(this._Permissions,t)},t.prototype.getPermissions=function(){return this._Permissions},t}();e.CartRoleManager=n,e.cartRoleManager=new n({Permissions:r.TOURIST_GUEST}),t.cartRoleManager=e.cartRoleManager,t.CartRoleManager=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ManagerController=void 0;var r=o(104),n=o(9),s=o(4),a=o(3),l=o(1),u=o(22),c=o(20),h=o(803),d=o(358),p=o(111),_=o(804),f=o(805),y=o(430),g=o(806),C=o(169),v=function(t){function e(e){var o=t.call(this,e)||this;return o.EditCartData=new a.UserEvent,o.EditCustomer=new a.UserEvent,o.EditProfile=new a.UserEvent,o._LeadClicked=null,o._Permissions={},o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._updateVisibility(),this._customerInfo.update({LeadCreated:this._leadCreated()})},e.prototype.updateManagerInfo=function(t){return u.authManager.isManager()&&this._Permissions.UpdateManagerInfoEnabled?d.managerService.updateManager(u.authManager.getId(),t):null},e.prototype.updateCustomer=function(t){return r.cartCatalog.getCartLeadId()&&this._Permissions.UpdateCustomerEnabled?h.customerService.updateCustomer(t):Promise.reject()},e.prototype.getDomNode=function(){return this._DomNode},e.prototype.destroy=function(){r.cartCatalog.Changed.remove(this),u.authManager.LoginSuccess.remove(this),t.prototype.destroy.call(this)},e.prototype._getManagerInfo=function(){return u.authManager.isManager()&&this._Permissions.UpdateManagerInfoEnabled?d.managerService.getManager(u.authManager.getId()):Promise.reject()},e.prototype._getCustomerData=function(){var t=r.cartCatalog.getCartLeadId();t&&this._Permissions.UpdateCustomerEnabled&&h.customerService.getLead(t)},e.prototype._init=function(){r.cartCatalog.Changed.addOnce(new s.Delegate(this,this._updateData)),this._DomNode=(0,l.newDiv)("TVCartInformation"),this._customerInfo=new _.CustomerInfoControl({Id:r.cartCatalog.getActiveCartId(),LeadCreated:this._leadCreated(),ParentNode:this._DomNode,EditClicked:new s.Delegate(this,this._onCustomerEditClicked),LeadClicked:this._LeadClicked});var t=(0,l.newDiv)("TVCartManagerInfoBlock",this._DomNode);this._managerInfo=new y.ManagerInfoControl({ParentNode:t}),this._viewProfile=new g.ViewProfileControl({ParentNode:t,EditClicked:new s.Delegate(this,this._onProfileEditClicked)}),this._cartInfo=new f.CartInfoControl({ParentNode:t,Click:new s.Delegate(this,this._onCartInfoClicked)}),this._updateVisibility()},e.prototype._onProfileEditClicked=function(){this._getManagerInfo(),this.EditProfile.fire()},e.prototype._onCustomerEditClicked=function(){this._getCustomerData(),this.EditCustomer.fire()},e.prototype._onCartInfoClicked=function(){this.EditCartData.fire()},e.prototype._updateData=function(t){var e=null,o=null,i=null,n=null;switch(t){case c.CatalogName.ManagerData:var s=r.cartCatalog.getCabinetManagerData(u.authManager.getId()),a=p.cartUtils.getCabinetManager(s);if(a){var l=a.name,h=a.contacts,d=a.path;e={Info:h||"",Name:l||"",PhotoUrl:d||""}}break;case c.CatalogName.CartInfoData:var _=r.cartCatalog.getInfoData();if(_){var f=_.manager,y=_.client,g=_.comment,C=_.ismanager,v=_.name,m=_.showtoclient;if(f){var T=f.photo,w=f.logo,h=f.contacts,S=f.name;e={Info:h||"",LogoUrl:w||"",Name:S||"",PhotoUrl:T||""}}i=p.cartUtils.getCreatorInfo(f),y&&(o={Content:p.cartUtils.getCustomerContent(y)}),n={Comment:g||"",IsManager:!!C,Name:v||"",ShowToClient:!!Number(m)}}break;case c.CatalogName.ActiveCartId:o={Id:r.cartCatalog.getActiveCartId()};break;case c.CatalogName.CartLeadData:var P=r.cartCatalog.getLeadData();if(P){var b=P.customer;o={Content:p.cartUtils.getCustomerContent({email:b.email,name:b.fullName,phone:b.telephone})}}break;case c.CatalogName.CartLeadId:0===r.cartCatalog.getCartLeadId()&&(o={Content:""})}e&&this._viewProfile.update(e),o&&this._customerInfo.update(o),i&&this._managerInfo.update(i),n&&this._cartInfo.update(n),this._updateVisibility()},e.prototype._updateVisibility=function(){var t=this._Permissions,e=t.Profile,o=t.CustomerInfo,i=t.UpdateManagerInfoEnabled,r=C.CartSettingsState.Hidden,n=C.CartSettingsState.Enable,s=o!==r,a=i&&e===n,u=this._managerInfo.getIsVisible()&&!a&&e!==r;(0,l.setVisible)(this._customerInfo.getDomNode(),s),(0,l.setVisible)(this._managerInfo.getDomNode(),u),(0,l.setVisible)(this._viewProfile.getDomNode(),a),this._cartInfo.update({IsManager:s}),(0,l.setVisible)(this._DomNode,s||u||a||this._cartInfo.getIsVisible())},e.prototype._leadCreated=function(){return this._Permissions.Menu.OpenLM===C.CartSettingsState.Enable},e}(n.Core);e.ManagerController=v,t.ManagerController=v}).call(e,o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)},n=this&&this.__awaiter||function(t,e,o,i){function r(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,n){function s(t){try{l(i.next(t))}catch(t){n(t)}}function a(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){t.done?o(t.value):r(t.value).then(s,a)}l((i=i.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){function o(t){return function(e){return i([t,e])}}function i(o){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,n=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){l.label=o[1];break}if(6===o[0]&&l.label<s[1]){l.label=s[1],s=o;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(o);break}s[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(t,l)}catch(t){o=[6,t],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var r,n,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(e,"__esModule",{value:!0}),e.customerService=e.CustomerService=void 0;var a=o(104),l=function(){function e(){}return e.prototype.getLead=function(e){return n(this,void 0,void 0,function(){var o;return s(this,function(i){return o=a.cartCatalog.getLeadData(),o?[2,o]:[2,t.leadManagerService.getLead(e).then(function(t){return a.cartCatalog.setLeadData(t.id.toString(),t),t})]})})},e.prototype.updateCustomer=function(e){var o=this,i=a.cartCatalog.getCartLeadId(),n=a.cartCatalog.getLeadData();if(!n)return this.getLead(i).then(function(t){if(!t)return Promise.reject();o.updateCustomer(e)});var s=r(r(r({},n),e),{comment:r(r({},n.comment),e.comment),customer:r(r({},n.customer),e.customer)});return t.leadManagerService.updateCustomer(i,s).then(function(t){a.cartCatalog.setLeadData(t.id.toString(),t)})},e}();e.CustomerService=l,e.customerService=new l,i.customerService=e.customerService,i.CustomerService=l}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CustomerInfoControl=void 0;var r=o(23),n=o(2),s=o(4),a=o(3),l=o(1),u=function(t){function e(e){var o=t.call(this,e)||this;return o.EditClicked=new a.UserEvent,o.ExportClicked=new a.UserEvent,o.LeadClicked=new a.UserEvent,o.templateName="cart-customer-info",o._Class="TVCartCustomerInfoControl",o._Content="",o._ExportEnable=!1,o._LeadCreated=!1,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateBtnsVisibility(),this._updateClasses()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&(this._updateBtnsVisibility(),this._updateClasses())},e.prototype._updateBtnsVisibility=function(){var t=this._nodes,e=t.content,o=t.createBtn,i=t.editBtn,r=t.exportBtn,n=this._hasContent();(0,l.setVisible)(e,n),(0,l.setVisible)(i,n),(0,l.setVisible)(o,!n),(0,l.setVisible)(r,this._ExportEnable)},e.prototype._updateClasses=function(){var t=this._hasContent();(0,l.updateClass)(this._DomNode,"TVCartCustomerInfoEmptyContent",!t),(0,l.updateClass)(this._nodes.leadBtn,"TVLeadCreated",this._LeadCreated)},e.prototype._hasContent=function(){return this._Content&&this._Content.length>0},e.prototype._onRecieved=function(){(0,l.hide)(this._nodes.leadWaiter)},e.prototype._onContentClick=function(){this.EditClicked.fire()},e.prototype._onCreateBtnClick=function(){this.EditClicked.fire()},e.prototype._onLeadBtnClick=function(){var t=this._nodes.leadWaiter;this._waiter||(this._waiter=new r.Waiter({ParentNode:t}),this._waiter.show()),(0,l.show)(t),this.LeadClicked.fire({Callback:new s.Delegate(this,this._onRecieved)})},e.prototype._onEditBtnClick=function(){this.EditClicked.fire()},e.prototype._onExportBtnClick=function(){this.ExportClicked.fire()},e}(n.Control);e.CustomerInfoControl=u,t.CustomerInfoControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CartInfoControl=void 0;var r=o(2),n=o(1),s=o(6),a=o(12),l=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="cart-info",o._Comment="",o._IsManager=!1,o._Name="",o._ShowToClient=!1,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateCartInfo()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._updateCartInfo()},e.prototype._updateCartInfo=function(){var t=this._nodes,e=t.cartComment,o=t.cartName,i=this._Name.length>0&&this._IsManager,r=this._Comment.length>0&&(this._IsManager||this._ShowToClient);(0,n.setVisible)(o,i),(0,n.setVisible)(e,r),this.setIsVisible(i||r),this._IsManager&&(0,n.addClass)(this._DomNode,"TVCursorPointerEnable"),o.textContent=i?this._Name:"",e.innerHTML=r?(0,a.sanitizeHTML)((0,s.nl2br)(this._Comment)):""},e}(r.Control);e.CartInfoControl=l,t.CartInfoControl=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ViewProfileControl=void 0;var r=o(2),n=o(3),s=o(1),a=o(12),l=o(28),u=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="view-profile",o.EditClicked=new n.UserEvent,o._Info="",o._LogoUrl="",o._Name="",o._PhotoUrl="",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._update()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&this._update()},e.prototype._update=function(){this._nodes.info.innerHTML=(0,a.sanitizeHTML)(this._Info)||"",this._updateEditVisibility(),this._updateImages()},e.prototype._onEditClick=function(){this.EditClicked.fire()},e.prototype._onLogoClick=function(){this._onEditClick()},e.prototype._onPhotoClick=function(){this._onEditClick()},e.prototype._updateEditVisibility=function(){(0,s.setVisible)(this._nodes.edit,!Boolean(this._Name))},e.prototype._updateImages=function(){var t=this._nodes,e=t.logo,o=t.photo;e.style.backgroundImage="url("+l.pictureUtils.getNoCacheUrl(this._LogoUrl)+")",o.style.backgroundImage="url("+this._PhotoUrl+")",this._LogoUrl?(0,s.addClass)(e,"TVActive"):(0,s.removeClass)(e,"TVActive"),this._PhotoUrl?(0,s.addClass)(o,"TVActive"):(0,s.removeClass)(o,"TVActive")},e}(r.Control);e.ViewProfileControl=u,t.ViewProfileControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.MobileCartController=void 0;var n,s=o(31),a=o(55),l=o(104),u=o(9),c=o(4),h=o(3),d=o(1),p=o(5),_=o(6),f=o(22),y=o(135),g=o(119),C=o(156),v=o(109),m=o(20),T=o(21),w=o(14),S=o(210),P=o(68),b=o(111),I=o(18),O=o(28),M=o(137),D=o(226),E=o(289),k=o(191),R=o(192),A=o(431);!function(t){t.CartPage="CartPage",t.CartAddDiscountPage="CartAddDiscountPage",t.CartLoginPage="CartLoginPage",t.CartSentToEmailPage="CartSentToEmailPage",t.CartSentToSmsPage="CartSentToSmsPage",t.CartShowcasePage="CartShowcasePage",t.CartEditCommentPage="CartEditCommentPage",t.CartNewConfirmPage="CartNewConfirmPage",t.CartSavePage="CartSavePage",t.CartLoadPage="CartLoadPage",t.CartEditProfilePage="CartEditProfilePage",t.CartCollectionsPage="CartCollectionsPage",t.CartEditCustomerPage="CartEditCustomerPage",t.CartDeletePage="CartDeletePage"}(n||(n={}));var V=function(t){function e(e){var o=t.call(this,e)||this;return o.CartHide=new h.UserEvent,o.ManageAction=new h.UserEvent,o._LeadManagerEnabled=!1,o._ManagerController=null,o._Permissions={},o._ShowOperator=!1,o._UpdatingTours=!1,o._deleteCartId="",o.__initSettings(e),o._init(),l.cartCatalog.Changed.addOnce(new c.Delegate(o,o._updateData)),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._cartPage&&this._cartPage.update(e)},e.prototype.show=function(){if((0,w.isCurrentPage)(T.RouterPath.CartLoad))return void w.router.back();var t=l.cartCatalog.getActiveCartId();w.router.goTo(T.RouterPath.Cart+"/"+t,{UrlId:t})},e.prototype.destroy=function(){this._ManagerController.EditProfile.remove(this),this._ManagerController.EditCustomer.remove(this),this._ManagerController.EditCartData.remove(this),this._ManagerController=null,t.prototype.destroy.call(this)},e.prototype._init=function(){a.layoutPageFactory.PageCreated.addOnce(new c.Delegate(this,this._onPageCreated)),this._ManagerController.EditProfile.addOnce(new c.Delegate(this,this._onClickMenu,{Item:k.CartMenu.EditProfile})),this._ManagerController.EditCustomer.addOnce(new c.Delegate(this,this._onClickMenu,{Item:k.CartMenu.EditCustomerData})),this._ManagerController.EditCartData.addOnce(new c.Delegate(this,this._onClickMenu,{Item:k.CartMenu.SaveCart}))},e.prototype._loginDialogClose=function(){w.router.back(),this.update({})},e.prototype._onPageCreated=function(t){var e=this,o=a.layoutPageFactory.getPage(),i=this._Permissions,r=i.RegistrationEnabled,s=i.FastRegistrationEnabled;switch(t.PageClassName){case n.CartPage:this._cartPage=o,this._cartPage.ClickMenu.addOnce(new c.Delegate(this,this._onClickMenu)),this._cartPage.Hide.addOnce(new c.Delegate(this,function(){e.CartHide.fire()})),this._cartPage.update({ManagerController:this._ManagerController,Permissions:this._Permissions,Changed:new c.Delegate(this,this._onTourChanged),HelpClicked:new c.Delegate(this,this._onRequestClicked),LoginClicked:new c.Delegate(this,this._onClickMenu,{Item:k.CartMenu.Login})});break;case n.CartLoginPage:this._loginPage=o,this._loginPage.update({FastRegistrationEnabled:s,RegistrationEnabled:r,Close:new c.Delegate(this,this._loginDialogClose)});break;case n.CartSentToSmsPage:this._smsPage=o,this._smsPage.Submit.addOnce(new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.Sms}));break;case n.CartSavePage:this._savePage=o,this._savePage.Submit.addOnce(new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.Save})),this._savePage.Clear.addOnce(new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.Clear})),this._updateSavePage();break;case n.CartLoadPage:this._loadPage=o,this._loadPage.Load.addOnce(new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.Load})),this._loadPage.Delete.addOnce(new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.Delete}));break;case n.CartAddDiscountPage:this._discountPage=o,this._discountPage.Submit.addOnce(new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.Discount})),this._updateDiscountPage();break;case n.CartSentToEmailPage:this._mailPage=o,this._mailPage.Submit.addOnce(new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.Mail}));break;case n.CartShowcasePage:this._showcasePage=o,this._showcasePage.update({Show:new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.Showcase})});break;case n.CartEditCommentPage:this._editCommentPage=o,this._editCommentPage.Submit.addOnce(new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.UpdateComment}));break;case n.CartNewConfirmPage:this._cartNewConfirmPage=o,this._cartNewConfirmPage.Confirm.addOnce(new c.Delegate(this,this._onNewCartClicked));break;case n.CartEditProfilePage:this._editProfilePage=o,this._editProfilePage.Submit.addOnce(new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.UpdateProfile})),this._updateEditProfilePage();break;case n.CartEditCustomerPage:this._editCustomerPage=o,this._editCustomerPage.update({IsAutocomplete:r}),this._editCustomerPage.Submit.addOnce(new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.UpdateCustomer})),this._updateEditCustomerPage();break;case n.CartCollectionsPage:this._cartCollectionsPage=o,this._cartCollectionsPage.ItemClick.addOnce(new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.Load})),this._cartCollectionsPage.ItemDelete.addOnce(new c.Delegate(this,this._onDeleteCart)),this._updateCartCollectionsPage();break;case n.CartDeletePage:this._cartDeletePage=o,this._cartDeletePage.Confirm.addOnce(new c.Delegate(this,this._onCartDeleteClicked))}},e.prototype._onTourChanged=function(t){var e=null;switch(t.TourAction){case R.TourItemActions.UpdateComment:e=E.CartManage.UpdateComment;break;case R.TourItemActions.UpdateRecommend:e=E.CartManage.UpdateRecommend;break;case R.TourItemActions.GetDetail:return void(0,M.showTourByShortId)(t.ShortId,{ModeView:p.ModeView.Mobile,Currency:t.Currency});case R.TourItemActions.DeleteTour:e=E.CartManage.Remove;break;case R.TourItemActions.EditComment:return void w.router.goTo(T.RouterPath.EditComment,t);case R.TourItemActions.UpdatePrice:e=E.CartManage.UpdatePrice;break;case R.TourItemActions.ShowMyCarts:this._onClickMenu({Item:k.CartMenu.MyCartCollections});break;case R.TourItemActions.ShowHotelPhoto:var o=t.CraftTourId,i=t.HotelId,n=t.HotelName;this._showPhotoGallery(i,n,o);break;case R.TourItemActions.ShowRoomInfo:var a=t.RoomId,l=t.RoomServiceType;(0,C.showRoom)({ActionSource:s.ActionStatisticsSource.CART,ModeView:p.ModeView.Mobile,RoomId:a,RoomServiceType:l})}this.ManageAction.fire(r(r({},t),{Manage:e}))},e.prototype._onRequestClicked=function(){(0,g.showRequest)({ModeView:p.ModeView.Mobile,SendClicked:new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.Order})})},e.prototype._onManageAction=function(t){this.ManageAction.fire(t)},e.prototype._onClickMenu=function(t){if(!f.authManager.isManager()){var e=t.Item;if(D.CartManager.MANAGER_ACTIONS.indexOf(e)>-1)return}switch(t.Item){case k.CartMenu.SaveCart:w.router.goTo(T.RouterPath.CartSave),this._updateSavePage();break;case k.CartMenu.LoadCart:w.router.goTo(T.RouterPath.CartLoad),this._loadPage.update({Items:l.cartCatalog.getCartList()});break;case k.CartMenu.NewCart:w.router.goTo(T.RouterPath.CartNew,r({ButtonTemplate:"cart-new-confirm-buttons"},b.cartUtils.getNewCartConfirmSettings(l.cartCatalog.getActiveCartId())));break;case k.CartMenu.OpenLM:this._onManageAction(r({Manage:E.CartManage.ExportToLM},t));break;case k.CartMenu.Mail:this._onManageAction({Manage:E.CartManage.GetMail}),w.router.goTo(T.RouterPath.CartMail);break;case k.CartMenu.Sms:this._onManageAction({Manage:E.CartManage.GetSms}),w.router.goTo(T.RouterPath.CartSms);break;case k.CartMenu.ShareLink:var o=b.cartUtils.getCountryGroupedData(l.cartCatalog.getToursData()),i=l.cartCatalog.getInfoData(),n=l.cartCatalog.getActiveCartId(),a=A.cartShareUtils.getShareSettings(o,i,n);(0,v.showShare)(r(r({},a),{ActionSource:s.ActionStatisticsSource.CART,ModeView:p.ModeView.Mobile,Shared:new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.ShareLink})}));break;case k.CartMenu.Discount:w.router.goTo(T.RouterPath.CartDiscount);break;case k.CartMenu.Print:this._onManageAction({Manage:E.CartManage.Print});break;case k.CartMenu.Update:this._onManageAction({Manage:E.CartManage.Refresh});break;case k.CartMenu.Showcase:w.router.goTo(T.RouterPath.CartShowcase);break;case k.CartMenu.Login:w.router.goTo(T.RouterPath.CartLogin);break;case k.CartMenu.Logout:f.authManager.logout();break;case k.CartMenu.EditProfile:w.router.goTo(T.RouterPath.CartEditProfile);break;case k.CartMenu.EditCustomerData:this._updateEditCustomerPage(),w.router.goTo(T.RouterPath.CartEditCustomer);break;case k.CartMenu.MyCartCollections:this._onManageAction({Manage:E.CartManage.CartListFull}),w.router.goTo(T.RouterPath.CartCollections)}},e.prototype._updateData=function(t){switch(t){case m.CatalogName.TourData:this._updateTourData();break;case m.CatalogName.CartSmsData:this._updateSmsPage();break;case m.CatalogName.CartMailData:this._updateMailPage();break;case m.CatalogName.CartInfoData:this._updateCartInfoData();break;case m.CatalogName.ManagerData:this._updateEditProfilePage();break;case m.CatalogName.CartListFull:this._updateCartCollectionsPage();break;case m.CatalogName.CartLeadData:this._updateCartLeadData();break;case m.CatalogName.CartLeadId:this._updateCartLeadId()}},e.prototype._updateTourData=function(){var t=b.cartUtils.getCountryGroupedData(l.cartCatalog.getToursData());this._cartPage&&this._cartPage.update({Items:t,Permissions:this._Permissions,ShowOperator:this._ShowOperator,UpdatingTours:!1})},e.prototype._updateCartLeadData=function(){this._updateDiscountPage(),this._updateSmsPage(),this._updateMailPage(),this._updateSavePage();var t=l.cartCatalog.getLeadData(),e=null===t||void 0===t?void 0:t.customer,o=null===t||void 0===t?void 0:t.comment;l.cartCatalog.setCustomerData({Comment:(null===o||void 0===o?void 0:o.text)||"",Email:(null===e||void 0===e?void 0:e.email)||"",Name:(null===e||void 0===e?void 0:e.fullName)||"",Phone:(null===e||void 0===e?void 0:e.telephone)||""}),this._updateEditCustomerPage()},e.prototype._updateCartInfoData=function(){var t,e=null===(t=l.cartCatalog.getInfoData())||void 0===t?void 0:t.client;l.cartCatalog.setCustomerData({Comment:(null===e||void 0===e?void 0:e.comment)||"",Email:(null===e||void 0===e?void 0:e.email)||"",Name:(null===e||void 0===e?void 0:e.name)||"",Phone:(null===e||void 0===e?void 0:e.phone)||""}),this._updateEditCustomerPage(),this._updateSmsPage(),this._updateMailPage()},e.prototype._updateCartLeadId=function(){var t=l.cartCatalog.getCartLeadId();this._editCustomerPage&&0===t&&this._editCustomerPage.update({Comment:"",Email:"",Name:"",Phone:""})},e.prototype._updateSmsPage=function(){if(this._smsPage){var t=l.cartCatalog.getSmsData(),e=(0,d.getProperty)(l.cartCatalog.getLeadData(),"customer.telephone"),o=(0,d.getProperty)(l.cartCatalog.getInfoData(),"client.phone"),i={};if(t){var r=t.longlink,n=t.shortlink;i={IsShortLink:t.isshortlink,Limit:t.limit,LongLink:r,ShortLink:n}}e&&(i.Phone=e),o&&(i.Phone=o),this._smsPage.update(i)}},e.prototype._updateMailPage=function(){if(this._mailPage){var t=l.cartCatalog.getMailData(),e=(0,d.getProperty)(l.cartCatalog.getLeadData(),"customer.email"),o=(0,d.getProperty)(l.cartCatalog.getInfoData(),"client.email"),i={};if(t){var r=t.begin,n=void 0===r?"":r,s=t.doclink,a=void 0===s?"":s,u=t.end,c=void 0===u?"":u,h=t.profilelink,p=void 0===h?"":h,_=t.subject;i={DocLink:a,ProfileLink:p,Signature:c,Subject:void 0===_?"":_,Text:n}}e&&(i.Mail=e),o&&(i.Mail=o),this._mailPage.update(i)}},e.prototype._updateDiscountPage=function(){if(this._discountPage){var t=l.cartCatalog.getInfoData(),e=t&&t.discount,o={};e&&(o.Value=(0,_.convertToDecimal)(e,2)),this._discountPage.update(o)}},e.prototype._updateEditProfilePage=function(){if(this._editProfilePage&&f.authManager.isManager()){var t=l.cartCatalog.getCabinetManagerData(f.authManager.getId()),e=l.cartCatalog.getInfoData(),o=b.cartUtils.getCabinetManager(t);if(o){var i=o.name,r=o.contacts,n=o.path;this._editProfilePage.update({FullName:i||"",Info:r||"",Logo:(0,d.getProperty)(e,"manager.logo")||"",Photo:n||""})}}},e.prototype._updateEditCustomerPage=function(){this._editCustomerPage&&this._editCustomerPage.update(l.cartCatalog.getCustomerData()||{})},e.prototype._updateCartCollectionsPage=function(){if(this._cartCollectionsPage&&f.authManager.isManager()){var t=l.cartCatalog.getCartListFull(f.authManager.getId());t&&this._cartCollectionsPage.update({Items:t})}},e.prototype._updateSavePage=function(){if(this._savePage){var t=l.cartCatalog.getInfoData(),e=t.comment,o=t.name,i=t.showtoclient;this._savePage.update({Comment:e||"",Name:o||"",ShowToClient:!!Number(i)})}},e.prototype._onNewCartClicked=function(){this._onManageAction({Manage:E.CartManage.Clear}),setTimeout(function(){w.router.back()},0)},e.prototype._onDeleteCart=function(t){this._deleteCartId=t.Id,w.router.goTo(T.RouterPath.CartDelete,{ContentHtml:t.Id})},e.prototype._onCartDeleteClicked=function(){this._onManageAction({Id:this._deleteCartId,Manage:E.CartManage.Delete,Callback:new c.Delegate(this,this._onManageAction,{Manage:E.CartManage.CartListFull})}),this._deleteCartId=""},e.prototype._showPhotoGallery=function(t,e,o){if(void 0===e&&(e=""),void 0===o&&(o=0),t){(Boolean(o)?S.craftTourPhotoService.all({tourId:o}).then(function(t){if((0,_.isNotEmptyArray)(t))return{Items:O.pictureUtils.getCraftTourLinks(t),Title:e.toLocaleLowerCase()}}):P.hotelDataService.getHotelDataById(t).then(function(t){return I.hotelUtils.getPhotoGalleryData(t)})).then(function(t){t&&(0,y.showGallery)(r(r({},t),{ActiveIndex:0,ModeView:p.ModeView.Mobile}))})}},e}(u.Core);e.MobileCartController=V,t.MobileCartController=V}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartPrintControl=void 0;var n=o(2),s=o(1),a=o(5),l=o(227),u=o(290),c=o(430),h=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="cart-print",o._Content=null,o._Items=[],o._CreatorInfo={},o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._printBody=(0,s.newDomNode)("body"),this._printBody.appendChild(this._DomNode),this._updateContent()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._updateContent()},e.prototype._updateContent=function(){var t=this._nodes,e=t.body,o=t.header;this._countryList?this._countryList.update({Items:this._Items}):this._countryList=new u.CountryListControl({IsAdaptive:!1,Items:this._Items,ModeView:a.ModeView.DescTop,ParentNode:e,Permissions:l.TOURIST_GUEST,ShowOperator:!1}),this._managerInfo?this._managerInfo.update(this._CreatorInfo):this._managerInfo=new c.ManagerInfoControl(r({ParentNode:o},this._CreatorInfo)),(0,s.isDefined)(this._CreatorInfo.IsVisible)&&(0,s.setVisible)(o,this._CreatorInfo.IsVisible)},e}(n.Control);e.CartPrintControl=h,t.CartPrintControl=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CountryItemControl=void 0;var r=o(2),n=o(1),s=o(5),a=o(6),l=o(810),u=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="country-item",o._Code=null,o._Currency=s.Currency.None,o._Expanded=!0,o._HotelsData=[],o._ModeView=s.ModeView.DescTop,o._Name="",o._Permissions={},o._Price=0,o._ShowOperator=!1,o._UpdatingTours=!1,o._Changed=null,o._hotelListControl=null,o.__initSettings(e),o._toggleItemBody=o._toggleItemBody.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o={Permissions:this._Permissions,ShowOperator:this._ShowOperator,UpdatingTours:this._UpdatingTours};this._updatePriceBlock(),this._hotelListControl.update(o)},e.prototype.render=function(){t.prototype.render.call(this);var o=this._nodes,i=o.flag,r=o.header,s=o.body,u=o.toggle;(0,n.addEvent)(r,"click",this._toggleItemBody),this._updatePriceBlock(),i.style.backgroundPosition=(0,a.getFlagPositionById)(this._Code,e.FLAG_HEIGHT),this._hotelListControl=new l.CartHotelListControl({Hotels:this._HotelsData,ModeView:this._ModeView,ParentNode:s,Permissions:this._Permissions,ShowOperator:this._ShowOperator,UpdatingTours:this._UpdatingTours,Changed:this._Changed}),(0,n.setVisible)(s,this._Expanded),(0,n.addClass)(u,this._Expanded?"TVExpanded":"")},e.prototype.destroy=function(){this._rendered&&(0,n.removeEvent)(this._nodes.header,"click",this._toggleItemBody),t.prototype.destroy.call(this)},e.prototype._updatePriceBlock=function(){var t=this._nodes,e=t.action,o=t.priceNode,i=t.currencyNode,r=[(0,a.getCurrencyCssClass)(this._Currency),"TVCountryItemAction"];e&&(e.className="",this._ModeView===s.ModeView.DescTop&&r.push(this._Permissions.DeleteTour?"TVDesctopPriceFull":"TVDesctopPrice")),(0,n.addClass)(e,r.join(" "));var l=this._Price>0&&this._Price<1/0;o.textContent=l?(0,n.getPrice)(this._Price):"",(0,n.setVisible)(i,l)},e.prototype._toggleItemBody=function(){var t=this._nodes,e=t.toggle,o=t.body;(0,n.setVisible)(o,!(0,n.hasClass)(e,"TVExpanded")),(0,n.toggleClass)(e,"TVExpanded")},e.FLAG_HEIGHT=26,e}(r.Control);e.CountryItemControl=u,t.CountryItemControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartHotelListControl=void 0;var n=o(2),s=o(1),a=o(5),l=o(811),u=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVCartHotelListControl",o._Hotels=[],o._ModeView=a.ModeView.DescTop,o._Permissions={},o._ShowOperator=!1,o._UpdatingTours=!1,o._Changed=null,o._hotelItems=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._rendered){if((0,s.isDefined)(e.Hotels))return void this._renderItems();var o={Permissions:this._Permissions,ShowOperator:this._ShowOperator,UpdatingTours:this._UpdatingTours};this._hotelItems.forEach(function(t){return t.update(o)})}},e.prototype.render=function(){t.prototype.render.call(this),this._renderItems()},e.prototype._renderItems=function(){var t=this;this._hotelItems.length=0,(0,s.removeChildren)(this._DomNode),this._Hotels&&(this._hotelItems=this._Hotels.map(function(e){return new l.CartHotelItem({Hotel:r({},e),ModeView:t._ModeView,ParentNode:t._DomNode,Permissions:t._Permissions,ShowOperator:t._ShowOperator,UpdatingTours:t._UpdatingTours,Changed:t._Changed})}))},e}(n.Control);e.CartHotelListControl=u,t.CartHotelListControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CartHotelItem=void 0;var r=o(157),n=o(2),s=o(4),a=o(3),l=o(1),u=o(5),c=o(6),h=o(12),d=o(92),p=o(192),_=o(812),f=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new a.UserEvent,o.templateName="cart-hotel-item",o._Hotel=null,o._ModeView=u.ModeView.DescTop,o._Permissions={},o._ShowOperator=!1,o._UpdatingTours=!1,o._title=null,o._tourList=null,o.__initSettings(e),o._ModeView===u.ModeView.Mobile&&(o.templateName="cart-hotel-item-mobile"),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o={Permissions:this._Permissions,ShowOperator:this._ShowOperator,UpdatingTours:this._UpdatingTours};this._tourList.update(o)},e.prototype.render=function(){var e=this;t.prototype.render.call(this);var o=this._Hotel,i=o.Accomodation,n=o.Tours,a=o.Description,p=o.Rating,f=o.Region,y=o.Name,g=o.Stars,C=o.SubRegion,v=o.Id,m=o.Foto,T=o.SeaDistance,w=this._nodes,S=w.imageNode,P=w.hotelRating,b=w.hotelDescVal,I=w.controlList,O=w.title,M=w.galleryButton,D=r.imageCatalog.getHotelImage(v);D&&D.src&&(this._ModeView!==u.ModeView.Mobile?S.appendChild(D):S.style.backgroundImage="url("+D.src+")"),this._title=new d.HotelTitleControl({Accomodation:i,Name:y,ParentNode:O,Region:f,SeaDistance:T,Stars:g,SubRegion:C});var E=parseFloat(p).toFixed(1);if(E&&Number(E)>0){var k=(0,c.getRatingClass)(E);(0,l.addClass)(P,k),P.textContent=E}else(0,l.hide)(P);this._ModeView!==u.ModeView.Mobile&&(b.innerHTML=(0,h.sanitizeHTML)((0,c.nl2br)(a))),this._tourList=new _.TourListControl({ModeView:this._ModeView,ParentNode:I,Permissions:this._Permissions,ShowOperator:this._ShowOperator,Tours:n,UpdatingTours:this._UpdatingTours,Changed:new s.Delegate(this,function(t){return e.Changed.fire(t)})}),(0,l.setVisible)(M,m)},e.prototype._init=function(){this._onGalleryButtonClick=this._showHotelPhoto.bind(this),this._onImageNodeClick=this._showHotelPhoto.bind(this)},e.prototype._showHotelPhoto=function(){var t={CraftTourId:this._Hotel.CraftTourId,HotelId:Number(this._Hotel.Id),HotelName:this._Hotel.Name,TourAction:p.TourItemActions.ShowHotelPhoto};this.Changed.fire(t)},e}(n.Control);e.CartHotelItem=f,t.CartHotelItem=f}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TourListControl=void 0;var n=o(2),s=o(1),a=o(5),l=o(111),u=o(181),c=o(813),h=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVTourListControl",o._Permissions={},o._ModeView=a.ModeView.DescTop,o._ShowOperator=!1,o._Tours=[],o._UpdatingTours=!1,o._Changed=null,o._tourItems=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._rendered){(0,s.isDefined)(e.Tours)&&(this._tourItems.forEach(function(t){return t.destroy()}),this._tourItems=[],(0,s.removeChildren)(this._DomNode),this.render());var o={Permissions:this._Permissions,ShowOperator:this._ShowOperator,Updating:this._UpdatingTours};this._tourItems.forEach(function(t){return t.update(o)})}},e.prototype.render=function(){var e=this;t.prototype.render.call(this),this._tourItems=this._Tours.map(function(t){var o=t.DepartureId,i=t.DepartureNameFrom;return new c.TourItemControl(r(r({ParentNode:e._DomNode},t),{DepartureNameFrom:u.departureUtils.isNoFlight(o)?"":l.cartUtils.getDepartureNameFrom(i),ModeView:e._ModeView,Permissions:e._Permissions,ShowOperator:e._ShowOperator,Updating:e._UpdatingTours,Changed:e._Changed}))})},e}(n.Control);e.TourListControl=h,t.TourListControl=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourItemControl=void 0;var r=o(31),n=o(78),s=o(157),a=o(814),l=o(23),u=o(2),c=o(4),h=o(3),d=o(1),p=o(5),_=o(6),f=o(211),y=o(111),g=o(12),C=o(8),v=o(192),m=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="tour-item",o.Changed=new h.UserEvent,o._Adults="",o._Child="",o._Class="TVCartTourDetailsBlock",o._Comment="",o._Currency=p.Currency.None,o._DepartureNameFrom="",o._FlyDate="",o._Meal="",o._ModeView=p.ModeView.DescTop,o._Nights="",o._NoTour=!1,o._OperatorId="",o._OperatorLink="",o._Permissions={},o._Price="",o._PriceOld="",o._Recommend=!1,o._Room="",o._RoomInfo=0,o._RoomServiceType=f.RoomServiceTypeEnum.COMMON,o._ShortId=0,o._ShortLink="",o._ShowOperator=!1,o._TourId="",o._Updating=!1,o._ViewCount=0,o._commentEditBox=null,o._waiter=null,o.__initSettings(e),o._ModeView===p.ModeView.Mobile&&(o.templateName="tour-item-mobile"),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){var o=this._Currency;t.prototype.update.call(this,e),this._updateContent(),e.Currency&&o!==this._Currency&&this._updateCurrency(o,this._Currency)},e.prototype.render=function(){t.prototype.render.call(this),this._updateCurrency(p.Currency.None,this._Currency),this._updateContent()},e.prototype._updateContent=function(){var t=this._nodes,e=t.dateParam,o=t.btnCartBook,i=t.btnCartDel,r=t.params,n=t.editComment,s=t.commentPanel,l=t.tourBtns,u=t.tourists,h=t.room,_=t.viewCount,f=this._ModeView===p.ModeView.DescTop,g=this._ModeView===p.ModeView.Mobile,v=this._Permissions,m=v.DeleteTour,T=v.EditComment,w=v.ViewCount;e.textContent=y.cartUtils.getDateNight(this._FlyDate,this._Nights),u.textContent=this._getTouristsInfo(),this._updatePriceBlock(),this._updateOperator(),this._updateComment(),this._updateHeartIcon(),(0,d.setVisible)(_,w),(0,d.updateClass)(_,"TVNoTour",this._NoTour),(0,d.setVisible)(i,m||this._NoTour&&g),o.href=this._NoTour?"":this._ShortLink,f?(this._commentEditBox||(this._commentEditBox=new a.EditBox({ActionBlock:n,EditBlock:s,ViewBlock:n,EditFinish:new c.Delegate(this,this._onCommentFinishEdit),EditStart:new c.Delegate(this,this._onCommentStartEdit),TextChanged:new c.Delegate(this,this._onCommentChanged)})),this._commentEditBox.update({Disable:this._NoTour||!T}),(0,d.updateClass)(o,"TVNoTour",this._NoTour)):(0,d.setVisible)(o,!this._NoTour),(0,d.updateClass)(l,"TVDeleteNotEnabled",!m),(0,d.updateClass)(i,"TVNoTourDel",m&&this._NoTour),(0,d.updateClass)(i,"TVNoTourMobile",m&&this._NoTour&&g),(0,d.updateClass)(i,"TVNoManager",!m&&this._NoTour&&g),(0,d.updateClass)(h,C.TV_ROOM_INFO,this._RoomInfo>0),(0,d.updateClass)(r,"TVNoTourOpacity",!!this._NoTour)},e.prototype._onCommentStartEdit=function(){this._nodes.editComment.innerHTML=(0,g.sanitizeHTML)(this._Comment)},e.prototype._onCommentFinishEdit=function(){this._nodes.editComment.innerHTML=(0,g.sanitizeHTML)(this._Comment)||this._nodes.editComment.title},e.prototype._onCommentChanged=function(t){this._Comment=t.Text,this._updateComment(),this.Changed.fire({Comment:t.Text,TourAction:v.TourItemActions.UpdateComment,TourId:this._TourId})},e.prototype._updateHeartIcon=function(){var t=this._nodes.heartIcon,e=this._Permissions.Recommend;(0,d.updateClass)(t,"TVHearted",this._Recommend),(0,d.updateClass)(t,"TVAccess",e),(0,d.setVisible)(t,(this._Recommend||e)&&!this._NoTour)},e.prototype._updateOperator=function(){var t=this._nodes,e=t.cartOperator,o=t.operatorLink,i=this._Permissions.SeeOperator,r=this._ShowOperator||i;(0,d.setVisible)(e,r),r&&(this._operatorImg||(this._operatorImg=s.imageCatalog.getOperatorImage(this._OperatorId),e.appendChild(this._operatorImg),(0,d.updateClass)(this._operatorImg,"TVNoTourOpacity",!!this._NoTour)),o.href=this._OperatorLink||"",(0,d.setVisible)(o,(0,d.isDefined)(this._OperatorLink)&&!this._NoTour&&i))},e.prototype._updateCurrency=function(t,e){var o=(0,_.getCurrencyCssClass)(t),i=(0,_.getCurrencyCssClass)(e);(0,d.removeClass)(this._DomNode,o),(0,d.addClass)(this._DomNode,i)},e.prototype._updatePriceBlock=function(){var t=this._nodes,e=t.tourPrice,o=t.oldPrice,i=t.editPrice,r=t.pricesPanel,n=t.editPriceDiv,s=(0,d.getPrice)(this._Price),a=this._Permissions.EditPrice&&!this._NoTour;this._updateWaiter(),(0,d.updateClass)(r,"TVNoTourOpacity",!!this._NoTour),o.textContent=(0,d.getPrice)(this._PriceOld),e.textContent=s,i.value=s,(0,d.setVisible)(n,a),(0,d.setVisible)(i,a),(0,d.setVisible)(e,!a),(0,d.setVisible)(o,this._PriceOld&&!this._NoTour&&this._PriceOld!==this._Price)},e.prototype._updateComment=function(){var t=this._nodes.editComment,e=this._Permissions.EditComment;(0,d.setVisible)(t,!(this._NoTour||!this._Comment&&!e)),(0,d.updateClass)(t,"TVAccess",e),(0,d.updateClass)(t,"TVCommentFilled",!!this._Comment),t.textContent=this._Comment||t.title},e.prototype._getTouristsInfo=function(){var t=parseInt(this._Adults,10)>0?" "+this._Adults+" взр":"",e=parseInt(this._Child,10)>0?" "+this._Child+" реб":"";return" /"+t.concat(e)},e.prototype._updateWaiter=function(){this._waiter||(this._waiter=new l.Waiter({ParentNode:this._nodes.pricesPanel})),this._Updating?this._waiter.show():this._waiter.hide()},e.prototype._onBtnCartBookClick=function(t){this._NoTour||(this.Changed.fire({Currency:this._Currency,ShortId:this._ShortId,ShortLink:this._ShortLink,TourAction:v.TourItemActions.GetDetail,TourId:this._TourId}),(0,d.preventDefault)(t),(0,d.stopPropagation)(t))},e.prototype._onRoomClick=function(t){this._RoomInfo>0&&(this.Changed.fire({RoomId:this._RoomInfo,RoomServiceType:this._RoomServiceType,TourAction:v.TourItemActions.ShowRoomInfo}),(0,d.stopPropagation)(t))},e.prototype._onBtnCartDelClick=function(t){this._Permissions.DeleteTour&&(this.Changed.fire({TourAction:v.TourItemActions.DeleteTour,TourId:this._TourId}),(0,d.stopPropagation)(t))},e.prototype._onEditPriceChange=function(t){if(this._Permissions.EditPrice&&!this._NoTour){var e=this._nodes.editPrice;this.Changed.fire({Price:t.target.value.replace(/\D/g,""),Target:e,TourAction:v.TourItemActions.UpdatePrice,TourId:this._TourId}),(0,d.stopPropagation)(event)}},e.prototype._onEditPriceInput=function(t){if(this._Permissions.EditPrice&&!this._NoTour){var e=this._nodes.editPrice,o=t.data;(0,d.isNumeric)(o)||(e.value=t.target.value.replace(o,"")),(0,d.stopPropagation)(event)}},e.prototype._onHeartIconClick=function(t){if(this._Permissions.Recommend){var e=this._nodes.heartIcon;(0,d.toggleClass)(e,"TVHearted"),this.Changed.fire({Recommend:(0,d.hasClass)(e,"TVHearted"),TourAction:v.TourItemActions.UpdateRecommend,TourId:this._TourId}),(0,d.stopPropagation)(t)}},e.prototype._onEditCommentClick=function(t){this._Permissions.EditComment&&this._ModeView!==p.ModeView.DescTop&&(this.Changed.fire({Comment:this._Comment||"",TourAction:v.TourItemActions.EditComment,TourId:this._TourId}),(0,d.stopPropagation)(t))},e.prototype._onOperatorLinkClick=function(t){(0,n.reachGoal)(r.ActionStatisticsSource.CART,r.ActionStatisticsType.OPERATOR_URL),(0,d.stopPropagation)(t)},e.prototype._onEditPriceClick=function(t){(0,d.stopPropagation)(t)},e}(u.Control);e.TourItemControl=m,t.TourItemControl=m}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.EditBox=void 0;var r=o(9),n=o(3),s=o(1),a=o(6),l=function(t){function e(e){var o=t.call(this,e)||this;return o.EditStart=new n.UserEvent,o.TextChanged=new n.UserEvent,o.EditFinish=new n.UserEvent,o._EditBlock=null,o._ViewBlock=null,o._ActionBlock=null,o._Disable=!1,o._blurHandle=null,t.prototype.__initSettings.call(o,e),o.onStartEdit=o.onStartEdit.bind(o),o._blurHandle=o.onStopEdit.bind(o),o.init(),o}return i(e,t),e.prototype.stopEdit=function(){(0,s.removeEvent)(this._EditBlock,"blur",this._blurHandle),this.onStopEdit(),(0,s.addEvent)(this._EditBlock,"blur",this._blurHandle)},e.prototype.init=function(){if(!this._ActionBlock||!this._EditBlock||!this._ViewBlock)return void new Error("EditBox: init error");(0,s.addEvent)(this._ActionBlock,"click",this.onStartEdit),(0,s.addEvent)(this._EditBlock,"blur",this._blurHandle)},e.prototype.onStartEdit=function(){this._Disable||(this.EditStart.fire(),(0,s.hide)(this._ViewBlock),(0,s.hide)(this._ActionBlock),(0,s.show)(this._EditBlock),this._EditBlock.value=(0,a.br2nl)(this._ViewBlock.innerHTML),this._EditBlock.focus())},e.prototype.onStopEdit=function(){var t=this._EditBlock.value,e=(0,a.br2nl)(this._ViewBlock.innerHTML);(0,s.hide)(this._EditBlock),(0,s.show)(this._ViewBlock),(0,s.show)(this._ActionBlock),t!==e&&(this._ViewBlock.innerHTML=(0,a.nl2br)(t),this.TextChanged.fire({Text:t})),this.EditFinish.fire()},e}(r.Core);e.EditBox=l,t.EditBox=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ShowMyCartsControl=void 0;var r=o(2),n=o(3),s=o(1),a=o(192),l=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="show-my-carts",o.ButtonClicked=new n.UserEvent,o._ButtonsVisible=!1,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._nodes.infoLink.href="http://support.tourvisor.ru/nachalo-raboty-s-tourvisor-4/46-korzina-turov.html",this._setVisibleButtons()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._setVisibleButtons()},e.prototype._setVisibleButtons=function(){var t=this._nodes,e=t.myCarts,o=t.infoLink;(0,s.setVisible)(e,this._ButtonsVisible),(0,s.setVisible)(o,this._ButtonsVisible)},e.prototype._onMyCartsClick=function(){var t={TourAction:a.TourItemActions.ShowMyCarts};this.ButtonClicked.fire(t)},e}(r.Control);e.ShowMyCartsControl=l,t.ShowMyCartsControl=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ToursPrintControl=void 0;var n=o(2),s=o(3),a=o(817),l=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="tours-print",o.Close=new s.UserEvent,o._Items=[],o._ShowHotelName=!1,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&this._updateContent()},e.prototype.render=function(){t.prototype.render.call(this),this._updateContent()},e.prototype._onCloseClick=function(){this.Close.fire()},e.prototype._updateContent=function(){var t=this;this._Items.length>0&&this._Items.forEach(function(e){return new a.TourPrintControl(r(r({},e),{ParentNode:t._nodes.container,ShowHotelName:t._ShowHotelName}))})},e}(n.Control);e.ToursPrintControl=l,t.ToursPrintControl=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourPrintControl=void 0;var r=o(2),n=o(1),s=o(5),a=o(6),l=o(111),u=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="tour-print",o._Adults="",o._Child="",o._Country="",o._DepartureNameFrom="",o._Currency=s.Currency.Rub,o._Price="",o._Meal="",o._Room="",o._Nights="",o._FlyDate="",o._Stars=0,o._HotelName="",o._ShowHotelName=!1,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes,o=e.tourDate,i=e.tourMeal,r=e.tourPrice,u=e.hotelName;o.textContent=l.cartUtils.getDateNight(this._FlyDate,this._Nights),i.textContent=(0,a.getStringMeal)(this._Meal),r.textContent=(0,n.getPrice)(Math.ceil(Number(this._Price)/(Number(this._Adults)+Number(this._Child)))),this._ShowHotelName&&((0,n.setVisible)(u,!0),(0,n.addClass)(this._DomNode,"TVTourPrintHotelEnable")),this._Currency!==s.Currency.Rub&&(0,n.addClass)(this._DomNode,(0,a.getCurrencyCssClass)(this._Currency))},e}(r.Control);e.TourPrintControl=u,t.TourPrintControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.CartPermissionsSetting=void 0;var o;!function(t){t.CustomerInfo="CustomerInfo",t.DeleteTour="DeleteTour",t.EditComment="EditComment",t.EditPrice="EditPrice",t.Menu="Menu",t.Discount="Menu.Discount",t.Load="Menu.Load",t.Login="Menu.Login",t.Logout="Menu.Logout",t.MyCartCollections="Menu.MyCartCollections",t.NewCart="Menu.NewCart",t.OpenLM="Menu.OpenLM",t.Print="Menu.Print",t.Save="Menu.Save",t.SendEmail="Menu.SendEmail",t.SendSms="Menu.SendSms",t.ShareLink="Menu.ShareLink",t.Showcase="Menu.Showcase",t.Title="Menu.Title",t.UpdatePrice="Menu.UpdatePrice",t.Profile="Profile",t.Recommend="Recommend",t.SeeOperator="SeeOperator"}(o=e.CartPermissionsSetting||(e.CartPermissionsSetting={})),t.CartPermissionsSetting=o}).call(e,o(0))},function(t,e,o){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});var r=o(820),n=o(826),s=o(828),a=o(830),l=o(832),u=o(833),c=o(835),h=o(838),d=o(839),p=o(840),_=o(841),f=o(842),y=o(843),g=o(844),C=o(21),v=o(14),m=C.RouterPath,T=C.RouterPathParam;v.router.addRoutes((i={},i[m.Cart+"/"+T.CartId]=r.CartPage,i[m.CartNew]=d.CartNewConfirmPage,i[m.CartDiscount]=n.CartAddDiscountPage,i[m.CartDelete]=g.CartDeletePage,i[m.CartEditCustomer]=l.CartEditCustomerPage,i[m.CartLoad]=c.CartLoadPage,i[m.CartLogin]=h.CartLoginPage,i[m.CartLogout]=null,i[m.CartMail]=_.CartSentToEmailPage,i[m.CartPrint]=null,i[m.CartSave]=p.CartSavePage,i[m.CartSms]=f.CartSentToSmsPage,i[m.CartCollections]=s.CartCollectionsPage,i[m.CartShowcase]=y.CartShowcasePage,i[m.EditComment]=a.CartEditCommentPage,i[m.CartEditProfile]=u.CartEditProfilePage,i))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CartPage=void 0;var r=o(1),n=o(5),s=o(42),a=o(821),l=o(825),u=function(t){function e(e){var o=t.call(this,e)||this;return o._Items=[],o._LayoutClass="TVCartPage",o._ManagerController=null,o._ShowOperator=!1,o._Permissions={},o._Changed=null,o._HelpClicked=null,o._LoginClicked=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){var e=s.customClassUtils.getCartPageClass();this._LayoutClass=(0,r.classNames)(this._LayoutClass,e),t.prototype.render.call(this)},e.prototype.update=function(e){t.prototype.update.call(this,e),this._mobileCart&&this._mobileCart.update(e)},e.prototype.destroy=function(){this._ManagerController=null,this._Changed=null,this._HelpClicked=null,this._LoginClicked=null,t.prototype.destroy.call(this)},e.prototype._getContent=function(){return this._mobileCart||(this._mobileCart=new a.MobileCartControl({Items:this._Items,ManagerController:this._ManagerController,ModeView:n.ModeView.Mobile,Permissions:this._Permissions,ShowOperator:this._ShowOperator,Changed:this._Changed,HelpClicked:this._HelpClicked,LoginClicked:this._LoginClicked})),this._mobileCart},e.displayName="CartPage",e.UrlHash=n.Hash.Cartid,e}(l.BaseCartPage);e.CartPage=u,t.CartPage=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MobileCartControl=void 0;var r=o(2),n=o(3),s=o(1),a=o(5),l=o(22),u=o(42),c=o(434),h=o(290),d=o(436),p=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="mobile-cart",o.HelpClicked=new n.UserEvent,o._Changed=null,o._Items=[],o._ManagerController=null,o._ModeView=a.ModeView.Mobile,o._Permissions={},o._ShowOperator=!1,o._LoginClicked=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&(this._countryList.update(e),this._updateVisibilityControls())},e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes,o=e.list,i=e.registrationBlock,r=e.managerBlock,n=e.activationBlock;this._Permissions.FastRegistrationEnabled&&new c.RegistrationController({LoginClicked:this._LoginClicked,RegistrationNode:i}).show();new d.ProActivationControl({ParentNode:n});r.appendChild(this._ManagerController.getDomNode()),this._updateVisibilityControls(),this._countryList=new h.CountryListControl({Changed:this._Changed,Items:this._Items,ModeView:a.ModeView.Mobile,ParentNode:o,Permissions:this._Permissions,ShowOperator:this._ShowOperator}),this._addCustomClasses()},e.prototype.destroy=function(){this._ManagerController=null,t.prototype.destroy.call(this)},e.prototype._addCustomClasses=function(){var t=this._nodes.footer;u.customClassUtils.addCartMobileFooterClass(t)},e.prototype._onButtonClick=function(){this.HelpClicked.fire()},e.prototype._updateVisibilityControls=function(){var t=this._nodes,e=t.registrationBlock,o=t.footer,i=t.tvinfo,r=t.activationBlock,n=this._Permissions,a=n.FastRegistrationEnabled,u=n.TourvisorProActivation,c=l.authManager.isManager();(0,s.setVisible)(e,a&&!c),(0,s.setVisible)(r,u),(0,s.setVisible)(o,!c),(0,s.setVisible)(i,c&&a)},e}(r.Control);e.MobileCartControl=p,t.MobileCartControl=p}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ManagerAccessControl=void 0;var r=o(2),n=o(3),s=function(t){function e(e){var o=t.call(this,e)||this;return o.LoginClicked=new n.UserEvent,o.RegisterClicked=new n.UserEvent,o.templateName="manager-access",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._nodes.link.href="https://tourvisor.ru/freecart.php"},e.prototype._onLoginClick=function(){this.LoginClicked.fire()},e.prototype._onRegisterClick=function(){this.RegisterClicked.fire()},e}(r.Control);e.ManagerAccessControl=s,t.ManagerAccessControl=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RegisterFormControl=void 0;var r=o(23),n=o(2),s=o(3),a=o(1),l=o(435),u=o(8),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Submit=new s.UserEvent,o.templateName="register-form",o._Email="",o._Error="",o._Updating=!1,o._waiter=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes,o=e.resend,i=e.changeEmail,n=e.submit;(0,a.remove)(o),(0,a.remove)(i),this._waiter=new r.Waiter({Class:"TVMainColor",ParentNode:n}),this._update()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&this._update()},e.prototype._update=function(){var t=this._nodes,e=t.error,o=t.input;(0,a.updateClass)(e,u.TV_ERROR,Boolean(this._Error)),this._Updating?this._waiter.show():this._waiter.hide(),o.value=this._Email},e.prototype._onInputChange=function(){var t=this._nodes.input;l.validationUtils.getIsValidEmail(t.value)&&(0,a.removeClass)(t,u.TV_WARNING)},e.prototype._onSubmitClick=function(){var t=this._nodes.input;if(this._Email=t.value,!l.validationUtils.getIsValidEmail(this._Email))return void(0,a.addClass)(t,u.TV_WARNING);this._Error="",this.Submit.fire({Email:this._Email})},e}(n.Control);e.RegisterFormControl=c,t.RegisterFormControl=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ShortLoginPassword=void 0;var r=o(23),n=o(2),s=o(3),a=o(1),l=o(8),u=function(t){function e(e){var o=t.call(this,e)||this;return o.ChangeEmailClicked=new s.UserEvent,o.ResendClicked=new s.UserEvent,o.Submit=new s.UserEvent,o.templateName="register-form",o._Class="TVShortLoginPassword",o._IsError=!1,o._Updating=!1,o._Password="",o._waiter=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes,o=e.input,i=e.submit;o.placeholder="Введите пароль",o.type="password",this._waiter=new r.Waiter({Class:"TVMainColor",ParentNode:i})},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&(e.Password&&(this._nodes.input.value=this._Password),this._update())},e.prototype._update=function(){var t=this._nodes.error;(0,a.updateClass)(t,l.TV_ERROR,this._IsError),this._Updating?this._waiter.show():this._waiter.hide()},e.prototype._onChangeEmailClick=function(){var t=this._nodes,e=t.error,o=t.input;(0,a.removeClass)(e,l.TV_ERROR,"TVResend"),o.value&&((0,a.removeClass)(o,l.TV_WARNING),o.value=""),this.ChangeEmailClicked.fire(),o.value=""},e.prototype._onInputChange=function(){var t=this._nodes.input;t.value&&(0,a.removeClass)(t,l.TV_WARNING)},e.prototype._onResendClick=function(){var t=this._nodes.error;this._IsError=!1,(0,a.removeClass)(t,l.TV_ERROR),(0,a.addClass)(t,"TVResend"),this.ResendClicked.fire()},e.prototype._onSubmitClick=function(){var t=this._nodes,e=t.input,o=t.error,i=e.value;if(!i)return void(0,a.addClass)(e,l.TV_WARNING);this._IsError=!1,(0,a.removeClass)(o,l.TV_ERROR,"TVResend"),this.Submit.fire({Password:i})},e}(n.Control);e.ShortLoginPassword=u,t.ShortLoginPassword=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.BaseCartPage=void 0;var n=o(134),s=o(4),a=o(3),l=o(437),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ClickMenu=new a.UserEvent,e}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),e&&e.Permissions&&(e.MenuItemsState=e.Permissions.Menu),this._Menu.update(e)},e.prototype._getSideNavContent=function(){return this._Menu||(this._Menu=new l.CartMenuControl({ClickMenu:new s.Delegate(this,this._onClickMenu)})),this._Menu.getDomNode()},e.prototype._onClickMenu=function(t){var e=this;if(t.Callback){var o=t.Callback;t.Callback=new s.Delegate(this,function(){o.fire(),e._hideMenu()})}else this._hideMenu();this.ClickMenu.fire(t)},e.prototype._hideMenu=function(){this._layoutControl.update({SideNavSettings:r(r({},this._getSideNavSettings()),{Visible:!1})})},e}(n.LayoutPage);e.BaseCartPage=u,t.BaseCartPage=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CartAddDiscountPage=void 0;var r=o(36),n=o(4),s=o(3),a=o(14),l=o(438),u=function(t){function e(e){var o=t.call(this,e)||this;return o.Submit=new s.UserEvent,o._Value=0,o._LayoutClass="TVCartAddDiscountPage",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._getDiscountForm().update(e)},e.prototype._getContent=function(){return this._getDiscountForm()},e.prototype._getDiscountForm=function(){return this._discountFormControl||(this._discountFormControl=new l.DiscountFormControl({Submit:new n.Delegate(this,this._onSubmit)})),this._discountFormControl.update({Value:this._Value}),this._discountFormControl},e.prototype._onSubmit=function(t){this.Submit.fire(t),a.router.back()},e.displayName="CartAddDiscountPage",e}(r.Page);e.CartAddDiscountPage=u,t.CartAddDiscountPage=u}).call(e,o(0))},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){o.d(e,"DateInput",function(){return n});var i=o(83),r=o(1),n=(o.n(r),function(t){t=t||{},n.baseClass.call(this,t)});Object(r.initClass)(n,i.Input);var s=n.prototype;s.render=function(){n.base.render.call(this),this._oldVallength=this._input.value.length},s._onChangeValue=function(t){if(n.base._onChangeValue.call(this,t),this._oldVallength>this._input.value.length)return void(this._oldVallength=this._input.value.length);var e=this._input.value;if(e=e.split("."),1==e.length){var o=e[0];1==o.length&&parseInt(o[0])>3&&(this._input.value="0"+this._input.value+"."),2==o.length&&(this._input.value=this._input.value+".")}2==e.length&&(o=e[1],1==o.length&&parseInt(o[0])>1&&(this._input.value=e[0]+".0"+o+"."),2==o.length&&(this._input.value=this._input.value+".")),this._oldVallength=this._input.value.length,o=this._input.value,this._input.value="",this._input.value=o},s=null,t.DateInput=n}.call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CartCollectionsPage=void 0;var r=o(36),n=o(4),s=o(3),a=o(14),l=o(439),u=function(t){function e(e){var o=t.call(this,e)||this;return o.ItemClick=new s.UserEvent,o.ItemDelete=new s.UserEvent,o._LayoutClass="TVCartCollectionsPage",o._Items=[],o._cartCollectionsControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._getContent().update(e)},e.prototype._getContent=function(){return this._cartCollectionsControl||(this._cartCollectionsControl=new l.CartCollectionsControl({ItemClick:new n.Delegate(this,this._onClick),ItemDelete:new n.Delegate(this,this._onItemDeleteClick),Items:this._Items})),this._cartCollectionsControl},e.prototype._onClick=function(t){this.ItemClick.fire(t),a.router.back()},e.prototype._onItemDeleteClick=function(t){this.ItemDelete.fire(t)},e.displayName="CartCollectionsPage",e}(r.Page);e.CartCollectionsPage=u,t.CartCollectionsPage=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CartCollectionItem=void 0;var r=o(2),n=o(3),s=o(1),a=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="cart-collection-item",o.Delete=new n.UserEvent,o._Client="",o._Id="",o._SearchInfo="",o._SendInfo="",o._Time="",o._ViewCount=0,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes,o=e.sendInfo,i=e.titleNode;i.textContent=this._Id,this._Client&&(i.textContent+=", "+this._Client),(0,s.updateClass)(this._DomNode,"TVActive",!!this._Client),(0,s.updateClass)(o,"TVSendInfo",!!this._SendInfo)},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&((0,s.removeChildren)(this._DomNode),this.render())},e.prototype._onClicked=function(){this.Click.fire({Id:this._Id})},e.prototype._onDeleteClick=function(t){(0,s.stopPropagation)(t),this.Delete.fire({Id:this._Id})},e}(r.Control);e.CartCollectionItem=a,t.CartCollectionItem=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CartEditCommentPage=void 0;var r=o(36),n=o(4),s=o(3),a=o(14),l=o(831),u=function(t){function e(e){var o=t.call(this,e)||this;return o.Submit=new s.UserEvent,o._LayoutClass="TVCartEditCommentPage",o._Comment="",o._TourId=0,o._editForm=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._getEditCommentFormController().update(e)},e.prototype._getContent=function(){return this._getEditCommentFormController()},e.prototype._getEditCommentFormController=function(){return this._editForm||(this._editForm=new l.EditCommentFormControl({Comment:this._Comment,TourId:this._TourId,Submit:new n.Delegate(this,this._onSubmit)})),this._editForm},e.prototype._onSubmit=function(t){this.Submit.fire(t),a.router.back()},e.displayName="CartEditCommentPage",e}(r.Page);e.CartEditCommentPage=u,t.CartEditCommentPage=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.EditCommentFormControl=void 0;var r=o(2),n=o(3),s=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="edit-comm-form",o.Submit=new n.UserEvent,o._Class="TVEditCommentFormControl",o._Comment="",o._TourId=0,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype._onSubmitNodeClick=function(){var t=this._nodes.comment.value;this.Submit.fire({Comment:t,TourId:this._TourId})},e}(r.Control);e.EditCommentFormControl=s,t.EditCommentFormControl=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartEditCustomerPage=void 0;var n=o(36),s=o(4),a=o(3),l=o(14),u=o(440),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Submit=new a.UserEvent,o._IsAutocomplete=!1,o._LayoutClass="TVCartEditCustomerPage",o._editCustomerForm=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._getContent().update(e)},e.prototype._getContent=function(){return this._editCustomerForm||(this._editCustomerForm=new u.EditCustomerControl({Submit:new s.Delegate(this,this._onSubmit)})),this._editCustomerForm},e.prototype._onSubmit=function(t){this._showWaiter(),this.Submit.fire(r(r({},t),{Callback:new s.Delegate(this,this._onRecieved)}))},e.prototype._onRecieved=function(t){t.success?l.router.back():this.showMessage("При сохранении данных клиента произошла ошибка, обратитесь в техподдержку."),this._hideWaiter()},e.displayName="CartEditCustomerPage",e}(n.Page);e.CartEditCustomerPage=c,t.CartEditCustomerPage=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartEditProfilePage=void 0;var n=o(36),s=o(4),a=o(3),l=o(14),u=o(441),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Submit=new a.UserEvent,o._LayoutClass="TVCartEditProfilePage",o._FullName="",o._Info="",o._Logo="",o._Photo="",o._editProfile=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._getContent().update(e)},e.prototype._getContent=function(){return this._editProfile||(this._editProfile=new u.EditProfileControl({FullName:this._FullName,Info:this._Info,Logo:this._Logo,Photo:this._Photo,Submit:new s.Delegate(this,this._onSubmit)})),this._editProfile},e.prototype._onSubmit=function(t){this._showWaiter(),this.Submit.fire(r(r({},t),{Callback:new s.Delegate(this,this._onRecieved)}))},e.prototype._onRecieved=function(t){this._hideWaiter(),t.success?l.router.back():this.showMessage(u.EditProfileControl.WARNING),this._hideWaiter()},e.displayName="CartEditProfilePage",e}(n.Page);e.CartEditProfilePage=c,t.CartEditProfilePage=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.LoadImageControl=void 0;var r=o(2),n=o(4),s=o(3),a=o(1),l=o(221),u=o(442),c=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="load-image",o.Change=new s.UserEvent,o._Image="",o._loader=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._initLoader(),this._update()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._update()},e.prototype._onImageDelClick=function(){this._setImage(""),this.Change.fire({ImageFile:null})},e.prototype._onLoaderChanged=function(t){var e=this,o=t.ImageFile;this.Change.fire({ImageFile:o}),l.fileConverter.readAsImage(o,function(t){e._setImage(t)})},e.prototype._initLoader=function(){this._loader=new u.LoaderImage({ParentNode:this._nodes.loaderNode,Changed:new n.Delegate(this,this._onLoaderChanged)})},e.prototype._setImage=function(t){var e=this._nodes,o=e.loaderNode,i=e.imageBlock,r=e.imageDel,n=Boolean(t);n||this._loader.update({Reset:!0}),(0,a.updateClass)(this._DomNode,"TVNoImage",!n),(0,a.setVisible)(o,!n),i.style.backgroundImage=n?"url("+t+")":"",(0,a.setVisible)(i,n),(0,a.setVisible)(r,n)},e.prototype._update=function(){this._setImage(this._Image)},e}(r.Control);e.LoadImageControl=c,t.LoadImageControl=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartLoadPage=void 0;var n=o(36),s=o(104),a=o(4),l=o(3),u=o(1),c=o(14),h=o(443),d=function(t){function e(e){var o=t.call(this,e)||this;return o.Load=new l.UserEvent,o.Delete=new l.UserEvent,o._FooterFixed=!0,o._Items=[],o._LayoutClass="TVCartLoadPage",o._deletedItemId=0,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._getCartListControl().update(r(r({},e),{Items:this._Items}))},e.prototype._getContent=function(){return this._getCartListControl()},e.prototype._getCartListControl=function(){return this._cartListControl||(this._cartListControl=new h.SelectCartControl({Delete:new a.Delegate(this,this._onDeleteClicked),Load:new a.Delegate(this,this._onLoadClicked)})),this._cartListControl},e.prototype._onLoadClicked=function(t){c.router.back(),this.Load.fire(r({},t))},e.prototype._onDeleteClicked=function(t){this._showWaiter(),this._deletedItemId=t.Id||0,this.Delete.fire(r(r({},t),{Callback:new a.Delegate(this,this._onRecieved)}))},e.prototype._onRecieved=function(t){var e=this;this._hideWaiter();var o=(0,u.getProperty)(t,"data.success"),i=(0,u.getProperty)(t,"data.warning");if(1===o){var r=s.cartCatalog.getCartList(),n=r.filter(function(t){return Number(t.id)!==e._deletedItemId});s.cartCatalog.setCartList(n),this._cartListControl.update({Items:n})}else this.showMessage(i)},e.displayName="CartLoadPage",e}(n.Page);e.CartLoadPage=d,t.CartLoadPage=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.CartDateType=void 0;var o;!function(t){t.Month="month",t.Week="week",t.Today="today"}(o=e.CartDateType||(e.CartDateType={})),t.CartDateType=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ListCarts=void 0;var r=o(266),n=o(187),s=o(4),a=o(3),l=o(1),u=o(273),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new a.UserEvent,o._Class="TVListCarts",o._Items=[],o._delegateItemClicked=null,o._hashItems=[],o._items=[],t.prototype.__initSettings.call(o,e),o._init(),o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._createHash()},e.prototype.setItems=function(t){this._items=this._hashItems.filter(function(e){return t.some(function(t){return t.id===e.getId()})}),this._renderItems()},e.prototype.update=function(e){t.prototype.update.call(this,e),(0,l.isDefined)(e.Items)&&this._createHash()},e.prototype._init=function(){this._delegateItemClicked=new s.Delegate(this,this._onItemClicked)},e.prototype._renderItems=function(){var t=this;(0,l.removeChildren)(this._DomNode),this._items.forEach(function(e){t._DomNode.appendChild(e.getDomNode())})},e.prototype._onItemClicked=function(t){this._hashItems.forEach(function(e){var o=e.getId()===t.Selected;return e.update({IsChecked:o})}),this.Changed.fire(t)},e.prototype._createHash=function(){var t=this;this._hashItems.forEach(function(t){t.destroy()}),this._hashItems=this._Items.map(function(e){var o=u.controlUtils.getHTMLByTemplate("list-cart-item",{Cartdate:e.cartdate||"",Name:e.name||""});return new n.InputRadio({AttributeName:"tvCartListItem",Content:o.outerHTML,Data:e.id,Id:e.id,Changed:t._delegateItemClicked})})},e}(r.ListForTabbedControlBase);e.ListCarts=c,t.ListCarts=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CartLoginPage=void 0;var r=o(36),n=o(357),s=o(5),a=function(t){function e(e){var o=t.call(this,e)||this;return o._Close=null,o._FastRegistrationEnabled=!1,o._LayoutClass="TVCartLoginPage",o._RegistrationEnabled=!1,o._loginForm=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._getLoginFormController().update(e)},e.prototype.show=function(){this._getLoginFormController().update({LoginFormSettings:{Error:"",Message:""},State:n.LoginFormState.Login}),t.prototype.show.call(this)},e.prototype._getContent=function(){return this._getLoginFormController()},e.prototype._getLoginFormController=function(){return this._loginForm||(this._loginForm=new n.LoginFormController({Close:this._Close,LoginFormSettings:{FastRegistrationEnabled:this._FastRegistrationEnabled,RegistrationEnabled:this._RegistrationEnabled},ModeView:s.ModeView.Mobile})),this._loginForm},e.displayName="CartLoginPage",e}(r.Page);e.CartLoginPage=a,t.CartLoginPage=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartNewConfirmPage=void 0;var n=o(293),s=function(t){function e(e){var o=t.call(this,r(r({},e),{Render:!1}))||this;return o._LayoutClass="TVCartNewConfirmPage",o._Render=!0,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.displayName="CartNewConfirmPage",e}(n.ConfirmPage);e.CartNewConfirmPage=s,t.CartNewConfirmPage=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartSavePage=e.IActionType=void 0;var n,s=o(36),a=o(189),l=o(4),u=o(3),c=o(1),h=o(14),d=o(444);!function(t){t[t.Continue=0]="Continue",t[t.New=1]="New"}(n=e.IActionType||(e.IActionType={}));var p=function(t){function e(e){var o=t.call(this,e)||this;return o.Submit=new u.UserEvent,o.Clear=new u.UserEvent,o._LayoutClass="TVCartSavePage",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._getContent().update(e)},e.prototype._getContent=function(){return this._cartSaveForm||(this._cartSaveForm=new d.CartSaveFormControl({ActionClicked:new l.Delegate(this,this._onActionClicked),Submit:new l.Delegate(this,this._onSubmitted)})),this._cartSaveForm},e.prototype._onSubmitted=function(t){this._showWaiter(),this.Submit.fire(r(r({},t),{Callback:new l.Delegate(this,this._onRecieved)}))},e.prototype._onRecieved=function(t){var o=(0,c.getProperty)(t,"data.success"),i=(0,c.getProperty)(t,"data.warning");this._hideWaiter(),this._cartSaveForm.update({Message:1===o?e.MESSAGE_SUCCESS:i})},e.prototype._onActionClicked=function(t){h.router.back(),t.DialogResult===a.DialogResult.Yes&&(h.router.back(),this.Clear.fire())},e.displayName="CartSavePage",e.MESSAGE_SUCCESS="Подборка сохранена.",e}(s.Page);e.CartSavePage=p,t.CartSavePage=p,t.IActionType=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartSentToEmailPage=void 0;var n=o(36),s=o(4),a=o(3),l=o(1),u=o(14),c=o(445),h=o(446),d=o(447),p=function(t){function e(e){var o=t.call(this,e)||this;return o.Submit=new a.UserEvent,o._CopyCheck=!0,o._LayoutClass="TVCartSentToEmailPage",o._Mail="",o._Signature="",o._Subject="",o._Text="",o._DocLink="",o._formContainer=null,o._mailForm=null,o._configureMailForm=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._formContainer=(0,l.newDiv)("TVMailFormContainer"),this._renderMailForm(),this._renderConfigureMailForm()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&(this._mailForm.update(e),this._configureMailForm.update(e),this._updateContentVisibility())},e.prototype._renderMailForm=function(){this._mailForm=new d.MailFormControl({CopyCheck:this._CopyCheck,IsVisible:!1,Mail:this._Mail,ParentNode:this._formContainer,Signature:this._Signature,Subject:this._Subject,Text:this._Text,Submit:new s.Delegate(this,this._onSubmitted)})},e.prototype._renderConfigureMailForm=function(){this._configureMailForm=new h.ConfigureMailControl({DocLink:"",IsVisible:!1,ParentNode:this._formContainer,LinkClicked:new s.Delegate(this,this._onLinkClicked)})},e.prototype._getContent=function(){return this._formContainer},e.prototype._updateContentVisibility=function(){var t=!this._DocLink;(0,l.setVisible)(this._mailForm,t),(0,l.setVisible)(this._configureMailForm,!t)},e.prototype._onSubmitted=function(t){this._showWaiter(),this.Submit.fire(r(r({},t),{Callback:new s.Delegate(this,this._onRecieved)}))},e.prototype._onRecieved=function(t){this._hideWaiter();var e=t.success,o=t.doclink,i=void 0===o?"":o,r=t.warning,n=void 0===r?c.SEND_EMAIL_ERROR_MESSAGE:r;if(0===e&&Boolean(i))return void this.update({DocLink:i});var s=1===e?c.SEND_EMAIL_SUCCESS_MESSAGE:n;this.showMessage(s)},e.prototype._onLinkClicked=function(){u.router.back()},e.displayName="CartSentToEmailPage",e}(n.Page);e.CartSentToEmailPage=p,t.CartSentToEmailPage=p}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartSentToSmsPage=void 0;var n=o(36),s=o(4),a=o(3),l=o(1),u=o(448),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Submit=new a.UserEvent,o._LayoutClass="TVCartSentToSmsPage",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._getSmsForm().update(e)},e.prototype._getContent=function(){return this._getSmsForm()},e.prototype._getSmsForm=function(){return this._smsForm||(this._smsForm=new u.SmsFormControl({Submit:new s.Delegate(this,this._onSubmitted)})),this._smsForm},e.prototype._onSubmitted=function(t){this._showWaiter(),this.Submit.fire(r(r({},t),{Callback:new s.Delegate(this,this._onRecieved)}))},e.prototype._onRecieved=function(t){var o=(0,l.getProperty)(t,"data.success"),i=(0,l.getProperty)(t,"data.warning");this._hideWaiter(),this.showMessage(1===o?e.MESSAGE_SUCCESS:i)},e.displayName="CartSentToSmsPage",e.MESSAGE_SUCCESS="Сообщение успешно отправлено",e}(n.Page);e.CartSentToSmsPage=c,t.CartSentToSmsPage=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartShowcasePage=void 0;var n=o(36),s=o(3),a=o(291),l=function(t){function e(e){var o=t.call(this,e)||this;return o.Show=new s.UserEvent,o._LayoutClass="TVShowcasePage",o._showcaseForm=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),e&&(e=r({},e),this._getShowcaseFormControl().update(e))},e.prototype._getContent=function(){return this._getShowcaseFormControl()},e.prototype._getShowcaseFormControl=function(){return this._showcaseForm||(this._showcaseForm=new a.ShowcaseFormControl({})),this._showcaseForm},e.displayName="CartShowcasePage",e}(n.Page);e.CartShowcasePage=l,t.CartShowcasePage=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartDeletePage=void 0;var n=o(293),s=function(t){function e(e){var o=t.call(this,r(r({},e),{Render:!1}))||this;return o._LayoutClass="TVDeleteCart",o._Render=!0,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.displayName="CartDeletePage",e}(n.ConfirmPage);e.CartDeletePage=s,t.CartDeletePage=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.DesctopCartController=void 0;var s=o(31),a=o(104),l=o(281),u=o(356),c=o(9),h=o(4),d=o(3),p=o(5),_=o(6),f=o(22),y=o(135),g=o(156),C=o(109),v=o(20),m=o(210),T=o(68),w=o(111),S=o(18),P=o(28),b=o(846),I=o(847),O=o(848),M=o(849),D=o(850),E=o(851),k=o(852),R=o(853),A=o(854),V=o(855),L=o(289),N=o(191),B=o(192),H=o(856),x=o(431),F=function(e){function o(t){var o=e.call(this,t)||this;return o.CartHide=new d.UserEvent,o.ManageAction=new d.UserEvent,o._Count=0,o._PreviewEnabled=!1,o._FormRequiredFields=p.FormRequiredFieldsType.PhoneOrEmail,o._IsPublic=!1,o._ManagerController=null,o._Permissions={},o._ShowOperator=!1,o._UpdatingTours=!1,o._BeforeShow=null,o._DescChanged=null,o._ShowCart=null,o._active=!1,o._preview=null,o._window=null,o._deleteCartId="",o.__initSettings(t),o._init(),o._preview=new b.CartPreviewControl({Click:o._ShowCart}),o._updatePreview(),a.cartCatalog.Changed.addOnce(new h.Delegate(o,o._updateData)),o}return r(o,e),o.prototype.destroy=function(){a.cartCatalog.Changed.remove(this),this._ManagerController.EditProfile.remove(this),this._ManagerController.EditCustomer.remove(this),this._ManagerController.EditCartData.remove(this),this._ManagerController=null,f.authManager.LoginSuccess.remove(this),f.authManager.Logout.remove(this),e.prototype.destroy.call(this)},o.prototype.update=function(t){e.prototype.update.call(this,t),this._window&&this._window.update(t),this._preview&&this._preview.update(t),this._updatePreview()},o.prototype.show=function(){var t=w.cartUtils.getCountryGroupedData(a.cartCatalog.getToursData());this._window?this._window.update({Items:t}):this._window=new H.ToursCartWindow({BeforeShow:this._BeforeShow,HashName:p.Hash.Cartid,HistoryEnable:!0,Items:t,ManagerController:this._ManagerController,Permissions:this._Permissions,ShowOperator:this._ShowOperator,Changed:new h.Delegate(this,this._onTourChanged),Hide:new h.Delegate(this,this._onWindowHide),LoginClicked:new h.Delegate(this,this._onMenuClicked,{Item:N.CartMenu.Login}),MenuClicked:new h.Delegate(this,this._onMenuClicked),SendRequest:new h.Delegate(this,this._onSendRequest)}),this._showWindow(),this._active=!0},o.prototype._showWindow=function(){this._preview.hide(),this._window.show(a.cartCatalog.getActiveCartId())},o.prototype._init=function(){var t=this._Permissions,e=t.RegistrationEnabled,o=t.FastRegistrationEnabled;this._loginDialog=new u.LoginDialog({FastRegistrationEnabled:o,RegistrationEnabled:e}),this._newCartConfirmDialog=new l.ConfirmDialog({ButtonTemplate:"cart-new-confirm-buttons",WindowClass:"TVCartNewConfirmDialog",Confirm:new h.Delegate(this,this._onSubmitDialog,{Manage:L.CartManage.Clear})}),this._ManagerController.EditCartData.addOnce(new h.Delegate(this,this._onMenuClicked,{Item:N.CartMenu.SaveCart})),this._saveDialog=new R.SaveDialog({Submit:new h.Delegate(this,this._onSubmitDialog,{Manage:L.CartManage.Save})}),this._loadDialog=new E.LoadDialog({Delete:new h.Delegate(this,this._onSubmitDialog,{Manage:L.CartManage.Delete}),Load:new h.Delegate(this,this._onSubmitDialog,{Manage:L.CartManage.Load})}),this._smsDialog=new V.SmsDialog({BeforeShow:new h.Delegate(this,this._onSubmitDialog,{Manage:L.CartManage.GetSms}),Submit:new h.Delegate(this,this._onSubmitDialog,{Manage:L.CartManage.Sms})}),this._discountDialog=new O.DiscountDialog({Submit:new h.Delegate(this,this._onSubmitDialog,{Manage:L.CartManage.Discount})}),this._mailDialog=new k.MailDialog({BeforeShow:new h.Delegate(this,this._onSubmitDialog,{Manage:L.CartManage.GetMail}),Submit:new h.Delegate(this,this._onSubmitDialog,{Manage:L.CartManage.Mail})}),this._showcaseDialog=new A.ShowcaseDialog({Show:new h.Delegate(this,this._onSubmitDialog,{Manage:L.CartManage.Showcase})}),this._cartCollectionsDialog=new I.CartCollectionsDialog({BeforeShow:new h.Delegate(this,this._onUpdateCartListFull),ItemClick:new h.Delegate(this,this._onSubmitDialog,{Manage:L.CartManage.Load}),ItemDelete:new h.Delegate(this,this._onDeleteCart)}),this._ManagerController.EditProfile.addOnce(new h.Delegate(this,this._onMenuClicked,{Item:N.CartMenu.EditProfile})),this._editProfileDialog=new D.EditProfileDialog({Submit:new h.Delegate(this,this._onSubmitDialog,{Manage:L.CartManage.UpdateProfile})}),this._ManagerController.EditCustomer.addOnce(new h.Delegate(this,this._onMenuClicked,{Item:N.CartMenu.EditCustomerData})),this._editCustomerDialog=new M.EditCustomerDialog({IsAutocomplete:e,Submit:new h.Delegate(this,this._onSubmitDialog,{Manage:L.CartManage.UpdateCustomer})}),this._deleteCartDialog=new l.ConfirmDialog({WindowClass:"TVDeleteCart",Confirm:new h.Delegate(this,this._onDeleteCartDialogClicked)}),f.authManager.LoginSuccess.addOnce(new h.Delegate(this,this._updatePreview)),f.authManager.Logout.addOnce(new h.Delegate(this,this._updatePreview))},o.prototype._showPreview=function(){this._window&&this._active&&this._window.hide(),this._PreviewEnabled&&this._preview.show()},o.prototype._updatePreview=function(){!this._active&&(this._Count>0||f.authManager.isManager())?this._showPreview():this._preview.hide()},o.prototype._onWindowHide=function(){this._active=!1,this.CartHide.fire()},o.prototype._onSubmitDialog=function(t){this.ManageAction.fire(t),t.Manage===L.CartManage.Clear&&this._window&&this._window.hide()},o.prototype._onDeleteCart=function(t){this._deleteCartId=t.Id,this._deleteCartDialog.update({ContentHtml:t.Id}),this._deleteCartDialog.show()},o.prototype._onDeleteCartDialogClicked=function(){this._onSubmitDialog({Id:this._deleteCartId,Manage:L.CartManage.Delete,Callback:new h.Delegate(this,this._onUpdateCartListFull)}),this._deleteCartId=""},o.prototype._onUpdateCartListFull=function(){this._cartCollectionsDialog.update({IsUpdating:!0}),this._onSubmitDialog({Manage:L.CartManage.CartListFull})},o.prototype._onTourChanged=function(e){var o=null;switch(e.TourAction){case B.TourItemActions.UpdateComment:o=L.CartManage.UpdateComment;break;case B.TourItemActions.UpdateRecommend:o=L.CartManage.UpdateRecommend;break;case B.TourItemActions.GetDetail:e.ShortLink&&t.windowOpen(e.ShortLink,"_blank");break;case B.TourItemActions.UpdatePrice:o=L.CartManage.UpdatePrice;break;case B.TourItemActions.DeleteTour:o=L.CartManage.Remove;break;case B.TourItemActions.ShowHotelPhoto:var i=e.CraftTourId,r=e.HotelId,s=e.HotelName;this._showPhotoGallery(r,s,i);break;case B.TourItemActions.ShowRoomInfo:this._showRoomInfo(e);break;case B.TourItemActions.ShowMyCarts:this._cartCollectionsDialog.show()}o&&this.ManageAction.fire(n(n({},e),{Manage:o}))},o.prototype._onMenuClicked=function(t){switch(t.Item){case N.CartMenu.SaveCart:this._saveDialog.show();break;case N.CartMenu.LoadCart:this._loadDialog.update({Items:a.cartCatalog.getCartList()}),this._loadDialog.show();break;case N.CartMenu.NewCart:this._newCartConfirmDialog.update(w.cartUtils.getNewCartConfirmSettings(a.cartCatalog.getActiveCartId())),this._newCartConfirmDialog.show();break;case N.CartMenu.OpenLM:this.ManageAction.fire(n({Manage:L.CartManage.ExportToLM},t));break;case N.CartMenu.MyCartCollections:this._cartCollectionsDialog.show();break;case N.CartMenu.Mail:this._mailDialog.show();break;case N.CartMenu.Sms:this._smsDialog.show();break;case N.CartMenu.ShareLink:var e=w.cartUtils.getCountryGroupedData(a.cartCatalog.getToursData()),o=a.cartCatalog.getInfoData(),i=a.cartCatalog.getActiveCartId(),r=x.cartShareUtils.getShareSettings(e,o,i);(0,C.showShare)(n(n({},r),{ActionSource:s.ActionStatisticsSource.CART,ModeView:p.ModeView.DescTop,Shared:new h.Delegate(this,this._onSubmitDialog,{Manage:L.CartManage.ShareLink})}));break;case N.CartMenu.Discount:this._discountDialog.show();break;case N.CartMenu.Print:this.ManageAction.fire({Manage:L.CartManage.Print});break;case N.CartMenu.Update:this._onSubmitDialog({Manage:L.CartManage.Refresh});break;case N.CartMenu.Login:this._loginDialog.show();break;case N.CartMenu.Logout:f.authManager.logout();break;case N.CartMenu.Showcase:this._showcaseDialog.show();break;case N.CartMenu.EditProfile:this._updateEditProfileDialog(),this._editProfileDialog.show();break;case N.CartMenu.EditCustomerData:this._editCustomerDialog.update({}),this._editCustomerDialog.show()}},o.prototype._onSendRequest=function(t){this.ManageAction.fire(n(n({},t),{Manage:L.CartManage.Order}))},o.prototype._updateData=function(t){switch(t){case v.CatalogName.TourData:var e=w.cartUtils.getCountryGroupedData(a.cartCatalog.getToursData());this._window&&this._window.update({Items:e,UpdatingTours:!1});break;case v.CatalogName.CartSmsData:if(this._smsDialog){var o=a.cartCatalog.getSmsData();if(o){var i=o.longlink,r=o.shortlink,n=o.isshortlink,s=o.limit;this._smsDialog.update({IsShortLink:n,Limit:s,LongLink:i,ShortLink:r})}}break;case v.CatalogName.CartMailData:this._updateMailData();break;case v.CatalogName.CartInfoData:this._updateInfoData();break;case v.CatalogName.ClientData:break;case v.CatalogName.ManagerData:this._updateEditProfileDialog();break;case v.CatalogName.CartListFull:if(this._cartCollectionsDialog&&f.authManager.isManager()){var l=a.cartCatalog.getCartListFull(f.authManager.getId());l&&this._cartCollectionsDialog.update({Items:l,IsUpdating:!1})}break;case v.CatalogName.CartLeadData:var u=a.cartCatalog.getLeadData();if(u){var c=u.customer,h=c.email,d=c.fullName,p=c.telephone,_=u.comment.text;this._editCustomerDialog&&this._editCustomerDialog.update({Comment:_||"",Email:h||"",Name:d||"",Phone:p||""}),this._mailDialog&&this._mailDialog.update({Mail:h||""}),this._smsDialog&&this._smsDialog.update({Phone:p||""})}break;case v.CatalogName.CartLeadId:var y=a.cartCatalog.getCartLeadId();this._editCustomerDialog&&0===y&&this._editCustomerDialog.update({Comment:"",Email:"",Name:"",Phone:""})}},o.prototype._updateMailData=function(){if(this._mailDialog){var t=a.cartCatalog.getMailData();if(t){var e=t.begin,o=void 0===e?"":e,i=t.doclink,r=void 0===i?"":i,n=t.end,s=void 0===n?"":n,l=t.profilelink,u=void 0===l?"":l,c=t.subject,h=void 0===c?"":c;this._mailDialog.update({ProfileLink:u,DocLink:r,Signature:s,Subject:h,Text:o})}}},o.prototype._updateInfoData=function(){var t=a.cartCatalog.getInfoData(),e=t.discount,o=(t.share,t.manager),i=t.client,r=t.name,n=t.comment,s=t.showtoclient;if(e&&this._discountDialog.update({Value:(0,_.convertToDecimal)(e,2)}),o&&this._editProfileDialog&&this._editProfileDialog.update({Logo:o.logo||""}),this._saveDialog.update({Comment:n||"",Name:r||"",ShowToClient:!!Number(s)}),i){var l=i.email,u=i.name,c=i.phone,h=i.comment;this._editCustomerDialog&&this._editCustomerDialog.update({Comment:h||"",Email:l||"",Name:u||"",Phone:c||""}),this._mailDialog&&this._mailDialog.update({Mail:l||""}),this._smsDialog&&this._smsDialog.update({Phone:c||""})}},o.prototype._updateEditProfileDialog=function(){if(this._editProfileDialog&&f.authManager.isManager()){var t=a.cartCatalog.getCabinetManagerData(f.authManager.getId()),e=w.cartUtils.getCabinetManager(t);if(e){var o=e.name,i=e.contacts,r=e.path;this._editProfileDialog.update({FullName:o||"",Info:i||"",Photo:r||""})}}},o.prototype._showPhotoGallery=function(t,e,o){if(void 0===e&&(e=""),void 0===o&&(o=0),t){(Boolean(o)?m.craftTourPhotoService.all({tourId:o}).then(function(t){if((0,_.isNotEmptyArray)(t))return{Items:P.pictureUtils.getCraftTourLinks(t),Title:e.toLocaleLowerCase()}}):T.hotelDataService.getHotelDataById(t).then(function(t){var o=S.hotelUtils.getHotelPhoto(t);if(o){return{Items:S.hotelUtils.getPhotoGalleryItems(o),Title:(t.hotel_name||e).toLowerCase()}}})).then(function(t){t&&(0,y.showGallery)(n(n({},t),{ActiveIndex:0,ModeView:p.ModeView.DescTop}))})}},o.prototype._showRoomInfo=function(t){var e=t.RoomId,o=t.RoomServiceType;e&&(0,g.showRoom)({ActionSource:s.ActionStatisticsSource.CART,ModeView:p.ModeView.DescTop,RoomId:e,RoomServiceType:o})},o}(c.Core);e.DesctopCartController=F,i.DesctopCartController=F}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CartPreviewControl=void 0;var r=o(2),n=o(1),s=o(433),a=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="cart-preview",o._Count=0,o._Align=s.CartPreviewAlign.Right,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateAlign()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._updateAlign()},e.prototype.show=function(){document.body.appendChild(this._DomNode)},e.prototype.hide=function(){this._DomNode.parentNode&&this._DomNode.parentNode.removeChild(this._DomNode)},e.prototype.destroy=function(){this.hide(),t.prototype.destroy.call(this)},e.prototype._updateAlign=function(){switch(this._Align){case s.CartPreviewAlign.Left:(0,n.addClass)(this._DomNode,"TVCartPreviewLeft"),(0,n.removeClass)(this._DomNode,"TVCartPreviewRight");break;case s.CartPreviewAlign.Right:default:(0,n.addClass)(this._DomNode,"TVCartPreviewRight"),(0,n.removeClass)(this._DomNode,"TVCartPreviewLeft")}},e}(r.Control);e.CartPreviewControl=a,t.CartPreviewControl=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CartCollectionsDialog=void 0;var r=o(77),n=o(23),s=o(4),a=o(3),l=o(439),u=function(t){function e(e){var o=t.call(this,e)||this;return o.ItemClick=new a.UserEvent,o._IsUpdating=!1,o._ItemDelete=null,o._Items=[],o._WindowClass="TVCartCollectionsDialog",o._cartCollectionsControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){this._cartCollectionsControl=new l.CartCollectionsControl({Items:this._Items,ItemClick:new s.Delegate(this,this._onItemClicked),ItemDelete:this._ItemDelete}),this._Content=this._cartCollectionsControl.getDomNode(),t.prototype.render.call(this)},e.prototype.update=function(e){t.prototype.update.call(this,e),this._cartCollectionsControl.update(e),this._IsUpdating?this._showWaiter():this._hideWaiter()},e.prototype._showWaiter=function(){var t=this._nodes.contentNode;this._waiter||(this._waiter=new n.Waiter({ParentNode:t})),this._waiter.show()},e.prototype._hideWaiter=function(){this._waiter&&this._waiter.hide()},e.prototype._onItemClicked=function(t){this.ItemClick.fire(t),this.hide()},e}(r.PopUpDialog);e.CartCollectionsDialog=u,t.CartCollectionsDialog=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.DiscountDialog=void 0;var r=o(77),n=o(4),s=o(3),a=o(438),l=function(t){function e(e){var o=t.call(this,e)||this;return o.Submit=new s.UserEvent,o._Class="TVDiscountForm",o._Value=0,o._discountFormControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),e.Value&&this._discountFormControl.update({Value:e.Value})},e.prototype.render=function(){this._discountFormControl=new a.DiscountFormControl({Submit:new n.Delegate(this,this._onSubmit),Value:this._Value}),this._Content=this._discountFormControl.getDomNode(),t.prototype.render.call(this)},e.prototype.show=function(){t.prototype.show.call(this),this._discountFormControl.update({Value:this._Value})},e.prototype._onSubmit=function(t){this.Submit.fire(t),this.hide()},e}(r.PopUpDialog);e.DiscountDialog=l,t.DiscountDialog=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.EditCustomerDialog=void 0;var n=o(77),s=o(4),a=o(3),l=o(440),u=function(t){function e(e){var o=t.call(this,e)||this;return o.Submit=new a.UserEvent,o._IsAutocomplete=!1,o._WindowClass="TVEditCustomerDialog",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){this._editCustomerControl=new l.EditCustomerControl({IsAutocomplete:this._IsAutocomplete,Submit:new s.Delegate(this,this._onSubmit)}),this._Content=this._editCustomerControl.getDomNode(),t.prototype.render.call(this)},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&this._editCustomerControl.update(e)},e.prototype._onSubmit=function(t){this._showWaiter(),this.Submit.fire(r(r({},t),{Callback:new s.Delegate(this,this._onRecieved)}))},e.prototype._onRecieved=function(t){t.success?this.hide():this._showMessage("При сохранении данных клиента произошла ошибка, обратитесь в техподдержку."),this._hideWaiter()},e}(n.PopUpDialog);e.EditCustomerDialog=u,t.EditCustomerDialog=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.EditProfileDialog=void 0;var n=o(77),s=o(4),a=o(3),l=o(441),u=function(t){function e(e){var o=t.call(this,e)||this;return o.Submit=new a.UserEvent,o._FullName="",o._Info="",o._Logo="",o._Photo="",o._WindowClass="TVEditProfileDialog",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){this._editCommentForm=new l.EditProfileControl({FullName:this._FullName,Info:this._Info,Logo:this._Logo,Photo:this._Photo,Submit:new s.Delegate(this,this._onSubmit)}),this._Content=this._editCommentForm.getDomNode(),t.prototype.render.call(this)},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&this._editCommentForm.update(e)},e.prototype._onSubmit=function(t){this._showWaiter(),this.Submit.fire(r(r({},t),{Callback:new s.Delegate(this,this._onRecieved)}))},e.prototype._onRecieved=function(t){t.success?this.hide():this._showMessage(l.EditProfileControl.WARNING),this._hideWaiter()},e}(n.PopUpDialog);e.EditProfileDialog=u,t.EditProfileDialog=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.LoadDialog=void 0;var n=o(77),s=o(4),a=o(3),l=o(1),u=o(443),c=o(104),h=function(t){function e(e){var o=t.call(this,e)||this;return o.Load=new a.UserEvent,o.Delete=new a.UserEvent,o._Class="TVLoadForm",o._Items=[],o._WindowClass="TVLoadDialog",o._deletedItemId=0,o._cartListControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){this._cartListControl=new u.SelectCartControl({Delete:new s.Delegate(this,this._onDeleted),Load:new s.Delegate(this,this._onLoaded)}),this._Content=this._cartListControl.getDomNode(),t.prototype.render.call(this)},e.prototype.update=function(e){if(t.prototype.update.call(this,e),e.Message)return void this._showMessage(e.Message);this._cartListControl.update(e)},e.prototype._onLoaded=function(t){this.Load.fire(r({},t)),this.hide()},e.prototype._onDeleted=function(t){this._showWaiter(),this._deletedItemId=t.Id||0,this.Delete.fire(r(r({},t),{Callback:new s.Delegate(this,this._onRecieved)}))},e.prototype._onRecieved=function(t){var e=this;this._hideWaiter();var o=(0,l.getProperty)(t,"data.success"),i=(0,l.getProperty)(t,"data.warning");if(1===o){var r=c.cartCatalog.getCartList(),n=r.filter(function(t){return Number(t.id)!==e._deletedItemId});c.cartCatalog.setCartList(n),this._cartListControl.update({Items:n})}else this._showMessage(i)},e}(n.PopUpDialog);e.LoadDialog=h,t.LoadDialog=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.MailDialog=void 0;var n=o(77),s=o(4),a=o(3),l=o(1),u=o(445),c=o(446),h=o(447),d=function(t){function e(e){var o=t.call(this,e)||this;return o.Submit=new a.UserEvent,o._Class="TVMailForm",o._CopyCheck=!0,o._DocLink="",o._ManagerId="",o._ShowEmail=!0,o._ShowCopyCheck=!0,o._WindowClass="TVMailDialog",o._mailForm=null,o._configureMailForm=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){var e=(0,l.newDiv)("TVMailFormContainer");this._mailForm=new h.MailFormControl({CopyCheck:this._CopyCheck,ParentNode:e,ShowCopyCheck:this._ShowCopyCheck,ShowEmail:this._ShowEmail,Submit:new s.Delegate(this,this._onSubmitted)}),this._configureMailForm=new c.ConfigureMailControl({DocLink:"",IsVisible:!1,ParentNode:e,LinkClicked:new s.Delegate(this,this._onLinkClicked)}),this._Content=e,t.prototype.render.call(this)},e.prototype.update=function(e){t.prototype.update.call(this,e),this._configureMailForm.update(e),this._mailForm.update(e),this._updateContentVisibility()},e.prototype._onSubmitted=function(t){this._showWaiter(),this.Submit.fire(r(r({},t),{Callback:new s.Delegate(this,this._onRecieved)}))},e.prototype._updateContentVisibility=function(){var t=!this._DocLink;(0,l.setVisible)(this._mailForm,t),(0,l.setVisible)(this._configureMailForm,!t)},e.prototype._onRecieved=function(t){this._hideWaiter();var e=t.success,o=t.doclink,i=void 0===o?"":o,r=t.warning,n=void 0===r?u.SEND_EMAIL_ERROR_MESSAGE:r;if(0===e&&Boolean(i))return this.update({DocLink:i}),void this._showContent();var s=1===e?u.SEND_EMAIL_SUCCESS_MESSAGE:n;this._showMessage(s)},e.prototype._showContent=function(){var t=this._nodes,e=t.contentNode,o=t.nodeWaiter,i=t.message;(0,l.show)(e),(0,l.hide)(o),(0,l.hide)(i)},e.prototype._onLinkClicked=function(){this.hide()},e}(n.PopUpDialog);e.MailDialog=d,t.MailDialog=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.SaveDialog=void 0;var n=o(77),s=o(4),a=o(3),l=o(1),u=o(444),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Submit=new a.UserEvent,o._Class="",o._WindowClass="TVSaveDialog",o._saveForm=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){this._saveForm=new u.CartSaveFormControl({Submit:new s.Delegate(this,this._onSubmitted)}),this._Content=this._saveForm.getDomNode(),t.prototype.render.call(this)},e.prototype.update=function(e){if(t.prototype.update.call(this,e),e.Message)return void this._showMessage(e.Message);this._saveForm.update(e)},e.prototype._onSubmitted=function(t){this._showWaiter(),this.Submit.fire(r(r({},t),{Callback:new s.Delegate(this,this._onRecieved)}))},e.prototype._onRecieved=function(t){var o=(0,l.getProperty)(t,"data.success"),i=(0,l.getProperty)(t,"data.warning");this._hideWaiter(),this._showMessage(1===o?e.MESSAGE_SUCCESS:i)},e.MESSAGE_SUCCESS="Подборка успешно сохранена",e}(n.PopUpDialog);e.SaveDialog=c,t.SaveDialog=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ShowcaseDialog=void 0;var r=o(77),n=o(291),s=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVShowcaseForm",o._WindowClass="TVShowcaseFormControl",o._Show=null,o._showcaseFormControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){this._showcaseFormControl=new n.ShowcaseFormControl({Show:this._Show}),this._Content=this._showcaseFormControl.getDomNode(),t.prototype.render.call(this)},e}(r.PopUpDialog);e.ShowcaseDialog=s,t.ShowcaseDialog=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.SmsDialog=void 0;var n=o(77),s=o(4),a=o(3),l=o(1),u=o(448),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Submit=new a.UserEvent,o._Class="TVSmsFormControl",o._ShowPhone=!0,o._ShowShortlnk=!0,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){this._smsForm=new u.SmsFormControl({ShowPhone:this._ShowPhone,ShowShortlnk:this._ShowShortlnk,Submit:new s.Delegate(this,this._onSubmitted)}),this._Content=this._smsForm.getDomNode(),t.prototype.render.call(this)},e.prototype.update=function(e){t.prototype.update.call(this,e),this._smsForm.update(e)},e.prototype._onSubmitted=function(t){this._showWaiter(),this.Submit.fire(r(r({},t),{Callback:new s.Delegate(this,this._response)}))},e.prototype._response=function(t){var o=(0,l.getProperty)(t,"data.success"),i=(0,l.getProperty)(t,"data.warning");this._hideWaiter(),this._showMessage(1===o?e.MESSAGE_SUCCESS:i)},e.MESSAGE_SUCCESS="Сообщение успешно отправлено",e}(n.PopUpDialog);e.SmsDialog=c,t.SmsDialog=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ToursCartWindow=void 0;var n=o(43),s=o(4),a=o(3),l=o(1),u=o(22),c=o(170),h=o(366),d=o(8),p=o(226),_=o(434),f=o(437),y=o(290),g=o(436),C=o(191),v=o(169),m=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="tours-cart-window",o.MenuClicked=new a.UserEvent,o._IsFixScroll=!0,o._Items=[],o._ManagerController=null,o._ManagerInfo=null,o._Permissions={},o._ShowOperator=!0,o._UpdatingTours=!1,o._WindowClass="TVToursCartWindow",o._Changed=null,o._LoginClicked=null,o._SendRequest=null,t.prototype.__initSettings.call(o,e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),(0,l.addClass)(this._closeButton,"TVMainColor");var e=this._nodes,o=e.menuNode,i=e.request,r=e.body,n=e.registrationBlock,a=e.managerBlock,u=e.activationBlock,d=this._Permissions,p=d.Menu,C=d.FastRegistrationEnabled;this._menu=new f.CartMenuControl({ManagerInfo:this._ManagerInfo,MenuItemsState:p,ClickMenu:new s.Delegate(this,this._onMenuClick)}),this._sideNavControl=new h.SideNavControl({Content:this._menu.getDomNode(),ParentNode:o,Position:"left"}),C&&(this._registration=new _.RegistrationController({LoginClicked:this._LoginClicked,RegistrationNode:n}));new g.ProActivationControl({ParentNode:u});a.appendChild(this._ManagerController.getDomNode()),this._countryList=new y.CountryListControl({Changed:this._Changed,ParentNode:r,Permissions:this._Permissions,ShowOperator:this._ShowOperator}),this._requestControl=(0,c.newRequestControl)({IsVisible:!1,ParentNode:i,Render:!1,Send:this._SendRequest}),this._updateVisibilityControls(),this._addEvents()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._requestControl.update(e);var o={Permissions:this._Permissions,ShowOperator:this._ShowOperator,UpdatingTours:this._UpdatingTours};e&&e.Items&&(o.Items=this._Items),this._countryList.update(o),this._menu.update(r(r({},e),{MenuItemsState:this._Permissions.Menu})),this._updateVisibilityControls()},e.prototype.show=function(e){var o=u.authManager.isManager(),i=this._Permissions,r=i.FastRegistrationEnabled,n=i.TourvisorProActivation;this._requestControl&&this._requestControl.setIsVisible(!1),r&&this._registration.show(),(0,l.setVisible)(this._nodes.registrationBlock,r&&!o),(0,l.setVisible)(this._nodes.activationBlock,n),t.prototype.show.call(this,e)},e.prototype.destroy=function(){this._removeEvents(),this._ManagerController=null,t.prototype.destroy.call(this)},e.prototype._addEvents=function(){this._onMailButtonClick=this._onMenuClick.bind(this,{Item:C.CartMenu.Mail}),this._onMenuButtonClick=this._onMenuButtonClick.bind(this),this._onNewCartButtonClick=this._onMenuClick.bind(this,{Item:C.CartMenu.NewCart}),this._onPrintButtonClick=this._onMenuClick.bind(this,{Item:C.CartMenu.Print}),this._onShareLinkButtonClick=this._onMenuClick.bind(this,{Item:C.CartMenu.ShareLink}),this._onSmsButtonClick=this._onMenuClick.bind(this,{Item:C.CartMenu.Sms});var t=this._nodes,e=t.mail,o=t.menuButton,i=t.newCart,r=t.print,n=t.shareLink,s=t.sms;(0,l.addEvent)(e,"click",this._onMailButtonClick),(0,l.addEvent)(o,"click",this._onMenuButtonClick),(0,l.addEvent)(i,"click",this._onNewCartButtonClick),(0,l.addEvent)(r,"click",this._onPrintButtonClick),(0,l.addEvent)(n,"click",this._onShareLinkButtonClick),(0,l.addEvent)(s,"click",this._onSmsButtonClick)},e.prototype._removeEvents=function(){var t=this._nodes,e=t.mail,o=t.menuButton,i=t.newCart,r=t.print,n=t.shareLink,s=t.sms;(0,l.removeEvent)(e,"click",this._onMailButtonClick),(0,l.removeEvent)(o,"click",this._onMenuButtonClick),(0,l.removeEvent)(i,"click",this._onNewCartButtonClick),(0,l.removeEvent)(r,"click",this._onPrintButtonClick),(0,l.removeEvent)(n,"click",this._onShareLinkButtonClick),(0,l.removeEvent)(s,"click",this._onSmsButtonClick)},e.prototype._onMenuClick=function(t){var e=this;if(!u.authManager.isManager()){var o=t.Item;if(p.CartManager.MANAGER_ACTIONS.indexOf(o)>-1)return}if(t.Callback){var i=t.Callback;t.Callback=new s.Delegate(this,function(){i.fire(),e._hideMenu()})}else this._hideMenu();this.MenuClicked.fire(t)},e.prototype._hideMenu=function(){this._sideNavControl.update({Visible:!1})},e.prototype._onMenuButtonClick=function(){this._sideNavControl.update({Visible:!0})},e.prototype._onButtonClick=function(){var t=this._nodes,e=t.footer,o=t.request;(0,l.hide)(e),(0,l.show)(o),this._requestControl.setIsVisible(!0),this._requestControl.show()},e.prototype._updateVisibilityControls=function(){var t=this._nodes,e=t.footer,o=t.mail,i=t.request,r=t.sms,n=t.registrationBlock,s=t.tvinfo,a=t.print,c=t.shareLink,h=t.activationBlock,p=u.authManager.isManager(),_=this._Permissions,f=_.Menu,y=_.FastRegistrationEnabled,g=_.TourvisorProActivation,C=f.SendEmail,m=f.SendSms,T=f.Print,w=f.ShareLink,S=v.CartSettingsState.Disable,P=v.CartSettingsState.Hidden;(0,l.setVisible)(o,C!==P),(0,l.updateClass)(o,d.TV_DISABLED,C===S),(0,l.setVisible)(r,m!==P),(0,l.updateClass)(r,d.TV_DISABLED,m===S),(0,l.setVisible)(a,T!==P),(0,l.updateClass)(a,d.TV_DISABLED,T===S),(0,l.setVisible)(c,w!==P),(0,l.updateClass)(c,d.TV_DISABLED,w===S),(0,l.setVisible)(e,!p&&!this._requestControl.getIsVisible()),(0,l.setVisible)(i,!p&&this._requestControl.getIsVisible()),(0,l.setVisible)(n,y&&!p),(0,l.setVisible)(h,g),(0,l.setVisible)(s,p&&y)},e}(n.PopUpBase);e.ToursCartWindow=m,t.ToursCartWindow=m}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotOfferDesktopController=void 0;var r=o(31),n=o(281),s=o(9),a=o(4),l=o(3),u=o(1),c=o(5),h=o(121),d=o(858),p=o(33),_=o(86),f=o(230),y=function(t){function e(e){var o=t.call(this,e)||this;return o.ActionClicked=new l.UserEvent,o.ShowShare=new l.UserEvent,o._BeforeShow=null,o._Hide=null,o._SendRequest=null,o._offerId=0,o._offerWindow=null,o._deleteDialog=null,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.show=function(t){this._initWindow(),this._offerWindow.show(t)},e.prototype.hide=function(){this._offerWindow.hide()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._offerWindow&&this._offerWindow.update(e);var o=e.HotOfferData;(0,u.isDefined)(o)&&(this._offerId=o.Id||0)},e.prototype._init=function(){this._deleteDialog=new n.ConfirmDialog({WindowClass:_.TV_OFFER_DELETE_CONFIRM,Confirm:new a.Delegate(this,this._onConfirmDelete)})},e.prototype._getOfferWindow=function(){return this._offerWindow},e.prototype._initWindow=function(){this._offerWindow||(this._offerWindow=new d.OfferWindow({HashName:c.Hash.Offerid,HistoryEnable:!0,ActionClicked:new a.Delegate(this,this._onActionClicked),BeforeShow:this._BeforeShow,Hide:this._Hide,SendRequest:this._SendRequest}))},e.prototype._onActionClicked=function(t){switch(t.Action){case p.HotOfferAction.Delete:return void this._showDeleteDialog();case p.HotOfferAction.Share:return void this.ShowShare.fire();case p.HotOfferAction.SendError:this._showErrorDialog()}this.ActionClicked.fire(t)},e.prototype._onConfirmDelete=function(){var t=this;this.ActionClicked.fire({Action:p.HotOfferAction.Delete,CallBack:new a.Delegate(this,function(){return t._offerWindow.hide()})})},e.prototype._showDeleteDialog=function(){this._deleteDialog.update({ContentHtml:" "}),this._deleteDialog.show()},e.prototype._showErrorDialog=function(){(0,h.showError)({ActionSource:r.ActionStatisticsSource.HOTOFFER,ErrorData:{OfferId:this._offerId,Url:encodeURIComponent(f.hotOffersShareUtils.getOfferLink(this._offerId))},ModeView:c.ModeView.DescTop})},e}(s.Core);e.HotOfferDesktopController=y,t.HotOfferDesktopController=y}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferWindow=void 0;var r=o(43),n=o(4),s=o(3),a=o(1),l=o(6),u=o(50),c=o(8),h=o(33),d=o(126),p=o(859),_=function(t){function e(e){var o=t.call(this,e)||this;return o.ActionClicked=new s.UserEvent,o.SendRequest=new s.UserEvent,o._HotOfferData={},o._Mode=h.HotOfferCardMode.View,o._WindowClass="TVHotOfferWindow",o._content=null,o.__initSettings(e),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderContent()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ActualizeVisibled,i=e.Mode,r=e.PreviewVisibled,n=e.WaiterVisibled;(0,a.isDefined)(i)&&(this._content.destroy(),this._renderContent(),this._updateUrl()),(0,a.isDefined)(o)&&(0,a.updateClass)(this._mainContainer,c.TV_ACTUALIZING,o),(0,a.isDefined)(r)&&(0,a.updateClass)(this._mainContainer,c.TV_PREVIEW,r),(0,a.isDefined)(n)&&(0,a.updateClass)(this._mainContainer,c.TV_SAVING,n),this._content&&this._content.update(e)},e.prototype.show=function(e){this._rendered||this.render(),t.prototype.show.call(this,e)},e.prototype.hide=function(){t.prototype.hide.call(this),this._content.update({Reset:!0}),(0,a.removeClass)(this._mainContainer,c.TV_SAVING)},e.prototype._renderContent=function(){this._content=new p.OfferCardWrapper({Class:"TVHotOfferWindowCard",DomNode:this._DomNode,HotOfferData:this._HotOfferData,Mode:this._Mode,ActionClicked:new n.Delegate(this,this._onActionClicked),SendRequest:new n.Delegate(this,this._onSendRequest)})},e.prototype._onActionClicked=function(t){this.ActionClicked.fire(t)},e.prototype._onSendRequest=function(t){this.SendRequest.fire(t)},e.prototype._updateUrl=function(){if(d.hotOfferUtils.isCreatingOffer(this._Mode,this._HotOfferData.Id)){var t=(0,l.removeSearchParams)((0,l.getCurrentURL)());u.historyService.replace("",{PopUp:!0},""+t)}},e}(r.PopUpBase);e.OfferWindow=_,t.OfferWindow=_}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.OfferCardWrapper=void 0;var n=o(2),s=o(4),a=o(3),l=o(1),u=o(5),c=o(170),h=o(33),d=o(86),p=o(452),_=o(460),f=o(462),y=function(t){function e(e){var o=t.call(this,e)||this;return o.ActionClicked=new a.UserEvent,o._Class="TVHotOfferCardWrapper",o._HotOfferData={},o._Mode=h.HotOfferCardMode.View,o._MenuItems=[],o._PriceItems=[],o._SendRequest=null,o._card=null,o._requestControl=null,o._menu=null,o._menuBtn=null,o._priceMenu=null,o._priceBtn=null,o._requestWrapperNode=null,o.__initSettings(e),o._onMenuBtnClick=o._onMenuBtnClick.bind(o),o._onPriceBtnClick=o._onPriceBtnClick.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderCard(),this._renderMenuBtn(),this._renderPriceBtn()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ActualizeVisibled,i=e.HotOfferData,r=e.MenuItems,n=e.PriceItems,s=e.Reset,a=e.WaiterVisibled;(0,l.isDefined)(i)&&this._card&&this._card.update(i),(0,l.isDefined)(o)&&this._card.update({ActualizeVisibled:o}),(0,l.isDefined)(r)&&(this._menu&&this._menu.update({MenuItems:r}),this._setVisibleMenuBtn()),(0,l.isDefined)(n)&&(this._priceMenu&&this._priceMenu.update({Items:n}),this._setVisiblePriceBtn()),(0,l.isDefined)(s)&&this._resetControls(),(0,l.isDefined)(a)&&this._card.update({WaiterVisibled:a})},e.prototype.destroy=function(){(0,l.removeEvent)(this._menuBtn,"click",this._onMenuBtnClick),(0,l.removeEvent)(this._priceBtn,"click",this._onPriceBtnClick),this._DomNode=null,this._HotOfferData=null,t.prototype.destroy.call(this)},e.prototype._renderCard=function(){this._card=new p.OfferCard(r(r({},this._HotOfferData),{Mode:this._Mode,ModeView:u.ModeView.DescTop,ParentNode:this._DomNode,ActionClicked:new s.Delegate(this,this._onActionClicked)}))},e.prototype._renderMenuBtn=function(){var t=this._card.getDateNode();this._menuBtn=(0,l.newDiv)(d.TV_MENU_BTN,t),(0,l.addEvent)(this._menuBtn,"click",this._onMenuBtnClick),this._setVisibleMenuBtn()},e.prototype._renderPriceBtn=function(){var t=this._card.getDateNode();this._priceBtn=(0,l.newDiv)(d.TV_PRICE_BTN,t),(0,l.addEvent)(this._priceBtn,"click",this._onPriceBtnClick),this._setVisiblePriceBtn()},e.prototype._onMenuBtnClick=function(){if(!this._menu){var t=this._card.getContentNode();this._menu=new _.OfferMenuDropPanel({MenuItems:this._MenuItems,ParentNode:t,MenuClicked:new s.Delegate(this,this._onMenuClicked)})}this._menu.show()},e.prototype._onPriceBtnClick=function(){if(!this._priceMenu){var t=this._card.getContentNode();this._priceMenu=new f.OfferPriceDropPanel({Items:this._PriceItems,ParentNode:t,Clicked:new s.Delegate(this,this._onPriceClicked)})}this._priceMenu.show()},e.prototype._onMenuClicked=function(t){this._menu.hide(),this.ActionClicked.fire(t)},e.prototype._onPriceClicked=function(t){this.ActionClicked.fire(t)},e.prototype._onActionClicked=function(t){switch(t.Action){case h.HotOfferAction.ShowDetail:this._showDetailClicked()}this.ActionClicked.fire(t)},e.prototype._resetControls=function(){this._setVisibleRequestController(!1)},e.prototype._showDetailClicked=function(){if(!this._requestControl)return this._requestWrapperNode=(0,l.newDiv)("TVHotOfferCardRequest",this._DomNode),this._requestControl=(0,c.newRequestControl)({IsVisible:!1,ParentNode:this._requestWrapperNode,Render:!1,Send:this._SendRequest}),this._requestControl.show(),void this._setVisibleRequestController(!0);var t=!this._requestControl.getIsVisible();this._setVisibleRequestController(t)},e.prototype._setVisibleRequestController=function(t){this._requestControl&&((0,l.setVisible)(this._requestWrapperNode,t),this._requestControl.setIsVisible(t))},e.prototype._setVisibleMenuBtn=function(){(0,l.setVisible)(this._menuBtn,this._MenuItems.length>0)},e.prototype._setVisiblePriceBtn=function(){(0,l.setVisible)(this._priceBtn,this._PriceItems.length>0)},e}(n.Control);e.OfferCardWrapper=y,t.OfferCardWrapper=y}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferButtonsController=void 0;var r=o(9),n=o(33),s=o(126),a=o(861),l=o(862),u=function(t){function e(e){var o=t.call(this,e)||this;return o._Mode=n.HotOfferCardMode.View,o._ActionBtnsNode=null,o._EditBtnsNode=null,o._Clicked=null,o._buttons=null,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._buttons.update(e)},e.prototype.destroy=function(){this._ActionBtnsNode=null,this._EditBtnsNode=null,t.prototype.destroy.call(this)},e.prototype._init=function(){var t=s.hotOfferUtils.isEditMode(this._Mode),e={ParentNode:t?this._EditBtnsNode:this._ActionBtnsNode,Clicked:this._Clicked};this._buttons=t?new l.OfferEditButtons(e):new a.OfferActionButtons(e)},e}(r.Core);e.OfferButtonsController=u,t.OfferButtonsController=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferActionButtons=void 0;var r=o(2),n=o(4),s=o(3),a=o(1),l=o(16),u=o(42),c=o(8),h=o(33),d=o(86),p=o(454),_=o(455),f=function(t){function e(e){var o=t.call(this,e)||this;return o.Clicked=new s.UserEvent,o._Class=d.TV_OFFER_ACTION_BUTTONS,o._IsLiked=!1,o._LikeCount=0,o._SearchLink="",o._ShareCount=0,o._likesButton=null,o._runSearchLink=null,o._showDetailButton=null,o._sharesButton=null,o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._createButtons(),this._updateShares(),this._updateLikes(),this._renderShowDetail(),this._renderRunSearchLink(),this._setVisibleActionButtons(),this._addCustomClasses()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsLiked,i=e.LikeCount,r=e.SearchLink,n=e.ShareCount;(0,a.isDefined)(n)&&this._updateShares(),((0,a.isDefined)(o)||(0,a.isDefined)(i))&&this._updateLikes(),(0,a.isDefined)(r)&&(this._updateRunSearchLink(),this._setVisibleActionButtons())},e.prototype.destroy=function(){(0,a.removeEvent)(this._showDetailButton,"click",this._onShowDetailClicked),(0,a.removeEvent)(this._runSearchLink,"click",this._onRunSearchClicked),t.prototype.destroy.call(this)},e.prototype._init=function(){this._onShowDetailClicked=this._onShowDetailClicked.bind(this),this._onRunSearchClicked=this._onRunSearchClicked.bind(this)},e.prototype._createButtons=function(){this._likesButton=new p.OfferLikesButtonControl({ParentNode:this._DomNode,Size:l.SizeEnum.XL,Click:new n.Delegate(this,this._onActionClicked,{Action:h.HotOfferAction.Like})}),this._sharesButton=new _.SharesButtonControl({ParentNode:this._DomNode,Click:new n.Delegate(this,this._onActionClicked,{Action:h.HotOfferAction.Share})})},e.prototype._renderShowDetail=function(){this._showDetailButton=(0,a.newDiv)(d.TV_OFFER_SHOW_DETAIL_BTN+" "+c.TV_BUTTON_HOVER,this._DomNode),(0,a.addEvent)(this._showDetailButton,"click",this._onShowDetailClicked)},e.prototype._renderRunSearchLink=function(){this._runSearchLink=(0,a.newLinkNode)(d.TV_OFFER_SHOW_DETAIL_BTN+" "+c.TV_BUTTON_HOVER,this._DomNode),(0,a.addEvent)(this._runSearchLink,"click",this._onRunSearchClicked)},e.prototype._setVisibleActionButtons=function(){var t=this._SearchLink.length>0;(0,a.setVisible)(this._runSearchLink,t),(0,a.setVisible)(this._showDetailButton,!t)},e.prototype._updateRunSearchLink=function(){this._runSearchLink.href=this._SearchLink},e.prototype._updateLikes=function(){this._likesButton.update({Count:this._LikeCount,IsActive:this._IsLiked,Id:this._Id})},e.prototype._updateShares=function(){this._sharesButton.update({Count:this._ShareCount,Id:this._Id})},e.prototype._onActionClicked=function(t){this.Clicked.fire(t)},e.prototype._onRunSearchClicked=function(t){this.Clicked.fire({Action:h.HotOfferAction.SearchLink,Event:t,Link:this._SearchLink})},e.prototype._onShowDetailClicked=function(t){this.Clicked.fire({Action:h.HotOfferAction.ShowDetail})},e.prototype._addCustomClasses=function(){u.customClassUtils.addHotOfferActionButtonsClass(this._DomNode)},e}(r.Control);e.OfferActionButtons=f,t.OfferActionButtons=f}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferEditButtons=void 0;var r=o(93),n=o(2),s=o(4),a=o(3),l=o(1),u=o(42),c=o(85),h=o(33),d=o(86),p=o(295),_=function(t){function e(e){var o=t.call(this,e)||this;return o.Clicked=new a.UserEvent,o._Class=d.TV_OFFER_ACTION_BUTTONS+" "+d.TV_OFFER_EDIT_BUTTONS,o._cancelButton=null,o._copyButton=null,o._createButton=null,o._deleteButton=null,o._saveButton=null,o._createHint=null,o._copyHint=null,o._deleteHint=null,o.__initSettings(e),o._onCreateClicked=o._onActionClicked.bind(o,{Action:h.HotOfferAction.Create}),o._onCopyClicked=o._onActionClicked.bind(o,{Action:h.HotOfferAction.Copy}),o._onDeleteClicked=o._onActionClicked.bind(o,{Action:h.HotOfferAction.Delete}),o._onSaveClicked=o._onActionClicked.bind(o,{Action:h.HotOfferAction.Save}),o._onCancelClicked=o._onActionClicked.bind(o,{Action:h.HotOfferAction.Cancel}),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderButtons(),this._renderHints(),this._addCustomClasses()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.WaiterVisibled;(0,l.isDefined)(o)&&this._saveButton.update({WaiterVisible:o})},e.prototype.destroy=function(){(0,l.removeEvent)(this._createButton,"click",this._onCreateClicked),(0,l.removeEvent)(this._copyButton,"click",this._onCopyClicked),(0,l.removeEvent)(this._deleteButton,"click",this._onDeleteClicked),t.prototype.destroy.call(this)},e.prototype._renderButtons=function(){this._createButton=(0,l.newDiv)(p.TV_HOT_OFFER_BASE_BUTTON+" "+d.TV_CREATE_BTN,this._DomNode),this._copyButton=(0,l.newDiv)(p.TV_HOT_OFFER_BASE_BUTTON+" "+d.TV_COPY_BTN,this._DomNode),this._deleteButton=(0,l.newDiv)(p.TV_HOT_OFFER_BASE_BUTTON+" "+d.TV_DELETE_BTN,this._DomNode),(0,l.addEvent)(this._createButton,"click",this._onCreateClicked),(0,l.addEvent)(this._copyButton,"click",this._onCopyClicked),(0,l.addEvent)(this._deleteButton,"click",this._onDeleteClicked),this._cancelButton=new c.ButtonWaiter({Class:d.TV_CANCEL_BTN,ParentNode:this._DomNode,Click:new s.Delegate(this,this._onCancelClicked)}),this._saveButton=new c.ButtonWaiter({Class:d.TV_SAVE_BTN,ParentNode:this._DomNode,Click:new s.Delegate(this,this._onSaveClicked)})},e.prototype._renderHints=function(){this._createHint=new r.Hint({Anchor:this._createButton,Position:r.HintPosition.TOP,Class:d.TV_CREATE_BTN_HINT}),this._copyHint=new r.Hint({Anchor:this._copyButton,Position:r.HintPosition.TOP,Class:d.TV_COPY_BTN_HINT}),this._deleteHint=new r.Hint({Anchor:this._deleteButton,Position:r.HintPosition.TOP,Class:d.TV_DELETE_BTN_HINT})},e.prototype._onActionClicked=function(t){this.Clicked.fire(t)},e.prototype._addCustomClasses=function(){u.customClassUtils.addHotOfferActionButtonsClass(this._DomNode)},e}(n.Control);e.OfferEditButtons=_,t.OfferEditButtons=_}).call(e,o(0))},function(t,e,o){"use strict";(function(t){/*!
 * Clamp.js 0.11.5
 *
 * Now Maintained by Josh English http://joshengish.com
 * Joseph Schmitt http://joe.sh
 * Released under the WTFPL license
 * http://sam.zoy.org/wtfpl/
 * https://github.com/jmenglis/clamp-js-main/blob/master/clamp.js
 */
Object.defineProperty(e,"__esModule",{value:!0}),e.resetClamp=e.setClamp=e.autoClamp=void 0;var i=o(1);e.autoClamp="auto";var r=function(t,o){o=o||{};var r,n={clamp:o.clamp||2,useNativeClamp:!(0,i.isDefined)(o.useNativeClamp)||o.useNativeClamp,splitOnChars:o.splitOnChars||[".","-","–","—"," "],animate:o.animate||!1,truncationChar:o.truncationChar||"…",truncationHTML:o.truncationHTML},s=t.style,a=t.innerHTML,l=(0,i.isDefined)(t.style.webkitLineClamp),u=n.clamp,c=u.indexOf&&(u.indexOf("px")>-1||u.indexOf("em")>-1);n.truncationHTML&&(r=(0,i.newSpan)(),r.innerHTML=n.truncationHTML);var h=function(t,e){return window.getComputedStyle(t,null).getPropertyValue(e)},d=function(t,e){var o=e||t.clientHeight,i=p(t);return Math.max(Math.floor(o/i),0)},p=function(t){var e=h(t,"line-height");return"normal"===e&&(e=1.187*parseInt(h(t,"font-size"),10)),Math.ceil(parseFloat(e))},_=function(e){if(e.lastChild)return e.lastChild.childNodes&&e.lastChild.childNodes.length>0?_(Array.prototype.slice.call(e.childNodes).pop()):e.lastChild&&e.lastChild.nodeValue&&""!==e.lastChild.nodeValue&&e.lastChild.nodeValue!==n.truncationChar?e.lastChild:(e.lastChild.parentNode.removeChild(e.lastChild),_(t))},f=function(e,o){var i,s,a=n.splitOnChars.slice(0),l=a[0];if(e&&o){var u=e.nodeValue.replace(n.truncationChar,"");if(i||(l=a.length>0?a.shift():"",i=u.split(l)),i.length>1?(s=i.pop(),y(e,i.join(l))):i=null,r&&(e.nodeValue=e.nodeValue.replace(n.truncationChar,""),t.innerHTML=e.nodeValue+" "+r.innerHTML+n.truncationChar),i){if(t.clientHeight<=o){if(!(a.length>=0&&""!==l))return t.innerHTML;y(e,i.join(l)+l+s),i=null}}else""===l&&(y(e,""),e=_(t),function(){a=n.splitOnChars.slice(0),l=a[0],i=null,s=null}());if(!n.animate)return f(e,o);setTimeout(function(){f(e,o)},!0===n.animate?10:n.animate)}},y=function(t,e){t.nodeValue=e+n.truncationChar};u===e.autoClamp?u=d(t):c&&(u=d(t,parseInt(u,10)));var g;if(l&&n.useNativeClamp)s.overflow="hidden",s.textOverflow="ellipsis",s.webkitBoxOrient="vertical",s.display="-webkit-box",s.webkitLineClamp=u,c&&(s.height=n.clamp+"px");else{var C=function(t,e){return p(t)*e}(t,u);C<t.clientHeight&&(g=f(_(t),C))}return{Clamped:g,Original:a}};e.setClamp=r;var n=function(t,e){var o=(0,i.isDefined)(t.style.webkitLineClamp),r=t.style,n=!(0,i.isDefined)(e.useNativeClamp)||e.useNativeClamp,s=e.clamp||2,a=s.indexOf&&(s.indexOf("px")>-1||s.indexOf("em")>-1);o&&n&&(r.overflow="",r.textOverflow="",r.webkitBoxOrient="",r.display="",r.webkitLineClamp="",a&&(r.height=""))};e.resetClamp=n,t.resetClamp=e.resetClamp,t.setClamp=e.setClamp,t.autoClamp=e.autoClamp}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferPriceInputControl=void 0;var r,n=o(83),s=o(2),a=o(4),l=o(3),u=o(1),c=o(5),h=o(344),d=o(865),p=o(125),_=o(457);!function(t){t[t.New=0]="New",t[t.Old=1]="Old"}(r||(r={}));var f=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new l.UserEvent,o._Class=_.TV_OFFER_PRICE_CONTROL,o._Currency=c.Currency.Rub,o._New=0,o._Old=0,o._newPrice=null,o._oldPrice=null,o._currency=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderNewPrice(),this._renderOldPrice(),this._renderCurrency(),this._updateCurrency()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.New,i=e.Old,r=e.Currency;(0,u.isDefined)(o)&&this._updateNewPrice(),(0,u.isDefined)(i)&&this._updateOldPrice(),(0,u.isDefined)(r)&&this._updateCurrency()},e.prototype._renderNewPrice=function(){this._newPrice=new n.Input({CheckValid:!1,Class:"TVOfferPriceNewPriceInput",NumberOnly:!0,ParentNode:this._DomNode,Value:(0,u.getPrice)(this._New),ChangeValue:new a.Delegate(this,this._onPriceChanged,{Type:r.New})})},e.prototype._renderOldPrice=function(){this._oldPrice=new n.Input({CheckValid:!1,Class:"TVOfferPriceOldPriceInput",NumberOnly:!0,ParentNode:this._DomNode,Value:(0,u.getPrice)(this._Old),ChangeValue:new a.Delegate(this,this._onPriceChanged,{Type:r.Old})})},e.prototype._renderCurrency=function(){var t=p.hotOffersFilterUtils.getDefaultCurrencies();this._currency=new d.SelectCurrencyControl({Class:"TVOfferPriceCurrencyCombobox",Items:h.currencyUtils.getItems(t),ParentNode:this._DomNode,Render:!1,SelectionChanged:new a.Delegate(this,this._onCurrencyChanged)})},e.prototype._updateNewPrice=function(){var t=this._New>0?(0,u.getPrice)(this._New):"";this._newPrice.setValue(t)},e.prototype._updateOldPrice=function(){var t=this._Old>0?(0,u.getPrice)(this._Old):"";this._oldPrice.setValue(t)},e.prototype._updateCurrency=function(){this._currency.update({Currency:this._Currency})},e.prototype._onPriceChanged=function(t){var e=t.Value,o=t.Type,i=(0,u.replaceAll)(" ","",e);switch(o){case r.New:this._New=Number(i),this._updateNewPrice();break;case r.Old:this._Old=Number(i),this._updateOldPrice()}var n={Currency:this._Currency,New:this._New,Old:this._Old};this.Changed.fire(n)},e.prototype._onCurrencyChanged=function(t){var e=t.Item;this._Currency=e.Id;var o={Currency:this._Currency,New:this._New,Old:this._Old};this.Changed.fire(o)},e}(s.Control);e.OfferPriceInputControl=f,t.OfferPriceInputControl=f}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.SelectCurrencyControl=void 0;var r=o(63),n=o(1),s=o(5),a=o(6),l=function(t){function e(e){var o=t.call(this,e)||this;return o._Currency=s.Currency.Rub,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),(0,n.isDefined)(e.Currency)&&(this.clearSelection(),this.setSelectedById(this._Currency,!1))},e.prototype._setContent=function(e){var o=this._Selected[0];if((0,n.isDefined)(o)){var i=(0,a.getPureCurrencyRusStr)(o);t.prototype._setContent.call(this,i)}},e.CLASS="TVSelectCurrencyControl",e}(r.ComboBox);e.SelectCurrencyControl=l,t.SelectCurrencyControl=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.OfferFilterControl=void 0;var n=o(130),s=o(2),a=o(3),l=o(1),u=o(5),c=o(6),h=o(99),d=o(459),p=o(42),_=o(102),f=o(40),y=o(126),g=[h.FilterType.DEPARTURE,h.FilterType.COUNTRY,h.FilterType.HOTELS,h.FilterType.DATE,h.FilterType.NIGHTS],C=function(t){function e(e){var o=t.call(this,e)||this;return o.LinkChanged=new a.UserEvent,o.templateName="offer-filter",o._Link="",o._ModeView=u.ModeView.DescTop,o._Settings={},o._SettingsChanged=null,o._form=null,o._linkInput=null,o.__initSettings(e),o._onLinkChanged=o._onLinkChanged.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderForm(),this._renderInput(),this._updateLink(),this._addCustomClasses()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Link,i=e.Settings;(0,l.isDefined)(i)&&this._updateForm(),(0,l.isDefined)(o)&&this._updateLink()},e.prototype.destroy=function(){(0,l.removeEvent)(this._linkInput,"blur",this._onLinkChanged),t.prototype.destroy.call(this)},e.prototype._renderForm=function(){var t=this._nodes.tourParamsNode;this._Settings.DepartureProps=this._Settings.DepartureProps||{},this._Settings.DepartureProps.IsEnabledUnselectedContent=!1,this._Settings.HotelProps=this._Settings.HotelProps||{},this._Settings.HotelProps.SelectedLimit=1,this._Settings.NightsLimit=1,this._Settings.CalendarProps=this._Settings.CalendarProps||{},this._Settings.CalendarProps.SelectedLimit=1,this._form=new n.ModuleFilters(r(r({},this._Settings),{ActiveFilters:g,CountryMultiSelectEnabled:!1,DepartureNoFlightEnabled:!1,FilterMinWidth:140,ModeView:this._ModeView,ParentNode:t,WaiterEnabled:!0,SettingsChanged:this._SettingsChanged}))},e.prototype._renderInput=function(){var t=this._nodes.tourLinkNode;this._linkInput=(0,l.newDomNode)("textarea","TVHotOfferFilterTourInput",t),(0,l.addEvent)(this._linkInput,"input",this._onLinkChanged)},e.prototype._onLinkChanged=function(t){var e=this._linkInput.value;this._updateSettingsByLink(e),this.LinkChanged.fire({Link:e})},e.prototype._updateForm=function(){this._form.update(this._Settings)},e.prototype._updateLink=function(){this._linkInput.value=this._Link},e.prototype._updateSettingsByLink=function(t){var e=this;if(Boolean(t)&&(0,c.isUrl)(t)){var o=t.split("#");if(!(o.length<2)){o=o[1].split("=");if(o[0]===u.Hash.Tourid){var i=parseInt(o[1],10);if(i){var r={currency:u.Currency.None,shortid:i};d.tourService.get(r).then(function(t){if(t&&t.data&&t.data.tour){var o=f.tourUtils.getTourData(t.data.tour);e._form.update(_.searchFormUtils.getSettingsFromTourData(o)),e._SettingsChanged.fire(y.hotOfferUtils.getSettingsFromTourData(o))}}).catch(function(t){return console.log(t),t})}}}}},e.prototype._addCustomClasses=function(){p.customClassUtils.addHotOfferFilterClass(this._DomNode)},e}(s.Control);e.OfferFilterControl=C,t.OfferFilterControl=C}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.OfferPictureControl=void 0;var n=o(136),s=o(2),a=o(4),l=o(3),u=o(1),c=o(221),h=o(6),d=o(22),p=o(296),_=o(450),f=o(151),y=o(8),g=o(33),C=o(868),v=o(126),m=o(869),T=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new l.UserEvent,o._Class="TVHotOfferPicture",o._Mode=g.HotOfferCardMode.View,o._PictureLink="",o._PictureSettings={},o._buttons=null,o._gallery=null,o._pictureItems=[],o._pictureType=p.PictureType.NONE,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderGallery(),v.hotOfferUtils.isEditMode(this._Mode)&&(this._renderButtons(),this._updatePicturesByType(),this._updateVisibleButtons())},e.prototype.update=function(e){var o=this._PictureSettings;t.prototype.update.call(this,e);var i=e.PictureLink,r=e.PictureSettings;if((0,u.isDefined)(i)){var n=this._PictureLink.length>0?[this._PictureLink]:[];this._updateGallery(n)}(0,u.isDefined)(r)&&v.hotOfferUtils.isEditMode(this._Mode)&&(this._pictureType=C.hotOfferPictureUtils.getTypeByLink(this._PictureLink),this._updateVisibleButtons(),this._updatePicturesBySettings(o),this._updateActiveButton())},e.prototype._changePictureByIndex=function(t){(0,h.isEmptyArray)(this._pictureItems)||(this._PictureLink=this._pictureItems[t],this.Changed.fire({PictureLink:this._PictureLink}))},e.prototype._loadPictures=function(t){(0,u.removeClass)(this._DomNode,y.TV_PICTURE_OVERSIZED,y.TV_PICTURE_ERROR);var e=r(r({},t),{tsmng:d.authManager.getId()});return this._pictureItems=[],this.Changed.fire({PictureFile:null}),_.pictureService.query(e).catch(f.errorCatched)},e.prototype._onGalleryChanged=function(t){var e=t.ActiveIndex;this._changePictureByIndex(e)},e.prototype._onPictureButtonClicked=function(t){var e=t.Type;this._pictureType!==e&&(this._pictureType=e,this._updatePicturesByType(),this._updateVisibleButtons())},e.prototype._onUserPictureChanged=function(t){var e=this,o=t.ImageFile;(0,u.removeClass)(this._DomNode,y.TV_PICTURE_OVERSIZED,y.TV_PICTURE_ERROR),this._updateGallery([]);var i=null;o?o.size>3e7?(0,u.addClass)(this._DomNode,y.TV_PICTURE_OVERSIZED):((0,u.addClass)(this._DomNode,y.TV_PICTURE_LOADING),i=o):(0,u.addClass)(this._DomNode,y.TV_PICTURE_ERROR),this._pictureType=p.PictureType.USER,this.Changed.fire({PictureFile:i}),i&&c.fileConverter.readAsImage(i,function(t){e._updateGallery([t]),(0,u.removeClass)(e._DomNode,y.TV_PICTURE_LOADING)},function(t){(0,u.addClass)(e._DomNode,y.TV_PICTURE_ERROR),e.Changed.fire({PictureFile:null}),console.log(t)})},e.prototype._renderButtons=function(){this._buttons=new m.OfferPictureButtonsControl({ParentNode:this._DomNode,ButtonClicked:new a.Delegate(this,this._onPictureButtonClicked),UserPictureChanged:new a.Delegate(this,this._onUserPictureChanged)})},e.prototype._renderGallery=function(){this._gallery=new n.PhotoGalleryControl({ParentNode:this._DomNode,PhotoSwitching:n.PhotoSwitching.Transform,TemplateName:n.PhotoGalleryTemplate.MOBILE,Change:new a.Delegate(this,this._onGalleryChanged)})},e.prototype._updateActiveButton=function(){this._buttons.update({ActiveType:this._pictureType})},e.prototype._updatePicturesBySettings=function(t){var e=this;if(C.hotOfferPictureUtils.isNeedLoadPictures(this._pictureType)){var o=C.hotOfferPictureUtils.getFilter(this._pictureType,this._PictureSettings);o=(0,h.isEmptyObject)(o)?C.hotOfferPictureUtils.getFilterBySettings(this._PictureSettings):o,this._pictureType=C.hotOfferPictureUtils.getTypeByFilter(o),this._loadPictures(o).then(function(o){var i=C.hotOfferPictureUtils.isSettingsChanged(t,e._PictureSettings);e._pictureItems=i?o:C.hotOfferPictureUtils.getPictures(e._PictureLink,o),e._updateGallery(e._pictureItems,0)})}},e.prototype._updatePicturesByType=function(){var t=this;if(C.hotOfferPictureUtils.isNeedLoadPictures(this._pictureType)){var e=C.hotOfferPictureUtils.getFilter(this._pictureType,this._PictureSettings);this._loadPictures(e).then(function(e){t._pictureItems=e,t._updateGallery(t._pictureItems,0)})}},e.prototype._updateVisibleButtons=function(){var t=this._PictureSettings,e=t.CountryId,o=t.HotelId,i=[p.PictureType.COMMON,p.PictureType.USER];e&&i.push(p.PictureType.COUNTRY),o&&i.push(p.PictureType.HOTEL),this._buttons.update({VisibleButtons:i})},e.prototype._updateGallery=function(t,e){this._gallery.update({Items:t}),(0,u.isDefined)(e)&&this._changePictureByIndex(e)},e}(s.Control);e.OfferPictureControl=T,t.OfferPictureControl=T}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var i,r=0,n=e.length;r<n;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.hotOfferPictureUtils=void 0;var r=o(296),n=function(){function t(){}return t.prototype.getTypeByLink=function(t){switch(!0){case!t:return r.PictureType.NONE;case t.indexOf("/slider/")>-1:return r.PictureType.COUNTRY;case t.indexOf("/hotel_pics/")>-1:return r.PictureType.HOTEL;case t.indexOf("/custom/")>-1:return r.PictureType.COMMON;default:return r.PictureType.USER}},t.prototype.getPictures=function(t,e){void 0===e&&(e=[]);var o=t&&e.indexOf(t)>-1,r=o?e.filter(function(e){return e!==t}):e;return i([t],r,!0)},t.prototype.getFilter=function(t,e){var o=e.CountryId,i=e.HotelId,n={};switch(t){case r.PictureType.HOTEL:i&&(n.hotelId=i);break;case r.PictureType.COUNTRY:o&&(n.countryId=o);break;default:n.common=!0}return n},t.prototype.getFilterBySettings=function(t){var e=t.CountryId,o=t.HotelId,i={};switch(!0){case Boolean(o):i.hotelId=o;break;case Boolean(e):i.countryId=e;break;default:i.common=!0}return i},t.prototype.getTypeByFilter=function(t){switch(!0){case Boolean(t.hotelId):return r.PictureType.HOTEL;case Boolean(t.countryId):return r.PictureType.COUNTRY;default:return r.PictureType.COMMON}},t.prototype.isNeedLoadPictures=function(t){return t!==r.PictureType.USER&&t!==r.PictureType.NONE},t.prototype.isSettingsChanged=function(t,e){var o=t.CountryId,i=t.HotelId,r=e.CountryId,n=e.HotelId;return o>0&&r!==o||i&&n!==i},t}();e.hotOfferPictureUtils=new n,t.hotOfferPictureUtils=e.hotOfferPictureUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferPictureButtonsControl=void 0;var r=o(442),n=o(2),s=o(4),a=o(3),l=o(1),u=o(90),c=o(296),h=o(8),d=function(t){function e(e){var o=t.call(this,e)||this;return o.ButtonClicked=new a.UserEvent,o.UserPictureChanged=new a.UserEvent,o.templateName="offer-picture-buttons",o._VisibleButtons=[],o._userPictureLoader=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderUserPictureLoader(),this._updateActiveButton(c.PictureType.NONE),this._updateVisibleButtons(),(0,u.addSwipeHandler)({EndHandler:this._onSwipe.bind(this),Node:this._DomNode})},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._rendered){var o=e.ActiveType,i=e.VisibleButtons;(0,l.isDefined)(o)&&this._updateActiveButton(o),(0,l.isDefined)(i)&&this._updateVisibleButtons()}},e.prototype._clickButton=function(t){this._updateActiveButton(t),this.ButtonClicked.fire({Type:t})},e.prototype._onCommonClick=function(){this._clickButton(c.PictureType.COMMON)},e.prototype._onCountryClick=function(){this._clickButton(c.PictureType.COUNTRY)},e.prototype._onHotelClick=function(){this._clickButton(c.PictureType.HOTEL)},e.prototype._onResortClick=function(){this._clickButton(c.PictureType.REGION)},e.prototype._onSwipe=function(t){(0,l.stopPropagation)(t),(0,l.preventDefault)(t)},e.prototype._onUserPictureChanged=function(t){this._updateActiveButton(c.PictureType.USER),this.UserPictureChanged.fire(t)},e.prototype._renderUserPictureLoader=function(){this._userPictureLoader=new r.LoaderImage({ParentNode:this._nodes.user,Changed:new s.Delegate(this,this._onUserPictureChanged)})},e.prototype._updateActiveButton=function(t){var e=this._nodes,o=e.common,i=e.country,r=e.hotel,n=e.resort,s=e.user;(0,l.updateClass)(o,h.TV_ACTIVE,t===c.PictureType.COMMON),(0,l.updateClass)(i,h.TV_ACTIVE,t===c.PictureType.COUNTRY),(0,l.updateClass)(n,h.TV_ACTIVE,t===c.PictureType.REGION),(0,l.updateClass)(r,h.TV_ACTIVE,t===c.PictureType.HOTEL),(0,l.updateClass)(s,h.TV_ACTIVE,t===c.PictureType.USER)},e.prototype._updateVisibleButtons=function(){var t=this._nodes,e=t.common,o=t.country,i=t.hotel,r=t.resort,n=t.user;(0,l.setVisible)(e,-1!==this._VisibleButtons.indexOf(c.PictureType.COMMON)),(0,l.setVisible)(o,-1!==this._VisibleButtons.indexOf(c.PictureType.COUNTRY)),(0,l.setVisible)(r,-1!==this._VisibleButtons.indexOf(c.PictureType.REGION)),(0,l.setVisible)(i,-1!==this._VisibleButtons.indexOf(c.PictureType.HOTEL)),(0,l.setVisible)(n,-1!==this._VisibleButtons.indexOf(c.PictureType.USER))},e}(n.Control);e.OfferPictureButtonsControl=d,t.OfferPictureButtonsControl=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.OfferPriceMenu=void 0;var n=o(2),s=o(1),a=o(6),l=o(8),u=o(871),c=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVOfferPriceMenu "+l.TV_STYLE_SCROLL,o._Items=[],o._Clicked=null,o._itemsHash=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderPrices()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Items,i=e.ScrollToCurrent;(0,s.isDefined)(o)&&(this._clearPrices(),this._renderPrices()),(0,s.isDefined)(i)&&this._scrollToCurrent()},e.prototype.destroy=function(){this._Clicked=null,this._clearPrices(),t.prototype.render.call(this)},e.prototype._clearPrices=function(){(0,a.isNotEmptyArray)(this._itemsHash)&&(this._itemsHash.forEach(function(t){return t.destroy()}),this._itemsHash=[])},e.prototype._renderPrices=function(){var t=this;this._itemsHash=this._Items.map(function(e){return new u.OfferPriceMenuItem(r(r({},e),{ParentNode:t._DomNode,Clicked:t._Clicked}))})},e.prototype._scrollToCurrent=function(){var t=this._getCurrentNode(),e=this._DomNode.offsetHeight,o=t.offsetHeight,i=t.offsetTop;i+o>e&&(this._DomNode.scrollTop=i-e/2)},e.prototype._getCurrentNode=function(){var t=this._Items.findIndex(function(t){return t.IsCurrent});return this._itemsHash[t].getDomNode()},e}(n.Control);e.OfferPriceMenu=c,t.OfferPriceMenu=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferPriceMenuItem=void 0;var r=o(2),n=o(3),s=o(1),a=o(5),l=o(6),u=o(8),c=o(33),h=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="offer-price-menu-item",o.Clicked=new n.UserEvent,o._Currency=a.Currency.Rub,o._Date="",o._Day="",o._IsCurrent=!1,o._Link="",o._Nights="",o._Price="",o._DomNode=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateCurrency(),this._updateLink(),this._updateCurrent()},e.prototype._updateCurrency=function(){var t=(0,l.getCurrencyCssClass)(this._Currency);(0,s.addClass)(this._DomNode,t)},e.prototype._updateLink=function(){var t=this._hasLink();this._DomNode.href=t?this._Link:"",this._DomNode.title=t?"Открыть в поиске":"",this._DomNode.target=t?"_blank":"",(0,s.updateClass)(this._DomNode,"TVHasLink",t)},e.prototype._onClicked=function(e){if(!this._hasLink())return void(0,s.preventDefault)(e);t.prototype._onClicked.call(this,e),this.Clicked.fire({Action:c.HotOfferAction.SearchLink,Event:e,Link:this._Link})},e.prototype._updateCurrent=function(){(0,s.updateClass)(this._DomNode,u.TV_ACTIVE,this._IsCurrent)},e.prototype._hasLink=function(){return Boolean(this._Link)},e}(r.Control);e.OfferPriceMenuItem=h,t.OfferPriceMenuItem=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.HotOfferMobileController=e.HotOffersPagesName=void 0;var n,s=o(31),a=o(55),l=o(9),u=o(4),c=o(3),h=o(1),d=o(5),p=o(121),_=o(119),f=o(21),y=o(14),g=o(50),C=o(33),v=o(230);!function(t){t.HotOfferPage="HotOfferPage",t.HotOfferDeletePage="HotOfferDeletePage"}(n=e.HotOffersPagesName||(e.HotOffersPagesName={}));var m=function(t){function e(e){var o=t.call(this,e)||this;return o.ActionClicked=new c.UserEvent,o.Hide=new c.UserEvent,o.ShowShare=new c.UserEvent,o.SendRequest=new c.UserEvent,o._offerId=0,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._offerPage&&this._offerPage.update(e);var o=e.HotOfferData;(0,h.isDefined)(o)&&(this._offerId=o.Id||0)},e.prototype.show=function(t){y.router.goTo(f.RouterPath.HotOffer+"/"+t),y.router.Changed.addOnce(new u.Delegate(this,this._onRouteChanged))},e.prototype.hide=function(){y.router.back()},e.prototype.destroy=function(){a.layoutPageFactory.PageCreated.remove(this),t.prototype.destroy.call(this)},e.prototype._init=function(){a.layoutPageFactory.PageCreated.addOnce(new u.Delegate(this,this._onPageCreated))},e.prototype._onPageCreated=function(t){var e=a.layoutPageFactory.getPage();switch(t.PageClassName){case n.HotOfferPage:this._offerPage=e,this._offerPage.ActionClicked.addOnce(new u.Delegate(this,this._onActionClicked));break;case n.HotOfferDeletePage:this._offerDeletePage=e,this._offerDeletePage.Confirm.addOnce(new u.Delegate(this,this._onConfirmDelete))}},e.prototype._onActionClicked=function(t){switch(t.Action){case C.HotOfferAction.ShowDetail:this._showRequestPage();break;case C.HotOfferAction.Delete:return void this._showDeletePage();case C.HotOfferAction.Share:return void this.ShowShare.fire();case C.HotOfferAction.SendError:this._showErrorPage()}this.ActionClicked.fire(t)},e.prototype._onConfirmDelete=function(){this.ActionClicked.fire({Action:C.HotOfferAction.Delete,CallBack:new u.Delegate(this,function(){return y.router.back()})})},e.prototype._onRouteChanged=function(t){var e=t.From,o=t.Navigation;e.includes(f.RouterPath.HotOffer+"/")&&o===g.NavigationDirection.Back&&(y.router.Changed.remove(this),this.Hide.fire())},e.prototype._showErrorPage=function(){(0,p.showError)({ActionSource:s.ActionStatisticsSource.HOTOFFER,ErrorData:{OfferId:this._offerId,Url:encodeURIComponent(v.hotOffersShareUtils.getOfferLink(this._offerId))},ModeView:d.ModeView.Mobile})},e.prototype._showDeletePage=function(){y.router.goTo(f.RouterPath.HotOfferDelete,{ContentHtml:" "})},e.prototype._showRequestPage=function(){(0,_.showRequest)({ModeView:d.ModeView.Mobile,SendClicked:new u.Delegate(this,this._onSendRequet)})},e.prototype._onSendRequet=function(t){this.SendRequest.fire(r(r({},t),{IsMobile:!0}))},e}(l.Core);e.HotOfferMobileController=m,t.HotOfferMobileController=m,t.HotOffersPagesName=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var i,r=0,n=e.length;r<n;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.hotOfferMenuUtils=void 0;var r=o(6),n=o(33),s=[{Action:n.HotOfferAction.Edit},{Action:n.HotOfferAction.Create},{Action:n.HotOfferAction.Copy},{Action:n.HotOfferAction.Delete},{Action:n.HotOfferAction.Share},{Action:n.HotOfferAction.SearchLink,Link:""},{Action:n.HotOfferAction.SendError}],a=function(){function t(){}return t.prototype.getMenuItems=function(t){var e=i([],s,!0),o=[],r=[],a=this._getSearchLink(t);return a?r.push({Action:n.HotOfferAction.SearchLink,Link:a}):o.push(n.HotOfferAction.SearchLink),this._filterMenuItems(e,r,o)},t.prototype._getSearchLink=function(t){return t&&t.SearchLink||""},t.prototype._filterMenuItems=function(t,e,o){return t=t||[],(0,r.isNotEmptyArray)(e)&&e.forEach(function(e){var o=t.findIndex(function(t){return t.Action===e.Action});o>-1?t[o]=e:t.push(e)}),(0,r.isNotEmptyArray)(o)&&(t=t.filter(function(t){return!o.some(function(e){return e===t.Action})})),t},t}();e.hotOfferMenuUtils=new a,t.hotOfferMenuUtils=e.hotOfferMenuUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var o=this&&this.__assign||function(){return o=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},o.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.hotOfferPriceMenuUtils=void 0;var i=function(){function t(){}return t.prototype.getItems=function(t,e){var i=t.Snapshots;return(void 0===i?[]:i).map(function(t){var i=t.Link;return o(o({},t),{Link:e?i:""})})},t}();e.hotOfferPriceMenuUtils=new i,t.hotOfferPriceMenuUtils=e.hotOfferPriceMenuUtils}).call(e,o(0))},function(t,e,o){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});var r=o(21),n=o(14),s=o(876),a=o(877),l=r.RouterPath,u=r.RouterPathParam;n.router.addRoutes((i={},i[l.HotOffer+"/"+u.OfferId]=a.HotOfferPage,i[l.HotOfferDelete]=s.HotOfferDeletePage,i))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.HotOfferDeletePage=void 0;var n=o(293),s=o(86),a=function(t){function e(e){var o=t.call(this,r(r({},e),{Render:!1}))||this;return o._LayoutClass=s.TV_OFFER_DELETE_CONFIRM,o._Render=!0,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.displayName="HotOfferDeletePage",e}(n.ConfirmPage);e.HotOfferDeletePage=a,t.HotOfferDeletePage=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.HotOfferPage=void 0;var n=o(4),s=o(3),a=o(1),l=o(5),u=o(6),c=o(21),h=o(14),d=o(42),p=o(8),_=o(452),f=o(33),y=o(878),g=function(t){function e(e){var o=t.call(this,e)||this;return o.MoreBtnClicked=new s.UserEvent,o._HotOfferData={},o._LayoutClass="TVHotOfferPage",o._Mode=f.HotOfferCardMode.View,o._Transitions=[l.TransitionAnimationType.HideBack,l.TransitionAnimationType.ShowForward,l.TransitionAnimationType.ShowBack],o._hotOfferCard=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){var e=d.customClassUtils.getHotOfferPageClass();this._LayoutClass=(0,a.classNames)(this._LayoutClass,e),t.prototype.render.call(this),this._replaceRouter()},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._hotOfferCard){var o=e.ActualizeVisibled,i=e.HotOfferData,r=e.Mode,n=e.OfferId,s=e.PreviewVisibled,l=e.WaiterVisibled;(0,a.isDefined)(r)&&(this._Content=null,this._hotOfferCard.destroy(),this._hotOfferCard=null,this._createContent()),(0,a.isDefined)(i)&&this._hotOfferCard.update(i),(0,a.isDefined)(o)&&((0,a.updateClass)(this._layoutControl.getDomNode(),p.TV_ACTUALIZING,o),this._hotOfferCard.update({ActualizeVisibled:o})),(0,a.isDefined)(s)&&(0,a.updateClass)(this._layoutControl.getDomNode(),p.TV_PREVIEW,s),(0,a.isDefined)(l)&&((0,a.updateClass)(this._layoutControl.getDomNode(),p.TV_SAVING,l),this._hotOfferCard.update({WaiterVisibled:l})),(0,a.isDefined)(n)&&this._replaceRouter()}},e.prototype._getContent=function(){return this._hotOfferCard||(this._hotOfferCard=new _.OfferCard(r(r({},this._HotOfferData),{ScrollNode:this._layoutControl.getPanel(),Mode:this._Mode,ModeView:l.ModeView.Mobile,ActionClicked:new n.Delegate(this,this._onActionClicked)}))),this._hotOfferCard},e.prototype._onActionClicked=function(t){this.ActionClicked.fire(t)},e.prototype._replaceRouter=function(){this._OfferId&&h.router.replace({Path:c.RouterPath.HotOffer+"/"+this._OfferId,Url:(0,u.getCurrentURL)()+"#"+e.UrlHash+"="+this._OfferId})},e.displayName="HotOfferPage",e.UrlHash=l.Hash.Offerid,e}(y.BaseOfferPage);e.HotOfferPage=g,t.HotOfferPage=g}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.BaseOfferPage=void 0;var r=o(134),n=o(9),s=o(4),a=o(3),l=o(1),u=o(460),c=o(462),h=o(86),d=function(t){function e(e){var o=t.call(this,e)||this;return o.ActionClicked=new a.UserEvent,o._OfferId=0,o._MenuItems=[],o._PriceItems=[],o._extraHeader=null,o._menu=null,o._menuBtn=null,o._priceMenu=null,o._priceBtn=null,o.__initSettings(e),o._onMenuBtnClick=o._onMenuBtnClick.bind(o),o._onPriceBtnClick=o._onPriceBtnClick.bind(o),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderExtraHeader(),this._layoutControl.update({ExtraHeader:this._extraHeader,ShowMenu:!1,ShowProgress:!1})},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.MenuItems,i=e.Mode,r=e.PriceItems;(0,l.isDefined)(o)&&(this._menu&&this._menu.update({MenuItems:this._MenuItems}),this._setVisibleMenuBtn()),(0,l.isDefined)(r)&&(this._priceMenu&&this._priceMenu.update({Items:this._PriceItems}),this._setVisiblePriceBtn()),(0,l.isDefined)(i)&&this._updateMode()},e.prototype.destroy=function(){(0,l.removeEvent)(this._menuBtn,"click",this._onMenuBtnClick),t.prototype.destroy.call(this)},e.prototype._renderExtraHeader=function(){this._extraHeader=(0,l.newDiv)("TVHotOfferPageMenuButtons"),this._renderPriceBtn(),this._renderMenuBtn()},e.prototype._renderMenuBtn=function(){this._menuBtn=(0,l.newDiv)(h.TV_MENU_BTN,this._extraHeader),(0,l.addEvent)(this._menuBtn,"click",this._onMenuBtnClick),this._setVisibleMenuBtn()},e.prototype._renderPriceBtn=function(){this._priceBtn=(0,l.newDiv)(h.TV_PRICE_BTN,this._extraHeader),(0,l.addEvent)(this._priceBtn,"click",this._onPriceBtnClick),this._setVisiblePriceBtn()},e.prototype._createLayout=function(){this._LayoutClass="TVBaseOfferPage "+this._LayoutClass,t.prototype._createLayout.call(this)},e.prototype._destroyMenu=function(){this._menu instanceof n.Core&&(this._menu.destroy(),this._menu=null)},e.prototype._updateMode=function(){this._destroyMenu()},e.prototype._onMenuBtnClick=function(){this._menu||(this._menu=new u.OfferMenuDropPanel({MenuItems:this._MenuItems,ParentNode:this._layoutControl.getDomNode(),MenuClicked:new s.Delegate(this,this._onMenuClicked)})),this._menu.show()},e.prototype._onPriceBtnClick=function(){this._priceMenu||(this._priceMenu=new c.OfferPriceDropPanel({Items:this._PriceItems,ParentNode:this._layoutControl.getDomNode(),Clicked:new s.Delegate(this,this._onPriceClicked)})),this._priceMenu.show()},e.prototype._onMenuClicked=function(t){this._menu.hide(),this.ActionClicked.fire(t)},e.prototype._onPriceClicked=function(t){this.ActionClicked.fire(t)},e.prototype._setVisibleMenuBtn=function(){(0,l.setVisible)(this._menuBtn,this._MenuItems.length>0)},e.prototype._setVisiblePriceBtn=function(){(0,l.setVisible)(this._priceBtn,this._PriceItems.length>0)},e.displayName="BaseOfferPage",e}(r.LayoutPage);e.BaseOfferPage=d,t.BaseOfferPage=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.HotOfferSubscribeManager=void 0;var n=o(34),s=o(9),a=o(4),l=o(5),u=o(880),c=o(32),h=o(151),d=o(125),p=o(881),_=o(886),f=o(887);o(889);var y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._FilterSettings={},e._ModeView=l.ModeView.DescTop,e._OffsetTop=0,e._instance=null,e._сlientId=0,e}return i(e,t),e.prototype.show=function(t){this.__initSettings(t),this._initClientId(),this._initInstance(),this._showInstance(),this._updateInstance()},e.prototype.destroy=function(){this._FilterSettings=null,t.prototype.destroy.call(this)},e.prototype._initClientId=function(){var t=n.clientCatalog.getClientData();this._сlientId=c.clientUtils.getClientId(t)},e.prototype._initInstance=function(){var t=d.hotOffersFilterUtils.getModuleFilterSettings(this._FilterSettings),e={FilterSettings:t,FilterChanged:new a.Delegate(this,this._onFilterChanged),Hide:new a.Delegate(this,this._onInstanceHided),MessengerClicked:new a.Delegate(this,this._onMessengerClicked)};this._ModeView===l.ModeView.Mobile?this._initMobileController(e):this._initDesktopController(e)},e.prototype._initMobileController=function(t){if(this._instance instanceof _.HotOfferMobileSubscribeController)return this._instance;this._instance=new _.HotOfferMobileSubscribeController(t)},e.prototype._initDesktopController=function(t){if(this._instance instanceof p.HotOfferDesktopSubscribeController)return this._instance;this._instance=new p.HotOfferDesktopSubscribeController(t)},e.prototype._showInstance=function(){this._instance.show(this._OffsetTop)},e.prototype._onInstanceHided=function(){this._instance.update({Reset:!0})},e.prototype._updateInstance=function(){var t=d.hotOffersFilterUtils.getModuleFilterSettings(this._FilterSettings);this._instance.update({FilterSettings:t})},e.prototype._onFilterChanged=function(t){this._FilterSettings=r(r({},this._FilterSettings),t)},e.prototype._onMessengerClicked=function(t){var e=this,o=t.Messenger;this._instance.update({ShowWaiter:!0}),this._getSubscribeLink(o,this._сlientId).then(function(t){e._onClientSubsribeLinkReceived(t),e._instance.update({ShowWaiter:!1})},h.errorCatched)},e.prototype._getSubscribeLink=function(t,e){var o=f.hotOfferSubscribeUtils.getApiOfferSubscribeData({ClientId:e,Messenger:t,Settings:this._FilterSettings});return u.hotOfferSubscribeService.getSubscribe(o)},e.prototype._onClientSubsribeLinkReceived=function(t){if(t){var e={MessengerLink:t};this._instance.update(e)}},e}(s.Core);e.HotOfferSubscribeManager=y,t.HotOfferSubscribeManager=y}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.hotOfferSubscribeService=void 0;var i=o(46),r=o(47),n=function(){function t(){this.url="//tourvisor.ru/api/v1.1/bot-urls"}return t.prototype.getSubscribe=function(t){return i.cors.update({Url:this.url+"/subscribe"}),i.cors.get(t).catch(function(t){return r.logService.error(t)})},t.prototype.getBot=function(t){return i.cors.update({Url:this.url+"/url"}),i.cors.get(t).catch(function(t){return r.logService.error(t)})},t}();e.hotOfferSubscribeService=new n,t.hotOfferSubscribeService=e.hotOfferSubscribeService}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotOfferDesktopSubscribeController=void 0;var r=o(9),n=o(882),s=function(t){function e(e){var o=t.call(this,e)||this;return o._FilterSettings={},o._FilterChanged=null,o._Hide=null,o._MessengerClicked=null,o._window=null,o.__initSettings(e),o}return i(e,t),e.prototype.show=function(t){this._initWindow(),this._window.show(t)},e.prototype.update=function(e){t.prototype.update.call(this,e),this._window&&this._window.update(e)},e.prototype.destroy=function(){this._FilterChanged=null,this._Hide=null,this._MessengerClicked=null,this._FilterSettings=null,t.prototype.destroy.call(this)},e.prototype._initWindow=function(){this._window||(this._window=new n.OfferSubscribeWindow({FilterSettings:this._FilterSettings,FilterChanged:this._FilterChanged,Hide:this._Hide,MessengerClicked:this._MessengerClicked}))},e}(r.Core);e.HotOfferDesktopSubscribeController=s,t.HotOfferDesktopSubscribeController=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferSubscribeWindow=void 0;var r=o(43),n=o(1),s=o(463),a=function(t){function e(e){var o=t.call(this,e)||this;return o._FilterSettings={},o._WindowClass="TVHotOfferSubscribeWindow",o._FilterChanged=null,o._MessengerClicked=null,o._content=null,o.__initSettings(e),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderContent()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&this._content&&this._content.update(e)},e.prototype.show=function(e){this._rendered||this.render(),t.prototype.show.call(this),this._updateMainContainerPosition(e)},e.prototype.destroy=function(){this._MessengerClicked=null,this._FilterSettings=null,t.prototype.destroy.call(this)},e.prototype._renderContent=function(){this._content=new s.OfferSubscribeControl({FilterSettings:this._FilterSettings,ParentNode:this._DomNode,FilterChanged:this._FilterChanged,MessengerClicked:this._MessengerClicked})},e.prototype._updateMainContainerPosition=function(t){if(t){this._mainContainer.style.top=t+"px";var e=(0,n.getComputedSize)(this._mainContainer).Height,o=(0,n.getViewPort)().y,i=(0,n.getCoords)(this._mainContainer).top,r=e+i;r>o&&e<o&&(this._mainContainer.style.top=t-(r-o)+"px")}},e}(r.PopUpBase);e.OfferSubscribeWindow=a,t.OfferSubscribeWindow=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.OfferSubscribeFilterPanel=void 0;var n=o(130),s=o(1),a=o(5),l=o(99),u=o(166),c=o(464),h=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVOfferSubscribeFilterPanel",o._FilterSettings={},o._ModeView=a.ModeView.DescTop,o._FilterChanged=null,o._filter=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderFilter()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.FilterSettings;(0,s.isDefined)(o)&&this._filter.update(o)},e.prototype.destroy=function(){this._FilterChanged=null,t.prototype.destroy.call(this)},e.prototype._renderFilter=function(){var t=this._nodes.panel,e=u.HOT_OFFERS_ACTIVE_FILTERS.filter(function(t){return t!==l.FilterType.HIDE&&t!==l.FilterType.REMEMBER});this._filter=new n.ModuleFilters(r(r({},this._FilterSettings),{ActiveFilters:e,DepartureNoFlightEnabled:!1,ModeView:this._ModeView,ParentNode:t,WaiterEnabled:!0,SettingsChanged:this._FilterChanged}))},e}(c.SubscribeBasePanel);e.OfferSubscribeFilterPanel=h,t.OfferSubscribeFilterPanel=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OfferSubscribeMessengerPanel=void 0;var r=o(1),n=o(5),s=o(464),a=o(885),l=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVOfferSubscribeMessengerPanel",o._Messenger=n.MessengerType.None,o._MessengerClicked=null,o._messengerbuttons=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderMessengerButtons()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Messenger;(0,r.isDefined)(o)&&this._messengerbuttons.update({Selected:[o]})},e.prototype.destroy=function(){this._MessengerClicked=null,t.prototype.destroy.call(this)},e.prototype._renderMessengerButtons=function(){var t=this._nodes.panel;this._messengerbuttons=new a.MessengerButtons({ParentNode:t,Selected:[this._Messenger],Clicked:this._MessengerClicked})},e}(s.SubscribeBasePanel);e.OfferSubscribeMessengerPanel=l,t.OfferSubscribeMessengerPanel=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MessengerButtons=void 0;var r=o(2),n=o(3),s=o(1),a=o(5),l=o(6),u=o(8),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Clicked=new n.UserEvent,o.templateName="messenger-buttons",o._IsVisibleTelegram=!0,o._IsVisibleViber=!1,o._Selected=[],o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateSelected(),this._updateButtonsVisibility()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Selected;(0,s.isDefined)(o)&&this._updateSelected()},e.prototype._init=function(){this._onTelegramClick=this._onMessengerClicked.bind(this,{Messenger:a.MessengerType.Telegram}),this._onViberClick=this._onMessengerClicked.bind(this,{Messenger:a.MessengerType.Viber})},e.prototype._onMessengerClicked=function(t){var e=t.Messenger;this.Clicked.fire({Messenger:e})},e.prototype._updateSelected=function(){if(!(0,l.isEmptyArray)(this._Selected)){var t=this._nodes,e=t.telegram,o=t.viber,i=this._Selected.some(function(t){return t===a.MessengerType.Telegram}),r=this._Selected.some(function(t){return t===a.MessengerType.Viber});(0,s.updateClass)(e,u.TV_ACTIVE,i),(0,s.updateClass)(o,u.TV_ACTIVE,r)}},e.prototype._updateButtonsVisibility=function(){var t=this._nodes,e=t.telegram,o=t.viber;(0,s.setVisible)(o,this._IsVisibleViber),(0,s.setVisible)(e,this._IsVisibleTelegram)},e}(r.Control);e.MessengerButtons=c,t.MessengerButtons=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotOfferMobileSubscribeController=void 0;var r,n=o(55),s=o(9),a=o(4),l=o(21),u=o(14);!function(t){t.OffersSubscibePage="OffersSubscibePage"}(r||(r={}));var c=function(t){function e(e){var o=t.call(this,e)||this;return o._FilterSettings={},o._FilterChanged=null,o._Hide=null,o._MessengerClicked=null,o._subscribePage=null,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.show=function(){u.router.goTo(""+l.RouterPath.HotOffersSubscribe)},e.prototype.update=function(e){t.prototype.update.call(this,e),this._subscribePage&&this._subscribePage.update(e)},e.prototype.destroy=function(){this._FilterChanged=null,this._MessengerClicked=null,this._FilterSettings=null,this._subscribePage=null,n.layoutPageFactory.PageCreated.remove(this),t.prototype.destroy.call(this)},e.prototype._init=function(){n.layoutPageFactory.PageCreated.addOnce(new a.Delegate(this,this._onPageCreated))},e.prototype._onPageCreated=function(t){var e=n.layoutPageFactory.getPage();switch(t.PageClassName){case r.OffersSubscibePage:this._subscribePage=e,this._subscribePage.update({FilterSettings:this._FilterSettings,FilterChanged:this._FilterChanged,Hide:this._Hide,MessengerClicked:this._MessengerClicked})}},e}(s.Core);e.HotOfferMobileSubscribeController=c,t.HotOfferMobileSubscribeController=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.hotOfferSubscribeUtils=void 0;var i=o(7),r=o(5),n=o(6),s=o(13),a=o(888),l=function(){function t(){}return t.prototype.getApiOfferSubscribeData=function(t){var e=t.Settings,o=t.Messenger,l=t.ClientId,u=e.Countries,c=e.Currency,h=e.Departure,d=e.Discount,p=e.FlyDates,_=e.HotelClass,f=e.Nights,y=e.Price,g=e.Visa,C=(0,n.isNotEmptyArray)(p)&&p[0],v=C?s.FormatDate.dateToStrReverse(p[0],"-"):null,m=(0,n.isNotEmptyArray)(p)&&p[1],T=m?s.FormatDate.dateToStrReverse(p[1],"-"):null;return{channel_id:o,client_id:l,subscribe_type_id:a.SubscribeType.HOTOFFERS,currency_id:c||r.Currency.Rub,departure_id:h||i.DEFAULT_DEPARTURE_ID,stars:_||i.MIN_STARS,country_id:(0,n.isNotEmptyArray)(u)?u:null,discount:d>0?d:null,fly_date_from:v,fly_date_to:T,nights_from:(0,n.isNotEmptyArray)(f)&&f[0]?f[0]:null,nights_to:(0,n.isNotEmptyArray)(f)&&f[1]?f[1]:null,price_max:y&&y.Max>0?y.Max:null,visa:g?!g:null}},t.prototype.getApiOfferBotData=function(t){return{channel_id:t.Messenger,client_id:t.ClientId}},t}();e.hotOfferSubscribeUtils=new l,t.hotOfferSubscribeUtils=e.hotOfferSubscribeUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.SubscribeType=void 0;var o;!function(t){t[t.HOTOFFERS=0]="HOTOFFERS",t[t.PRICE=1]="PRICE"}(o=e.SubscribeType||(e.SubscribeType={})),t.SubscribeType=o}).call(e,o(0))},function(t,e,o){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});var r=o(21),n=o(14),s=o(890);n.router.addRoutes((i={},i[r.RouterPath.HotOffersSubscribe]=s.OffersSubscibePage,i))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OffersSubscibePage=void 0;var r=o(36),n=o(5),s=o(463),a=function(t){function e(e){var o=t.call(this,e)||this;return o._ExtraBackBtnEnabled=!0,o._FilterSettings={},o._LayoutClass="TVHotOfferSubscribePage",o._Transitions=[n.TransitionAnimationType.HideBack,n.TransitionAnimationType.ShowForward,n.TransitionAnimationType.ShowBack],o._FilterChanged=null,o._MessengerClicked=null,o._subscribeControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._subscribeControl&&this._subscribeControl.update(e)},e.prototype._getContent=function(){return this._subscribeControl||(this._subscribeControl=new s.OfferSubscribeControl({FilterSettings:this._FilterSettings,ModeView:n.ModeView.Mobile,FilterChanged:this._FilterChanged,MessengerClicked:this._MessengerClicked})),this._subscribeControl},e.prototype._onExtraBackBtnClicked=function(){if(this._subscribeControl.getStep()>0)return void this._subscribeControl.update({ShowPreviousStep:!0});t.prototype._onExtraBackBtnClicked.call(this)},e.displayName="OffersSubscibePage",e}(r.Page);e.OffersSubscibePage=a,t.OffersSubscibePage=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.contractUtils=void 0;var i=o(1),r=function(){function t(){}return t.prototype.getText=function(t){var e;return(null===(e=null===t||void 0===t?void 0:t.data)||void 0===e?void 0:e.dogovortext)||""},t.prototype.getSettings=function(t,e,o){void 0===e&&(e=[]);var r=(null===t||void 0===t?void 0:t.NAME)||"",n=e.filter(function(t){return Boolean(t.NAME)||Boolean(t.SURNAME)}).map(function(t){return{Name:(0,i.capitalize)(t.NAME||"",!0),Surname:(0,i.capitalize)(t.SURNAME||"",!0)}});return{ContractText:this.getText(o),Tourists:n,UserName:r}},t}();e.contractUtils=new r,t.contractUtils=e.contractUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.exportCrmUtils=void 0;var o=function(){function t(){}return t.prototype.getCrmUrl=function(t){var e=this._parseResponse(t);return(null===e||void 0===e?void 0:e.data)&&e.data.crmurl||""},t.prototype.getCrmError=function(t){var e=this._parseResponse(t);return(null===e||void 0===e?void 0:e.data)&&e.data.errormessage||"Ошибка экспорта в CRM"},t.prototype.isSuccessExport=function(t){var e=this._parseResponse(t);return Boolean(null===e||void 0===e?void 0:e.data)&&1===e.data.success},t.prototype._parseResponse=function(t){try{var e=t.Response;return JSON.parse(e)}catch(t){return{}}},t}();e.exportCrmUtils=new o,t.exportCrmUtils=e.exportCrmUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourDesktopController=void 0;var r=o(9),n=o(1),s=o(5),a=o(894),l=function(t){function e(e){var o=t.call(this,e)||this;return o._AddToCart=null,o._AfterShow=null,o._BeforeShow=null,o._ContractClicked=null,o._Hide=null,o._MoreFlightsClicked=null,o._RunSearch=null,o._SendRequest=null,o._IsEnabledSetHash=!0,o._IsVisibleAddToCart=!1,o._IsVisibleBuyInCredit=!1,o._IsVisibleBuyOnline=!1,o._IsVisibleRequest=!1,o._ShowOperator=s.Operator.Hide,o._TourId=0,o._window=null,o.__initSettings(e),o}return i(e,t),e.prototype.show=function(t){this._initWindow(),this._window.show(t)},e.prototype.hide=function(){this._window.hide()},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._window){var o=e.InstructionMessage;if((0,n.isDefined)(o))return void this._window.showInstruction(o);this._window.update(e)}},e.prototype.destroy=function(){this._AddToCart=null,this._AfterShow=null,this._BeforeShow=null,this._ContractClicked=null,this._Hide=null,this._MoreFlightsClicked=null,this._RunSearch=null,this._SendRequest=null,t.prototype.destroy.call(this)},e.prototype._initWindow=function(){this._window||(this._window=new a.TourCardWindow({HashName:s.Hash.Tourid,HistoryEnable:this._IsEnabledSetHash,IsVisibleAddToCart:this._IsVisibleAddToCart,IsVisibleBuyInCredit:this._IsVisibleBuyInCredit,IsVisibleBuyOnline:this._IsVisibleBuyOnline,IsVisibleRequest:this._IsVisibleRequest,MoreFlightsClicked:this._MoreFlightsClicked,ShowOperator:this._ShowOperator,TourId:this._TourId,AddToCart:this._AddToCart,AfterShow:this._AfterShow,BeforeShow:this._BeforeShow,ContractClicked:this._ContractClicked,Hide:this._Hide,RunSearch:this._RunSearch,SendRequest:this._SendRequest}))},e}(r.Core);e.TourDesktopController=l,t.TourDesktopController=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardWindow=void 0;var r=o(31),n=o(78),s=o(34),a=o(120),l=o(17),u=o(43),c=o(44),h=o(4),d=o(3),p=o(1),_=o(5),f=o(6),y=o(110),g=o(22),C=o(156),v=o(112),m=o(895),T=o(232),w=o(32),S=o(118),P=o(18),b=o(208),I=o(297),O=o(108),M=o(24),D=o(40),E=o(8),k=o(466),R=o(896),A=o(898),V=o(916),L=o(918),N=o(929),B=o(486),H=o(308),x=o(237),F=o(493),U=o(194),j=o(72),G=o(480),W=o(310),z=o(948),q=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="tour-card-window",o.AddToCart=new d.UserEvent,o.ContractClicked=new d.UserEvent,o.MoreFlightsClicked=new d.UserEvent,o.RunSearch=new d.UserEvent,o.SendRequest=new d.UserEvent,o._ClientData=null,o._ErrorEnabled=!1,o._HotelData=null,o._IsActualizing=!1,o._IsEnabledAddToCart=!0,o._IsEnabledMultiOffice=!0,o._IsFixScroll=!0,o._IsLoadingFlights=!1,o._IsVisibleAddToCart=!1,o._IsVisibleBooking=!1,o._IsVisibleBuyInCredit=!1,o._IsVisibleBuyOnline=!1,o._IsVisibleCreateContract=!0,o._IsVisibleCrm=!0,o._IsVisibleOperatorBooking=!0,o._IsVisibleOperatorLink=!0,o._IsVisibleRequest=!1,o._OrderMode=U.OrderModeEnum.CUSTOMER,o._ProgramData=null,o._Ref=null,o._ShortTourId=0,o._ShowOperator=_.Operator.Hide,o._TourData=null,o._TourEnable=!0,o._TourId=0,o._WindowClass="TVTourCardWindow",o._selectedFlight=null,o._comeBackBottom=null,o._comeBackTop=null,o._contentSwitcher=null,o._contractControl=null,o._contractNode=null,o._tourDetail=null,o._instructionNode=null,o._tourBooking=null,o._tourCardHeader=null,o._tourCardInfo=null,o._tourOrder=null,o._tourOrderFactory=null,o._windowSwitcher=null,o.__initSettings(e),o._onActionContinueClicked=o._onActionContinueClicked.bind(o),o._onContractHide=o._onContractHide.bind(o),g.authManager.Logout.addOnce(new h.Delegate(o,o._onAuthManagerAction)),g.authManager.LoginSuccess.addOnce(new h.Delegate(o,o._onAuthManagerAction)),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes,o=e.header,i=e.hotelNode;this._tourCardHeader=new V.TourCardHeaderControl({IsEnabledAddHotOffer:this._isEnabledAddHotOffer(),IsEnabledBooking:this._IsVisibleBooking,IsEnabledSendError:this._isEnabledSendError(),IsVisibleOperatorLink:this._IsVisibleOperatorLink,IsVisibleOperatorLogo:this._isVisibleOperatorLogo(),ParentNode:o,MenuClicked:new h.Delegate(this,this._onHeaderMenuClicked),OperatorClicked:new h.Delegate(this,this._onOperatorLinkClicked)}),this._tourDetail=new A.TourCardDetailController({ParentNode:i,ScrollToTop:new h.Delegate(this,this._scrollToDetailBlock)}),this._renderTourCardInfo(),this._tourOrderFactory=new N.TourCardOrderFactory,this._renderOrder(),this._renderBooking(),this._renderWindowSwitcher(),this._renderContentSwitcher(),this._updateContinueButtonText(),this._updateTourCardActionButtons(),this._switchWindowMode(z.TourCardWindowViewModeEnum.TOURCARD),this._switchContentMode(W.TourCardContentViewModeEnum.NONE)},e.prototype.update=function(o){var i=this._OrderMode;t.prototype.update.call(this,o);var r=o.ClientData,n=o.ContentViewMode,s=o.ContractData,a=o.ErrorEnabled,l=o.HotelData,u=o.IsActualizing,c=o.IsEnabledAddToCart,h=o.IsLoadingExtraFlights,d=o.IsLoadingFlights,_=o.IsLoadingTour,f=o.IsVisibleBooking,y=o.IsVisibleBuyOnline,g=o.OrderMode,C=o.SearchLink,v=o.TourData,m=o.TourEnable;if((0,p.isDefined)(s)&&(this._switchWindowMode(z.TourCardWindowViewModeEnum.CONTRACT),(0,p.scrollToTop)(e.SCROLL_DURATION,this._contractNode.offsetTop),this._contractControl.update(s)),(0,p.isDefined)(_)){this._tourCardHeader.update({IsLoadingTour:_}),this._tourCardInfo.update({IsLoadingTour:_});var T=_?W.TourCardContentViewModeEnum.NONE:W.TourCardContentViewModeEnum.HOTEL;this._switchContentMode(T)}if((0,p.isDefined)(d)||(0,p.isDefined)(u)||(0,p.isDefined)(h)){var w={};(0,p.isDefined)(d)&&(w.IsLoadingFlights=d),(0,p.isDefined)(u)&&(w.IsActualizing=u),(0,p.isDefined)(h)&&(w.IsLoadingExtraFlights=h),this._tourCardInfo.update(w)}if((0,p.isDefined)(g)&&i!==this._OrderMode&&(this._renderOrder(),this._tourCardHeader.update({IsEnabledAddHotOffer:this._isEnabledAddHotOffer(),IsEnabledSendError:this._isEnabledSendError(),IsVisibleOperatorLink:this._IsVisibleOperatorLink,IsVisibleOperatorLogo:this._isVisibleOperatorLogo()})),(0,p.isDefined)(m)&&(this._tourCardHeader.update({IsEnabledTour:this._TourEnable}),this._tourCardInfo.update({IsEnabledTour:this._TourEnable,IsVisibleRequestButton:this._OrderMode!==U.OrderModeEnum.MANAGER}),this._updateVisibilityDetailBlocks(),this._updateTourOrder()),(0,p.isDefined)(a)&&(this._tourCardInfo.update({IsVisibleTitle:!a}),this._updateVisibilityDetailBlocks(),this._updateTourOrder()),(0,p.isDefined)(l)&&this._updateHotelData(),(0,p.isDefined)(v)&&(this._updateTourTypeClass(),this._updateTourData(),this._updateSelectedFlights(),this._updateHash(v.shortid)),(0,p.isDefined)(r)){var S=D.tourUtils.getRedirectLink(this._ClientData),P=D.tourUtils.getRedirectText(this._ClientData);this._tourCardInfo.update({RedirectLink:S,ContinueText:P}),this._tourBooking.update({BookingItems:D.tourUtils.getBookingCenters(this._ClientData)}),this._updateContinueButtonText()}if((0,p.isDefined)(y)&&this._updateContinueButtonText(),(0,p.isDefined)(f)&&this._tourCardHeader.update({IsEnabledBooking:this._IsVisibleBooking}),(0,p.isDefined)(c)&&this._updateTourCardActionButtons(),(0,p.isDefined)(C)&&this._tourCardHeader.update({SearchLink:C}),(0,p.isDefined)(n)&&n===W.TourCardContentViewModeEnum.ORDER){this._showOrderContentView(!1)}this._updateTourOrderBySettings(o)},e.prototype.show=function(e){t.prototype.show.call(this),this._TourId=e},e.prototype.showInstruction=function(t){this._instructionNode.innerHTML=t,this._switchWindowMode(z.TourCardWindowViewModeEnum.INSTRUCTION);var e=(0,p.cumulativeOffset)(this._mainContainer).top-200;e<0&&(this._mainContainer.style.top="200px",e=0),document.body.scrollTop=e,document.documentElement.scrollTop=e},e.prototype.destroy=function(){g.authManager.Logout.remove(this),g.authManager.LoginSuccess.remove(this),this._removeEvents(),t.prototype.destroy.call(this)},e.prototype._hide=function(){if(this._windowSwitcher.getId()===z.TourCardWindowViewModeEnum.CONTRACT)return void this._onContractHide();this._tourCardInfo.update({Reset:!0}),(0,p.isVisible)(this._nodes.hotelNode)&&this._tourDetail.update({IsEnabledPhotoLoading:!1,IsEnabledVideoLoading:!1}),this._OrderMode===U.OrderModeEnum.MANAGER&&(a.orderCatalog.setTouristsData([]),a.orderCatalog.setUserData({})),this._clearSelectedFlight(),this._switchWindowMode(z.TourCardWindowViewModeEnum.TOURCARD),this._switchContentMode(W.TourCardContentViewModeEnum.HOTEL),t.prototype._hide.call(this)},e.prototype._onAuthManagerAction=function(){this._tourCardHeader.update({IsEnabledAddHotOffer:this._isEnabledAddHotOffer(),IsEnabledSendError:this._isEnabledSendError()}),this._renderOrder()},e.prototype._onShowRoom=function(t){(0,C.showRoom)({ActionSource:r.ActionStatisticsSource.TOURCARD,ModeView:_.ModeView.DescTop,RoomData:this._TourData.roomdata,RoomId:t.Id})},e.prototype._onContractHide=function(){this._switchWindowMode(z.TourCardWindowViewModeEnum.TOURCARD),this._scrollToDetailBlock()},e.prototype._removeEvents=function(){(0,p.removeEvent)(this._comeBackTop,"click",this._onContractHide),(0,p.removeEvent)(this._comeBackBottom,"click",this._onContractHide)},e.prototype._renderTourCardInfo=function(){var t=this._nodes.tourCardInfoNode;this._tourCardInfo=new L.TourCardInfoControl({ParentNode:t,ActionAddCartClicked:new h.Delegate(this,this._onAddToCartBtnClick),ActionContinueClicked:new h.Delegate(this,this._onActionContinueClicked),ActionRedirectLinkClicked:new h.Delegate(this,this._onActionRedirectLinkClicked),FlightSelected:new h.Delegate(this,this._onFlightSelected),MoreFlightsClicked:new h.Delegate(this,this._onMoreFlightsClicked),ShowRoom:new h.Delegate(this,this._onShowRoom)})},e.prototype._renderOrder=function(){this._tourOrder&&this._tourOrder.destroy();var t=this._nodes.orderNode;switch(this._OrderMode){case U.OrderModeEnum.MANAGER:this._tourOrder=this._tourOrderFactory.getManagerOrder({IsVisibleBooking:this._IsVisibleBooking,IsVisibleCreateContract:this._IsVisibleCreateContract,IsVisibleCrm:this._IsVisibleCrm,IsVisibleOperatorBooking:this._IsVisibleOperatorBooking,IsVisibleOperatorLink:this._IsVisibleOperatorLink,ParentNode:t,TourId:this._TourId,ActionClicked:new h.Delegate(this,this._onManagerOrderActionClicked),BackClicked:new h.Delegate(this,this._onBackToHotelClick),BookingClicked:new h.Delegate(this,this._onBookingClicked),SendRequest:new h.Delegate(this,this._onSendRequest)});break;case U.OrderModeEnum.AGENCY:this._tourOrder=this._tourOrderFactory.getAgencyOrder({ParentNode:t,ShortTourId:this._ShortTourId,BackClicked:new h.Delegate(this,this._onBackToHotelClick),SendRequest:new h.Delegate(this,this._onSendRequest)});break;default:this._tourOrder=this._tourOrderFactory.getCustomerOrder({IsEnabledMultiOffice:this._IsEnabledMultiOffice,IsVisibleBuyInCredit:this._IsVisibleBuyInCredit,IsVisibleBuyOnline:this._IsVisibleBuyOnline,IsVisibleRequest:this._IsVisibleRequest,ParentNode:t,TourEnable:this._TourEnable,TourId:this._TourId,BackClicked:new h.Delegate(this,this._onBackToHotelClick),ContractClicked:new h.Delegate(this,this._onContractClicked),SendRequest:new h.Delegate(this,this._onSendRequest)})}},e.prototype._renderBooking=function(){var t=this._nodes.bookingNode;this._tourBooking=new R.TourCardBookingControl({BookingItems:D.tourUtils.getBookingCenters(this._ClientData),ParentNode:t,BackClicked:new h.Delegate(this,this._onBackToHotelClick),BookingClicked:new h.Delegate(this,this._onBookingClicked)})},e.prototype._renderWindowSwitcher=function(){this._windowSwitcher=new c.LayerSwitch({ParentNode:this._DomNode.parentNode}),this._contractNode=(0,p.newDiv)("TVTourCardWindowContract",this._DomNode.parentElement),this._instructionNode=(0,p.newDiv)("TVTourCardWindowInstruction",this._DomNode.parentElement),this._windowSwitcher.add(this._DomNode,z.TourCardWindowViewModeEnum.TOURCARD),this._windowSwitcher.add(this._contractNode,z.TourCardWindowViewModeEnum.CONTRACT),this._windowSwitcher.add(this._instructionNode,z.TourCardWindowViewModeEnum.INSTRUCTION)},e.prototype._renderContentSwitcher=function(){var t=this._nodes,e=t.bookingNode,o=t.hotelNode,i=t.orderNode,r=t.tourDetailBlock;this._contentSwitcher=new c.LayerSwitch({ParentNode:r,ViewLayerId:W.TourCardContentViewModeEnum.HOTEL}),this._contentSwitcher.add(o,W.TourCardContentViewModeEnum.HOTEL),this._contentSwitcher.add(i,W.TourCardContentViewModeEnum.ORDER),this._contentSwitcher.add(e,W.TourCardContentViewModeEnum.BOOKING)},e.prototype._onBookingClicked=function(t){var e,o=t.Booking;switch(o){case m.BookCenter.CENTER:e=r.ActionStatisticsType.BOOKING_CENTER;break;case m.BookCenter.HOTTOURS:e=r.ActionStatisticsType.BOOKING_HOTTOURS}(0,p.isDefined)(e)&&(0,n.reachGoal)(r.ActionStatisticsSource.TOURCARD,e)},e.prototype._onHeaderMenuClicked=function(t){switch(t.Action){case G.TourCardAction.SEARCHLINK:var e=t.Event,o=t.Link;this.RunSearch.fire({Event:e,Url:o});break;case G.TourCardAction.BOOKING:this._switchContentMode(W.TourCardContentViewModeEnum.BOOKING)}},e.prototype._onManagerOrderActionClicked=function(t){switch(t.Action){case x.ManagerOrderAction.EXPORT_CRM:(0,n.reachGoal)(r.ActionStatisticsSource.TOURCARD,r.ActionStatisticsType.CRM_EXPORT);break;case x.ManagerOrderAction.OPEN_TO:this._onOperatorLinkClicked()}},e.prototype._onOperatorLinkClicked=function(){(0,n.reachGoal)(r.ActionStatisticsSource.TOURCARD,r.ActionStatisticsType.OPERATOR_URL)},e.prototype._onSendRequest=function(t){var e=t.Type,o=D.tourUtils.isFromTourvisorTour(this._ClientData),i=T.fromTourvisorService.hasFlag();switch(e){case j.RequestType.SimpleRequest:if(!this._TourEnable){t.Source=_.OrderSource.FREE;var s=l.resultStore.getActualSearchSettings();M.searchUtils.updateSearchLink(t,s)}o?t.IsFromTourvisor=o:i&&(t.IsFromTourvisorCookie=i);break;case j.RequestType.OnlineRequest:t.Fly=this._selectedFlight,t.AddPayments=this._TourData.addpayments,t.Manager=g.authManager.getId(!0),o?t.IsFromTourvisor=o:i&&(t.IsFromTourvisorCookie=i),this._OrderMode===U.OrderModeEnum.MANAGER&&(0,n.reachGoal)(r.ActionStatisticsSource.TOURCARD,r.ActionStatisticsType.CREATE_CONTRACT);break;case j.RequestType.ExportRequest:t.Manager=g.authManager.getId(!0),t.Fly=this._selectedFlight}this.SendRequest.fire(t)},e.prototype._onContractClicked=function(){this._contractControl||(this._comeBackTop=(0,p.newDiv)("TVBackTo",this._contractNode),this._contractControl=new k.ContractControl({ParentNode:this._contractNode}),this._comeBackBottom=(0,p.newDiv)("TVBackTo",this._contractNode),(0,p.addEvent)(this._comeBackTop,"click",this._onContractHide),(0,p.addEvent)(this._comeBackBottom,"click",this._onContractHide)),this.ContractClicked.fire()},e.prototype._onAddToCartBtnClick=function(){var t={},e=D.tourUtils.getPrice(this._TourData,this._selectedFlight);e>0&&(t.Price=e),this.AddToCart.fire(t)},e.prototype._onActionContinueClicked=function(){this._showOrderContentView()},e.prototype._onActionRedirectLinkClicked=function(){y.analiticManager.reachGoal(_.Metrica.TOURPARTNER)},e.prototype._onBackToHotelClick=function(){this._switchContentMode(W.TourCardContentViewModeEnum.HOTEL)},e.prototype._onFlightSelected=function(t){var e=t.Flight;this._selectedFlight=e,this._tourCardHeader.update({SelectedFlight:this._selectedFlight}),this._updateIncludePrices()},e.prototype._onMoreFlightsClicked=function(){this.MoreFlightsClicked.fire()},e.prototype._clearSelectedFlight=function(){this._selectedFlight=null,this._tourCardHeader.update({SelectedFlight:null}),this._tourOrder.update({SelectedFlight:null})},e.prototype._showOrderContentView=function(t){void 0===t&&(t=!0),this._switchContentMode(W.TourCardContentViewModeEnum.ORDER),this._updateTourOrder(),t&&this._scrollToDetailBlock()},e.prototype._scrollToDetailBlock=function(){(0,v.animateScroll)(null,this._nodes.tourDetailBlock)},e.prototype._switchContentMode=function(t){this._contentSwitcher.showById(t),this._updateTourCardActionButtons()},e.prototype._switchWindowMode=function(t){this._windowSwitcher.showById(t)},e.prototype._updateTourTypeClass=function(){var t=D.tourUtils.isCraftTour(this._TourData);(0,p.updateClass)(this._DomNode,E.TV_CRAFT_TOUR_CARD,t)},e.prototype._updateTourOrder=function(){if(this._contentSwitcher.getId()===W.TourCardContentViewModeEnum.ORDER){var t=this._IsVisibleBuyOnline&&this._TourEnable?H.CustomerOrderViewMode.BUYONLINE:H.CustomerOrderViewMode.REQUEST,e=D.tourUtils.isWhereBuyOnline(this._ClientData),o=e&&this._TourEnable?B.AgencyOrderViewMode.ACTIONS:B.AgencyOrderViewMode.REQUEST;this._tourOrder.update({AgencyView:o,CustomerView:t,ManagerView:F.ManagerOrderViewMode.ACTIONS,TourEnable:this._TourEnable})}},e.prototype._updateTourOrderBySettings=function(t){var e=t.ClientData,o=t.IsActualizing,i=t.IsEnabledMultiOffice,r=t.IsVisibleBooking,n=t.IsVisibleBuyInCredit,s=t.IsVisibleBuyOnline,a=t.IsVisibleCreateContract,l=t.IsVisibleCrm,u=t.IsVisibleOperatorBooking,c=t.IsVisibleOperatorLink,h=t.IsVisibleRequest,d={};(0,p.isDefined)(o)&&(d.IsActualizing=this._IsActualizing),(0,p.isDefined)(e)&&(d.ClientData=this._ClientData),(0,p.isDefined)(s)&&(d.IsVisibleWhereBuyOnline=D.tourUtils.isWhereBuyOnline(this._ClientData)),(0,p.isDefined)(s)&&(d.IsVisibleBuyOnline=this._IsVisibleBuyOnline),(0,p.isDefined)(n)&&(d.IsVisibleBuyInCredit=this._IsVisibleBuyInCredit),(0,p.isDefined)(h)&&(d.IsVisibleRequest=this._IsVisibleRequest),(0,p.isDefined)(i)&&(d.IsEnabledMultiOffice=this._IsEnabledMultiOffice),(0,p.isDefined)(r)&&(d.IsVisibleBooking=this._IsVisibleBooking),(0,p.isDefined)(a)&&(d.IsVisibleCreateContract=this._IsVisibleCreateContract),(0,p.isDefined)(c)&&(d.IsVisibleOperatorLink=this._IsVisibleOperatorLink),(0,p.isDefined)(u)&&(d.IsVisibleOperatorBooking=this._IsVisibleOperatorBooking),(0,p.isDefined)(l)&&(d.IsVisibleCrm=this._IsVisibleCrm),(0,f.isNotEmptyObject)(d)&&this._tourOrder.update(d)},e.prototype._updateIncludePrices=function(){var t=D.tourUtils.getPrice(this._TourData,this._selectedFlight),e=D.tourUtils.getPriceType(this._TourData),o=D.tourUtils.getIncludePrices(this._TourData,this._selectedFlight),i=D.tourUtils.hasInstantConfirmation(this._TourData);this._tourOrder.update({TourBuyData:{IncludePrices:o,IsVisibleConfirmation:i,Price:t,PriceType:e}})},e.prototype._updateSelectedFlights=function(){var t=this._TourData.flights;this._selectedFlight=S.flightUtils.getDefaultSet(t),this._tourCardHeader.update({SelectedFlight:this._selectedFlight}),this._updateIncludePrices()},e.prototype._updateHotelData=function(){this._tourCardInfo.update({HotelData:this._HotelData,InsertStarsInTitle:!D.tourUtils.isCraftTour(this._TourData),IsTransformTitle:D.tourUtils.isHotelTour(this._TourData)});var t=D.tourUtils.hasHotelCoords(this._HotelData),e=D.tourUtils.hasHotelDescription(this._HotelData),o=D.tourUtils.hasHotelImages(this._HotelData),i=I.programUtils.hasProgram(this._ProgramData),r=D.tourUtils.hasCraftTourData(this._TourData),n=s.clientCatalog.getClientData(),a=w.clientUtils.getReviewMode(n),l=O.reviewsUtils.reviewsEnabled(a,Number(this._HotelData.hotelcode)),u=t||e||o||l||i||r;if(u){var c=P.hotelUtils.getHotelId(this._HotelData);this._tourDetail.update({HotelId:c,ProgramData:this._ProgramData,TourData:this._TourData}),this._tourOrder.update({IsVisibleBackButton:u}),this._tourBooking.update({IsVisibleBackButton:u})}else this._switchContentMode(W.TourCardContentViewModeEnum.ORDER),this._tourOrder.update({AgencyView:B.AgencyOrderViewMode.ACTIONS,CustomerView:H.CustomerOrderViewMode.REQUEST,IsVisibleBackButton:u,ManagerView:F.ManagerOrderViewMode.ACTIONS}),this._tourBooking.update({IsVisibleBackButton:u})},e.prototype._updateTourData=function(){var t=this._TourData,e=t.operatorcode,o=t.shortid,i=t.tourid,r=D.tourUtils.getOperatorLink(this._TourData),n=D.tourUtils.getTourLinkWithUserMode(this._TourData,_.UserMode.Customer),s=D.tourUtils.getOnlinePartners(this._TourData);this._tourCardHeader.update({IsEnabledAddHotOffer:this._isEnabledAddHotOffer(),IsVisibleOperatorLink:this._IsVisibleOperatorLink,IsVisibleOperatorLogo:this._isVisibleOperatorLogo(),TourData:this._TourData}),this._tourCardInfo.update({TourData:this._TourData}),this._tourOrder.update({AgencyItems:s||[],CustomerTourLink:n,OperatorId:e,OperatorLink:r,ShortTourId:o,TourId:i})},e.prototype._updateContinueButtonText=function(){var t=D.tourUtils.isWhereBuyOnline(this._ClientData),e=D.tourUtils.getRedirectText(this._ClientData),o="";switch(!0){case Boolean(e):o=e;break;case!this._IsVisibleBuyOnline&&!t:o="Заявка на тур";break;default:o="Продолжить"}this._tourCardInfo.update({ContinueText:o})},e.prototype._updateTourCardActionButtons=function(){this._tourCardInfo.update({IsEnabledAddToCart:this._IsEnabledAddToCart,IsEnabledContinue:!0,IsVisibleAddToCart:this._IsVisibleAddToCart})},e.prototype._updateVisibilityDetailBlocks=function(){this._TourEnable&&!this._ErrorEnabled||this._contentSwitcher.showById(W.TourCardContentViewModeEnum.NONE)},e.prototype._isVisibleOperatorLogo=function(){return this._ShowOperator===_.Operator.Show},e.prototype._isEnabledSendError=function(){return this._OrderMode===U.OrderModeEnum.MANAGER||w.clientUtils.getAllowError(s.clientCatalog.getClientData())},e.prototype._isEnabledAddHotOffer=function(){var t=this._OrderMode===U.OrderModeEnum.MANAGER,e=D.tourUtils.isCraftTour(this._TourData);if(!t||e)return!1;var o=s.clientCatalog.getClientData();return b.moduleSettingUtils.isActiveModuleByType(_.ModuleTypes.TourvisorPro,o)},e.SUBREGION_NAME_PATH="subregion.name",e.SCROLL_DURATION=500,e}(u.PopUpBase);e.TourCardWindow=q,t.TourCardWindow=q}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.BookCenter=void 0;var o;!function(t){t[t.CENTER=0]="CENTER",t[t.HOTTOURS=1]="HOTTOURS"}(o=e.BookCenter||(e.BookCenter={})),t.BookCenter=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardBookingControl=void 0;var r=o(2),n=o(3),s=o(1),a=o(298),l=function(t){function e(e){var o=t.call(this,e)||this;return o.BackClicked=new n.UserEvent,o.templateName="tour-card-booking",o._IsVisibleBackButton=!0,o._BookingItems=[],o._BookingClicked=null,o._tourBookingControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderBookingControl(),this._updateBookingItems()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.BookingItems,i=e.IsVisibleBackButton;(0,s.isDefined)(i)&&this._updateBackButtonVisibility(),(0,s.isDefined)(o)&&this._updateBookingItems()},e.prototype.destroy=function(){this._BookingClicked=null,t.prototype.destroy.call(this)},e.prototype._renderBookingControl=function(){var t=this._nodes.contentNode;this._tourBookingControl=new a.TourBookingControl({ParentNode:t,BookingClicked:this._BookingClicked})},e.prototype._updateBookingItems=function(){this._tourBookingControl.update({BookingItems:this._BookingItems})},e.prototype._onBackNodeClick=function(){this.BackClicked.fire()},e.prototype._updateBackButtonVisibility=function(){var t=this._nodes.backNode;(0,s.setVisible)(t,this._IsVisibleBackButton)},e}(r.Control);e.TourCardBookingControl=l,t.TourCardBookingControl=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourBookingItemControl=void 0;var r=o(2),n=o(3),s=o(1),a=o(5),l=o(8),u=function(t){function e(e){var o=t.call(this,e)||this;return o.Clicked=new n.UserEvent,o._Class="TVBookingItem",o._Description="",o._Link="",o._LogoLink="",o._ModeView=a.ModeView.DescTop,o._Name="",o._Title="",o.__initSettings(e),o.templateName=o._ModeView===a.ModeView.DescTop?"tour-booking-item":"tour-booking-item-mobile",o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateLogo(),this._updateLink(),this._updateLinkEnabled()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsEnabled,i=e.Link,r=e.LogoLink;(0,s.isDefined)(o)&&this._updateLinkEnabled(),(0,s.isDefined)(i)&&this._updateLink(),(0,s.isDefined)(r)&&this._updateLogo()},e.prototype._onBookingLinkClick=function(){this._IsEnabled&&this.Clicked.fire()},e.prototype._updateLogo=function(){var t;this._nodes.logoNode.style.backgroundImage=(null===(t=this._LogoLink)||void 0===t?void 0:t.length)>0?"url("+this._LogoLink+")":""},e.prototype._updateLink=function(){var t=this._nodes.bookingLink;t&&(t.href=this._Link,t.title=this._Title)},e.prototype._updateLinkEnabled=function(){var t=this._nodes.bookingLink;t&&(0,s.updateClass)(t,l.TV_DISABLED,!this._IsEnabled)},e}(r.Control);e.TourBookingItemControl=u,t.TourBookingItemControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardDetailController=void 0;var n,s=o(34),a=o(467),l=o(44),u=o(9),c=o(4),h=o(7),d=o(1),p=o(6),_=o(154),f=o(68),y=o(32),g=o(18),C=o(297),v=o(108),m=o(40),T=o(8),w=o(67),S=o(103),P=o(468),b=o(901),I=o(907),O=o(908),M=o(909),D=o(910),E=o(911),k=o(234);!function(t){t[t.HotelExcursion=1]="HotelExcursion",t[t.ExcursionOnly=2]="ExcursionOnly"}(n||(n={}));var R=function(t){function e(e){var o=t.call(this,e)||this;return o._HotelId=0,o._ParentNode=null,o._TourData=null,o._ProgramData=null,o._ScrollToTop=null,o._bodyState=_.HotelState.NONE,o._hotelData=null,o._accommodations=null,o._craftTourDescriptionView=null,o._excursionTour=null,o._hotelButtons=null,o._hotelDescription=null,o._hotelMap=null,o._hotelPhoto=null,o._hotelReviewsView=null,o._hotelVideo=null,o._laySwitch=null,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.HotelId,i=e.IsEnabledPhotoLoading,r=e.IsEnabledVideoLoading;(0,d.isDefined)(o)&&this._loadHotelData(),(0,d.isDefined)(i)&&!i&&this._disablePhotoLoading(),(0,d.isDefined)(r)&&!r&&this._disableVideoLoading()},e.prototype.destroy=function(){this._ScrollToTop=null,t.prototype.destroy.call(this)},e.prototype._changeState=function(t){this._hotelButtons.update(t),this._onBodyChange(t)},e.prototype._disablePhotoLoading=function(){this._bodyState===_.HotelState.PHOTO&&this._hotelPhoto.update({IsEnabledMoreLoad:!1})},e.prototype._disableVideoLoading=function(){this._hotelVideo&&this._hotelVideo.update({Reset:!0})},e.prototype._init=function(){this._hotelButtons=new O.HotelButtonsControl({ParentNode:this._ParentNode,State:this._bodyState,Changed:new c.Delegate(this,this._onBodyChange)}),this._laySwitch=new l.LayerSwitch({Class:"TVHotelCardBody",ParentNode:this._ParentNode})},e.prototype._loadHotelData=function(){var t,e=this;switch(this._bodyState=_.HotelState.NONE,this._hotelData=null,(0,d.addClass)(this._ParentNode,T.TV_PREVIEW),this._TourData.tourtype){case w.TourType.CRAFT:this._updateControls(),(0,d.removeClass)(this._ParentNode,T.TV_PREVIEW);break;case w.TourType.EXCURSION:if((null===(t=this._ProgramData)||void 0===t?void 0:t.type)===n.ExcursionOnly){this._updateControls(),(0,d.removeClass)(this._ParentNode,T.TV_PREVIEW);break}case w.TourType.FLIGHT:default:f.hotelDataService.getHotelDataById(this._HotelId).then(function(t){e._hotelData=r({},t),e._updateControls(),(0,d.removeClass)(e._ParentNode,T.TV_PREVIEW)})}},e.prototype._onBodyChange=function(t){t.State!==_.HotelState.NONE&&(this._disablePhotoLoading(),this._bodyState=t.State,this._updateBodyState())},e.prototype._setDefaultBodyState=function(t){this._bodyState===_.HotelState.NONE&&(this._bodyState=t,this._updateBodyState())},e.prototype._updateBodyState=function(){switch(this._laySwitch.showById(this._bodyState),this._bodyState){case _.HotelState.CRAFT:this._craftTourDescriptionView.update({UpdateVisibleUpButton:!0});break;case _.HotelState.DESCRIPTION:this._hotelDescription.update({UpdateVisibleUpButton:!0});break;case _.HotelState.MAP:this._hotelMap.update({MapEnable:!0});break;case _.HotelState.PHOTO:this._hotelPhoto.update({IsEnabledMoreLoad:!0});break;case _.HotelState.VIDEO:}},e.prototype._updateControls=function(){var t=this._getHotelSectionsAvailable();this._updateHotelButtons(t),this._updateExcursionTour(),this._updateCraftTourDescription(),this._updateHotelDescription(),this._updateHotelPhoto(),this._updateAccommodations(),this._updateHotelMap(),this._updateHotelReviewsView(),this._updateHotelVideo(),this._updateActiveBlock(t)},e.prototype._getHotelSectionsAvailable=function(){var t,e=g.hotelUtils.getHotelMapData(this._hotelData),o=m.tourUtils.isCraftTour(this._TourData),i=o?null===(t=this._TourData)||void 0===t?void 0:t.photos:g.hotelUtils.getHotelPhotos(this._hotelData),r=s.clientCatalog.getClientData(),n=y.clientUtils.getReviewMode(r),a=g.hotelUtils.getHotelCommonData(this._hotelData),l=g.hotelUtils.getHotelDesciptionData(this._hotelData),u=a.ShortDescription,c=(0,p.isNotEmptyArray)(i),h=(0,d.isDefined)(u)&&u.length>0||!o&&c||g.hotelUtils.checkDescriptionData(l),_=e.Coords.reduce(function(t,e){return t||0!==e},!1),f=v.reviewsUtils.reviewsEnabled(n,this._HotelId),C=!!this._ProgramData;return{AccommodationEnable:m.tourUtils.hasTourAccommodation(this._TourData),CraftDescriptionEnable:m.tourUtils.hasCraftTourDescription(this._TourData),DescriptionEnable:h,ExcursionEnable:C,MapEnable:_,PhotoEnable:c,ReviewsEnable:f,VideoEnable:Boolean(g.hotelUtils.getVideoLink(this._hotelData))}},e.prototype._updateHotelButtons=function(t){this._hotelButtons&&this._hotelButtons.update(r({},t))},e.prototype._updateActiveBlock=function(t){var e=t.AccommodationEnable,o=t.DescriptionEnable,i=t.ExcursionEnable,r=t.MapEnable,s=t.PhotoEnable,a=t.ReviewsEnable,l=t.CraftDescriptionEnable,u=t.VideoEnable;switch(!0){case i&&this._ProgramData.type===n.ExcursionOnly:this._setDefaultBodyState(_.HotelState.EXCURSION);break;case l:this._setDefaultBodyState(_.HotelState.CRAFT);break;case o:this._setDefaultBodyState(_.HotelState.DESCRIPTION);break;case s:this._setDefaultBodyState(_.HotelState.PHOTO);break;case u:this._setDefaultBodyState(_.HotelState.VIDEO);break;case e:this._setDefaultBodyState(_.HotelState.ACCOMMODATION);break;case r:this._setDefaultBodyState(_.HotelState.MAP);break;case a:this._setDefaultBodyState(_.HotelState.REVIEWS)}},e.prototype._updateExcursionTour=function(){var t={Description:C.programUtils.getFull(this._ProgramData),PhotoItems:C.programUtils.getImages(this._ProgramData).map(function(t){return t.url}),Text:C.programUtils.getShort(this._ProgramData)};if(this._excursionTour)return void this._excursionTour.update(t);this._excursionTour=new I.ExcursionTourControl(t),this._laySwitch.add(this._excursionTour,_.HotelState.EXCURSION)},e.prototype._updateCraftTourDescription=function(){var t={Attraction:S.craftTourUtils.getAttractionItems(this._TourData),FullDescription:this._TourData.fulldescription,Images:this._TourData.photos,ImportantInformation:S.craftTourUtils.getImportantInformation(this._TourData),IncludesConditions:this._TourData.includesConditions,NotIncludesConditions:this._TourData.notIncludesConditions,ShortDescription:this._TourData.shortdescription,TourProgram:S.craftTourUtils.getTourProgramItems(this._TourData)};if(this._craftTourDescriptionView)return void this._craftTourDescriptionView.update(t);this._craftTourDescriptionView=new b.CraftTourDescriptionView(r(r({},t),{UpButtonClicked:this._ScrollToTop})),this._laySwitch.add(this._craftTourDescriptionView,_.HotelState.CRAFT)},e.prototype._updateHotelDescription=function(){var t=g.hotelUtils.getHotelCommonData(this._hotelData),e=g.hotelUtils.getReviewsCount(this._hotelData),o=g.hotelUtils.getHotelDesciptionData(this._hotelData),i=g.hotelUtils.getHotelPhotosUrl(this._hotelData),n={CommonData:t,DescriptionData:o,Photos:i,ReviewsCount:e};if(this._hotelDescription)return void this._hotelDescription.update(n);this._hotelDescription=new M.HotelDescriptionView(r(r({},n),{MorePhotoClicked:new c.Delegate(this,this._changeState,{State:_.HotelState.PHOTO}),ShowReviewClicked:new c.Delegate(this,this._changeState,{State:_.HotelState.REVIEWS}),UpButtonClicked:this._ScrollToTop})),this._laySwitch.add(this._hotelDescription,_.HotelState.DESCRIPTION)},e.prototype._updateHotelPhoto=function(){var t,e=m.tourUtils.isCraftTour(this._TourData),o=e?(null===(t=this._TourData)||void 0===t?void 0:t.photos.map(function(t){return{url:t,width:2*h.PHOTO_HALF_WIDTH}}))||[]:g.hotelUtils.getHotelPhotos(this._hotelData);if(this._hotelPhoto)return void this._hotelPhoto.update({Pictures:o});this._hotelPhoto=new E.HotelPhotoControl({Pictures:o,UpButtonClicked:this._ScrollToTop}),this._laySwitch.add(this._hotelPhoto,_.HotelState.PHOTO)},e.prototype._updateAccommodations=function(){var t={Items:S.craftTourUtils.getAccommodationItems(this._TourData)};if(this._accommodations)return void this._accommodations.update(t);this._accommodations=new P.AccommodationList(t),this._laySwitch.add(this._accommodations,_.HotelState.ACCOMMODATION)},e.prototype._updateHotelMap=function(){var t=g.hotelUtils.getHotelMapData(this._hotelData);if(this._hotelMap)return void this._hotelMap.update(t);this._hotelMap=new D.HotelMapView(t),this._laySwitch.add(this._hotelMap,_.HotelState.MAP)},e.prototype._updateHotelVideo=function(){var t=g.hotelUtils.getVideoLink(this._hotelData),e={Link:t};if(this._hotelVideo)return void this._hotelVideo.update(e);this._hotelVideo=new a.VideoControl(r(r({},e),{Class:"TVHotelCardVideo"})),this._laySwitch.add(this._hotelVideo,_.HotelState.VIDEO)},e.prototype._updateHotelReviewsView=function(){var t=g.hotelUtils.getReviewsServicesLinks(this._hotelData),o={HotelId:this._HotelId,ReviewsServicesLinks:t};if(this._hotelReviewsView)return void this._hotelReviewsView.update(o);this._hotelReviewsView=new k.HotelReviewsView(r({InitReviewsCount:e.CARD_REVIEWS_COUNT,UpButtonClicked:this._ScrollToTop},o)),this._laySwitch.add(this._hotelReviewsView,_.HotelState.REVIEWS)},e.CARD_REVIEWS_COUNT=5,e}(u.Core);e.TourCardDetailController=R,t.TourCardDetailController=R}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.AccommodationItem=void 0;var r=o(469),n=o(299),s=o(2),a=o(1),l=o(16),u=o(470),c=o(12),h=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="accommodation-item",o._Actype="",o._Description="",o._Images=[],o._IsEnabledClampText=!1,o._IsVisibleFullText=!0,o._Stars=0,o._Title="",o._domNodeWidth=0,o._imageSlider=null,o._resizeObserver=null,o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderStars(),this._updateTitle(),this._updateImageSlider(),this._updateDescription(),this._updateObserver()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Title,i=e.Description,r=e.Images,n=e.IsEnabledClampText,s=e.IsVisibleFullText;(0,a.isDefined)(o)&&this._updateTitle(),(0,a.isDefined)(r)&&this._updateImageSlider(),(0,a.isDefined)(n)&&this._updateObserver(),((0,a.isDefined)(i)||(0,a.isDefined)(n)||(0,a.isDefined)(s))&&this._updateDescription()},e.prototype._init=function(){this._resize=this._resize.bind(this),this._resizeObserver=new u.NodeResizeObserver},e.prototype._renderStars=function(){var t=this._nodes.starsNode;return new n.StarsControl({Count:this._Stars,ParentNode:t,Size:l.SizeEnum.M})},e.prototype._updateTitle=function(){var t=this._nodes.titleNode;(0,a.setVisible)(t,Boolean(this._Title))},e.prototype._updateDescription=function(){this._nodes.descriptionNode.innerHTML=(0,c.sanitizeHTML)(this._Description),this._updateDescriptionBlock()},e.prototype._updateDescriptionBlock=function(){var t=this._nodes,e=t.descriptionNode,o=t.hideButton,i=t.descriptionBlock,r=this._IsEnabledClampText&&e.offsetHeight>160,n=!this._IsVisibleFullText&&r;(0,a.setVisible)(o,r),i.style.height=n||!r?"":e.offsetHeight+"px",(0,a.updateClass)(this._DomNode,"TVHideDescription",n)},e.prototype._updateImageSlider=function(){var t=this._nodes.imageNode;if((0,a.setVisible)(t,this._Images&&this._Images.length>0),this._imageSlider)return void this._imageSlider.update({Items:this._Images});this._imageSlider=new r.PhotoSliderGallery({Items:this._Images,ParentNode:t})},e.prototype._updateObserver=function(){if(this._IsEnabledClampText)return void this._resizeObserver.observe(this._DomNode,this._resize);this._resizeObserver.unobserve()},e.prototype._onHideButtonClick=function(){this._IsVisibleFullText=!this._IsVisibleFullText,this._updateDescriptionBlock()},e.prototype._resize=function(){var t=this._DomNode.offsetWidth;t<=0||this._domNodeWidth===t||(this._domNodeWidth=t,this._updateDescriptionBlock())},e}(s.Control);e.AccommodationItem=h,t.AccommodationItem=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.Photo=void 0;var r=o(2),n=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVPhoto",o._Url="",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updatePhoto()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._updatePhoto()},e.prototype._updatePhoto=function(){this._DomNode.style.backgroundImage=this._Url?"url("+this._Url+")":""},e}(r.Control);e.Photo=n,t.Photo=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CraftTourDescriptionView=void 0;var r=o(471),n=o(2),s=o(3),a=o(1),l=o(6),u=o(61),c=o(12),h=o(472),d=o(474),p=o(475),_=o(301),f=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="craft-tour-description-view",o.UpButtonClicked=new s.UserEvent,o._Attraction=[],o._FullDescription="",o._Images=[],o._ImportantInformation=[],o._IncludesConditions=[],o._NotIncludesConditions=[],o._ShortDescription="",o._TourProgram=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateControls()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Attraction,i=e.IncludesConditions,r=e.NotIncludesConditions,n=e.TourProgram,s=e.ShortDescription,l=e.Images,u=e.FullDescription,c=e.UpdateVisibleUpButton,h=e.ImportantInformation;(0,a.isDefined)(o)&&this._updateAttractionList(),((0,a.isDefined)(i)||(0,a.isDefined)(r))&&this._updateConditions(),(0,a.isDefined)(n)&&this._updateTourProgram(),(0,a.isDefined)(s)&&this._updateShortDescription(),(0,a.isDefined)(l)&&this._updateImages(),(0,a.isDefined)(u)&&this._updateFullDescription(),(0,a.isDefined)(h)&&this._updateImportantInformation(),((0,a.isDefined)(c)||(0,a.isDefined)(o)||(0,a.isDefined)(i)||(0,a.isDefined)(r)||(0,a.isDefined)(n)||(0,a.isDefined)(s)||(0,a.isDefined)(l)||(0,a.isDefined)(u)||(0,a.isDefined)(h))&&this._updateVisibleUpButton()},e.prototype._updateControls=function(){this._updateShortDescription(),this._updateImages(),this._updateFullDescription(),this._updateAttractionList(),this._updateTourProgram(),this._updateConditions(),this._updateImportantInformation(),this._updateVisibleUpButton()},e.prototype._updateShortDescription=function(){var t=this._nodes.shortDescriptionNode,e=Boolean(this._ShortDescription);(0,a.setVisible)(t,e),e&&(t.innerHTML=(0,c.sanitizeHTML)(this._ShortDescription))},e.prototype._updateImages=function(){var t=this._nodes.galleryNode,e=this._Images&&this._Images.length>0;if((0,a.setVisible)(t,e),e)return this._gallery?void this._gallery.update({Items:this._Images}):void(this._gallery=new _.HotelGalleryControl({Items:this._Images,ParentNode:t}))},e.prototype._updateFullDescription=function(){var t=this._nodes.fullDescriptionNode,e=Boolean(this._FullDescription);(0,a.setVisible)(t,e),e&&(t.innerHTML=(0,c.sanitizeHTML)(this._FullDescription))},e.prototype._updateAttractionList=function(){var t=this._nodes.attractionNode;if((0,a.setVisible)(t,(0,l.isNotEmptyArray)(this._Attraction)),this._attractionList)return void this._attractionList.update({Items:this._Attraction});this._attractionList=new h.AttractionList({DomNode:t,Items:this._Attraction})},e.prototype._updateTourProgram=function(){var t=this._nodes.tourProgramNode;if((0,a.setVisible)(t,(0,l.isNotEmptyArray)(this._TourProgram)),this._tourProgramList)return void this._tourProgramList.update({Items:this._TourProgram});this._tourProgramList=new p.TourProgramList({DomNode:t,Items:this._TourProgram})},e.prototype._updateImportantInformation=function(){var t=this._nodes.importantInformationNode;if((0,a.setVisible)(t,(0,l.isNotEmptyArray)(this._ImportantInformation)),this._importantInformationList)return void this._importantInformationList.update({Items:this._ImportantInformation});this._importantInformationList=new r.AccordionList({Color:u.ColorThemeEnum.INFO,DomNode:t,Items:this._ImportantInformation})},e.prototype._updateConditions=function(){var t=this._nodes.conditionsNode;return(0,l.isEmptyArray)(this._IncludesConditions)&&(0,l.isEmptyArray)(this._NotIncludesConditions)?void(0,a.hide)(t):((0,a.show)(t),this._tourConditions?void this._tourConditions.update({Includes:this._IncludesConditions,NotIncludes:this._NotIncludesConditions}):void(this._tourConditions=new d.CraftTourConditions({Includes:this._IncludesConditions,NotIncludes:this._NotIncludesConditions,ParentNode:t})))},e.prototype._updateVisibleUpButton=function(){var t=this._nodes.upButton,e=screen.height||window.innerHeight;(0,a.setVisible)(t,this._DomNode.offsetHeight>e)},e.prototype._onUpButtonClick=function(){this.UpButtonClicked.fire()},e}(n.Control);e.CraftTourDescriptionView=f,t.CraftTourDescriptionView=f}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.AttractionItem=void 0;var r=o(2),n=o(1),s=o(5),a=o(135),l=o(10),u=o(12),c=o(15),h=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="attraction-item",o._Description="",o._Images=[],o._StyleTheme=l.StyleThemeEnum.THEME1,o._Title="",o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){var o=this._StyleTheme;t.prototype.update.call(this,e);var i=e.Images,r=e.Title,s=e.Description,a=e.StyleTheme;(0,n.isDefined)(i)&&this._updateImages(),(0,n.isDefined)(r)&&this._updateTitle(),(0,n.isDefined)(s)&&this._updateDescription(),(0,n.isDefined)(a)&&this._updateStyleTheme(o)},e.prototype.render=function(){t.prototype.render.call(this),this._updateImages(),this._updateTitle(),this._updateDescription(),this._updateStyleTheme(this._StyleTheme)},e.prototype._init=function(){this._onGalleryButtonClick=this._showPhotoGallery.bind(this),this._onImageNodeClick=this._showPhotoGallery.bind(this)},e.prototype._updateImages=function(){var t=this._nodes,e=t.imageNode,o=t.galleryBtn,i=this._Images.length>0;e.style.backgroundImage=i?"url("+this._Images[0]+")":"",(0,n.setVisible)(o,i)},e.prototype._updateTitle=function(){this._nodes.titleNode.innerHTML=(0,u.sanitizeHTML)(this._Title)},e.prototype._updateDescription=function(){this._nodes.descriptionNode.innerHTML=(0,u.sanitizeHTML)(this._Description)},e.prototype._updateStyleTheme=function(t){(0,n.removeClass)(this._DomNode,c.styleUtils.getClassByTheme(t)),(0,n.addClass)(this._DomNode,c.styleUtils.getClassByTheme(this._StyleTheme))},e.prototype._showPhotoGallery=function(){0!==this._Images.length&&(0,a.showGallery)({ActiveIndex:0,Items:this._Images,ModeView:s.ModeView.DescTop,Title:this._Title})},e}(r.Control);e.AttractionItem=h,t.AttractionItem=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CraftTourProgram=void 0;var r=o(300),n=o(2),s=o(1),a=o(6),l=o(10),u=o(15),c=o(904),h=o(905),d=o(233),p=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVCraftTourProgram",o._DayNumber=0,o._Description="",o._GalleryType=d.TourProgramGalleryType.SLIDER,o._Images=[],o._StyleTheme=l.StyleThemeEnum.THEME1,o._Title="",o._accordion=null,o._description=null,o._title=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._title=new h.CraftTourProgramTitle({DayNumber:this._DayNumber,Title:this._Title}),this._description=new c.CraftTourProgramDescription({Description:this._Description,GalleryType:this._GalleryType,Images:this._Images}),this._accordion=new r.Accordion({Content:this._Description.length>0||(0,a.isNotEmptyArray)(this._Images)?this._description:"",ParentNode:this._DomNode,Title:this._title}),(0,s.addClass)(this._DomNode,u.styleUtils.getClassByTheme(this._StyleTheme))},e}(n.Control);e.CraftTourProgram=p,t.CraftTourProgram=p}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CraftTourProgramDescription=void 0;var r=o(136),n=o(469),s=o(2),a=o(1),l=o(6),u=o(12),c=o(233),h=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVProgramDescription",o._GalleryType=c.TourProgramGalleryType.SLIDER,o._Description="",o._Images=[],o._description=null,o._gallery=null,o._imageSlider=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderDescription(),this._renderPhotos()},e.prototype._renderDescription=function(){this._Description&&(this._description=(0,a.newDiv)("TVProgramDescriptionText",this._DomNode),this._description.innerHTML=(0,u.sanitizeHTML)(this._Description))},e.prototype._renderPhotos=function(){if((0,l.isNotEmptyArray)(this._Images))switch(this._GalleryType){case c.TourProgramGalleryType.GALLERY:this._renderPhotoGallery();break;case c.TourProgramGalleryType.SLIDER:default:this._renderPhotoSlider()}},e.prototype._renderPhotoSlider=function(){this._imageSlider=new n.PhotoSliderGallery({Items:this._Images,ParentNode:this._DomNode})},e.prototype._renderPhotoGallery=function(){this._gallery=new r.PhotoGalleryControl({Items:this._Images,ParentNode:this._DomNode,PhotoSwitching:r.PhotoSwitching.Transform,TemplateName:r.PhotoGalleryTemplate.MOBILE})},e}(s.Control);e.CraftTourProgramDescription=h,t.CraftTourProgramDescription=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CraftTourProgramTitle=void 0;var r=o(2),n=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="craft-tour-program-title",o._DayNumber=0,o._Title="",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e}(r.Control);e.CraftTourProgramTitle=n,t.CraftTourProgramTitle=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.PreviewGalleryControl=void 0;var r=o(2),n=o(3),s=o(1),a=o(8),l=function(t){function e(e){var o=t.call(this,e)||this;return o.ItemSelected=new n.UserEvent,o.MoreClicked=new n.UserEvent,o.templateName="preview-gallery",o._Class="TVPreviewGalleryControl",o._Items=[],o._SelectedIndex=0,o._currentGroup=0,o._itemNodes=[],o.__initSettings(e),o._onShowPhotoClicked=o._onShowPhotoClicked.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){(0,s.removeEvent)(this._nodes.moreBtn,"click",this._onShowPhotoClicked),this._clear(),t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this),this._renderGroupItems(),this._updateVisibleItems(this._currentGroup,!0),this._updateSelectedItem(),(0,s.addEvent)(this._nodes.moreBtn,"click",this._onShowPhotoClicked)},e.prototype.update=function(e){var o=e.Items,i=e.SelectedIndex;if((0,s.isDefined)(i)&&this._updateSelectedItem(i),t.prototype.update.call(this,e),(0,s.isDefined)(o))return this._clear(),this._renderGroupItems(),this._updateVisibleItems(this._currentGroup,!0),void this._updateSelectedItem()},e.prototype._addItem=function(t){var e=this,o=this._nodes.list,i=this._Items[t];if(i instanceof HTMLElement)this._itemNodes[t]=i,o.appendChild(i);else{var r=(0,s.newDiv)("TVPreviewItem TVHide "+a.TV_PREVIEW,o),n=new Image;n.onload=function(){r.style.backgroundImage="url("+e._Items[t]+")",(0,s.removeClass)(r,a.TV_PREVIEW)},n.src=this._Items[t],this._itemNodes[t]=r}var l=this._onItemSelected.bind(this,{PictureIndex:t});(0,s.addEvent)(this._itemNodes[t],"click",l),this._itemNodes[t].tvhandler=l},e.prototype._clear=function(){this._itemNodes.forEach(function(t){(0,s.removeEvent)(t,"click",t.tvhandler)}),(0,s.removeChildren)(this._nodes.list),this._currentGroup=0,this._itemNodes=[],this._SelectedIndex=0},e.prototype._onItemSelected=function(t){var e=t.PictureIndex;this._SelectedIndex!==e&&(this._updateSelectedItem(e),this.ItemSelected.fire(t))},e.prototype._onShowPhotoClicked=function(){this.MoreClicked.fire()},e.prototype._renderGroupItems=function(){var t=this._Items.length;if(0!==t&&this._itemNodes.length!==t){var o=this._currentGroup*e.GROUP_COUNT,i=(this._currentGroup+1)*e.GROUP_COUNT;i=Math.min(i,t);for(var r=o;r<i;r+=1)this._addItem(r);(0,s.setVisible)(this._nodes.moreBtn,this._Items.length>e.GROUP_COUNT)}},e.prototype._updateGroupItems=function(){if(0!==this._Items.length){var t=Math.floor(this._SelectedIndex/e.GROUP_COUNT);this._currentGroup!==t&&(this._updateVisibleItems(this._currentGroup,!1),this._currentGroup=t,this._renderGroupItems(),this._updateVisibleItems(this._currentGroup,!0))}},e.prototype._updateSelectedItem=function(t){(0,s.isDefined)(t)&&((0,s.removeClass)(this._itemNodes[this._SelectedIndex],e.TV_SELECTED),this._SelectedIndex=t),this._updateGroupItems(),(0,s.addClass)(this._itemNodes[this._SelectedIndex],e.TV_SELECTED)},e.prototype._updateVisibleItems=function(t,o){var i=t*e.GROUP_COUNT,r=(t+1)*e.GROUP_COUNT;r=Math.min(r,this._Items.length);for(var n=i;n<r;n+=1)(0,s.setVisible)(this._itemNodes[n],o)},e.GROUP_COUNT=12,e.NONE_SELECTED=-1,e.TV_SELECTED="TVSelected",e}(r.Control);e.PreviewGalleryControl=l,t.PreviewGalleryControl=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ExcursionTourControl=void 0;var r=o(2),n=o(1),s=o(301),a=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="excursion-tour",o._Text="",o._Description="",o._PhotoItems=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateGallery(),this._nodes.description.innerHTML=this._Description},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.PhotoItems,i=e.Description;(0,n.isDefined)(o)&&this._updateGallery(),(0,n.isDefined)(i)&&(this._nodes.description.innerHTML=this._Description)},e.prototype._updateGallery=function(){var t=this._nodes.slider;if(!this._PhotoItems||0===this._PhotoItems.length)return void(0,n.hide)(t);this._gallery?this._gallery.update({Items:this._PhotoItems}):this._gallery=new s.HotelGalleryControl({Items:this._PhotoItems,ParentNode:t})},e}(r.Control);e.ExcursionTourControl=a,t.ExcursionTourControl=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelButtonsControl=void 0;var r=o(2),n=o(3),s=o(1),a=o(154),l=o(8),u=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new n.UserEvent,o.templateName="hotel-card-buttons",o._AccommodationEnable=!1,o._Class="TVHotelButtonsControl",o._CraftDescriptionEnable=!1,o._DescriptionEnable=!1,o._ExcursionEnable=!1,o._MapEnable=!1,o._PhotoEnable=!1,o._ReviewsEnable=!1,o._State=a.HotelState.NONE,o._VideoEnable=!1,o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateState(),this._addActiveClass(),this._updateVisible()},e.prototype.update=function(e){this._removeActiveClass(),t.prototype.update.call(this,e),this._updateState(),this._addActiveClass(),this._updateVisible()},e.prototype._init=function(){this._onCraftBtnClick=this._onButtonClick.bind(this,{State:a.HotelState.CRAFT}),this._onExcursionBtnClick=this._onButtonClick.bind(this,{State:a.HotelState.EXCURSION}),this._onDescriptionBtnClick=this._onButtonClick.bind(this,{State:a.HotelState.DESCRIPTION}),this._onPhotoBtnClick=this._onButtonClick.bind(this,{State:a.HotelState.PHOTO}),this._onAccommodationBtnClick=this._onButtonClick.bind(this,{State:a.HotelState.ACCOMMODATION}),this._onMapBtnClick=this._onButtonClick.bind(this,{State:a.HotelState.MAP}),this._onReviewsBtnClick=this._onButtonClick.bind(this,{State:a.HotelState.REVIEWS}),this._onVideoBtnClick=this._onButtonClick.bind(this,{State:a.HotelState.VIDEO})},e.prototype._getButtonNode=function(t){var e=this._nodes,o=e.descriptionBtn,i=e.photoBtn,r=e.mapBtn,n=e.reviewsBtn,s=e.excursionBtn,l=e.accommodationBtn,u=e.craftBtn,c=e.videoBtn;switch(t){case a.HotelState.DESCRIPTION:return o;case a.HotelState.PHOTO:return i;case a.HotelState.ACCOMMODATION:return l;case a.HotelState.MAP:return r;case a.HotelState.REVIEWS:return n;case a.HotelState.EXCURSION:return s;case a.HotelState.CRAFT:return u;case a.HotelState.VIDEO:return c;default:return}},e.prototype._onButtonClick=function(t){this._removeActiveClass(),this._State=t.State,this._addActiveClass(),this.Changed.fire(t)},e.prototype._addActiveClass=function(){if(this._State!==a.HotelState.NONE){var t=this._getButtonNode(this._State);(0,s.addClass)(t,l.TV_ACTIVE)}},e.prototype._removeActiveClass=function(){if(this._State!==a.HotelState.NONE){var t=this._getButtonNode(this._State);(0,s.removeClass)(t,l.TV_ACTIVE),this._State=a.HotelState.NONE}},e.prototype._updateVisible=function(){var t=this._nodes,e=t.descriptionBtn,o=t.photoBtn,i=t.accommodationBtn,r=t.mapBtn,n=t.reviewsBtn,a=t.excursionBtn,l=t.craftBtn,u=t.videoBtn;(0,s.setVisible)(e,this._DescriptionEnable),(0,s.setVisible)(o,this._PhotoEnable),(0,s.setVisible)(i,this._AccommodationEnable),(0,s.setVisible)(r,this._MapEnable),(0,s.setVisible)(n,this._ReviewsEnable),(0,s.setVisible)(a,this._ExcursionEnable),(0,s.setVisible)(l,this._CraftDescriptionEnable),(0,s.setVisible)(u,this._VideoEnable)},e.prototype._updateState=function(){if(this._State===a.HotelState.NONE)switch(!0){case this._ExcursionEnable&&!this._DescriptionEnable:this._State=a.HotelState.EXCURSION;break;case this._CraftDescriptionEnable:this._State=a.HotelState.CRAFT;break;case this._DescriptionEnable:this._State=a.HotelState.DESCRIPTION;break;case this._PhotoEnable:this._State=a.HotelState.PHOTO;break;case this._AccommodationEnable:this._State=a.HotelState.ACCOMMODATION;break;case this._MapEnable:this._State=a.HotelState.MAP;break;case this._ReviewsEnable:this._State=a.HotelState.REVIEWS;break;case this._VideoEnable:this._State=a.HotelState.VIDEO}},e}(r.Control);e.HotelButtonsControl=u,t.HotelButtonsControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelDescriptionView=void 0;var r=o(2),n=o(3),s=o(1),a=o(12),l=o(302),u=o(301),c=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="hotel-description-view",o.UpButtonClicked=new n.UserEvent,o._Class="TVHotelDescriptionView",o._CommonData=null,o._DescriptionData=null,o._Photos=[],o._ReviewsCount=0,o._MorePhotoClicked=null,o._ShowReviewClicked=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateControls()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.CommonData,i=e.DescriptionData,r=e.Photos,n=e.ReviewsCount,a=e.UpdateVisibleUpButton;((0,s.isDefined)(o)||(0,s.isDefined)(i)||(0,s.isDefined)(r)||(0,s.isDefined)(n))&&(this._clear(),this._updateControls()),(0,s.isDefined)(a)&&this._updateVisibleUpButton()},e.prototype._clear=function(){(0,s.removeChildren)(this._nodes.descriptionText)},e.prototype._updateControls=function(){var t=this._nodes,e=t.descriptionNode,o=t.descriptionText,i=t.sliderNode;this._hotelGalleryControl||(this._hotelGalleryControl=new u.HotelGalleryControl({ParentNode:i,MorePhotoClicked:this._MorePhotoClicked,ShowReviewClicked:this._ShowReviewClicked})),this._hotelDescriptionControl||(this._hotelDescriptionControl=new l.HotelDescriptionControl({ParentNode:e}));var r={Items:[],Rating:0,ReviewsCount:this._ReviewsCount};if(this._CommonData){var n=this._CommonData,c=n.Rating,h=n.ShortDescription,d=(0,s.isDefined)(c)?Number(c):0;d>0&&(r.Rating=d),(0,s.isDefined)(h)&&h.length>0&&(o.innerHTML=(0,a.sanitizeHTML)(h))}this._Photos.length>0&&(r.Items=this._Photos),r.Items.length>0||r.Rating>0?(this._hotelGalleryControl.update(r),(0,s.show)(i)):(0,s.hide)(i),this._hotelDescriptionControl.update(this._DescriptionData),this._updateVisibleUpButton()},e.prototype._updateVisibleUpButton=function(){var t=this._nodes.upButton,e=screen.height||window.innerHeight;(0,s.setVisible)(t,this._DomNode.offsetHeight>e)},e.prototype._onUpButtonClick=function(){this.UpButtonClicked.fire()},e}(r.Control);e.HotelDescriptionView=c,t.HotelDescriptionView=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelMapView=void 0;var r=o(2),n=o(1),s=o(188),a=o(84),l=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="hotel-map-view",o._Class="TVHotelMapView",o._Coords=[],o.__initSettings(e),a.resourceManager.loadYandexMap(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateControls()},e.prototype.update=function(e){t.prototype.update.call(this,e),(0,n.isDefined)(e.Coords)&&this._updateControls(),(0,n.isDefined)(e.MapEnable)&&this._map&&this._map.container.fitToViewport()},e.prototype._applyMap=function(){this._map=new ymaps.Map(this._nodes.mapContainer,{center:this._Coords,zoom:e.HOTEL_ZOOM,type:e.YANDEX_MAP_TYPE,controls:e.YANDEX_MAP_CONTROLS}),this._markerHotel=new ymaps.Placemark(this._Coords,{}),this._map.geoObjects.add(this._markerHotel),(0,n.show)(this._nodes.googleMap),(0,n.show)(this._nodes.yandexMap)},e.prototype._createGoogleLink=function(){var t=s.ExternalLinks.GoogleMapLink;this._nodes.googleMap.href=this._getUpdatedLink(t)},e.prototype._createYandexLink=function(){var t=s.ExternalLinks.YandexMapLink;this._nodes.yandexMap.href=this._getUpdatedLink(t)},e.prototype._updateControls=function(){if(0!==this._Coords.length){if(this._createGoogleLink(),this._createYandexLink(),!this._map)return void a.resourceManager.onYandexMapLoad({CallBack:this._applyMap,Context:this});this._map.setCenter(this._Coords),this._map.setZoom(e.HOTEL_ZOOM),this._markerHotel.geometry.setCoordinates(this._Coords)}},e.prototype._getUpdatedLink=function(t){var e=t.replace(/lat/g,this._Coords[0].toString());return e=e.replace(/lng/g,this._Coords[1].toString())},e.HOTEL_ZOOM=14,e.YANDEX_MAP_CONTROLS=["zoomControl"],e.YANDEX_MAP_TYPE="yandex#hybrid",e}(r.Control);e.HotelMapView=l,t.HotelMapView=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__awaiter||function(t,e,o,i){function r(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,n){function s(t){try{l(i.next(t))}catch(t){n(t)}}function a(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){t.done?o(t.value):r(t.value).then(s,a)}l((i=i.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){function o(t){return function(e){return i([t,e])}}function i(o){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,n=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){l.label=o[1];break}if(6===o[0]&&l.label<s[1]){l.label=s[1],s=o;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(o);break}s[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(t,l)}catch(t){o=[6,t],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var r,n,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(e,"__esModule",{value:!0}),e.HotelPhotoControl=void 0;var s=o(23),a=o(2),l=o(3),u=o(7),c=o(1),h=o(6),d=o(28),p=function(t){function e(e){var o=t.call(this,e)||this;return o.UpButtonClicked=new l.UserEvent,o.templateName="hotel-photo",o._Class="TVHotelPhotoControl",o._IsEnabledMoreLoad=!0,o._Pictures=[],o._renderedIndexPicture=0,o._timeout=null,o._waiter=null,o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderWaiter(),this._renderPictures(),this._updateVisibleWaiter()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsEnabledMoreLoad,i=e.Pictures;(0,c.isDefined)(i)&&(this._clear(),this._renderPictures()),(0,c.isDefined)(o)&&(o?this._continueLoadPictures():this._resetTimeout())},e.prototype.destroy=function(){this._clear(),t.prototype.destroy.call(this)},e.prototype._init=function(){this._loadPicture=this._loadPicture.bind(this)},e.prototype._clear=function(){var t=this._nodes,e=t.container,o=t.upButton;(0,c.removeChildren)(e),(0,c.hide)(o),this._renderedIndexPicture=0,this._resetTimeout()},e.prototype._renderWaiter=function(){this._waiter=new s.Waiter({ParentNode:this._nodes.waiter})},e.prototype._renderPictures=function(){if(this._hasPictures()){this._Pictures=d.pictureUtils.sortByWidth(this._Pictures);for(var t=Math.min(this._Pictures.length,3),e=0;e<t;e++)this._renderedIndexPicture=e,this._createPictureNode(this._Pictures[e]);this._updateVisibleWaiter()}},e.prototype._continueLoadPictures=function(){this._hasPictures()&&this._loadPicture()},e.prototype._loadPicture=function(){return r(this,void 0,void 0,function(){var t,e;return n(this,function(o){switch(o.label){case 0:return this._isAllRendered()?[2]:(this._renderedIndexPicture+=1,[4,this._createPictureNode(this._Pictures[this._renderedIndexPicture])]);case 1:return t=o.sent(),this._isAllRendered()?this._updateVisibleWaiter():(e=this._getLoadInterval(t.width),this._timeout=setTimeout(this._loadPicture,e)),this._updateVisibleUpButton(),[2]}})})},e.prototype._createPictureNode=function(t){var e=this;return new Promise(function(o){var i,r=(0,c.classNames)("TVHotelPhotoItem",(i={},i.TVHalfWidth=Number(t.width)<u.PHOTO_HALF_WIDTH,i)),n=(0,c.newDomNode)("img",r,e._nodes.container);n.onload=function(){o(n)},n.src=t.url})},e.prototype._updateVisibleUpButton=function(){if(5===this._renderedIndexPicture){var t=this._nodes.upButton;(0,c.setVisible)(t,this._Pictures.length>5)}},e.prototype._updateVisibleWaiter=function(){if(this._isAllRendered())return void this._waiter.hide();this._waiter.show()},e.prototype._onUpButtonClick=function(){this.UpButtonClicked.fire()},e.prototype._resetTimeout=function(){clearTimeout(this._timeout),this._timeout=null},e.prototype._isAllRendered=function(){return this._renderedIndexPicture+1>=this._Pictures.length},e.prototype._hasPictures=function(){return(0,h.isNotEmptyArray)(this._Pictures)},e.prototype._getLoadInterval=function(t){return Number(t)>u.PHOTO_HALF_WIDTH?1e3:500},e}(a.Control);e.HotelPhotoControl=p,t.HotelPhotoControl=p}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.reviewService=void 0;var i=o(27);e.reviewService=new i.ApiService("/api/v1.1/reviews"),t.reviewService=e.reviewService}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.EmptyReviewsMessageControl=void 0;var r=o(2),n=o(1),s=o(5),a=o(108),l=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="empty-reviews-message",o._ReviewMode=s.ReviewMode.DISABLE,o._ReviewsServicesLinks=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),(0,n.isDefined)(e.ReviewsServicesLinks)&&this._updateLinks()},e.prototype._updateLinks=function(){var t=this._nodes,e=t.reviewsServices,o=t.tophotelsNode,i=t.tripadvisorNode,r=a.reviewsUtils.getIsVisibleTophotels(this._ReviewMode),s=a.reviewsUtils.getIsVisibleTripadvisor(this._ReviewMode),l=a.reviewsUtils.getTophotelsLink(this._ReviewsServicesLinks),u=a.reviewsUtils.getTripadvisorLink(this._ReviewsServicesLinks);l=r?l:"",u=s?u:"";var c=l.length>0,h=u.length>0;switch(!0){case c&&h:e.className="TVReviewsServices";break;case c&&!h||h&&!c:e.className="TVReviewsService";break;default:e.className="TVHide"}o.href=l,i.href=u,(0,n.setVisible)(o,c),(0,n.setVisible)(i,h)},e}(r.Control);e.EmptyReviewsMessageControl=l,t.EmptyReviewsMessageControl=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelReviewsButtonsControl=e.ReviewsButtonsType=void 0;var r,n=o(2),s=o(1),a=o(5),l=o(108);!function(t){t[t.MORE=0]="MORE",t[t.NEW=1]="NEW",t[t.TOPHOTELS=2]="TOPHOTELS",t[t.TRIPADVISOR=3]="TRIPADVISOR"}(r=e.ReviewsButtonsType||(e.ReviewsButtonsType={}));var u=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="hotel-reviews-buttons",o._AddReviewBottomEnable=!1,o._ModeView=a.ModeView.DescTop,o._MoreButtonVisible=!1,o._MoreReviewsEnable=!1,o._ReviewMode=a.ReviewMode.DISABLE,o._ReviewsNode=null,o._ReviewsServicesLinks=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){this._ReviewsNode&&(t.prototype.render.call(this),this._updateReviewsServicesNodes(),this._DomNode.insertBefore(this._ReviewsNode,this._nodes.moreReviewsWrapper))},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.MoreButtonVisible,i=e.ReviewsServicesLinks;(0,s.isDefined)(o)&&this._MoreReviewsEnable&&((0,s.setVisible)(this._nodes.moreReviews,o),(0,s.setVisible)(this._nodes.moreReviewsWrapper,o)),(0,s.isDefined)(i)&&this._updateReviewsServicesNodes()},e.prototype._onAddReviewClick=function(){this.Click.fire({Type:r.NEW})},e.prototype._onMoreReviewsClick=function(){this._MoreReviewsEnable&&this._MoreButtonVisible&&this.Click.fire({Type:r.MORE})},e.prototype._onTophotelsClick=function(){l.reviewsUtils.getIsVisibleTophotels(this._ReviewMode)&&this.Click.fire({Type:r.TOPHOTELS})},e.prototype._onTripadvisorClick=function(){l.reviewsUtils.getIsVisibleTripadvisor(this._ReviewMode)&&this.Click.fire({Type:r.TRIPADVISOR})},e.prototype._updateReviewsServiceButton=function(t,e){var o=t.length>0;e.href=t,(0,s.setVisible)(e,o)},e.prototype._updateReviewsServicesNodes=function(){var t=l.reviewsUtils.getIsVisibleTophotels(this._ReviewMode),e=l.reviewsUtils.getIsVisibleTripadvisor(this._ReviewMode);if(t){var o=l.reviewsUtils.getTophotelsLink(this._ReviewsServicesLinks);this._updateReviewsServiceButton(o,this._nodes.tophotels)}if(e){var i=l.reviewsUtils.getTripadvisorLink(this._ReviewsServicesLinks);this._updateReviewsServiceButton(i,this._nodes.tripadvisor)}},e}(n.Control);e.HotelReviewsButtonsControl=u,t.HotelReviewsButtonsControl=u,t.ReviewsButtonsType=r}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelReviewsControl=void 0;var r=o(2),n=o(4),s=o(3),a=o(1),l=o(108),u=o(478),c=function(t){function e(e){var o=t.call(this,e)||this;return o.ReviewSelected=new s.UserEvent,o._Class="TVHotelReviewsControl",o._IsNewReviews=!1,o._ReviewClickable=!1,o._Reviews=[],o._ReviewsServiceLink="",o._reviewItems=[],t.prototype.__initSettings.call(o,e),o._handlerClickedReview=new n.Delegate(o,o._onReviewSelected),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){this._Reviews=[],t.prototype.destroy.call(this)},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsNewReviews,i=e.Reviews;o&&this._clear(),(0,a.isArray)(i)&&this._renderReviews()},e.prototype._clear=function(){this._reviewItems.forEach(function(t){t.destroy()}),this._reviewItems=[],(0,a.removeChildren)(this._DomNode)},e.prototype._createReviewItem=function(t){return new u.HotelReviewItemControl({Content:t.content,ExpandEnable:!0,Id:t.id,IsEnabled:this._ReviewClickable,Name:l.reviewsUtils.getReviewName(t),NegativeReview:t.xminus,ParentNode:this._DomNode,PositiveReview:t.xplus,Rating:t.rate_our||0,Clicked:this._handlerClickedReview})},e.prototype._onReviewSelected=function(t){this.ReviewSelected.fire(t)},e.prototype._renderReviews=function(){var t=this;(this._Reviews||[]).forEach(function(e){l.reviewsUtils.hasContent(e)&&t._reviewItems.push(t._createReviewItem(e))})},e}(r.Control);e.HotelReviewsControl=c,t.HotelReviewsControl=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardHeaderControl=void 0;var n=o(31),s=o(2),a=o(4),l=o(3),u=o(1),c=o(5),h=o(13),d=o(22),p=o(121),_=o(109),f=o(229),y=o(40),g=o(33),C=o(479),v=o(8),m=o(480),T=o(374),w=o(917),S=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="tour-card-header",o.MenuClicked=new l.UserEvent,o.OperatorClicked=new l.UserEvent,o._IsEnabledAddHotOffer=!1,o._IsEnabledBooking=!1,o._IsEnabledSendError=!1,o._IsEnabledTour=!1,o._IsVisibleOperatorLink=!1,o._IsVisibleOperatorLogo=!1,o._SearchLink="",o._SelectedFlight=null,o._TourData=null,o._menu=null,o._isVisibleMenu=!1,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderMenu()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsLoadingTour,i=e.TourData,r=e.IsEnabledTour,n=e.IsVisibleOperatorLogo,s=e.IsVisibleOperatorLink,a=this._nodes,l=a.menuNode,c=a.shareNode,h=a.operatorLinkBlockNode;(0,u.isDefined)(o)&&((0,u.setVisible)(l,!o),(0,u.setVisible)(c,!o),(0,u.setVisible)(h,!o)),((0,u.isDefined)(i)||(0,u.isDefined)(n)||(0,u.isDefined)(s)||(0,u.isDefined)(r))&&(this._updateOperatorLink(),this._updateOperatorLogo(),this._updateEnabledOperator(),this._updateMenuItems())},e.prototype._renderMenu=function(){this._menu=new w.TourCardMenuDropPanel({ParentNode:this._DomNode,Hide:new a.Delegate(this,this._onMenuHided),MenuClicked:new a.Delegate(this,this._onMenuClicked)})},e.prototype._onOperatorLinkBlockNodeClick=function(t){this.OperatorClicked.fire()},e.prototype._onShareNodeClick=function(){this._showShare()},e.prototype._onMenuNodeClick=function(){this._isVisibleMenu=!this._isVisibleMenu,this._menu.setVisible(this._isVisibleMenu),this._updateMenuNode(),this._updateMenuItems()},e.prototype._onMenuClicked=function(t){switch(t.Action){case m.TourCardAction.SHARE:this._showShare();break;case m.TourCardAction.SENDERROR:this._showError();break;case m.TourCardAction.ADDHOTOFFER:this._showHotOffer()}this._menu.hide(),this.MenuClicked.fire(t)},e.prototype._onMenuHided=function(){this._isVisibleMenu=!1,this._updateMenuNode()},e.prototype._showShare=function(){var t=T.tourCardShareUtils.getShareSettings(this._TourData,this._SelectedFlight);(0,_.showShare)(r(r({},t),{ActionSource:n.ActionStatisticsSource.TOURCARD,ModeView:c.ModeView.DescTop}))},e.prototype._showError=function(){(0,p.showError)({ActionSource:n.ActionStatisticsSource.TOURCARD,ErrorData:{TourId:this._TourData.tourid},ModeView:c.ModeView.DescTop})},e.prototype._showHotOffer=function(){var t=y.tourUtils.getHotOfferParams(this._TourData,this._SelectedFlight),e={tsmng:d.authManager.getId()};f.hotOfferService.generate(t,e).then(function(t){(0,C.showHotOffer)({Mode:g.HotOfferCardMode.Edit,OfferApiData:r(r({},t),{created_at:h.FormatDate.getISOStringDate()}),OfferId:0})})},e.prototype._updateMenuNode=function(){var t=this._nodes.menuNode;(0,u.updateClass)(t,v.TV_ACTIVE,this._isVisibleMenu)},e.prototype._updateMenuItems=function(){var t=this._getMenuItems();this._menu.update({MenuItems:t})},e.prototype._getMenuItems=function(){var t=[{Action:m.TourCardAction.SHARE}],e=this._getSearchLink();if(e&&t.push({Action:m.TourCardAction.SEARCHLINK,Link:e}),this._isVisibleOperatorLink()){var o=this._getOperatorLink();t.push({Action:m.TourCardAction.OPERATORLINK,Link:o})}if(this._IsEnabledSendError&&t.push({Action:m.TourCardAction.SENDERROR}),this._IsEnabledAddHotOffer){var i=!this._isEnabledAddHotOffer();t.push({Action:m.TourCardAction.ADDHOTOFFER,Hint:i?"Необходимо выбрать тур только с двумя взрослыми":"",IsDisabled:i})}return this._IsEnabledBooking&&t.push({Action:m.TourCardAction.BOOKING}),t},e.prototype._updateOperatorLogo=function(){var t,e,o=this._nodes,i=o.operatorLogoNode,r=o.operatorName,n=(null===(t=this._TourData)||void 0===t?void 0:t.operatorlogo)||"",s=(null===(e=this._TourData)||void 0===e?void 0:e.operatorname)||"",a=Boolean(n),l=Boolean(s),c=this._IsVisibleOperatorLogo&&this._IsEnabledTour,h=c&&a,d=c&&l&&!a;(0,u.setVisible)(i,h),(0,u.setVisible)(r,d),i.src=h?n:"",r.textContent=d?s:""},e.prototype._updateOperatorLink=function(){var t=this._nodes,e=t.operatorLinkNode,o=t.operatorLinkBlockNode,i=this._isVisibleOperatorLink();(0,u.setVisible)(e,i);var r=this._getOperatorLink();o.href=i?r:"",o.title=i?"Перейти в кабинет туроператора":""},e.prototype._updateEnabledOperator=function(){var t=this._nodes.operatorLinkBlockNode,e=this._isVisibleOperatorLink();(0,u.updateClass)(t,v.TV_DISABLED,!e)},e.prototype._getOperatorLink=function(){return y.tourUtils.getOperatorLink(this._TourData)},e.prototype._isVisibleOperatorLink=function(){var t=this._getOperatorLink();return this._IsVisibleOperatorLink&&this._IsEnabledTour&&Boolean(t)},e.prototype._getSearchLink=function(){var t=y.tourUtils.getSearchSettings(this._TourData);return y.tourUtils.getSearchLink(this._SearchLink,t)},e.prototype._isEnabledAddHotOffer=function(){return y.tourUtils.isTwoAdultsOnly(this._TourData)},e}(s.Control);e.TourCardHeaderControl=S,t.TourCardHeaderControl=S}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardMenuDropPanel=void 0;var r=o(129),n=o(215),s=o(9),a=o(1),l=o(61),u=function(t){function e(e){var o=t.call(this,e)||this;return o._MenuItems=[],o._ParentNode=null,o._Hide=null,o._MenuClicked=null,o._menu=null,o._dropPanel=null,o.__initSettings(e),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._menu&&this._menu.update(e)},e.prototype.destroy=function(){this._MenuClicked=null,this._Hide=null,t.prototype.destroy.call(this)},e.prototype.show=function(){this._dropPanel||this._render(),this._dropPanel.show(),this._updatePosition(this._ParentNode)},e.prototype.hide=function(){this._dropPanel.hide()},e.prototype.setVisible=function(t){if(t)return void this.show();this.hide()},e.prototype._render=function(){this._renderMenu(),this._renderDropPanel()},e.prototype._renderDropPanel=function(){this._dropPanel=new r.DropPanel({Class:"TVTourCardMenuDropPanel",ParentNode:this._ParentNode,Hide:this._Hide}),this._dropPanel.addChild(this._menu)},e.prototype._renderMenu=function(){this._menu=new n.MenuControl({Color:l.ColorThemeEnum.INFO,MenuItems:this._MenuItems,MenuClicked:this._MenuClicked})},e.prototype._updatePosition=function(t){var e=(0,a.cumulativeOffset)(t);this._dropPanel.updatePosition(e.left+5,t.offsetWidth,e.top,t.offsetHeight,(0,a.getCoords)(t))},e}(s.Core);e.TourCardMenuDropPanel=u,t.TourCardMenuDropPanel=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardInfoControl=void 0;var n=o(44),s=o(2),a=o(4),l=o(3),u=o(1),c=o(12),h=o(118),d=o(18),p=o(40),_=o(103),f=o(304),y=o(919),g=o(92),C=o(921),v=o(483),m=o(924),T=o(485),w=o(928),S=function(t){function e(e){var o=t.call(this,e)||this;return o.ActionContinueClicked=new l.UserEvent,o.ActionRedirectLinkClicked=new l.UserEvent,o.FlightSelected=new l.UserEvent,o.MoreFlightsClicked=new l.UserEvent,o.ShowRoom=new l.UserEvent,o.templateName="tour-card-info",o._InsertStarsInTitle=!0,o._IsLoadingTour=!1,o._IsTransformTitle=!1,o._TourData=null,o._ActionAddCartClicked=null,o._flightDetailDropPanel=null,o._hotelTitleControl=null,o._switcher=null,o._tourCardActionControl=null,o._tourCardFlightsControl=null,o._tourCardOptionsControl=null,o._tourFlightSelectionList=null,o._selectedFlight=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){this._ActionAddCartClicked=null,t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this),this._renderHotelTitle(),this._renderTourCardOptions(),this._renderTourCardFlights(),this._renderTourCardAction(),this._renderSwitcher()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ContinueText,i=e.HotelData,r=e.InsertStarsInTitle,n=e.IsActualizing,s=e.IsEnabledAddToCart,a=e.IsEnabledContinue,l=e.IsEnabledTour,c=e.IsLoadingExtraFlights,h=e.IsLoadingFlights,d=e.IsLoadingTour,p=e.IsTransformTitle,_=e.IsVisibleAddToCart,f=e.IsVisibleRequestButton,y=e.IsVisibleTitle,g=e.RedirectLink,C=e.Reset,v=e.TourData;(0,u.isDefined)(v)&&(this._updateTourData(),this._updateTitleTags(),this._updateSelectedFlight(),this._updateVisibleFlights(),this._updateTourCardFlights()),(0,u.isDefined)(s)&&this._tourCardActionControl.update({IsEnabledAddToCart:s}),(0,u.isDefined)(a)&&this._tourCardActionControl.update({IsEnabledContinue:a}),(0,u.isDefined)(l)&&this._updateViewMode(l),(0,u.isDefined)(y)&&this._updateVisibleTitle(y),(0,u.isDefined)(d)&&(this._hotelTitleControl.update({IsVisiblePreview:d}),this._tourCardOptionsControl.update({IsVisiblePreview:d}),this._tourCardFlightsControl.update({IsVisiblePreview:d}),this._tourCardActionControl.update({IsLoadingTour:d})),(0,u.isDefined)(h)&&this._tourCardFlightsControl.update({IsVisiblePreview:h}),(0,u.isDefined)(c)&&this._tourFlightSelectionList.update({IsVisibleWaiter:c}),(0,u.isDefined)(n)&&this._tourCardActionControl.update({IsVisibleWaiter:n}),((0,u.isDefined)(p)||(0,u.isDefined)(i)||(0,u.isDefined)(r))&&this._updateHotelTitle(i),(0,u.isDefined)(_)&&this._tourCardActionControl.update({IsVisibleAddToCart:_}),(0,u.isDefined)(f)&&this._setVisibleRequestButton(f),(0,u.isDefined)(g)&&this._tourCardActionControl.update({RedirectLink:g}),(0,u.isDefined)(o)&&this._tourCardActionControl.update({ContinueText:o}),(0,u.isDefined)(C)&&this._reset(),((0,u.isDefined)(v)||(0,u.isDefined)(d))&&this._updateVisibleWarning()},e.prototype._reset=function(){this._updateViewMode(!0),(0,u.hide)(this._tourFlightSelectionList)},e.prototype._onDetailFlightClicked=function(t){if(this._selectedFlight){var e=t.Direction,o=t.Event,i=null===o||void 0===o?void 0:o.target,r=this._TourData.regular,n=h.flightUtils.getDetailItems(this._selectedFlight,e,r);this._flightDetailDropPanel.update({Items:n,ParentNode:i}),this._flightDetailDropPanel.show()}},e.prototype._onFlightSelected=function(t){(0,u.hide)(this._tourFlightSelectionList);var e=t.Flight;this._selectedFlight=e,this._tourCardFlightsControl.update({FlightData:this._selectedFlight}),this._updateIncludePrices(),this.FlightSelected.fire(t)},e.prototype._onFlightSelectionClose=function(){(0,u.hide)(this._tourFlightSelectionList)},e.prototype._onMoreButtonFlightsClicked=function(){(0,u.show)(this._tourFlightSelectionList),this._updateTourCardFlights(),this.MoreFlightsClicked.fire()},e.prototype._onRequestButtonClick=function(){this.ActionContinueClicked.fire()},e.prototype._onRedirectLinkClick=function(){this.ActionRedirectLinkClicked.fire()},e.prototype._onShowRoom=function(t){this.ShowRoom.fire(t)},e.prototype._renderSwitcher=function(){this._switcher=new n.LayerSwitch({ViewLayerId:w.TourCardInfoViewMode.INFO});var t=this._nodes,e=t.infoBlockNode,o=t.noTourNode;this._switcher.add(e,w.TourCardInfoViewMode.INFO),this._switcher.add(o,w.TourCardInfoViewMode.NO_TOUR),this._updateViewMode(!0)},e.prototype._renderHotelTitle=function(){var t=this._nodes.titleNode;this._hotelTitleControl=new g.HotelTitleControl({ParentNode:t,TagBorderColor:""})},e.prototype._renderTourCardAction=function(){var t=this._nodes.rightBlockNode;this._tourCardActionControl=new C.TourCardActionControl({ParentNode:t,AddCartClicked:this._ActionAddCartClicked,ContinueClicked:new a.Delegate(this,this._onRequestButtonClick),RedirectLinkClicked:new a.Delegate(this,this._onRedirectLinkClick)})},e.prototype._renderTourCardFlights=function(){var t=this._nodes.tourCardFlightsNode;this._tourCardFlightsControl=new T.TourFlightsListControl({ParentNode:t,DetailClicked:new a.Delegate(this,this._onDetailFlightClicked),MoreButtonClicked:new a.Delegate(this,this._onMoreButtonFlightsClicked)}),this._tourFlightSelectionList=new m.TourFlightSelectionList({IsVisible:!1,ParentNode:t,Changed:new a.Delegate(this,this._onFlightSelected),CloseClicked:new a.Delegate(this,this._onFlightSelectionClose)}),this._flightDetailDropPanel=new y.FlightDetailDropPanel({ParentNode:this._DomNode})},e.prototype._renderTourCardOptions=function(){var t=this._nodes.tourCardOptionsNode;this._tourCardOptionsControl=new v.TourCardOptionsControl({Items:this._getTourOptionItems(),ParentNode:t})},e.prototype._setVisibleRequestButton=function(t){var e=this._nodes.requestButton;(0,u.setVisible)(e,t)},e.prototype._updateViewMode=function(t){var e=t?w.TourCardInfoViewMode.INFO:w.TourCardInfoViewMode.NO_TOUR;this._switcher.showById(e)},e.prototype._updateIncludePrices=function(){var t=p.tourUtils.getPrice(this._TourData,this._selectedFlight),e=p.tourUtils.getIncludePrices(this._TourData,this._selectedFlight);this._tourCardActionControl.update({IncludePrices:e,Price:t})},e.prototype._updateTourCardFlights=function(){var t=this._TourData.flights,e=h.flightUtils.getFlightSelectionCurrency(t),o=h.flightUtils.getFlightSelectionItems(t,this._selectedFlight),i=h.flightUtils.getTourDeparturePort(this._selectedFlight),r=h.flightUtils.getTourArrivalPort(this._selectedFlight);this._tourFlightSelectionList.update({Currency:e,Items:o,TourArrivalPort:r,TourDeparturePort:i})},e.prototype._updateSelectedFlight=function(){var t=this._TourData,e=t.flights,o=t.regular;this._selectedFlight=h.flightUtils.getDefaultSet(e),this._tourCardFlightsControl.update({FlightData:this._selectedFlight,IsVisibleMoreButton:h.flightUtils.isVisibleMoreExtraSets(e),Regular:o}),this._updateIncludePrices()},e.prototype._updateHotelTitle=function(t){var e=d.hotelUtils.getHotelTitleSettings(t),o=p.tourUtils.isCraftTour(this._TourData),i=o?_.craftTourUtils.getTourTypes(this._TourData):[];o&&(e.Accomodation=0),this._hotelTitleControl.update(r(r({},e),{InsertStarsInTitle:this._InsertStarsInTitle,IsTransformTitle:this._IsTransformTitle,Tags:i}))},e.prototype._updateTitleTags=function(){var t=p.tourUtils.isCraftTour(this._TourData),e=t?_.craftTourUtils.getTourTypes(this._TourData):[];this._hotelTitleControl.update({Tags:e})},e.prototype._updateTourData=function(){var t=this._nodes.warningMessageNode,e=this._TourData,o=e.price,i=e.warningmessage;this._tourCardOptionsControl.update({Items:this._getTourOptionItems()});var r=p.tourUtils.hasInstantConfirmation(this._TourData),n=p.tourUtils.getIncludePrices(this._TourData,this._selectedFlight),s=p.tourUtils.getPriceType(this._TourData),a=p.tourUtils.getCurrency(this._TourData);this._tourCardActionControl.update({Currency:a,IncludePrices:n,IsVisibleConfirmation:r,Price:o,PriceType:s}),t.innerHTML=(0,c.sanitizeHTML)(i)},e.prototype._getTourOptionItems=function(){var t=r({ShowRoom:new a.Delegate(this,this._onShowRoom)},this._TourData||{});return p.tourUtils.isCraftTour(this._TourData)?f.tourCardOptionUtils.getCraftTourOptions(t):f.tourCardOptionUtils.getOptions(t)},e.prototype._updateVisibleTitle=function(t){var e=this._nodes.titleNode;(0,u.setVisible)(e,t)},e.prototype._updateVisibleFlights=function(){var t=this._nodes.tourCardFlightsNode,e=p.tourUtils.isCraftTour(this._TourData),o=!e&&!p.tourUtils.isNoFlight(this._TourData);(0,u.setVisible)(t,o)},e.prototype._updateVisibleWarning=function(){var t=this._nodes.warningMessageNode,e=!this._IsLoadingTour&&p.tourUtils.hasWarningMessage(this._TourData);(0,u.setVisible)(t,e)},e}(s.Control);e.TourCardInfoControl=S,t.TourCardInfoControl=S}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.FlightDetailDropPanel=void 0;var r=o(129),n=o(9),s=o(1),a=o(8),l=o(482),u=function(t){function e(e){var o=t.call(this,e)||this;return o._Items=[],o._ParentNode=null,o._closeButton=null,o._flightDetailList=null,o._dropPanel=null,o.__initSettings(e),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._flightDetailList&&this._flightDetailList.update(e)},e.prototype.destroy=function(){(0,s.removeEvent)(this._closeButton,"click",this.hide),t.prototype.destroy.call(this)},e.prototype.show=function(){this._dropPanel||this._render(),this._dropPanel.show(),this._updatePosition(this._ParentNode)},e.prototype.hide=function(){this._dropPanel.hide()},e.prototype._render=function(){this._renderClose(),this._renderFlightDetailList(),this._renderDropPanel()},e.prototype._renderClose=function(){this._closeButton=(0,s.newDiv)(a.TV_CLOSE_POPUP),this.hide=this.hide.bind(this),(0,s.addEvent)(this._closeButton,"click",this.hide)},e.prototype._renderDropPanel=function(){this._dropPanel=new r.DropPanel({Class:"TVFlightDetailDropPanel",ParentNode:this._ParentNode}),this._dropPanel.addChild(this._closeButton),this._dropPanel.addChild(this._flightDetailList)},e.prototype._renderFlightDetailList=function(){this._flightDetailList=new l.FlightDetailListControl({Items:this._Items})},e.prototype._updatePosition=function(t){var e=(0,s.cumulativeOffset)(t),o=this._flightDetailList.getDomNode().offsetWidth,i=e.top-t.offsetHeight,r=e.left+t.offsetWidth-o+5;this._dropPanel.updatePosition(r,t.offsetWidth,i,t.offsetHeight,(0,s.getCoords)(t))},e}(n.Core);e.FlightDetailDropPanel=u,t.FlightDetailDropPanel=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.FlightDetailControl=void 0;var r=o(2),n=o(1),s=o(153),a=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="flight-detail",o._AirlineLogo="",o._AirlineName="",o._ArrivalCity="",o._ArrivalDate="",o._ArrivalPort="",o._ArrivalTime="",o._Baggage="",o._DepartureCity="",o._DepartureDate="",o._DeparturePort="",o._DepartureTime="",o._FlightNumber="",o._FlightDuration="",o._Type=s.FlightType.NONE,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateAirlineLogo(),this._updateVisibleFlightDuration()},e.prototype._updateAirlineLogo=function(){this._nodes.airlineLogoNode.style.backgroundImage=this._AirlineLogo?"url("+this._AirlineLogo+")":""},e.prototype._updateVisibleFlightDuration=function(){var t=this._nodes.flightDuration;(0,n.setVisible)(t,this._FlightDuration.length>0)},e}(r.Control);e.FlightDetailControl=a,t.FlightDetailControl=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardActionControl=void 0;var r=o(2),n=o(3),s=o(1),a=o(5),l=o(8),u=o(305),c=function(t){function e(e){var o=t.call(this,e)||this;return o.AddCartClicked=new n.UserEvent,o.ContinueClicked=new n.UserEvent,o.RedirectLinkClicked=new n.UserEvent,o.templateName="tour-card-action",o._ContinueText="",o._Currency=a.Currency.Rub,o._IncludePrices=[],o._IsEnabledAddToCart=!1,o._IsEnabledContinue=!1,o._IsLoadingTour=!1,o._IsVisibleAddToCart=!1,o._IsVisibleConfirmation=!1,o._IsVisibleWaiter=!1,o._Price=0,o._PriceType=a.PriceType.ForRoom,o._RedirectLink="",o._tourPriceControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderPriceBlock()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ContinueText,i=e.IsEnabledAddToCart,r=e.IsEnabledContinue,n=e.IsVisibleAddToCart,a=e.IsLoadingTour,l=e.RedirectLink;(0,s.isDefined)(l)&&this._updateContinueButtonLink(),(0,s.isDefined)(o)&&this._updateContinueButtonText(),(0,s.isDefined)(i)&&this._updateEnabledAddToCartButton(),(0,s.isDefined)(r)&&this._updateEnabledContinueButton(),(0,s.isDefined)(a)&&this._tourPriceControl.update({IsVisiblePreview:a}),((0,s.isDefined)(n)||(0,s.isDefined)(a))&&this._updateVisibleButtons(),this._tourPriceControl&&this._tourPriceControl.update(e)},e.prototype._onAddToCartBtnClick=function(){this._IsEnabledAddToCart&&this.AddCartClicked.fire()},e.prototype._onContinueBtnClick=function(t){if(this._RedirectLink.length>0)return void this.RedirectLinkClicked.fire();(0,s.preventDefault)(t),this.ContinueClicked.fire()},e.prototype._renderPriceBlock=function(){var t=this._nodes.priceBlock;this._tourPriceControl=new u.TourCardPriceControl({Currency:this._Currency,IncludePrices:this._IncludePrices,IsVisibleConfirmation:this._IsVisibleConfirmation,IsVisibleWaiter:this._IsVisibleWaiter,ParentNode:t,Price:this._Price,PriceType:this._PriceType})},e.prototype._updateContinueButtonLink=function(){this._nodes.continueBtn.href=this._RedirectLink||""},e.prototype._updateContinueButtonText=function(){this._nodes.continueBtn.textContent=this._ContinueText||""},e.prototype._updateEnabledAddToCartButton=function(){var t=this._nodes.addToCartBtn;(0,s.updateClass)(t,l.TV_DISABLED,!this._IsEnabledAddToCart)},e.prototype._updateEnabledContinueButton=function(){var t=this._nodes.continueBtn;(0,s.updateClass)(t,l.TV_DISABLED,!this._IsEnabledContinue)},e.prototype._updateVisibleButtons=function(){var t=this._nodes,e=t.addToCartBtn,o=t.continueBtn;(0,s.setVisible)(e,!this._IsLoadingTour&&this._IsVisibleAddToCart),(0,s.setVisible)(o,!this._IsLoadingTour)},e}(r.Control);e.TourCardActionControl=c,t.TourCardActionControl=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourIncludePriceControl=void 0;var r=o(2),n=o(1),s=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="tour-include-price",o._Currency="",o._Name="",o._Price=0,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateCurrency(),this._updatePrice()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Currency,i=e.Price;(0,n.isDefined)(i)&&this._updatePrice(),(0,n.isDefined)(o)&&this._updateCurrency()},e.prototype._updatePrice=function(){var t=this._nodes.priceNode;t.textContent=(0,n.getPrice)(this._Price),(0,n.setVisible)(t,Boolean(this._Price))},e.prototype._updateCurrency=function(){this._nodes.currencyNode.textContent=this._Currency},e}(r.Control);e.TourIncludePriceControl=s,t.TourIncludePriceControl=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardOptionControl=void 0;var r=o(2),n=o(3),s=o(1),a=o(12),l=o(481),u=o(304),c=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="tour-card-option",o.FooterClicked=new n.UserEvent,o.HeaderClicked=new n.UserEvent,o._Footer="",o._Header="",o._IconType=l.IconType.NONE,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){var o=this._IconType,i=e.IconType,r=e.Header,n=e.Footer;t.prototype.update.call(this,e),(0,s.isDefined)(i)&&this._updateIconClass(o),(0,s.isDefined)(r)&&this._updateHeader(),(0,s.isDefined)(n)&&this._updateFooter()},e.prototype.render=function(){t.prototype.render.call(this),this._updateHeader(),this._updateFooter(),this._updateIconClass()},e.prototype._updateHeader=function(){var t=this._nodes.headerNode,e=!!this._Header;(0,s.removeChildren)(t),(0,s.setVisible)(t,e),e&&(t.innerHTML=(0,a.sanitizeHTML)(this._Header))},e.prototype._updateFooter=function(){var t=this._nodes.footerNode,e=!!this._Footer;(0,s.removeChildren)(t),(0,s.setVisible)(t,e),e&&(t.innerHTML=(0,a.sanitizeHTML)(this._Footer))},e.prototype._updateIconClass=function(t){void 0===t&&(t=l.IconType.NONE);var e=u.tourCardOptionUtils.getClassByIconType(t),o=u.tourCardOptionUtils.getClassByIconType(this._IconType);(0,s.removeClass)(this._DomNode,e),(0,s.addClass)(this._DomNode,o)},e.prototype._onHeaderNodeClick=function(){this.HeaderClicked.fire()},e.prototype._onFooterNodeClick=function(){this.FooterClicked.fire()},e}(r.Control);e.TourCardOptionControl=c,t.TourCardOptionControl=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourFlightSelectionList=void 0;var r=o(2),n=o(3),s=o(1),a=o(484),l=function(t){function e(e){var o=t.call(this,e)||this;return o.CloseClicked=new n.UserEvent,o.templateName="tour-flight-selection",o._Items=[],o._Changed=null,o._flightSelectionList=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){this._Changed=null,t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this),this._flightSelectionList=new a.FlightSelectionList({Items:this._Items,ParentNode:this._DomNode,Changed:this._Changed}),this._updateEnableListScroll()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._flightSelectionList&&(this._flightSelectionList.update(e),this._updateEnableListScroll())},e.prototype._onCloseClick=function(){this.CloseClicked.fire()},e.prototype._updateEnableListScroll=function(){var t=this._flightSelectionList.getDomNode();(0,s.removeClass)(t,"TVScrollEnabled");var e=(0,s.hasVerticalScroll)(t);(0,s.updateClass)(t,"TVScrollEnabled",e)},e}(r.Control);e.TourFlightSelectionList=l,t.TourFlightSelectionList=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.FlightSelectionControl=void 0;var n=o(93),s=o(2),a=o(3),l=o(1),u=o(5),c=o(6),h=o(926),d=function(t){function e(e){var o=t.call(this,e)||this;return o.Selected=new a.UserEvent,o._Airlines=[],o._ChangedPrice=0,o._Currency=u.Currency.Rub,o._FlightSetData=null,o._ForwardData=null,o._IsDummyFlight=!1,o._ModeView=u.ModeView.DescTop,o._ReverseData=null,o._airlineHints=[],o._forwardInfo=null,o._reversedInfo=null,o.__initSettings(e),o.templateName=o._ModeView===u.ModeView.Mobile?"mobile-flight-selection":"flight-selection",o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){this._FlightSetData=null,t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this),this._renderForward(),this._renderReversed(),this._renderAirlines(),this._updateSelectionButton()},e.prototype._renderForward=function(){var t=this._nodes.forward;if(this._IsDummyFlight)return t.textContent="Любой рейс",void(0,l.addClass)(t,"TVAnyFlight");this._ForwardData&&(this._forwardInfo=new h.FlightInfoControl(r(r({},this._ForwardData),{ModeView:this._ModeView,ParentNode:t})))},e.prototype._renderReversed=function(){if(!this._IsDummyFlight||this._ModeView!==u.ModeView.Mobile){var t=this._nodes.reversed;if(this._IsDummyFlight)return t.textContent="Любой рейс",void(0,l.addClass)(t,"TVAnyFlight");this._ReverseData&&(this._reversedInfo=new h.FlightInfoControl(r(r({},this._ReverseData),{ModeView:this._ModeView,ParentNode:t})))}},e.prototype._renderAirlines=function(){if(!this._IsDummyFlight&&(0,c.isNotEmptyArray)(this._Airlines)){var t=this._nodes.airlinesNode;this._airlineHints=this._Airlines.map(function(e){var o=e.Logo,i=e.Name,r=(0,l.newDiv)("TVAirline",t);return r.style.backgroundImage="url("+o+")",new n.Hint({Anchor:r,Content:i,Position:n.HintPosition.TOP})})}},e.prototype._updateSelectionButton=function(){var t=this._nodes.selectionButton;if((0,l.updateClass)(t,"TVPriceIncrease",this._ChangedPrice>0),(0,l.updateClass)(t,"TVPriceReduction",this._ChangedPrice<0),(0,l.updateClass)(t,"TVSelectionButton",0===this._ChangedPrice),this._ChangedPrice&&0!==this._ChangedPrice){var e=(0,l.getPrice)(Math.abs(this._ChangedPrice)),o=(0,c.getCurrencyValue)(this._Currency);t.textContent=e+" "+o}},e.prototype._onSelectionButtonClick=function(){this.Selected.fire({Flight:this._FlightSetData})},e}(s.Control);e.FlightSelectionControl=d,t.FlightSelectionControl=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.FlightInfoControl=void 0;var r=o(2),n=o(1),s=o(5),a=function(t){function e(e){var o=t.call(this,e)||this;return o._Connections=[],o._Duration="",o._ModeView=s.ModeView.DescTop,o._Text="",o._Time="",o.__initSettings(e),o.templateName=o._ModeView===s.ModeView.Mobile?"mobile-flight-info":"flight-info",o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateConnections(),this._updateVisibleDuration()},e.prototype._updateConnections=function(){var t=this._nodes,e=t.connectionBlock,o=t.connectionInfo;(0,n.removeClass)(e,"TVDirectFlight","TVOneConnection","TVConnections");var i=this._Connections.length||0;switch(i){case 0:(0,n.addClass)(e,"TVDirectFlight");break;case 1:(0,n.addClass)(e,"TVOneConnection"),o.textContent=this._Connections[0];break;default:(0,n.addClass)(e,"TVConnections"),o.textContent=i}},e.prototype._updateVisibleDuration=function(){(0,n.setVisible)(this._nodes.duration,Boolean(this._Duration))},e}(r.Control);e.FlightInfoControl=a,t.FlightInfoControl=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourFlightControl=void 0;var r=o(2),n=o(3),s=o(1),a=o(5),l=o(153),u=function(t){function e(e){var o=t.call(this,e)||this;return o.DetailClicked=new n.UserEvent,o._Airlines=[],o._ArrivalCity="",o._ArrivalDate="",o._ArrivalPortId="",o._ArrivalTime="",o._Connections=[],o._DepartureCity="",o._DepartureDate="",o._DeparturePortId="",o._DepartureTime="",o._FlightDuration="",o._Type=l.FlightType.NONE,o._ModeView=a.ModeView.DescTop,o.__initSettings(e),o.templateName=o._ModeView===a.ModeView.Mobile?"mobile-tour-flight":"tour-flight",o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateContent()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._updateContent()},e.prototype._onDetailButtonClick=function(t){this.DetailClicked.fire({Event:t})},e.prototype._updateContent=function(){this._updateConnection(),this._updateAirlines(),this._updatePortNames(),this._updateVisibleFlightDuration()},e.prototype._updateConnection=function(){var t=this._nodes,e=t.connection,o=t.connectionBlock;(0,s.isDefined)(o)&&(0,s.updateClass)(o,"TVNonstop",0===this._Connections.length),(0,s.isDefined)(e)&&(e.textContent=this._Connections.join(", "))},e.prototype._updateAirlines=function(){this._updateAirlinesNode(),this._updateAirlineNode(),this._updateAirlineName()},e.prototype._updateAirlinesNode=function(){var t=this._nodes.airlinesNode;(0,s.isDefined)(t)&&((0,s.removeChildren)(t),this._Airlines.forEach(function(e){var o=e.Logo;(0,s.newDiv)("TVTourAirline",t).style.backgroundImage=o.length>0?"url("+o+")":""}))},e.prototype._updateAirlineNode=function(){var t=this._nodes.airlineNode;if((0,s.isDefined)(t)){var e=this._Airlines.length;(0,s.setVisible)(t,e>0),(0,s.updateClass)(t,"TVOneAirline",1===e);var o=1===e&&this._Airlines[0]&&this._Airlines[0].Logo;t.style.backgroundImage=o?"url("+o+")":""}},e.prototype._updateAirlineName=function(){var t=this._nodes.airlineName;if((0,s.isDefined)(t)){var e=this._Airlines.length;switch((0,s.setVisible)(t,e>0),(0,s.updateClass)(t,"TVOneAirline",1===e),e){case 0:t.textContent="";break;case 1:t.textContent=this._Airlines[0]&&this._Airlines[0].Name||"";break;default:t.textContent=e.toString()}}},e.prototype._updatePortNames=function(){var t=this._nodes.portNamesNode;t&&(t.textContent=this._DepartureCity+" - "+this._ArrivalCity)},e.prototype._updateVisibleFlightDuration=function(){var t=this._nodes.flightDuration;(0,s.setVisible)(t,this._FlightDuration.length>0)},e}(r.Control);e.TourFlightControl=u,t.TourFlightControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardInfoViewMode=void 0;var o;!function(t){t[t.INFO=0]="INFO",t[t.NO_TOUR=1]="NO_TOUR"}(o=e.TourCardInfoViewMode||(e.TourCardInfoViewMode={})),t.TourCardInfoViewMode=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardOrderFactory=void 0;var r=o(9),n=o(930),s=o(933),a=o(947),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getAgencyOrder=function(t){return new n.AgencyOrderControl(t)},e.prototype.getCustomerOrder=function(t){return new s.CustomerOrderControl(t)},e.prototype.getManagerOrder=function(t){return new a.ManagerOrderControl(t)},e}(r.Core);e.TourCardOrderFactory=l,t.TourCardOrderFactory=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.AgencyOrderControl=void 0;var n=o(44),s=o(2),a=o(4),l=o(3),u=o(1),c=o(5),h=o(110),d=o(170),p=o(112),_=o(235),f=o(306),y=o(486),g=o(72),C=o(487),v=o(488),m=o(489),T=function(t){function e(e){var o=t.call(this,e)||this;return o.ActionClicked=new l.UserEvent,o.BackClicked=new l.UserEvent,o.SendRequest=new l.UserEvent,o.templateName="agency-order",o._AgencyItems=[],o._AgencyView=y.AgencyOrderViewMode.ACTIONS,o._IsActualizing=!1,o._IsVisibleBackButton=!0,o._IsVisibleWhereBuyOnline=!1,o._ShortTourId=0,o._TourEnable=!0,o._TourId=0,o._agencyActionsControl=null,o._switcher=null,o._requestControl=null,o._tourBuyFromAgencyControl=null,o._tourBuyFromAgencyOfficeControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderSwitcher(),this._renderManagerActions(),this._renderBuyFromAgency(),this._renderBuyFromAgencyOffice(),this._renderRequest(),this._showByAgencyView(y.AgencyOrderViewMode.ACTIONS),this._updateAgencyActions(),this._updateBackButtonVisibility(),this._updateBackButtonContent()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsActualizing,i=e.AgencyItems,r=e.AgencyView,n=e.IsVisibleBackButton,s=e.IsVisibleWhereBuyOnline,a=e.ShortTourId,l=e.TourId;(0,u.isDefined)(o)&&this._updateAgencyActions(),(0,u.isDefined)(i)&&this._tourBuyFromAgencyControl.update({Items:this._AgencyItems}),(0,u.isDefined)(a)&&(this._tourBuyFromAgencyControl.update({ShortTourId:this._ShortTourId}),this._tourBuyFromAgencyOfficeControl.update({ShortTourId:this._ShortTourId})),(0,u.isDefined)(r)&&this._showByAgencyView(r),(0,u.isDefined)(n)&&(this._updateBackButtonVisibility(),this._updateBackButtonContent()),(0,u.isDefined)(l)&&this._requestControl.update({PromocodeTourId:this._TourId}),(0,u.isDefined)(s)&&(this._updateAgencyActions(),this._updateBackButtonVisibility(),this._updateBackButtonContent())},e.prototype._renderManagerActions=function(){var t=this._nodes.contentNode;this._agencyActionsControl=new C.AgencyOrderActionsControl({Actions:this._getActions(),ParentNode:t,Clicked:new a.Delegate(this,this._onActionClicked)});var e=this._agencyActionsControl.getDomNode();this._switcher.add(e,y.AgencyOrderViewMode.ACTIONS)},e.prototype._renderBuyFromAgency=function(){var t=this._nodes.contentNode;this._tourBuyFromAgencyControl=new m.TourBuyFromAgencyControl({Items:this._AgencyItems,ParentNode:t,ShortTourId:this._ShortTourId,ActionClicked:new a.Delegate(this,this._onTourBuyActionClicked)});var e=this._tourBuyFromAgencyControl.getDomNode();this._switcher.add(e,y.AgencyOrderViewMode.BUY_ONLINE)},e.prototype._renderBuyFromAgencyOffice=function(){var t=this._nodes.contentNode;this._tourBuyFromAgencyOfficeControl=new v.TourBuyFromAgencyOfficeControl({ParentNode:t,Render:!1,ShortTourId:this._ShortTourId})},e.prototype._renderRequest=function(){var t=this._nodes.contentNode;this._requestControl=(0,d.newRequestControl)({ParentNode:t,PromocodeTourId:this._TourId,Render:!1,Send:new a.Delegate(this,this._onSendRequest)})},e.prototype._renderSwitcher=function(){this._switcher=new n.LayerSwitch},e.prototype._showByAgencyView=function(t){switch(this._AgencyView=t,this._AgencyView){case y.AgencyOrderViewMode.BUY_ONLINE:this._scrollIntoView();break;case y.AgencyOrderViewMode.BUY_ONLINE_OFFICE:this._tourBuyFromAgencyOfficeControl.show();var e=this._tourBuyFromAgencyOfficeControl.getDomNode();this._switcher.add(e,y.AgencyOrderViewMode.BUY_ONLINE_OFFICE),this._scrollIntoView();break;case y.AgencyOrderViewMode.REQUEST:this._requestControl.show();var o=this._requestControl.getDomNode();this._switcher.add(o,y.AgencyOrderViewMode.REQUEST),this._scrollIntoView()}this._switcher.showById(this._AgencyView),this._updateBackButtonContent()},e.prototype._onActionClicked=function(t){switch(t.Action){case f.AgencyOrderAction.BUY_ONLINE:this._showByAgencyView(y.AgencyOrderViewMode.BUY_ONLINE);break;case f.AgencyOrderAction.REQUEST:this._showByAgencyView(y.AgencyOrderViewMode.REQUEST)}this.ActionClicked.fire(t)},e.prototype._onTourBuyActionClicked=function(t){var e=t.Action,o=t.Event;switch(e){case _.OnlinePartnerActionEnum.REDIRECT:h.analiticManager.reachGoal(c.Metrica.TOURREDIRECT);break;case _.OnlinePartnerActionEnum.MAP:(0,u.preventDefault)(o),this._showByAgencyView(y.AgencyOrderViewMode.BUY_ONLINE_OFFICE)}},e.prototype._onBackNodeClick=function(){if(this._isNoActionView())return void this._showByAgencyView(y.AgencyOrderViewMode.ACTIONS);this.BackClicked.fire()},e.prototype._onSendRequest=function(t){this.SendRequest.fire(r(r({},t),{Type:g.RequestType.SimpleRequest}))},e.prototype._updateBackButtonVisibility=function(){var t=this._nodes.backNode;(0,u.setVisible)(t,this._IsVisibleBackButton)},e.prototype._updateBackButtonContent=function(){var t=this._isNoActionView();(0,u.updateClass)(this._DomNode,"TVNoActionsView",t)},e.prototype._updateAgencyActions=function(){var t=this._getActions();this._agencyActionsControl.update({Actions:t})},e.prototype._isNoActionView=function(){var t=this._getActions();return this._AgencyView!==y.AgencyOrderViewMode.ACTIONS&&t.length>1},e.prototype._getActions=function(){var t=[];return this._IsVisibleWhereBuyOnline&&this._TourEnable&&t.push({Action:f.AgencyOrderAction.BUY_ONLINE,IsEnabled:!this._IsActualizing}),t.push({Action:f.AgencyOrderAction.REQUEST,IsEnabled:!0}),t},e.prototype._scrollIntoView=function(){(0,p.animateScroll)(null,this._DomNode)},e}(s.Control);e.AgencyOrderControl=T,t.AgencyOrderControl=T}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TourBuyFromAgencyGroup=void 0;var n=o(2),s=o(1),a=o(12),l=o(932),u=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVTourBuyFromAgencyGroup",o._Title="",o._Subtitle="",o._Items=[],o._itemsHash=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderHeader(),this._renderBody()},e.prototype.destroy=function(){this._clear(),t.prototype.destroy.call(this)},e.prototype._clear=function(){this._itemsHash.forEach(function(t){return t.destroy()}),this._itemsHash=[]},e.prototype._renderHeader=function(){if(this._Title||this._Subtitle){var t=(0,s.newDiv)("TVTourBuyFromAgencyGroupHeader",this._DomNode);if(this._Title){(0,s.newDiv)("TVTourBuyFromAgencyGroupTitle",t).innerHTML=(0,a.sanitizeHTML)(this._Title)}if(this._Subtitle){(0,s.newDiv)("TVTourBuyFromAgencyGroupSubtitle",t).innerHTML=(0,a.sanitizeHTML)(this._Subtitle)}}},e.prototype._renderBody=function(){if(0!==this._Items.length){var t=(0,s.newDiv)("TVTourBuyFromAgencyGroupBody",this._DomNode);this._itemsHash=this._Items.filter(function(t){return Boolean(t.Link)}).map(function(e){return new l.TourBuyFromAgencyItem(r(r({},e),{ParentNode:t}))})}},e}(n.Control);e.TourBuyFromAgencyGroup=u,t.TourBuyFromAgencyGroup=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourBuyFromAgencyItem=void 0;var r=o(2),n=o(3),s=o(1),a=o(235),l=o(16),u=o(12),c=o(15),h=o(8),d=function(t){function e(e){var o=t.call(this,e)||this;return o.ActionClicked=new n.UserEvent,o._Class="TVTourBuyFromAgencyItem",o._Action=null,o._Detail="",o._Link="",o._Logo="",o._Name="",o._PaddingSize=l.SizeEnum.M,o._linkNode=null,o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderLogo(),this._renderDetail(),this._renderLink(),this._addPaddingSizeClass()},e.prototype.destroy=function(){(0,s.removeEvent)(this._linkNode,"click",this._onActionClicked),t.prototype.destroy.call(this)},e.prototype._init=function(){this._onActionClicked=this._onActionClicked.bind(this)},e.prototype._renderLogo=function(){var t=(0,s.newDiv)("TVTourBuyFromAgencyItemLogo",this._DomNode);if(!this._Logo)return void(t.innerHTML=this._Name?(0,u.sanitizeHTML)(this._Name):"");t.style.backgroundImage="url("+this._Logo+")"},e.prototype._renderDetail=function(){(0,s.newDiv)("TVTourBuyFromAgencyItemDetail",this._DomNode).innerHTML=this._Detail?(0,u.sanitizeHTML)(this._Detail):""},e.prototype._renderLink=function(){this._linkNode=(0,s.newLinkNode)((0,s.classNames)("TVTourBuyFromAgencyItemLink",h.TV_BUTTON_HOVER),this._DomNode),this._linkNode.textContent=this._getActionText(),this._linkNode.href=this._Link||"",(0,s.addEvent)(this._linkNode,"click",this._onActionClicked)},e.prototype._addPaddingSizeClass=function(){var t=c.styleUtils.getClassByPaddingSize(this._PaddingSize);(0,s.addClass)(this._DomNode,t)},e.prototype._getActionText=function(){return this._Action===a.OnlinePartnerActionEnum.MAP?"Открыть карту":"Перейти на сайт"},e.prototype._onActionClicked=function(t){this.ActionClicked.fire({Action:this._Action,Event:t})},e}(r.Control);e.TourBuyFromAgencyItem=d,t.TourBuyFromAgencyItem=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CustomerOrderControl=void 0;var n=o(44),s=o(2),a=o(4),l=o(3),u=o(1),c=o(5),h=o(6),d=o(170),p=o(32),_=o(308),f=o(72),y=o(236),g=o(946),C=function(t){function e(e){var o=t.call(this,e)||this;return o.BackClicked=new l.UserEvent,o.SendRequest=new l.UserEvent,o.templateName="customer-order",o._Class="TVCustomerOrderControl",o._ClientData=null,o._CustomerView=_.CustomerOrderViewMode.REQUEST,o._IsActualizing=!1,o._IsVisibleBackButton=!0,o._IsEnabledMultiOffice=!0,o._IsVisibleBuyInCredit=!1,o._IsVisibleBuyOnline=!1,o._IsVisibleRequest=!1,o._SelectedFlight=null,o._TourEnable=!0,o._TourId=0,o._ContractClicked=null,o._switcher=null,o._orderTabs=null,o._tourBookingControl=null,o._tourBuyForm=null,o._tourBuyInCreditForm=null,o._requestControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderRequest(),this._renderBuy(),this._renderOrderLaySwitcher(),this._renderTabs(),this._updateTabsVisibility(),this._updateBackButtonVisibility()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.CustomerView,i=e.TourEnable,r=this._nodes.requestNode;(0,u.isDefined)(i)&&(0,u.updateClass)(r,"TVRequestFree",!this._TourEnable),(0,u.isDefined)(o)&&(this._selectTab({Id:this._CustomerView}),this._orderTabs&&this._orderTabs.update({ActiveTab:this._CustomerView})),this._updateTourBuyBySettings(e),this._updateTourRequestBySettings(e),this._updateBackButtonVisibility(),this._updateTabsVisibility()},e.prototype.destroy=function(){this._ContractClicked=null,this._ClientData=null,this._SelectedFlight=null,t.prototype.destroy.call(this)},e.prototype._onBackNodeClick=function(){this.BackClicked.fire()},e.prototype._updateTabsVisibility=function(){var t=this._nodes.tabs,e=[this._IsVisibleBuyOnline,this._IsVisibleBuyInCredit,this._IsVisibleRequest],o=e.filter(function(t){return t}).length>1;(0,u.setVisible)(t,this._TourEnable&&o),this._orderTabs.update({IsVisibleBuyInCredit:this._IsVisibleBuyInCredit,IsVisibleBuyOnline:this._IsVisibleBuyOnline,IsVisibleRequest:this._IsVisibleRequest})},e.prototype._renderTabs=function(){var t=this._nodes.tabs;this._orderTabs||(this._orderTabs=new g.TourCardOrderTabsControl({ParentNode:t,TabChanged:new a.Delegate(this,this._selectTab)}))},e.prototype._renderRequest=function(){var t=this._nodes.requestNode;this._requestControl=(0,d.newRequestControl)({ParentNode:t,PromocodeTourId:this._TourId,Render:!1,Send:new a.Delegate(this,this._sendRequest,{Type:f.RequestType.SimpleRequest})})},e.prototype._renderBuy=function(){var t=this._nodes,e=t.buyOnlineNode,o=t.buyInCreditNode,i={CrmName:c.ExportCrmName.NONE,TourId:this._TourId,ContractClicked:this._ContractClicked};this._tourBuyForm=new y.TourBuyControl(r(r({},i),{ParentNode:e,SendingClicked:new a.Delegate(this,this._sendRequest,{Type:f.RequestType.OnlineRequest})})),this._tourBuyInCreditForm=new y.TourBuyControl(r(r({},i),{PaymentTypesEnabled:!1,ParentNode:o,SendingClicked:new a.Delegate(this,this._sendRequest,{Type:f.RequestType.CreditRequest})}))},e.prototype._renderOrderLaySwitcher=function(){var t=this._nodes,e=t.buyOnlineNode,o=t.requestNode,i=t.buyInCreditNode;this._switcher=new n.LayerSwitch({ParentNode:this._DomNode,ViewLayerId:_.CustomerOrderViewMode.REQUEST}),this._switcher.add(e,_.CustomerOrderViewMode.BUYONLINE),this._switcher.add(o,_.CustomerOrderViewMode.REQUEST),this._switcher.add(i,_.CustomerOrderViewMode.BUYINCREDIT)},e.prototype._selectTab=function(t){var e=t.Id;switch(this._switcher.showById(e),e){case _.CustomerOrderViewMode.REQUEST:this._requestControl.show();break;case _.CustomerOrderViewMode.BUYONLINE:this._tourBuyForm.update({IsForceUpdate:!0});break;case _.CustomerOrderViewMode.BUYINCREDIT:this._tourBuyInCreditForm.update({IsForceUpdate:!0})}},e.prototype._updateTourBuyBySettings=function(t){var e=t.ClientData,o=t.IsActualizing,i=t.TourId,n=t.TourBuyData;if((0,u.isDefined)(i)&&(this._tourBuyForm.update({TourId:this._TourId}),this._tourBuyInCreditForm.update({TourId:this._TourId})),(0,u.isDefined)(e)){var s=p.clientUtils.getPromocodeEnabled(e);this._tourBuyForm.update({PromocodeEnabled:s}),this._tourBuyInCreditForm.update({PromocodeEnabled:s})}if((0,u.isDefined)(n)){var a=r({},n);this._tourBuyForm.update(a),this._tourBuyInCreditForm.update(a)}(0,u.isDefined)(o)&&(this._tourBuyForm.update({IsEnabledBuy:!this._IsActualizing,IsVisiblePriceWaiter:this._IsActualizing}),this._tourBuyInCreditForm.update({IsEnabledBuy:!this._IsActualizing,IsVisiblePriceWaiter:this._IsActualizing}))},e.prototype._updateTourRequestBySettings=function(t){var e=t.ClientData,o=t.IsEnabledMultiOffice,i=t.TourBuyData,r=t.TourId,n={};if((0,u.isDefined)(r)&&(n.PromocodeTourId=this._TourId),(0,u.isDefined)(e)){var s=p.clientUtils.getPromocodeEnabled(e);n.IsEnabledPromocode=s}(0,u.isDefined)(null===i||void 0===i?void 0:i.Price)&&(n.PromocodeTourPrice=null===i||void 0===i?void 0:i.Price),(0,u.isDefined)(o)&&(n.IsEnabledMultiOffice=o),(0,h.isNotEmptyObject)(n)&&this._requestControl.update(n)},e.prototype._updateBackButtonVisibility=function(){var t=this._nodes.backNode;(0,u.setVisible)(t,this._IsVisibleBackButton&&this._TourEnable)},e.prototype._sendRequest=function(t){this.SendRequest.fire(t)},e}(s.Control);e.CustomerOrderControl=C,t.CustomerOrderControl=C}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.userUtils=void 0;var i=o(6),r=function(){function t(){}return t.prototype.getOrderUserData=function(t,e,o){if(void 0===e&&(e=""),void 0===o&&(o=0),!t||(0,i.isEmptyObject)(t))return{};var r=t.ADDRESS,n=t.Comment,s=void 0===n?"":n,a=t.EMAIL,l=t.NAME,u=t.PHONE;return{Comment:s,PromoCode:e,PromoDiscount:o,UserAddress:r,UserEmail:a.replace(/ /g,""),UserName:l,UserPhone:u}},t}();e.userUtils=new r,t.userUtils=e.userUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.visaUtils=void 0;var i=o(1),r=function(){function t(){}return t.prototype.getTouristsVisaCharge=function(t,e){var o=t||{},r=o.adults,n=void 0===r?0:r,s=o.child,a=void 0===s?0:s,l=o.visacharge;return(void 0===l?0:l)*(n+a-e.reduce(function(t,e){var o=e.Visa;return!(0,i.isDefined)(o)||Boolean(o)?t:t+1},0))},t}();e.visaUtils=new r,t.visaUtils=e.visaUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.Promocode=void 0;var r=o(228),n=o(2),s=o(4),a=o(3),l=o(1),u=o(937),c=o(12),h=o(8),d=o(85),p="Ввести промокод",_=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="promocode",o.Changed=new a.UserEvent,o._Discount=0,o._PromoCode="",o._Placeholder=p,o._TourId=0,o._TourPrice=0,o._input=null,o._checkBtn=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderInput(),this._renderCheckBtn()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.PromoCode;(0,l.isDefined)(o)&&this._input.update({Value:this._PromoCode}),this._reset()},e.prototype._renderInput=function(){var t=this._nodes.inputContainer;this._input=new r.InputPro({CheckValid:!1,IsAnimateFixedLabel:!0,Label:this._Placeholder,ParentNode:t,Value:this._PromoCode,Blur:new s.Delegate(this,this._onBlurInput)})},e.prototype._renderCheckBtn=function(){var t=this._nodes.inputContainer;this._checkBtn=new d.ButtonWaiter({Class:"TVPromoCheck",ParentNode:t,Click:new s.Delegate(this,this._onCheckClicked)})},e.prototype._onBlurInput=function(t){var e=t.Value;this._PromoCode=e},e.prototype._onCheckClicked=function(){if(0===this._PromoCode.length)return void this._input.select();(0,l.addClass)(this._DomNode,h.TV_DISABLED),this._checkBtn.update({WaiterVisible:!0});var t=this._getUri();u.promocodeService.send(t,new s.Delegate(this,this._onPromoResponse))},e.prototype._getUri=function(){var t="&promocode="+encodeURIComponent(this._PromoCode);return this._TourId&&(t+="&tourid="+this._TourId),this._TourPrice&&(t+="&price="+this._TourPrice),t},e.prototype._onPromoResponse=function(t){(0,l.removeClass)(this._DomNode,h.TV_DISABLED),this._checkBtn.update({WaiterVisible:!1});var e=this._nodes.message,o=(0,l.getProperty)(t,"data");if(o.success){(0,l.addClass)(this._DomNode,h.TV_ACCEPTED);var i=(0,l.isDefined)(o.message);return e.innerHTML=i?(0,c.sanitizeHTML)(o.message):"",(0,l.setVisible)(e,i),(0,l.updateClass)(e,"TVMessageInformation",i),this._Discount=o.discount?o.discount:0,void this._onChanged()}var r=(0,l.isDefined)(o.errormessage);e.innerHTML=r?(0,c.sanitizeHTML)(o.errormessage):"",(0,l.updateClass)(e,"TVMessageError",r),(0,l.setVisible)(e,r),this._Discount=0},e.prototype._onChanged=function(){var t={Discount:this._Discount,PromoCode:this._PromoCode};this.Changed.fire(t)},e.prototype._reset=function(){var t=this._nodes.message;(0,l.hide)(t),(0,l.removeClass)(this._DomNode,h.TV_ACCEPTED),(0,l.removeClass)(this._DomNode,h.TV_DISABLED)},e}(n.Control);e.Promocode=_,t.Promocode=_}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.promocodeService=void 0;var i=o(48),r=o(30),n=function(){function t(){this.url=r.CoreLinks.PromoCode}return t.prototype.send=function(t,e){i.jsonp.update({Url:this.url}),i.jsonp.send(t,e)},t}();e.promocodeService=new n,t.promocodeService=e.promocodeService}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourBuyActionFactory=void 0;var r=o(9),n=o(491),s=o(942),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getCustomer=function(t){return new n.TourBuyCustomerButtonsControl(t)},e.prototype.getManager=function(t){return new s.TourBuyManagerButtonsControl(t)},e}(r.Core);e.TourBuyActionFactory=a,t.TourBuyActionFactory=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.PrePaymentControl=void 0;var n=o(187),s=o(2),a=o(4),l=o(3),u=o(1),c=o(5),h=o(940),d=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="pre-payment",o.Changed=new l.UserEvent,o._Class="TVPrePaymentControl",o._Currency="",o._PriceValue=0,o._PaymentTypes=[],o._payTypesHash=[],o._selectedPayType=c.PayType.Full,t.prototype.__initSettings.call(o,e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderPayTypes()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Currency,i=e.PaymentTypes,r=e.PriceValue;(0,u.isDefined)(i)&&(this._clearPaymentTypes(),this._renderPayTypes()),((0,u.isDefined)(r)||(0,u.isDefined)(o))&&this._prepayControl&&this._prepayControl.update({Currency:this._Currency,PriceValue:this._PriceValue})},e.prototype._renderPayTypes=function(){var t=this,o=""+e.RADIO_ATTRIBUTE_NAME+(0,u.getRandomHash)();this._payTypesHash=this._PaymentTypes.map(function(e,i){return new n.InputRadio({Color:c.Color.BLUE400,Id:e.id,Content:e.name,ParentNode:t._nodes.radioNodes,Data:r({},e),AttributeName:o,IsChecked:0===i,Changed:new a.Delegate(t,t._onPaymentTypeChanged)})})},e.prototype._clearPaymentTypes=function(){this._payTypesHash.forEach(function(t){t.destroy()}),this._payTypesHash=[],this._prepayControl&&this._prepayControl.hide(),this._selectedPayType=c.PayType.Full},e.prototype._onPaymentTypeChanged=function(t){var e=t.Selected;this._selectedPayType=e.id,(0,u.isDefined)(e.prepay)?(this._prepayControl=this._prepayControl||new h.Prepay({ParentNode:this._nodes.prepayNode,Changed:new a.Delegate(this,this._onPrepayValueChanged)}),this._prepayControl.update({Currency:this._Currency,PriceValue:this._PriceValue,Discount:e.prepay}),this._prepayControl.show()):(this._prepayControl&&this._prepayControl.hide(),this.Changed.fire({PrepayValue:this._PriceValue,SelectedPayType:this._selectedPayType}))},e.prototype._onPrepayValueChanged=function(t){var e=t.PrepayValue;this.Changed.fire({PrepayValue:e,SelectedPayType:this._selectedPayType})},e.RADIO_ATTRIBUTE_NAME="tvPayType",e}(s.Control);e.PrePaymentControl=d,t.PrePaymentControl=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.Prepay=void 0;var r=o(2),n=o(3),s=o(1),a=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="prepay",o.Changed=new n.UserEvent,o._Currency="",o._Discount=0,o._PriceValue=0,t.prototype.__initSettings.call(o,e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._addEvents()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Currency,i=e.PriceValue;(0,s.isDefined)(i)&&this._updatePrice(),(0,s.isDefined)(o)&&this._updateCurrency()},e.prototype.destroy=function(){this._removeEvents(),t.prototype.destroy.call(this)},e.prototype._init=function(){this._onInputPrice=this._onInputPrice.bind(this),this._onBlur=this._onBlur.bind(this)},e.prototype._addEvents=function(){var t=this._nodes.prepay;(0,s.addEvent)(t,"blur",this._onBlur),(0,s.addEvent)(t,"input",this._onInputPrice)},e.prototype._removeEvents=function(){var t=this._nodes.prepay;(0,s.removeEvent)(t,"blur",this._onBlur),(0,s.removeEvent)(t,"input",this._onInputPrice)},e.prototype._onBlur=function(){var t=this._nodes.prepay,e=this._getCorrectValue(t.value);t.value=(0,s.getPrice)(e),this.Changed.fire({PrepayValue:e})},e.prototype._onInputPrice=function(){var t=this._nodes.prepay,e=this._getIntValue(t.value);t.value=e?(0,s.getPrice)(e):0},e.prototype._updatePrice=function(){var t=this._nodes.prepay,e=this._getCorrectValue(t.value);t.value=(0,s.getPrice)(e),this.Changed.fire({PrepayValue:e})},e.prototype._updateCurrency=function(){this._nodes.title.textContent=this._Currency},e.prototype._getCorrectValue=function(t){var e=this._getIntValue(t),o=this._getMinPrice(this._PriceValue,this._Discount),i=Math.max(o,e);return i=Math.min(i,this._PriceValue)},e.prototype._getIntValue=function(t){return t=(0,s.replaceAll)(" ","",t),Number.parseInt(t,10)||0},e.prototype._getMinPrice=function(t,e){return Math.ceil(t*e/100)},e}(r.Control);e.Prepay=a,t.Prepay=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourBuySendingControl=void 0;var r=o(29),n=o(133),s=o(2),a=o(4),l=o(3),u=o(1),c=o(5),h=o(8),d=o(85),p=function(t){function e(e){var o=t.call(this,e)||this;return o.AgreeChecked=new l.UserEvent,o.BuyClicked=new l.UserEvent,o.ContractClicked=new l.UserEvent,o.templateName="tour-buy-sending",o._Class="TVTourBuySendingControl",o._IsCheckedAgree=!1,o._IsEnableBuy=!1,o._IsValidAgree=!0,o._ModeView=c.ModeView.DescTop,o._buyButton=null,t.prototype.__initSettings.call(o,e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._isMobile(),o=this._nodes,i=o.agreementNode,s=o.agreementMobileNode,l=o.agreementTextNode,u=o.sendingBlock;this._agreeCheckbox=new r.CheckBox({IsChecked:this._IsCheckedAgree,IsValid:this._IsValidAgree,ParentNode:i,Checked:new a.Delegate(this,this._onAgreeChanged)}),this._agreement=new n.AgreementControl({IsMobile:e,ParentNode:e?s:l}),this._buyButton=new d.ButtonWaiter({Class:"TVSendingBuyButton "+h.TV_BUTTON_HOVER,ParentNode:u,IsEnabled:this._IsEnableBuy,Click:new a.Delegate(this,this._onBuyClicked)})},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsEnableBuy,i=e.IsCheckedAgree,r=e.IsValidAgree,n=e.IsVisibleWaiter;(0,u.isDefined)(n)&&this._buyButton.update({WaiterVisible:n}),(0,u.isDefined)(i)&&(this._updateCheckedAgree(),this._updateEnableBuy()),(0,u.isDefined)(o)&&this._updateEnableBuy(),(0,u.isDefined)(r)&&this._updateValidAgree()},e.prototype._onAgreeChanged=function(t){this.AgreeChecked.fire(t)},e.prototype._onBuyClicked=function(){this.BuyClicked.fire()},e.prototype._onContractLinkNodeClick=function(){this._isMobile()||this.ContractClicked.fire()},e.prototype._onAgreementTextNodeClick=function(){if(this._isMobile()){var t={IsChecked:!this._IsCheckedAgree};this.AgreeChecked.fire(t)}},e.prototype._updateEnableBuy=function(){this._buyButton.update({IsEnabled:this._IsEnableBuy})},e.prototype._updateCheckedAgree=function(){this._agreeCheckbox.update({IsChecked:this._IsCheckedAgree})},e.prototype._updateValidAgree=function(){this._agreeCheckbox.update({IsValid:this._IsValidAgree})},e.prototype._isMobile=function(){return this._ModeView===c.ModeView.Mobile},e}(s.Control);e.TourBuySendingControl=p,t.TourBuySendingControl=p}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourBuyManagerButtonsControl=void 0;var r=o(2),n=o(4),s=o(3),a=o(1),l=o(5),u=o(8),c=o(492),h=o(85),d=function(t){function e(e){var o=t.call(this,e)||this;return o.BuyClicked=new s.UserEvent,o.ExportCrmClicked=new s.UserEvent,o._Class="TVTourManagerButtonsControl",o._CrmError="",o._CrmName=l.ExportCrmName.NONE,o._CrmStatus=l.ExportCrmStatus.DISABLE,o._CrmUrl="",o._IsEnableBuy=!1,o._IsVisibleBuy=!0,o._Mode=c.ExportCrmCallbackType.BUY,o._buyButton=null,o._crmButton=null,t.prototype.__initSettings.call(o,e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderBuyButton(),this._updateVisibleBuyButton(),this._updateEnableBuyButton(),this._renderCrmButton(),this._updateVisibleCrmButton()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsEnableBuy,i=e.IsVisibleBuy,r=e.CrmError,n=e.CrmName,s=e.CrmUrl,l=e.CrmStatus,u=e.IsVisibleWaiter,c=e.IsVisibleCrmWaiter;(0,a.isDefined)(o)&&this._updateEnableBuyButton(),(0,a.isDefined)(i)&&this._updateVisibleBuyButton(),(0,a.isDefined)(n)&&(this._updateCrmName(),this._updateVisibleCrmButton()),(0,a.isDefined)(s)&&this._updateCrmUrl(),(0,a.isDefined)(r)&&this._updateCrmError(),(0,a.isDefined)(l)&&this._updateEnableCrmButton(),(0,a.isDefined)(u)&&this._buyButton.update({WaiterVisible:u}),(0,a.isDefined)(c)&&this._crmButton.update({WaiterVisible:c})},e.prototype._renderBuyButton=function(){this._buyButton=new h.ButtonWaiter({Class:(0,a.classNames)("TVManagerBuyButton",u.TV_BUTTON_HOVER),ParentNode:this._DomNode,Click:new n.Delegate(this,this._onBuyClicked)})},e.prototype._renderCrmButton=function(){this._crmButton=new h.ButtonWaiter({Class:(0,a.classNames)("TVManagerCrmButton",u.TV_BUTTON_HOVER),IsAnchor:!0,ParentNode:this._DomNode,Click:new n.Delegate(this,this._onCrmClicked)})},e.prototype._onCrmClicked=function(t){(0,a.removeClass)(this._crmButton,u.TV_CRM_EXPORT_ERROR),this.ExportCrmClicked.fire(t)},e.prototype._onBuyClicked=function(){this.BuyClicked.fire()},e.prototype._updateEnableCrmButton=function(){var t=this._CrmStatus===l.ExportCrmStatus.ENABLE;this._crmButton.update({IsEnabled:t})},e.prototype._updateEnableBuyButton=function(){this._buyButton.update({IsEnabled:this._IsEnableBuy})},e.prototype._updateVisibleBuyButton=function(){this._buyButton.setIsVisible(this._IsVisibleBuy)},e.prototype._updateVisibleCrmButton=function(){var t=this._CrmName!==l.ExportCrmName.NONE;this._crmButton.setIsVisible(t)},e.prototype._updateCrmName=function(){(0,a.updateClass)(this._crmButton,u.TV_CRM_UON,this._CrmName===l.ExportCrmName.UON),(0,a.updateClass)(this._crmButton,u.TV_CRM_MY_DOCUMENTS,this._CrmName===l.ExportCrmName.MY_DOCUMENTS)},e.prototype._updateCrmUrl=function(){var t,e=(null===(t=this._CrmUrl)||void 0===t?void 0:t.length)>0;this._crmButton.update({Link:e?this._CrmUrl:""}),(0,a.updateClass)(this._crmButton,u.TV_CRM_EXPORT_LINK,e)},e.prototype._updateCrmError=function(){var t,e=(null===(t=this._CrmError)||void 0===t?void 0:t.length)>0;(0,a.updateClass)(this._crmButton,u.TV_CRM_EXPORT_ERROR,e)},e}(r.Control);e.TourBuyManagerButtonsControl=d,t.TourBuyManagerButtonsControl=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)},n=this&&this.__rest||function(t,e){var o={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(o[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(o[i[r]]=t[i[r]]);return o},s=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var i,r=0,n=e.length;r<n;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.TourBuyTouristListControl=void 0;var a=o(2),l=o(4),u=o(3),c=o(7),h=o(1),d=o(5),p=o(256),_=o(944),f=function(t){function e(e){var o=t.call(this,e)||this;return o.TouristDataChanged=new u.UserEvent,o._ModeView=d.ModeView.DescTop,o._TouristData=[],o._delegateFillLater=null,o._touristsHash=[],t.prototype.__initSettings.call(o,e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Adults,i=e.Children,r=e.TouristData;((0,h.isDefined)(o)||(0,h.isDefined)(i))&&(this._clearTouristData(),this._renderTouristForm(e)),(0,h.isDefined)(r)&&this._updateTouristForm()},e.prototype.validate=function(){return this._touristsHash.reduce(function(t,e){return e.validate()&&t},!0)},e.prototype.scrollToInvalid=function(){var t=this._findInvalidInput();if(t){var o=(0,h.cumulativeOffset)(t.getDomNode());(0,h.scrollToTop)(c.SCROLL_DURATION_S,o.top-e.SCROLL_TOP)}},e.prototype._init=function(){this._delegateFillLater=new l.Delegate(this,function(){})},e.prototype._renderTouristForm=function(t){var e=this;void 0===t&&(t={});var o=t.Adults,i=t.Children,a=(t.TouristData,n(t,["Adults","Children","TouristData"])),u=r(r({},a),{ParentNode:this._DomNode});this._ModeView===d.ModeView.DescTop&&(u.Gender=p.GenderType.MALE);for(var c=o,h=1===c,f=0;f<c;f+=1)this._touristsHash.push(new _.TourBuyTouristItemControl(r(r({},u),{Index:h?0:f+1,Changed:new l.Delegate(this,this._onTouristDataChanged,{Index:f}),FillLaterChanged:this._delegateFillLater})));var y=1===i.length;this._touristsHash=s(s([],this._touristsHash,!0),i.map(function(t,o){var i=o+c;return new _.TourBuyTouristItemControl(r(r({},u),{Index:y?0:o+1,ChildAge:t,Changed:new l.Delegate(e,e._onTouristDataChanged,{Index:i}),FillLaterChanged:e._delegateFillLater}))}),!0)},e.prototype._findInvalidInput=function(){for(var t=0;t<this._touristsHash.length;t+=1){var e=this._touristsHash[t];if(!e.getSettings().IsValid)return e}},e.prototype._clearTouristData=function(){this._touristsHash.forEach(function(t){t.destroy()}),this._touristsHash=[],(0,h.removeChildren)(this._DomNode)},e.prototype._onTouristDataChanged=function(t){this.TouristDataChanged.fire(t)},e.prototype._updateTouristForm=function(){var t=this;this._touristsHash.forEach(function(e,o){var i={ClearValid:!0},r=t._TouristData[o];(0,h.isDefined)(r)&&(i.Value=r),e.update(i)})},e.SCROLL_TOP=70,e}(a.Control);e.TourBuyTouristListControl=f,t.TourBuyTouristListControl=f}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TourBuyTouristItemControl=void 0;var n,s=o(29),a=o(228),l=o(187),u=o(2),c=o(4),h=o(3),d=o(7),p=o(1),_=o(5),f=o(6),y=o(13),g=o(16),C=o(35),v=o(184),m=o(256);!function(t){t[t.SURNAME=0]="SURNAME",t[t.BIRTHDAY=1]="BIRTHDAY",t[t.NAME=2]="NAME",t[t.NATIONALITY=3]="NATIONALITY"}(n||(n={}));var T;!function(t){t.MALE="Муж",t.WOMAN="Жен"}(T||(T={}));var w;!function(t){t[t.PASSPORTSERIES=0]="PASSPORTSERIES",t[t.PASSPORTNUMBER=1]="PASSPORTNUMBER",t[t.PASSPORTISSUE=2]="PASSPORTISSUE",t[t.PASSPORTAUTHORITY=3]="PASSPORTAUTHORITY",t[t.PASSPORTEXPIRY=4]="PASSPORTEXPIRY"}(w||(w={}));var S;!function(t){t[t.MALE=0]="MALE",t[t.WOMAN=1]="WOMAN"}(S||(S={}));var P;!function(t){t.ADULT="Adult",t.CHILD="Child"}(P||(P={}));var b=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new h.UserEvent,o.FillLaterChanged=new h.UserEvent,o.VisaChanged=new h.UserEvent,o._ChildAge=0,o._Currency=_.Currency.Rub,o._Class="TVTourBuyTouristItemControl",o._Gender=m.GenderType.NONE,o._Index=0,o._RusPassport=!1,o._TourEndDate=!1,o._TourStartDate=!1,o._Visa=0,o._commonInputs=[],o._commonValue={NAME:"",SURNAME:"",BIRTHDAY:"",NATIONALITY:""},o._isValid=!1,o._passportInputs=[],o._passportValue={PASSPORTSERIES:"",PASSPORTNUMBER:"",PASSPORTISSUE:"",PASSPORTEXPIRY:"",PASSPORTAUTHORITY:""},t.prototype.__initSettings.call(o,e),o._Render&&o.render(),o}return i(e,t),e.prototype.getSettings=function(){return{Value:r(r({},this._commonValue),this._passportValue),IsValid:this._isValid}},e.prototype.render=function(){if(t.prototype.render.call(this),this._touristType=(0,p.newDiv)("TVTourTouristType",this._DomNode),this._ChildAge&&this._ChildAge<e.ADULT_AGE){(0,p.addClass)(this._DomNode,"TVTourTouristChild");var o=v.touristUtils.getChildAgeContent(this._ChildAge);this._touristType.innerHTML=this._Index?"&nbsp"+this._Index+" ("+o+")":"&nbsp"+o}else(0,p.addClass)(this._DomNode,"TVTourTouristAdult"),this._touristType.innerHTML=this._Index?"&nbsp"+this._Index:"";this._Gender!==m.GenderType.NONE&&this._renderGender(),this._renderCommonBlock(),this._renderPassportBlock(),this._renderUseVisa()},e.prototype.update=function(t){var e=t.ClearValid,o=t.Value;if((0,p.isDefined)(o)){var i=this._getTouristValue({Gender:this._Gender},o),r=this._getTouristValue(this._commonValue,o),n=this._getTouristValue(this._passportValue,o);this._updateGender(i),this._updateCommon(r),this._updatePassport(n)}(0,p.isDefined)(e)&&(this._commonInputs.forEach(function(t){t.update({ClearValid:!0})}),this._passportInputs.forEach(function(t){t.update({ClearValid:!0})}))},e.prototype.validate=function(){return this._isValid=!0,this._updateValidInputs(this._commonInputs),this._fillLaterCheckbox.getIsChecked()||this._updateValidInputs(this._passportInputs),this._isValid},e.prototype._changed=function(){var t=r(r(r({},this._commonValue),this._passportValue),{Visa:this._Visa>0&&this._useVisa.getIsChecked()?this._Visa:0});this._Gender!==m.GenderType.NONE&&(t.Gender=this._Gender),this.Changed.fire({IsValid:this._isValid,Value:t})},e.prototype._checkForm=function(){this._isValid=!this._commonInputs.some(function(t){return!t.getSettings().IsValid}),this._isValid&&!this._fillLaterCheckbox.getIsChecked()&&(this._isValid=!this._passportInputs.some(function(t){return!t.getSettings().IsValid})),this._changed()},e.prototype._fillInputs=function(){this._commonInputs[n.NAME].update({Value:d.TEST_NAME}),this._commonInputs[n.SURNAME].update({Value:d.TEST_SURNAME}),this._commonInputs[n.BIRTHDAY].update({Value:d.TEST_BIRTHDAY}),this._commonInputs[n.NATIONALITY].update({Value:d.TEST_NATIONALITY}),this._commonValue.NAME=d.TEST_NAME,this._commonValue.SURNAME=d.TEST_SURNAME,this._commonValue.BIRTHDAY=d.TEST_BIRTHDAY,this._commonValue.NATIONALITY=d.TEST_NATIONALITY,this._passportInputs[w.PASSPORTSERIES].update({Value:d.TEST_PASSPORTSERIES}),this._passportInputs[w.PASSPORTNUMBER].update({Value:d.TEST_PASSPORTNUMBER}),this._passportInputs[w.PASSPORTISSUE].update({Value:d.TEST_PASSPORTISSUE}),this._passportInputs[w.PASSPORTAUTHORITY].update({Value:d.TEST_PASSPORTAUTHORITY}),this._passportValue.PASSPORTSERIES=d.TEST_PASSPORTSERIES,this._passportValue.PASSPORTNUMBER=d.TEST_PASSPORTNUMBER,this._passportValue.PASSPORTISSUE=d.TEST_PASSPORTISSUE,this._passportValue.PASSPORTAUTHORITY=d.TEST_PASSPORTAUTHORITY,this._RusPassport||(this._passportInputs[w.PASSPORTEXPIRY].update({Value:d.TEST_PASSPORTEXPIRY}),this._passportValue.PASSPORTEXPIRY=d.TEST_PASSPORTEXPIRY),this._checkForm()},e.prototype._checkPassportDate=function(t){var e=t.Value,o=t.Type,i=w[o];switch(this._passportValue[i]=e,o){case w.PASSPORTISSUE:if(""===e)break;var r=y.FormatDate.strToDate(e),n=y.FormatDate.strToDate(this._commonValue.BIRTHDAY);if(this._TourStartDate&&r>this._TourStartDate||n&&r<=n){this._passportInputs[w.PASSPORTISSUE].update({IsValid:!1});break}if(this._RusPassport)break;var s=y.FormatDate.strToDate(this._passportValue.PASSPORTEXPIRY);s&&this._passportInputs[w.PASSPORTEXPIRY].validate();break;case w.PASSPORTEXPIRY:if(""===e||this._RusPassport)break;var r=y.FormatDate.strToDate(this._passportValue.PASSPORTISSUE),s=y.FormatDate.strToDate(e),n=y.FormatDate.strToDate(this._commonValue.BIRTHDAY);(this._TourEndDate&&s<this._TourEndDate||n&&s<=n||r&&s<=r)&&this._passportInputs[w.PASSPORTEXPIRY].update({IsValid:!1})}this._checkForm()},e.prototype._onBirthdayBlur=function(t){var e=t.Value;if(this._commonValue.BIRTHDAY=e,""===e)return void this._checkForm();this._validateBirthday(t),this._checkForm()},e.prototype._onCommonInputsBlur=function(t){var e=t.Value,o=t.Type;if(e.toLowerCase()===d.TEST_HELP)return void this._fillInputs();var i=n[o];this._commonValue[i]=e,this._validateCommonInputs(t),this._checkForm()},e.prototype._onFillLaterChanged=function(t){var o=t.IsChecked;o?(0,p.addClass)(this._passportContainer,e.TV_DISABLED):(0,p.removeClass)(this._passportContainer,e.TV_DISABLED),this._passportInputs.forEach(function(t){t.update({ReadOnly:o})}),this._checkForm(),this.FillLaterChanged.fire()},e.prototype._onGenderChanged=function(t){this._Gender=t.Selected,this._changed()},e.prototype._onPassportInputsBlur=function(t){var e=t.Value,o=t.Type,i=w[o];this._passportValue[i]=e,this._checkForm()},e.prototype._onUseVisaChanged=function(t){this._changed();var o=t.IsChecked;if(this.VisaChanged.fire({UseVisa:o}),(0,p.isDefined)(this._visaMessage)||(this._visaMessage=(0,p.newDiv)("TVMessageInformation",this._DomNode),this._visaMessage.innerHTML=e.VISA_MESSAGE_CONTENT),o)return void(0,p.hide)(this._visaMessage);(0,p.show)(this._visaMessage)},e.prototype._renderCommonBlock=function(){this._touristContainer=(0,p.newDiv)(e.TV_TOUR_TOURIST_BLOCK,this._DomNode),this._commonValue.NATIONALITY=this._commonValue.NATIONALITY||v.touristUtils.getNationality(this._Currency);var t=this._commonValue,o=t.SURNAME,i=t.BIRTHDAY,r=t.NAME,s=t.NATIONALITY,l={Type:n.SURNAME};this._commonInputs[n.SURNAME]=new a.InputPro({Class:"TVTouristSurname",Value:o,ParentNode:this._touristContainer,LiteraOnly:!0,Blur:new c.Delegate(this,this._onCommonInputsBlur,l),Validating:new c.Delegate(this,this._validateCommonInputs,l)}),this._commonInputs[n.BIRTHDAY]=new a.InputPro({Class:"TVTouristBirthday",Value:i,ParentNode:this._touristContainer,IsDate:!0,Blur:new c.Delegate(this,this._onBirthdayBlur),Validating:new c.Delegate(this,this._validateBirthday)});var u={Type:n.NAME};this._commonInputs[n.NAME]=new a.InputPro({Class:"TVTouristName",Value:r,ParentNode:this._touristContainer,LiteraOnly:!this._RusPassport,Blur:new c.Delegate(this,this._onCommonInputsBlur,u),Validating:new c.Delegate(this,this._validateCommonInputs,u)}),this._commonInputs[n.NATIONALITY]=new a.InputPro({Class:"TVTouristNationality",Value:s,IsValid:(0,p.isDefined)(s),ParentNode:this._touristContainer,Blur:new c.Delegate(this,this._onCommonInputsBlur,{Type:n.NATIONALITY})})},e.prototype._renderPassportBlock=function(){this._passportTitle=(0,p.newDiv)(e.TV_TOUR_TOURIST_BLOCK+" TVTouristPassport",this._DomNode),this._RusPassport&&(0,p.addClass)(this._DomNode,"TVPassportRus"),this._fillLaterCheckbox=new s.CheckBox({Class:"TVFillLaterCheckbox",IsChecked:!1,ParentNode:this._passportTitle,Checked:new c.Delegate(this,this._onFillLaterChanged)}),this._passportContainer=(0,p.newDiv)(e.TV_TOUR_TOURIST_BLOCK,this._DomNode),this._passportInputs[w.PASSPORTSERIES]=new a.InputPro({Class:"TVPassportSeries",Value:this._passportValue.PASSPORTSERIES,ParentNode:this._passportContainer,MaxLength:12,IsNumber:!1,Blur:new c.Delegate(this,this._onPassportInputsBlur,{Type:w.PASSPORTSERIES})}),this._passportInputs[w.PASSPORTNUMBER]=new a.InputPro({Class:"TVPassportNumber",Value:this._passportValue.PASSPORTNUMBER,ParentNode:this._passportContainer,MaxLength:12,IsNumber:!1,Blur:new c.Delegate(this,this._onPassportInputsBlur,{Type:w.PASSPORTNUMBER})});var t=new c.Delegate(this,this._checkPassportDate,{Type:w.PASSPORTISSUE});if(this._passportInputs[w.PASSPORTISSUE]=new a.InputPro({Class:"TVPassportIssue",Value:this._passportValue.PASSPORTISSUE,ParentNode:this._passportContainer,IsDate:!0,Blur:t,Validating:t}),this._RusPassport)(0,p.addClass)(this._passportInputs[w.PASSPORTSERIES],"TVPassportSeriesWide"),(0,p.addClass)(this._passportInputs[w.PASSPORTNUMBER],"TVPassportNumberWide"),(0,p.addClass)(this._passportInputs[w.PASSPORTISSUE],"TVPassportIssueWide");else{var o=new c.Delegate(this,this._checkPassportDate,{Type:w.PASSPORTEXPIRY});this._passportInputs[w.PASSPORTEXPIRY]=new a.InputPro({Class:"TVPassportExpiry",Value:this._passportValue.PASSPORTEXPIRY,ParentNode:this._passportContainer,IsDate:!0,Blur:o,Validating:o})}this._passportInputs[w.PASSPORTAUTHORITY]=new a.InputPro({Class:"TVPassportAuthority",Value:this._passportValue.PASSPORTAUTHORITY,ParentNode:this._passportContainer,Blur:new c.Delegate(this,this._onPassportInputsBlur,{Type:w.PASSPORTAUTHORITY})})},e.prototype._renderGender=function(){var t=0===this._ChildAge||this._ChildAge>=e.ADULT_AGE,o=t?P.ADULT:P.CHILD,i=""+e.RADIO_ATTRIBUTE_NAME+o+(0,p.getRandomHash)();this._maleRadio=new l.InputRadio({ParentNode:this._touristType,Id:S.MALE,Content:T.MALE,Data:m.GenderType.MALE,AttributeName:i,IsChecked:this._Gender===m.GenderType.MALE,Size:g.SizeEnum.S,Changed:new c.Delegate(this,this._onGenderChanged)}),this._womanRadio=new l.InputRadio({ParentNode:this._touristType,Id:S.WOMAN,Content:T.WOMAN,Data:m.GenderType.WOMAN,AttributeName:i,IsChecked:this._Gender===m.GenderType.WOMAN,Size:g.SizeEnum.S,Changed:new c.Delegate(this,this._onGenderChanged)})},e.prototype._renderUseVisa=function(){if(0!==this._Visa){var t=(0,C.createDomElement)("div",{},(0,C.createDomElement)("div",{className:"TVTourTouristUseVisa"},(0,p.getPrice)(this._Visa)));this._useVisa=new s.CheckBox({Class:"TVTouristVisa",Content:""+t.innerHTML,IsChecked:!0,ParentNode:this._DomNode,Checked:new c.Delegate(this,this._onUseVisaChanged)})}},e.prototype._updateValidInputs=function(t){this._isValid=t.reduce(function(t,e){return e.validate()&&t},this._isValid)},e.prototype._getTouristValue=function(t,e){var o={};return Object.keys(t).forEach(function(t){var i=e[t];(0,p.isDefined)(i)&&(o[t]=i)}),o},e.prototype._updateValueInputs=function(t,e,o){t.forEach(function(t,i){var r=e[o[i]];r?t.update({Value:r}):t.update({ClearValid:!0,Value:""})})},e.prototype._updateGender=function(t){switch(this._Gender=t.Gender,this._Gender){case m.GenderType.MALE:this._maleRadio.update({IsChecked:!0});break;case m.GenderType.WOMAN:this._womanRadio.update({IsChecked:!0})}},e.prototype._updateCommon=function(t){this._commonValue=r(r({},this._commonValue),t),this._updateValueInputs(this._commonInputs,t,n)},e.prototype._updatePassport=function(t){this._passportValue=r(r({},this._passportValue),t),this._updateValueInputs(this._passportInputs,t,w)},e.prototype._validateBirthday=function(t){var o=t.Value;if(o){var i,r=y.FormatDate.strToDate(o),s=0===this._ChildAge||this._ChildAge>=e.ADULT_AGE,a=(0,f.getTouristAge)(r,this._TourStartDate),l=r>=this._TourStartDate;if(!s){i=1===this._ChildAge?a<2:this._ChildAge===a}(l||!s&&!i)&&this._commonInputs[n.BIRTHDAY].update({IsValid:!1});if(y.FormatDate.strToDate(this._passportValue.PASSPORTISSUE))this._passportInputs[w.PASSPORTISSUE].validate();else if(!this._RusPassport){var u=y.FormatDate.strToDate(this._passportValue.PASSPORTEXPIRY);u&&this._passportInputs[w.PASSPORTEXPIRY].validate()}}},e.prototype._validateCommonInputs=function(t){if(!this._RusPassport){var e=t.Value,o=t.Type;if(!/^[a-zA-Z\-\–\—]+$/.test(e))switch(o){case n.NAME:this._commonInputs[n.NAME].update({IsValid:!1});break;case n.SURNAME:this._commonInputs[n.SURNAME].update({IsValid:!1})}}},e.ADULT_AGE=14,e.RADIO_ATTRIBUTE_NAME="tvTouristGender",e.TV_DISABLED="TVDisabled",e.TV_TOUR_TOURIST_BLOCK="TVTourTouristBlock",e.VISA_MESSAGE_CONTENT='<div class="TVTourBuyVisaAttention">Внимание!</div>',e}(u.Control);e.TourBuyTouristItemControl=b,t.TourBuyTouristItemControl=b}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.TV_OPERATOR_BOOKING=void 0,e.TV_OPERATOR_BOOKING="TVOperatorBooking",t.TV_OPERATOR_BOOKING=e.TV_OPERATOR_BOOKING}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardOrderTabsControl=void 0;var r=o(220),n=o(2),s=o(4),a=o(3),l=o(1),u=o(61),c=o(10),h=o(308),d=function(t){function e(e){var o=t.call(this,e)||this;return o.TabChanged=new a.UserEvent,o._ActiveTab=h.CustomerOrderViewMode.REQUEST,o._Class="TVTourCardOrderTabsControl",o._IsVisibleBuyInCredit=!1,o._IsVisibleBuyOnline=!1,o._IsVisibleRequest=!1,o._tabs=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderTabs(),this._updateTabs()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ActiveTab,i=e.IsVisibleBuyInCredit,r=e.IsVisibleBuyOnline;(0,l.isDefined)(o)&&this._selectTab(),((0,l.isDefined)(i)||(0,l.isDefined)(r))&&this._updateTabs()},e.prototype._renderTabs=function(){this._tabs=new r.ToggleSwitch({Color:u.ColorThemeEnum.WHITE,ParentNode:this._DomNode,SelectedId:this._ActiveTab,StyleTheme:c.StyleThemeEnum.THEME1,Changed:new s.Delegate(this,this._onTabChanged)})},e.prototype._selectTab=function(){this._tabs.update({SelectedId:this._ActiveTab})},e.prototype._updateTabs=function(){var t=this._getItems();this._updateWidth(t.length),this._tabs.update({Items:t})},e.prototype._getItems=function(){var t=[];if(this._IsVisibleBuyOnline){var e=h.CustomerOrderViewMode.BUYONLINE;t.push({ClassName:"TVTourCardTabsBuyOnline",Content:this._getContent(e),Id:e})}if(this._IsVisibleRequest){var e=h.CustomerOrderViewMode.REQUEST;t.push({ClassName:"TVTourCardTabsSendRequest",Content:this._getContent(e),Id:e})}if(this._IsVisibleBuyInCredit){var e=h.CustomerOrderViewMode.BUYINCREDIT;t.push({ClassName:"TVTourCardTabsInCredit",Content:this._getContent(e),Id:e})}return t},e.prototype._getContent=function(t){switch(t){case h.CustomerOrderViewMode.BUYONLINE:return"Купить онлайн";case h.CustomerOrderViewMode.REQUEST:return"Отправить запрос";case h.CustomerOrderViewMode.BUYINCREDIT:return"Купить в кредит";default:return""}},e.prototype._updateWidth=function(t){var e=this._tabs.getDomNode();switch(t){case 2:e.style.width="40%";break;case 3:e.style.width="60%";break;case 4:e.style.width="80%";break;default:e.style.width="100%"}},e.prototype._onTabChanged=function(t){var e=t.Id;e!==this._ActiveTab&&(this._ActiveTab=e,this.TabChanged.fire(t))},e}(n.Control);e.TourCardOrderTabsControl=d,t.TourCardOrderTabsControl=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ManagerOrderControl=void 0;var n=o(44),s=o(2),a=o(4),l=o(3),u=o(7),c=o(1),h=o(5),d=o(6),p=o(112),_=o(40),f=o(492),y=o(193),g=o(237),C=o(493),v=o(72),m=o(494),T=o(298),w=o(236),S=o(309),P=function(t){function e(e){var o=t.call(this,e)||this;return o.ActionClicked=new l.UserEvent,o.BackClicked=new l.UserEvent,o.SendRequest=new l.UserEvent,o.templateName="manager-order",o._Class="TVManagerOrderControl",o._ClientData=null,o._CustomerTourLink="",o._IsVisibleBackButton=!0,o._IsVisibleBooking=!0,o._IsVisibleCreateContract=!0,o._IsVisibleCrm=!0,o._IsVisibleOperatorBooking=!0,o._IsVisibleOperatorLink=!0,o._ManagerView=C.ManagerOrderViewMode.ACTIONS,o._OperatorLink="",o._SelectedFlight=null,o._TourId=0,o._BookingClicked=null,o._managerActionsControl=null,o._switcher=null,o._tourBuyForm=null,o._tourOperatorBooking=null,o._tourBookingControl=null,t.prototype.__initSettings.call(o,e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderManagerActions(),this._renderTourBuyForm(),this._renderBooking(),this._renderOperatorBooking(),this._renderSwitcher(),this._updateBackButtonVisibility(),this._updateBackButtonContent()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsVisibleBackButton,i=e.ClientData,n=e.IsActualizing,s=e.ManagerView,a=e.OperatorLink,l=e.TourBuyData,u=e.TourId,h=e.CustomerTourLink;if((0,c.isDefined)(o)&&(this._updateBackButtonVisibility(),this._updateBackButtonContent()),(0,c.isDefined)(s)&&this._showByManagerView(s),(0,c.isDefined)(i)&&(this._updateBookings(),this._updateExportCrm()),(0,c.isDefined)(u)&&(this._tourBuyForm.update({TourId:this._TourId}),this._tourOperatorBooking.update({TourId:this._TourId})),(0,c.isDefined)(a)&&this._updateOperatorLink(),(0,c.isDefined)(h)&&this._updateCustomerTourLink(),(0,c.isDefined)(l)){var d=l.Price,p=l.IncludePrices,f=void 0===p?[]:p;this._tourBuyForm.update(r({},l)),this._tourOperatorBooking.update(r(r({},l),{IncludePrices:f.length>0?f:[_.tourUtils.getIncludeTourPrice(d)]}))}(0,c.isDefined)(n)&&this._updateEnableManagerActions(n),this._updateVisibilityActions(e)},e.prototype.destroy=function(){this._BookingClicked=null,this._ClientData=null,this._SelectedFlight=null,t.prototype.destroy.call(this)},e.prototype._renderManagerActions=function(){this._managerActionsControl=new m.ManagerOrderActionsControl({ParentNode:this._nodes.contentNode,Clicked:new a.Delegate(this,this._onActionClicked)})},e.prototype._renderTourBuyForm=function(){this._tourBuyForm=new w.TourBuyControl({IsManager:!0,ParentNode:this._nodes.contentNode,TourId:this._TourId,UserInputFields:[y.UserInputType.NAME,y.UserInputType.PHONE,y.UserInputType.EMAIL],ExportCrmClicked:new a.Delegate(this,this._onExportCrmClicked,{CallBackType:f.ExportCrmCallbackType.BUY}),SendingClicked:new a.Delegate(this,this._onSendRequest,{Type:v.RequestType.OnlineRequest})})},e.prototype._renderBooking=function(){this._tourBookingControl=new T.TourBookingControl({BookingItems:_.tourUtils.getBookingCenters(this._ClientData),ParentNode:this._nodes.contentNode,BookingClicked:this._BookingClicked})},e.prototype._renderOperatorBooking=function(){this._tourOperatorBooking=new w.TourBuyControl({CrmStatus:h.ExportCrmStatus.DISABLE,IsManager:!0,ParentNode:this._nodes.contentNode,TourBuyType:S.TourBuyTypeEnum.OPERATOR_BOOKING,TourId:this._TourId,UserInputFields:[y.UserInputType.NAME,y.UserInputType.PHONE,y.UserInputType.EMAIL],UserInputLabels:{ADDRESS:u.ADDRESS_LABEL,EMAIL:u.EMAIL_LABEL,NAME:u.AGENCY_NAME_LABEL,PHONE:u.PHONE_LABEL},SendingClicked:new a.Delegate(this,this._onSendRequest,{Type:v.RequestType.OnlineRequest})})},e.prototype._renderSwitcher=function(){this._switcher=new n.LayerSwitch({}),this._switcher.add(this._managerActionsControl.getDomNode(),C.ManagerOrderViewMode.ACTIONS),this._switcher.add(this._tourBuyForm.getDomNode(),C.ManagerOrderViewMode.CREATE_CONTRACT),this._switcher.add(this._tourBookingControl.getDomNode(),C.ManagerOrderViewMode.BOOKING),this._switcher.add(this._tourOperatorBooking.getDomNode(),C.ManagerOrderViewMode.OPERATOR_BOOKING),this._switcher.showById(C.ManagerOrderViewMode.ACTIONS)},e.prototype._onActionClicked=function(t){switch(t.Action){case g.ManagerOrderAction.EXPORT_CRM:this._onExportCrmClicked({CallBackType:f.ExportCrmCallbackType.REQUEST});break;case g.ManagerOrderAction.CREATE_CONTRACT:this._showByManagerView(C.ManagerOrderViewMode.CREATE_CONTRACT),this._tourBuyForm.update({IsForceUpdate:!0}),this._scrollIntoView();break;case g.ManagerOrderAction.BOOKING:this._showByManagerView(C.ManagerOrderViewMode.BOOKING);break;case g.ManagerOrderAction.OPERATOR_BOOKING:this._showByManagerView(C.ManagerOrderViewMode.OPERATOR_BOOKING),this._tourOperatorBooking.update({IsForceUpdate:!0})}this.ActionClicked.fire(t)},e.prototype._onBackNodeClick=function(){if(this._ManagerView!==C.ManagerOrderViewMode.ACTIONS)return void this._showByManagerView(C.ManagerOrderViewMode.ACTIONS);this.BackClicked.fire()},e.prototype._onSendRequest=function(t){this.SendRequest.fire(t)},e.prototype._onExportCrmClicked=function(t){var e=t.CallBackType;t.Type=v.RequestType.ExportRequest,t.CallBack=new a.Delegate(this,this._updateCrmUrl,{CallBackType:e}),this.SendRequest.fire(t)},e.prototype._showByManagerView=function(t){this._ManagerView=t,this._switcher.showById(this._ManagerView),this._updateBackButtonContent()},e.prototype._updateBookings=function(){var t=_.tourUtils.getBookingCenters(this._ClientData);this._tourBookingControl.update({BookingItems:t})},e.prototype._updateExportCrm=function(){var t=_.tourUtils.getManagerExportCrmName(this._ClientData),e={CrmName:t,CrmUrl:"",CrmError:""};this._managerActionsControl.update(e),this._tourBuyForm.update(e)},e.prototype._updateEnableManagerActions=function(t){var e=!t,o=e?h.ExportCrmStatus.ENABLE:h.ExportCrmStatus.DISABLE;this._managerActionsControl.update({CrmStatus:o,IsEnableBooking:e,IsEnableCreateContract:e}),this._tourBuyForm.update({CrmStatus:o})},e.prototype._updateOperatorLink=function(){this._managerActionsControl.update({OperatorLink:{href:this._OperatorLink}})},e.prototype._updateCustomerTourLink=function(){this._managerActionsControl.update({TourLink:{href:this._CustomerTourLink}})},e.prototype._updateVisibilityActions=function(t){var e=t.ClientData,o=t.IsVisibleBooking,i=t.IsVisibleCreateContract,r=t.IsVisibleCrm,n=t.IsVisibleOperatorBooking,s=t.IsVisibleOperatorLink,a={};((0,c.isDefined)(e)||(0,c.isDefined)(i))&&(a.IsVisibleCreateContract=this._IsVisibleCreateContract&&_.tourUtils.getManagerBuyOnlineEnabled(this._ClientData)),(0,c.isDefined)(s)&&(a.IsVisibleOperatorLink=this._IsVisibleOperatorLink),(0,c.isDefined)(o)&&(a.IsVisibleBooking=this._IsVisibleBooking),(0,c.isDefined)(n)&&(a.IsVisibleOperatorBooking=this._IsVisibleOperatorBooking),(0,c.isDefined)(r)&&(a.IsVisibleCrm=this._IsVisibleCrm),(0,d.isNotEmptyObject)(a)&&this._managerActionsControl.update(a)},e.prototype._updateCrmUrl=function(t){var e=t.CrmUrl,o=t.CrmError;switch(t.CallBackType){case f.ExportCrmCallbackType.BUY:this._tourBuyForm.update({CrmUrl:e,CrmError:o});break;case f.ExportCrmCallbackType.REQUEST:this._managerActionsControl.update({CrmUrl:e,CrmError:o})}},e.prototype._updateBackButtonVisibility=function(){var t=this._nodes.backNode;(0,c.setVisible)(t,this._IsVisibleBackButton)},e.prototype._updateBackButtonContent=function(){var t=this._ManagerView!==C.ManagerOrderViewMode.ACTIONS;(0,c.updateClass)(this._DomNode,"TVNoActionsView",t)},e.prototype._scrollIntoView=function(){(0,p.animateScroll)(null,this._DomNode)},e}(s.Control);e.ManagerOrderControl=P,t.ManagerOrderControl=P}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardWindowViewModeEnum=void 0;var o;!function(t){t[t.INSTRUCTION=0]="INSTRUCTION",t[t.CONTRACT=1]="CONTRACT",t[t.TOURCARD=2]="TOURCARD"}(o=e.TourCardWindowViewModeEnum||(e.TourCardWindowViewModeEnum={})),t.TourCardWindowViewModeEnum=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourMobileController=void 0;var r=o(31),n=o(55),s=o(120),a=o(17),l=o(9),u=o(4),c=o(3),h=o(1),d=o(5),p=o(6),_=o(110),f=o(119),y=o(156),g=o(154),C=o(235),v=o(21),m=o(14),T=o(232),w=o(50),S=o(32),P=o(118),b=o(18),I=o(40),O=o(194),M=o(72),D=o(310),E=o(495),k=o(496),R=o(497),A=o(498),V=o(499),L=o(500),N=function(t){function e(e){var o=t.call(this,e)||this;return o.AddToCart=new c.UserEvent,o.ContractClicked=new c.UserEvent,o.Hide=new c.UserEvent,o.MoreFlightsClicked=new c.UserEvent,o.SendRequest=new c.UserEvent,o._ClientData=null,o._HotelData=null,o._IsEnabledMultiOffice=!0,o._IsVisibleAddToCart=!1,o._IsVisibleBooking=!0,o._IsVisibleBuyOnline=!1,o._IsVisibleCreateContract=!0,o._IsVisibleCrm=!0,o._IsVisibleOperatorBooking=!0,o._IsVisibleOperatorLink=!0,o._IsVisibleFavoriteHotels=!0,o._IsVisibleRequest=!1,o._OrderMode=O.OrderModeEnum.CUSTOMER,o._Ref=null,o._SelectedFlight=null,o._ShowOperator=d.Operator.Hide,o._TourData=null,o._TourId=0,o._contractPage=null,o._flightsPage=null,o._operatorBookingPage=null,o._orderPage=null,o._orderFromAgencyPage=null,o._tourPage=null,o._showBuyTimeout=null,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.show=function(t){var e={IsVisibleAddToCart:this._IsVisibleAddToCart,IsVisibleBooking:this._IsVisibleBooking,IsVisibleBuyOnline:this._IsVisibleBuyOnline,IsVisibleCreateContract:this._IsVisibleCreateContract,IsVisibleCrm:this._IsVisibleCrm,IsVisibleFavoriteHotels:this._IsVisibleFavoriteHotels,IsVisibleOperatorBooking:this._IsVisibleOperatorBooking,IsVisibleOperatorLink:this._IsVisibleOperatorLink,IsVisibleRequest:this._IsVisibleRequest,ShowOperator:this._ShowOperator};m.router.goTo(v.RouterPath.Tours+"/"+(t||0),e),m.router.Changed.addOnce(new u.Delegate(this,this._onRouteChanged))},e.prototype.hide=function(){m.router.back(),this._tourPageHided()},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._tourPage){var o=e.ContentViewMode,i=e.ContractData,r=e.IsLoadingExtraFlights,s=e.InstructionMessage,l=e.IsSetTourHash,u=e.TourData;if((0,h.isDefined)(s)){return void n.layoutPageFactory.getPage().showMessage(s)}if((0,h.isDefined)(i))return void this._contractPage.update(i);if(this._flightsPage&&(0,h.isDefined)(r)&&this._flightsPage.update({IsVisibleWaiter:r}),(0,h.isDefined)(u)){this._updateSelectedFlight(),this._updateFlightsList();var c=(0,h.isDefined)(a.resultStore)&&(0,p.isEmptySettings)(a.resultStore.getActualSearchSettings());e.IsExpandHotelContent=c,e.SelectedFlight=this._SelectedFlight}l&&this._replaceTourHash(),this._tourPage.update(e),(0,h.isDefined)(o)&&this._updateContentViewMode(o)}},e.prototype.destroy=function(){this._clearTimeouts(),n.layoutPageFactory.PageCreated.remove(this),t.prototype.destroy.call(this)},e.prototype._init=function(){n.layoutPageFactory.PageCreated.addOnce(new u.Delegate(this,this._onPageCreated))},e.prototype._clearTimeouts=function(){clearTimeout(this._showBuyTimeout)},e.prototype._onPageCreated=function(t){switch(t.PageClassName){case L.TourPage.displayName:this._tourPage=n.layoutPageFactory.getPage(),this._tourPage.AddToCart.addOnce(new u.Delegate(this,this._onAddToCart)),this._tourPage.HotelTabClicked.addOnce(new u.Delegate(this,this._onHotelTabClicked)),this._tourPage.RedirectLinkClicked.addOnce(new u.Delegate(this,this._onRedirectLinkClicked)),this._tourPage.SendRequest.addOnce(new u.Delegate(this,this._onSendRequest)),this._tourPage.ShowBuy.addOnce(new u.Delegate(this,this._onShowBuy)),this._tourPage.ShowWhereBuy.addOnce(new u.Delegate(this,this._onShowWhereBuy)),this._tourPage.ShowFlightDetail.addOnce(new u.Delegate(this,this._onShowFlightDetail)),this._tourPage.ShowFlights.addOnce(new u.Delegate(this,this._onShowFlights)),this._tourPage.ShowRequest.addOnce(new u.Delegate(this,this._onShowRequest)),this._tourPage.ShowRoom.addOnce(new u.Delegate(this,this._onShowRoom)),this._tourPage.ShowTrackPrice.addOnce(new u.Delegate(this,this._onShowTrackPrice)),this._tourPage.ShowOperatorBooking.addOnce(new u.Delegate(this,this._onShowOperatorBooking)),this._tourPage.ShowVideo.addOnce(new u.Delegate(this,this._onShowVideo));break;case V.OrderCreatePage.displayName:this._orderPage=n.layoutPageFactory.getPage(),this._orderPage.SendRequest.addOnce(new u.Delegate(this,this._onSendRequest)),this._orderPage.ContractClicked.addOnce(new u.Delegate(this,this._onContractClicked));break;case R.OperatorBookingPage.displayName:this._operatorBookingPage=n.layoutPageFactory.getPage(),this._operatorBookingPage.SendRequest.addOnce(new u.Delegate(this,this._onSendRequest));break;case k.FlightSelectionListPage.displayName:this._flightsPage=n.layoutPageFactory.getPage(),this._flightsPage.Changed.addOnce(new u.Delegate(this,this._onFlightSetChanged));break;case E.ContractPage.displayName:this._contractPage=n.layoutPageFactory.getPage();break;case A.OrderFromAgencyPage.displayName:this._orderFromAgencyPage=n.layoutPageFactory.getPage(),this._orderFromAgencyPage.ActionClicked.addOnce(new u.Delegate(this,this._onTourWhereBuyActionClicked))}},e.prototype._onAddToCart=function(){var t={},e=I.tourUtils.getPrice(this._TourData,this._SelectedFlight);e>0&&(t.Price=e),this.AddToCart.fire(t)},e.prototype._onContractClicked=function(){m.router.goTo(v.RouterPath.Contract),this.ContractClicked.fire()},e.prototype._onFlightSetChanged=function(t){if(this._tourPage){var e=t.Flight;this._SelectedFlight=e,this._setSelectedFlight(),this._tourPage.update({SelectedFlight:this._SelectedFlight}),m.router.back()}},e.prototype._onHotelTabClicked=function(t){var e="",o=t.State,i=t.HotelId;switch(o){case g.HotelState.DESCRIPTION:e=v.RouterPath.Hotels+"/"+i+"/"+v.RouterPath.Description;break;case g.HotelState.REVIEWS:e=v.RouterPath.Hotels+"/"+i+"/"+v.RouterPath.HotelReviews;break;case g.HotelState.MAP:e=v.RouterPath.Hotels+"/"+i+"/"+v.RouterPath.Map;break;case g.HotelState.EXCURSION:e=v.RouterPath.Excursion+"/"+this._TourId}m.router.goTo(e)},e.prototype._onRouteChanged=function(t){var e=t.From,o=t.Navigation;e.includes(v.RouterPath.Tours+"/")&&o===w.NavigationDirection.Back&&(m.router.Changed.remove(this),this.Hide.fire(),this._tourPageHided())},e.prototype._onRedirectLinkClicked=function(){_.analiticManager.reachGoal(d.Metrica.TOURPARTNER)},e.prototype._onSendRequest=function(t){this.SendRequest.fire(t)},e.prototype._onShowBuy=function(t){var e=this._TourData.addpayments,o=I.tourUtils.hasInstantConfirmation(this._TourData),i=I.tourUtils.getIncludePrices(this._TourData,this._SelectedFlight),r=I.tourUtils.getPrice(this._TourData,this._SelectedFlight),n=I.tourUtils.getPriceType(this._TourData);m.router.goTo(v.RouterPath.Orders+"/"+t,{AddPayments:e,ClientData:this._ClientData,IncludePrices:i,IsVisibleConfirmation:o,Price:r,PriceType:n,SelectedFlight:this._SelectedFlight})},e.prototype._onShowWhereBuy=function(t){var e=I.tourUtils.getOnlinePartners(this._TourData);m.router.goTo(v.RouterPath.OrderFromAgency+"/"+t,{Items:e})},e.prototype._onShowFlights=function(){var t=this._TourData.flights,e={Currency:P.flightUtils.getFlightSelectionCurrency(t),Items:P.flightUtils.getFlightSelectionItems(t,this._SelectedFlight)};m.router.goTo(""+v.RouterPath.FlightList,e),this.MoreFlightsClicked.fire()},e.prototype._onShowFlightDetail=function(t){if(this._SelectedFlight){var e=t.Direction,o=this._TourData.regular,i=P.flightUtils.getDetailItems(this._SelectedFlight,e,o),r={Items:i};m.router.goTo(""+v.RouterPath.FlightDetail,r)}},e.prototype._onShowRequest=function(t){var e=t.TourId,o=I.tourUtils.getPrice(this._TourData,this._SelectedFlight),i=s.orderCatalog.getClientData(),r=S.clientUtils.getPromocodeEnabled(i),n=I.tourUtils.isFromTourvisorTour(this._ClientData),a=T.fromTourvisorService.hasFlag(),l={IsMobile:!0,Type:M.RequestType.SimpleRequest};n?l.IsFromTourvisor=n:a&&(l.IsFromTourvisorCookie=a),(0,f.showRequest)({IsEnabledMultiOffice:this._IsEnabledMultiOffice,IsEnabledPromocode:r,ModeView:d.ModeView.Mobile,PromocodeTourId:e,PromocodeTourPrice:o,SendClicked:new u.Delegate(this,this._onSendRequest,l)})},e.prototype._onShowRoom=function(t){var e=t.Id;(0,y.showRoom)({ActionSource:r.ActionStatisticsSource.TOURCARD,ModeView:d.ModeView.Mobile,RoomData:this._TourData.roomdata,RoomId:e})},e.prototype._onShowTrackPrice=function(){m.router.goTo(v.RouterPath.TrackPrice)},e.prototype._onShowOperatorBooking=function(t){var e=this._TourData.addpayments,o=I.tourUtils.getPrice(this._TourData,this._SelectedFlight),i=[I.tourUtils.getIncludeTourPrice(o)],r=I.tourUtils.getPriceType(this._TourData),n={AddPayments:e,IncludePrices:i,Price:o,PriceType:r,SelectedFlight:this._SelectedFlight};m.router.goTo(v.RouterPath.OperatorBooking+"/"+t,n)},e.prototype._onShowVideo=function(t){var e=t.HotelId,o=b.hotelUtils.getVideoLink(this._HotelData),i={VideoLink:o};m.router.goTo(v.RouterPath.Hotels+"/"+e+"/"+v.RouterPath.HotelVideo,i)},e.prototype._onTourWhereBuyActionClicked=function(t){var e=t.Action,o=t.Event;switch(e){case C.OnlinePartnerActionEnum.REDIRECT:_.analiticManager.reachGoal(d.Metrica.TOURREDIRECT);break;case C.OnlinePartnerActionEnum.MAP:(0,h.preventDefault)(o);var i=this._TourData.shortid;m.router.goTo(v.RouterPath.OrderFromAgencyOffice+"/"+i)}},e.prototype._replaceTourHash=function(){var t=this._TourData.shortid;t&&m.router.replace({Path:v.RouterPath.Tours+"/"+this._TourId,Url:(0,p.getCurrentURL)()+"#"+d.Hash.Tourid+"="+t})},e.prototype._setSelectedFlight=function(){s.orderCatalog.setSelectedFLightData(this._TourId,this._SelectedFlight)},e.prototype._tourPageHided=function(){this._clearTimeouts(),this._clearSelectedFlight(),this._tourPage.update({Reset:!0,SelectedFlight:this._SelectedFlight})},e.prototype._clearSelectedFlight=function(){this._SelectedFlight=null,this._setSelectedFlight()},e.prototype._updateContentViewMode=function(t){var e=this;t===D.TourCardContentViewModeEnum.ORDER&&(this._showBuyTimeout=setTimeout(function(){var t=e._TourData.tourid;e._onShowBuy(t)},300))},e.prototype._updateSelectedFlight=function(){var t=this._TourData.flights,e=P.flightUtils.getDefaultSet(t);this._SelectedFlight=e,this._setSelectedFlight()},e.prototype._updateFlightsList=function(){if(this._flightsPage){var t=this._TourData.flights,e={Currency:P.flightUtils.getFlightSelectionCurrency(t),Items:P.flightUtils.getFlightSelectionItems(t,this._SelectedFlight)};this._flightsPage.update(e)}},e}(l.Core);e.TourMobileController=N,t.TourMobileController=N}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardControl=void 0;var n=o(34),s=o(471),a=o(951),l=o(2),u=o(4),c=o(3),h=o(1),d=o(5),p=o(6),_=o(61),f=o(10),y=o(76),g=o(203),C=o(32),v=o(12),m=o(118),T=o(18),w=o(297),S=o(108),P=o(40),b=o(194),I=o(67),O=o(103),M=o(304),D=o(468),E=o(212),k=o(472),R=o(473),A=o(474),V=o(233),L=o(475),N=o(251),B=o(370),H=o(92),x=o(952),F=o(305),U=o(485),j=o(483),G=function(t){function e(e){var o=t.call(this,e)||this;return o.ClickAddToCart=new c.UserEvent,o.ClickBuy=new c.UserEvent,o.ClickFlightDetail=new c.UserEvent,o.ClickFlights=new c.UserEvent,o.ClickOperatorBooking=new c.UserEvent,o.ClickRedirectLink=new c.UserEvent,o.ClickRequest=new c.UserEvent,o.ClickTab=new c.UserEvent,o.ClickVideo=new c.UserEvent,o.ClickWhereBuy=new c.UserEvent,o.templateName="tour-card",o._ClientData=null,o._HotelData=null,o._IsActualizing=!1,o._IsLoadingFlights=!1,o._IsLoadingTour=!1,o._IsVisibleBooking=!0,o._IsVisibleCreateContract=!0,o._IsVisibleCrm=!0,o._IsVisibleOperatorBooking=!0,o._IsVisibleOperatorLink=!0,o._IsVisibleOperatorLogo=!1,o._IsVisibleWhereBuyOnline=!1,o._OrderMode=b.OrderModeEnum.CUSTOMER,o._ProgramData=null,o._ScrollNode=null,o._SelectedFlight=null,o._TourData=null,o._TourEnable=!0,o._TourId=0,o._ShowRoom=null,o._ClickTrackPrice=null,o._ClickExportCrm=null,o._currency=d.Currency.Rub,o._hotelButtons=null,o._hotelExpandNode=null,o._hotelId=0,o._hotelTitleControl=null,o._hotelVideoButton=null,o._resizeObserver=null,o._scrollObserver=null,o._tourCardActionButtonsControl=null,o._tourCardOptionsControl=null,o._tourCardPriceControl=null,o._tourContentControl=null,o._tourContentControlNode=null,o._tourFlightsListControl=null,o._accommodations=null,o._attractionList=null,o._description=null,o._importantInformationList=null,o._tourConditions=null,o._tourProgramList=null,o._accommodationsAccordion=null,o._attractionsAccordion=null,o._tourProgramAccordion=null,o._conditionsAccordion=null,o._importantInfoAccordion=null,o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.disable=function(){this._tourContentControl&&this._tourContentControl.update({}),this._disconnectObserver()},e.prototype.enable=function(){this._tourContentControl&&this._tourContentControl.update({}),this._observeResize(this._DomNode)},e.prototype.render=function(){t.prototype.render.call(this),this._renderTourContent(),this._renderHotelVideoButton(),this._renderTourTitle(),this._renderTourButtons(),this._renderTourFlightsList(),this._renderOptionsData(),this._rendeTourPrices(),this._renderAttractions(),this._renderDescription(),this._renderTourProgram(),this._renderAccommodations(),this._renderConditions(),this._renderImportantInformation(),this._scrollObserver=new g.ScrollObserver(this._onTourContentScroll),this._scrollObserver.observe(this._ScrollNode)},e.prototype.show=function(){t.prototype.show.call(this),this._tourContentControl&&this._tourContentControl.show()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.HotelData,i=e.IsActualizing,r=e.IsExpandHotelContent,n=e.IsLoadingFlights,s=e.IsLoadingTour,a=e.IsVisibleOperatorLogo,l=e.Reset,u=e.SelectedFlight,c=e.TourData,d=e.TourEnable;((0,h.isDefined)(c)||(0,h.isDefined)(a))&&this._updateOptionsData(),(0,h.isDefined)(s)&&(this._hotelTitleControl.update({IsVisiblePreview:s}),this._tourCardOptionsControl.update({IsVisiblePreview:s}),this._tourFlightsListControl.update({IsVisiblePreview:s}),this._tourCardPriceControl.update({IsVisiblePreview:s}),this._tourContentControl.update({IsVisiblePreview:s}),this._hotelVideoButton.update({IsVisiblePreview:s}),this._accommodationsAccordion.update({IsVisiblePreview:s}),this._attractionsAccordion.update({IsVisiblePreview:s}),this._description.update({IsVisiblePreview:s}),this._tourProgramAccordion.update({IsVisiblePreview:s}),this._conditionsAccordion.update({IsVisiblePreview:s}),this._importantInfoAccordion.update({IsVisiblePreview:s}),(0,h.setVisible)(this._hotelExpandNode,!s),(0,h.setVisible)(this._hotelButtons,!s),(0,h.setVisible)(this._tourCardActionButtonsControl,!s)),(0,h.isDefined)(n)&&this._tourFlightsListControl.update({IsVisiblePreview:n}),(0,h.isDefined)(i)&&this._tourCardPriceControl.update({IsVisibleWaiter:i}),(0,h.isDefined)(o)&&(this._updateHotelControls(),this._initControl()),(0,h.isDefined)(c)&&(this._updateCurrency(),this._updateWarning(),this._updateTourPrices(),this._updateOperatorLink(),this._updateTourTitle(),this._updateAttractions(),this._updateDescription(),this._updateTourProgram(),this._updateAccommodations(),this._updateConditions(),this._updateImportantInformation(),this._tourFlightsListControl.update({IsVisibleMoreButton:m.flightUtils.isVisibleMoreExtraSets(this._TourData.flights)})),(0,h.isDefined)(u)&&(this._tourFlightsListControl.update({FlightData:this._SelectedFlight}),this._updateTourPrices()),(0,h.isDefined)(d)&&this._updateTourEnabled(),(0,h.isDefined)(r)&&(0,h.updateClass)(this._tourContentControl,"TVHotelExpand",r),((0,h.isDefined)(c)||(0,h.isDefined)(s))&&(this._updateVisibleFlights(),this._updateVisibleWarning()),(0,h.isDefined)(l)&&this._showAccordionsContent(),this._tourCardActionButtonsControl.update(e)},e.prototype.destroy=function(){this._ClickTrackPrice=null,this._ClickExportCrm=null,this._ShowRoom=null,this._scrollObserver.unobserve(this._ScrollNode),this._disconnectObserver(),this._hotelExpandNode&&(0,h.removeEvent)(this._hotelExpandNode,"click",this._onHotelExpandButtonClick),t.prototype.destroy.call(this)},e.prototype._init=function(){this._onHotelExpandButtonClick=this._onHotelExpandButtonClick.bind(this),this._onTourContentScroll=this._onTourContentScroll.bind(this),this._onTourContentResize=this._onTourContentResize.bind(this)},e.prototype._onTourFlightDetailClicked=function(t){this.ClickFlightDetail.fire(t)},e.prototype._onTourFlightsMoreButtonClicked=function(){this.ClickFlights.fire()},e.prototype._initControl=function(){var t=this._nodes,e=t.disabledTour,o=t.tourInfo;(0,h.show)(o),(0,h.hide)(e)},e.prototype._updateHotelControls=function(){var t=this._nodes.hotelBlock,e=this._HotelData.hotelcode;this._hotelId=Number(e)||0,this._updateTourTitle();var o=this._getTourContentSettings();this._tourContentControl.update(o);var i=n.clientCatalog.getClientData(),r=C.clientUtils.getReviewMode(i),s=P.tourUtils.hasAboutHotel(this._HotelData),a=!this._ProgramData&&P.tourUtils.hasHotelCoords(this._HotelData),l=!!this._ProgramData&&!!this._ProgramData.full,u=S.reviewsUtils.reviewsEnabled(r,this._hotelId)&&(!this._ProgramData||s&&l);this._hotelButtons.update({AboutEnable:s,ExcursionEnable:l,MapEnable:a,ReviewsEnable:u}),this._hotelButtons.setIsVisible(s||a||l||u),(0,h.updateClass)(t,"TVExcursionData",!!this._ProgramData);var c=Boolean(T.hotelUtils.getVideoLink(this._HotelData));(0,h.setVisible)(this._hotelVideoButton,c)},e.prototype._renderTourContent=function(){var t=this._nodes.tourContent;this._tourContentControl=new E.AreaContentControl({ParentNode:t}),this._tourContentControlNode=this._tourContentControl.getDomNode()},e.prototype._getTourContentSettings=function(){switch(this._TourData.tourtype){case I.TourType.CRAFT:return O.craftTourUtils.getTourContentData(this._TourData);case I.TourType.EXCURSION:return w.programUtils.getTourContentData(this._ProgramData);case I.TourType.FLIGHT:default:var t=this._HotelData,e=t.rating,o=t.images;return{Description:t.hoteldescription,HotelId:this._hotelId,Images:o?o.map(function(t){return t.big}):[],Rating:Number(e),Title:""}}},e.prototype._renderTourTitle=function(){var t=(0,h.newDiv)("TVHotelTitleBlock",this._tourContentControlNode);this._hotelTitleControl=new H.HotelTitleControl({ParentNode:t}),this._hotelExpandNode=(0,h.newDiv)("TVHotelExpandButton",t),(0,h.addEvent)(this._hotelExpandNode,"click",this._onHotelExpandButtonClick)},e.prototype._updateTourTitle=function(){var t=this._HotelData,o=t.hotelname,i=t.hotelregionname,r=t.hotelstars,n=t.hotelactype,s=P.tourUtils.isHotelTour(this._TourData),a=P.tourUtils.isCraftTour(this._TourData),l=(0,h.getProperty)(this._HotelData,e.SUBREGION_NAME_PATH),u=a?0:n,c=a?O.craftTourUtils.getTourTypes(this._TourData):[];this._hotelTitleControl.update({Accomodation:u,IsTransformTitle:s,Name:o,Region:i,Stars:Number(r),SubRegion:l,Tags:c})},e.prototype._renderTourButtons=function(){this._hotelButtons=new N.HotelMobileButtonsControl({ParentNode:this._tourContentControlNode,Changed:new u.Delegate(this,this._onClickTab)})},e.prototype._renderHotelVideoButton=function(){var t=(0,h.newDiv)("TVHotelVideoContainer",this._tourContentControlNode);this._hotelVideoButton=new B.HotelMobileVideoButtonControl({ParentNode:t,Click:new u.Delegate(this,this._onVideoClicked)})},e.prototype._renderTourFlightsList=function(){var t=this._nodes.tourFlights;this._tourFlightsListControl=new U.TourFlightsListControl({ModeView:d.ModeView.Mobile,ParentNode:t,DetailClicked:new u.Delegate(this,this._onTourFlightDetailClicked),MoreButtonClicked:new u.Delegate(this,this._onTourFlightsMoreButtonClicked)})},e.prototype._renderOptionsData=function(){var t=this._nodes.optionsBlock;this._tourCardOptionsControl=new j.TourCardOptionsControl({Items:this._getTourOptionItems(),ParentNode:t})},e.prototype._updateOptionsData=function(){this._tourCardOptionsControl.update({Items:this._getTourOptionItems()})},e.prototype._getTourOptionItems=function(){var t=r({IsVisibleOperator:this._IsVisibleOperatorLogo,ShowRoom:this._ShowRoom},this._TourData||{});return P.tourUtils.isCraftTour(this._TourData)?M.tourCardOptionUtils.getCraftTourMobileOptions(t):M.tourCardOptionUtils.getMobileOptions(t)},e.prototype._updateOperatorLink=function(){this._tourCardActionButtonsControl.update({OperatorLink:P.tourUtils.getOperatorLink(this._TourData)})},e.prototype._rendeTourPrices=function(){var t=this._nodes.footer;this._tourCardPriceControl=new F.TourCardPriceControl({ParentNode:t}),this._tourCardActionButtonsControl=new x.TourCardActionButtonsControl({IsVisibleBooking:this._IsVisibleBooking,IsVisibleCreateContract:this._IsVisibleCreateContract,IsVisibleCrm:this._IsVisibleCrm,IsVisibleOperatorBooking:this._IsVisibleOperatorBooking,IsVisibleOperatorLink:this._IsVisibleOperatorLink,IsVisibleWhereBuyOnline:this._IsVisibleWhereBuyOnline,ParentNode:t,AddToCartClicked:new u.Delegate(this,this._onAddToCartClicked),BuyClicked:new u.Delegate(this,this._onBuyClicked),ContinueClicked:new u.Delegate(this,this._onContinueClicked),ExportCrmClicked:this._ClickExportCrm,OperatorBookingClicked:new u.Delegate(this,this._onOperatorBookingClicked),RedirectLinkClicked:new u.Delegate(this,this._onRedirectLinkClicked),RequestClicked:new u.Delegate(this,this._onRequestClicked),TrackPriceClicked:this._ClickTrackPrice,WhereBuyClicked:new u.Delegate(this,this._onWhereBuyClicked)})},e.prototype._updateTourPrices=function(){var t=P.tourUtils.hasInstantConfirmation(this._TourData),e=P.tourUtils.getPrice(this._TourData,this._SelectedFlight),o=P.tourUtils.getCurrency(this._TourData),i=P.tourUtils.getPriceType(this._TourData),r=P.tourUtils.getIncludePrices(this._TourData,this._SelectedFlight);this._tourCardPriceControl.update({Currency:o,IncludePrices:r,IsVisibleConfirmation:t,Price:e,PriceType:i}),this._tourCardActionButtonsControl.update({Currency:(0,p.getCurrencyValue)(o),Price:e})},e.prototype._renderAccommodations=function(){var t=this._nodes.accommodationsNode;this._accommodations=new D.AccommodationList({IsEnabledClampText:!0,IsVisibleFullText:!1}),this._accommodationsAccordion=(0,a.newAccordionText)({Content:this._accommodations,IsVisibleContent:!0,ParentNode:t,Title:"Проживание"})},e.prototype._updateAccommodations=function(){var t=this._nodes.accommodationsNode,e=O.craftTourUtils.getAccommodationItems(this._TourData),o=P.tourUtils.hasTourAccommodation(this._TourData);(0,h.setVisible)(t,o),o&&this._accommodations&&this._accommodations.update({IsVisibleFullText:!1,Items:e})},e.prototype._renderAttractions=function(){var t=this._nodes.attractionNode;this._attractionList=new k.AttractionList({StyleTheme:f.StyleThemeEnum.THEME2,View:R.AttractionListView.SLIDER}),this._attractionsAccordion=(0,a.newAccordionText)({Content:this._attractionList,IsVisibleContent:!0,ParentNode:t,Title:"Места и впечатления"})},e.prototype._updateAttractions=function(){var t=this._nodes.attractionNode,e=O.craftTourUtils.getAttractionItems(this._TourData),o=e.length>0;(0,h.setVisible)(t,o),o&&this._attractionList&&this._attractionList.update({Items:e})},e.prototype._renderDescription=function(){var t=this._nodes.descriptionNode;this._description=(0,a.newAccordionText)({Content:"",IsVisibleContent:!0,ParentNode:t,Title:"Описание тура"})},e.prototype._updateDescription=function(){var t,e=this._nodes.descriptionNode,o=null===(t=this._TourData)||void 0===t?void 0:t.fulldescription,i=Boolean(o);(0,h.setVisible)(e,i),i&&this._description.update({Content:o})},e.prototype._renderTourProgram=function(){var t=this._nodes.tourProgramNode;this._tourProgramList=new L.TourProgramList({GalleryType:V.TourProgramGalleryType.GALLERY,StyleTheme:f.StyleThemeEnum.THEME2}),this._tourProgramAccordion=(0,a.newAccordionText)({Content:this._tourProgramList,IsVisibleContent:!0,ParentNode:t,Title:"Программа тура"})},e.prototype._updateTourProgram=function(){var t=this._nodes.tourProgramNode,e=O.craftTourUtils.getTourProgramItems(this._TourData),o=e.length>0;(0,h.setVisible)(t,o),o&&this._tourProgramList&&this._tourProgramList.update({Items:e})},e.prototype._renderConditions=function(){var t=this._nodes.conditionsNode;this._tourConditions=new A.CraftTourConditions({}),this._conditionsAccordion=(0,a.newAccordionText)({Content:this._tourConditions,IsVisibleContent:!0,ParentNode:t,Title:"Условия"})},e.prototype._updateConditions=function(){var t=this._nodes.conditionsNode,e=this._TourData.includesConditions,o=this._TourData.notIncludesConditions,i=e.length>0||o.length>0;(0,h.setVisible)(t,i),i&&this._tourConditions&&this._tourConditions.update({Includes:e,NotIncludes:o})},e.prototype._renderImportantInformation=function(){var t=this._nodes.importantInformationNode;this._importantInformationList=new s.AccordionList({Color:_.ColorThemeEnum.INFO}),this._importantInfoAccordion=(0,a.newAccordionText)({Content:this._importantInformationList,IsVisibleContent:!0,ParentNode:t,Title:"Важная информация"})},e.prototype._updateImportantInformation=function(){var t=O.craftTourUtils.getImportantInformation(this._TourData),e=this._nodes.importantInformationNode,o=t.length>0;(0,h.setVisible)(e,o),o&&this._importantInformationList&&this._importantInformationList.update({Items:t})},e.prototype._showAccordionsContent=function(){if(this._rendered){var t={IsVisibleContent:!0};this._accommodationsAccordion.update(t),this._attractionsAccordion.update(t),this._description.update(t),this._tourProgramAccordion.update(t),this._conditionsAccordion.update(t),this._importantInfoAccordion.update(t)}},e.prototype._updateWarning=function(){this._nodes.warningMessageNode.innerHTML=(0,v.sanitizeHTML)(this._TourData.warningmessage)},e.prototype._updateVisibleFlights=function(){var t=this._nodes.tourFlights,e=P.tourUtils.isCraftTour(this._TourData),o=!e&&!P.tourUtils.isNoFlight(this._TourData);(0,h.setVisible)(t,o)},e.prototype._updateVisibleWarning=function(){var t=this._nodes.warningMessageNode,e=!this._IsLoadingTour&&t.innerHTML.length>0;(0,h.setVisible)(t,e)},e.prototype._onHotelExpandButtonClick=function(){(0,h.toggleClass)(this._tourContentControl.getDomNode(),"TVHotelExpand")},e.prototype._onRedirectLinkClicked=function(){this.ClickRedirectLink.fire()},e.prototype._onRequestClicked=function(){var t=this._TourData,e=t.operatorcode,o=t.tourid,i={OperatorId:e,TourId:o};this.ClickRequest.fire(i)},e.prototype._onVideoClicked=function(){var t={HotelId:this._hotelId};this.ClickVideo.fire(t)},e.prototype._onWhereBuyClicked=function(){this.ClickWhereBuy.fire(this._TourData.shortid)},e.prototype._onBuyClicked=function(){this._IsActualizing||this.ClickBuy.fire(this._TourData.tourid)},e.prototype._onOperatorBookingClicked=function(){this.ClickOperatorBooking.fire(this._TourData.tourid)},e.prototype._onContinueClicked=function(){var t=this._ScrollNode,e=t.clientHeight,o=t.scrollHeight,i=o-e-30;(0,h.setSmoothScrollTo)(this._ScrollNode,i,200)},e.prototype._onAddToCartClicked=function(){this.ClickAddToCart.fire()},e.prototype._onClickTab=function(t){var e=t.State,o={HotelId:this._hotelId,State:e};this.ClickTab.fire(o)},e.prototype._updateCurrency=function(){this._currency=this._TourData.currency},e.prototype._updateTourEnabled=function(){var t=this._nodes,e=t.disabledTour,o=t.tourInfo;(0,h.setVisible)(o,this._TourEnable),(0,h.setVisible)(e,!this._TourEnable)},e.prototype._updateVisibleTourPriceBlock=function(){var t=this._ScrollNode,e=t.clientHeight,o=t.scrollTop,i=t.scrollHeight,r=this._nodes.footer,n=o+e>=i-r.offsetHeight+60;(0,h.updateClass)(this._DomNode,"TVTourCardPriceHide",n)},e.prototype._onTourContentScroll=function(){this._updateVisibleTourPriceBlock()},e.prototype._onTourContentResize=function(){this._updateVisibleTourPriceBlock()},e.prototype._disconnectObserver=function(){this._resizeObserver&&((0,y.removeResizeObserver)(this._resizeObserver),this._resizeObserver=null)},e.prototype._observeResize=function(t){this._resizeObserver&&this._disconnectObserver(),this._resizeObserver=(0,y.newResizeObserver)(this._onTourContentResize,t)},e.SUBREGION_NAME_PATH="subregion.name",e}(l.Control);e.TourCardControl=G,t.TourCardControl=G}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__assign||function(){return i=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},i.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.newAccordionText=void 0;var r=o(61),n=o(300),s=function(t){return new n.Accordion(i(i({},t),{Color:r.ColorThemeEnum.TEXT}))};e.newAccordionText=s,t.newAccordionText=e.newAccordionText}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourCardActionButtonsControl=void 0;var r=o(2),n=o(4),s=o(3),a=o(1),l=o(5),u=o(6),c=o(42),h=o(40),d=o(8),p=o(306),_=o(237),f=o(194),y=o(487),g=o(85),C=o(494),v=o(298),m=function(t){function e(e){var o=t.call(this,e)||this;return o.AddToCartClicked=new s.UserEvent,o.BuyClicked=new s.UserEvent,o.ContinueClicked=new s.UserEvent,o.ExportCrmClicked=new s.UserEvent,o.OperatorBookingClicked=new s.UserEvent,o.RedirectLinkClicked=new s.UserEvent,o.RequestClicked=new s.UserEvent,o.TrackPriceClicked=new s.UserEvent,o.WhereBuyClicked=new s.UserEvent,o.templateName="tour-card-action-buttons",o._ClientData=null,o._CrmError="",o._CrmUrl="",o._Currency="",o._IsActualizing=!1,o._IsEnabledAddToCart=!1,o._IsVisibleAddToCart=!1,o._IsVisibleBooking=!0,o._IsVisibleBuyOnline=!1,o._IsVisibleCreateContract=!0,o._IsVisibleCrm=!0,o._IsVisibleOperatorBooking=!0,o._IsVisibleOperatorLink=!0,o._IsVisibleRequest=!1,o._IsVisibleWhereBuyOnline=!1,o._OperatorLink="",o._OrderMode=f.OrderModeEnum.CUSTOMER,o._Price=0,o._agencyActionsControl=null,o._managerActionsControl=null,o._requestBtn=null,o._tourBuyBtn=null,o._tourPreBuyBtn=null,o._tourBookingControl=null,o._redirectLink="",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderCommonButtons(),this._renderAgencyButtons(),this._renderManagersButtons(),this._renderCustomerButtons(),this._updateVisibleButtons()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ClientData,i=e.CrmError,r=e.CrmUrl,n=e.Currency,s=e.IsActualizing,l=e.IsEnabledAddToCart,u=e.IsVisibleAddToCart,c=e.IsVisibleBuyOnline,h=e.IsVisibleRequest,d=e.IsVisibleWhereBuyOnline,p=e.OperatorLink,_=e.OrderMode,f=e.Price;(0,a.isDefined)(_)&&this._updateVisibleButtons(),(0,a.isDefined)(u)&&this._updateAddToCartBtnsVisibility(),(0,a.isDefined)(c)&&this._updateBuyOnlineVisibility(),(0,a.isDefined)(h)&&this._updateRequestVisibility(),(0,a.isDefined)(d)&&this._updateAgencyActions(),(0,a.isDefined)(l)&&this._updateAddCartButton(),(0,a.isDefined)(p)&&this._updateOperatorLink(),(0,a.isDefined)(o)&&(this._updateBookings(),this._updareCrmName(),this._updateRedirectLink()),(0,a.isDefined)(f)&&this._updatePrice(f),(0,a.isDefined)(n)&&this._updateCurrency(),((0,a.isDefined)(r)||(0,a.isDefined)(i))&&this._updateCrmUrl(),(0,a.isDefined)(s)&&(this._updateEnableManagerActions(s),this._updateAgencyActions()),this._updateVisibilityManagerActions(e)},e.prototype._updateVisibleButtons=function(){var t=this._nodes,e=t.agencyBtns,o=t.customerBtns,i=t.bookingBtns,r=t.managersBtns;(0,a.setVisible)(r,this._OrderMode===f.OrderModeEnum.MANAGER),(0,a.setVisible)(i,this._OrderMode===f.OrderModeEnum.MANAGER&&this._IsVisibleBooking),(0,a.setVisible)(e,this._OrderMode===f.OrderModeEnum.AGENCY),(0,a.setVisible)(o,this._OrderMode===f.OrderModeEnum.CUSTOMER)},e.prototype._renderCustomerButtons=function(){var t=this._nodes.customerBtns;this._requestBtn=new g.ButtonWaiter({Class:"TVTourCardRequest",IsAnchor:!0,ParentNode:t,Click:new n.Delegate(this,this._onTourRequestBtnClick)}),this._tourBuyBtn=new g.ButtonWaiter({Class:"TVTourCardBuy",ParentNode:t,Click:new n.Delegate(this,this._onTourBuyBtnClick)})},e.prototype._renderCommonButtons=function(){var t=this._nodes.tourPriceBlock;this._tourPreBuyBtn=new g.ButtonWaiter({Class:"TVTourCardBuy",ParentNode:t,Click:new n.Delegate(this,this._onPreBuyBtnClick)}),c.customClassUtils.addTourCardPriceBlockClass(t)},e.prototype._renderAgencyButtons=function(){var t=this._nodes.agencyBtns;this._agencyActionsControl=new y.AgencyOrderActionsControl({Actions:this._getAgencyActions(),ModeView:l.ModeView.Mobile,ParentNode:t,Clicked:new n.Delegate(this,this._onAgencyActionClicked)})},e.prototype._renderManagersButtons=function(){var t=this._nodes,e=t.bookingBtns,o=t.managersBtns;this._managerActionsControl=new C.ManagerOrderActionsControl({ModeView:l.ModeView.Mobile,ParentNode:o,Clicked:new n.Delegate(this,this._onManagerActionClicked)}),this._tourBookingControl=new v.TourBookingControl({ModeView:l.ModeView.Mobile,ParentNode:e}),this._updateBookings()},e.prototype._onAgencyActionClicked=function(t){switch(t.Action){case p.AgencyOrderAction.BUY_ONLINE:this.WhereBuyClicked.fire();break;case p.AgencyOrderAction.REQUEST:this.RequestClicked.fire()}},e.prototype._onManagerActionClicked=function(t){switch(t.Action){case _.ManagerOrderAction.EXPORT_CRM:this.ExportCrmClicked.fire();break;case _.ManagerOrderAction.CREATE_CONTRACT:this.BuyClicked.fire();break;case _.ManagerOrderAction.OPERATOR_BOOKING:this.OperatorBookingClicked.fire()}},e.prototype._onTourRequestBtnClick=function(t){if(this._redirectLink.length>0)return void this.RedirectLinkClicked.fire();var e=t.Event;(0,a.preventDefault)(e),this.RequestClicked.fire()},e.prototype._onTourBuyBtnClick=function(){this.BuyClicked.fire()},e.prototype._onTourTrackPriceBtnClick=function(){this.TrackPriceClicked.fire()},e.prototype._onTourAddToCartBtnClick=function(){this._IsEnabledAddToCart&&this.AddToCartClicked.fire()},e.prototype._onPreBuyBtnClick=function(){this.ContinueClicked.fire()},e.prototype._updateAddCartButton=function(){var t=this;if(this._IsVisibleAddToCart){this._nodes.tourAddToCartBtn.forEach(function(e){t._IsEnabledAddToCart?(0,a.addEvent)(e,"click",t._onTourAddToCartBtnClick):(0,a.removeEvent)(e,"click",t._onTourAddToCartBtnClick),(0,a.updateClass)(e,d.TV_DISABLED,!t._IsEnabledAddToCart)})}},e.prototype._updateAddToCartBtnsVisibility=function(){var t=this;this._nodes.tourAddToCartBtn.forEach(function(e){(0,a.setVisible)(e,t._IsVisibleAddToCart)})},e.prototype._updateBuyOnlineVisibility=function(){(0,a.setVisible)(this._tourBuyBtn,this._IsVisibleBuyOnline)},e.prototype._updateRequestVisibility=function(){(0,a.setVisible)(this._requestBtn,this._IsVisibleRequest)},e.prototype._updateEnableTourBuyBtn=function(t){if(t)return void this._tourBuyBtn.update({IsEnabled:!0,WaiterVisible:!1});this._tourBuyBtn.update({IsEnabled:!1,WaiterVisible:!0})},e.prototype._updateBookings=function(){var t=this._nodes.bookingBtns,e=this._IsVisibleBooking&&h.tourUtils.hasBookingCenters(this._ClientData),o=e?h.tourUtils.getBookingCenters(this._ClientData):[];(0,a.setVisible)(t,e&&this._OrderMode===f.OrderModeEnum.MANAGER),this._tourBookingControl.update({BookingItems:o})},e.prototype._updateCrmUrl=function(){this._managerActionsControl.update({CrmUrl:this._CrmUrl,CrmError:this._CrmError})},e.prototype._updareCrmName=function(){this._CrmUrl="",this._CrmError="";var t=h.tourUtils.getManagerExportCrmName(this._ClientData);this._managerActionsControl.update({CrmError:this._CrmError,CrmName:t,CrmUrl:this._CrmUrl})},e.prototype._updateRedirectLink=function(){this._redirectLink=h.tourUtils.getRedirectLink(this._ClientData);var t=h.tourUtils.getRedirectText(this._ClientData)||"Запрос";this._requestBtn.update({Content:t,Link:this._redirectLink})},e.prototype._updateEnableManagerActions=function(t){var e=!t,o=e?l.ExportCrmStatus.ENABLE:l.ExportCrmStatus.DISABLE;this._updateEnableTourBuyBtn(e),this._tourBookingControl.update({IsEnableBooking:e}),this._managerActionsControl.update({CrmStatus:o,IsEnableCreateContract:e})},e.prototype._updateVisibilityManagerActions=function(t){var e=t.ClientData,o=t.IsVisibleBooking,i=t.IsVisibleCreateContract,r=t.IsVisibleCrm,n=t.IsVisibleOperatorBooking,s=t.IsVisibleOperatorLink,l={};((0,a.isDefined)(e)||(0,a.isDefined)(i))&&(l.IsVisibleCreateContract=this._IsVisibleCreateContract&&h.tourUtils.getManagerBuyOnlineEnabled(this._ClientData)),(0,a.isDefined)(s)&&(l.IsVisibleOperatorLink=this._IsVisibleOperatorLink),(0,a.isDefined)(o)&&(l.IsVisibleBooking=this._IsVisibleBooking),(0,a.isDefined)(n)&&(l.IsVisibleOperatorBooking=this._IsVisibleOperatorBooking),(0,a.isDefined)(r)&&(l.IsVisibleCrm=this._IsVisibleCrm),(0,u.isNotEmptyObject)(l)&&this._managerActionsControl.update(l)},e.prototype._updateOperatorLink=function(){this._managerActionsControl.update({OperatorLink:{href:this._OperatorLink}})},e.prototype._updatePrice=function(t){var e=this._nodes.tourPrice,o=t>0;e.textContent=o?(0,a.getPrice)(t):"",(0,a.setVisible)(e,o)},e.prototype._updateCurrency=function(){var t=this._nodes.tourCurrency;t.textContent=this._Currency,(0,a.setVisible)(t,Boolean(this._Currency))},e.prototype._updateAgencyActions=function(){this._agencyActionsControl.update({Actions:this._getAgencyActions()})},e.prototype._getAgencyActions=function(){var t=[];return this._IsVisibleWhereBuyOnline&&t.push({Action:p.AgencyOrderAction.BUY_ONLINE,IsEnabled:!this._IsActualizing}),t.push({Action:p.AgencyOrderAction.REQUEST,IsEnabled:!0}),t},e}(r.Control);e.TourCardActionButtonsControl=m,t.TourCardActionButtonsControl=m}).call(e,o(0))},function(t,e,o){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});var r=o(21),n=o(14),s=o(495),a=o(954),l=o(955),u=o(496),c=o(956),h=o(958),d=o(959),p=o(961),_=o(497),f=o(962),y=o(498),g=o(499),C=o(963),v=o(964),m=o(500),T=r.RouterPath,w=r.RouterPathParam;n.router.addRoutes((i={},i[T.Contract]=s.ContractPage,i[T.Hotels+"/"+w.HotelId+"/"+T.Description]=c.HotelDescriptionPage,i[T.Hotels+"/"+w.HotelId+"/"+T.HotelReviews]=d.HotelReviewsPage,i[T.Hotels+"/"+w.HotelId+"/"+T.ReviewsCreate]=C.CreateReviewPage,i[T.Hotels+"/"+w.HotelId+"/"+T.Map]=h.HotelMapPage,i[T.Hotels+"/"+w.HotelId+"/"+T.HotelVideo]=p.HotelVideoPage,i[T.Orders+"/"+w.TourId]=g.OrderCreatePage,i[T.OrderFromAgency+"/"+w.ShortTourId]=y.OrderFromAgencyPage,i[T.OrderFromAgencyOffice+"/"+w.ShortTourId]=f.OrderFromAgencyOfficePage,i[T.OperatorBooking+"/"+w.TourId]=_.OperatorBookingPage,i[T.Reviews+"/"+w.ReviewId]=v.ReviewPage,i[T.Tours+"/"+w.TourId]=m.TourPage,i[T.Excursion+"/"+w.TourId]=a.ExcursionPage,i[""+T.FlightDetail]=l.FlightDetailPage,i[""+T.FlightList]=u.FlightSelectionListPage,i))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ExcursionPage=void 0;var r=o(120),n=o(1),s=o(79),a=function(t){function e(e){var o=t.call(this,e)||this;return o._LayoutClass="TVExcursionPage",o._TourId=0,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype._getContent=function(){this._excursionProgramData||(this._excursionProgramData=(0,n.newDiv)("TVExcursionDescription"));var t=r.orderCatalog.getExcursionProgramData(this._TourId);return this._excursionProgramData.innerHTML=t&&t.full||"",this._excursionProgramData},e.displayName="ExcursionPage",e}(s.BaseOrderPage);e.ExcursionPage=a,t.ExcursionPage=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.FlightDetailPage=void 0;var r=o(482),n=o(79),s=function(t){function e(e){var o=t.call(this,e)||this;return o._Items=[],o._LayoutClass="TVFlightDetailPage",o._flightDetailList=null,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._flightDetailList&&this._flightDetailList.update(e)},e.prototype._getContent=function(){return this._flightDetailList||(this._flightDetailList=new r.FlightDetailListControl({Items:this._Items})),this._flightDetailList},e.displayName="FlightDetailPage",e}(n.BaseOrderPage);e.FlightDetailPage=s,t.FlightDetailPage=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelDescriptionPage=void 0;var r=o(4),n=o(14),s=o(957),a=o(79),l=function(t){function e(e){var o=t.call(this,e)||this;return o._LayoutClass="TVHotelDescriptionPage",o._HotelId=0,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._hotelDescriptionControl&&this._hotelDescriptionControl.update(e)},e.prototype._getContent=function(){return this._showWaiter(),this._hotelDescriptionControl||(this._hotelDescriptionControl=new s.MobileHotelDescriptionView({HotelId:this._HotelId,BackButtonClicked:new r.Delegate(this,this._onBack),DataLoaded:new r.Delegate(this,this._onReady)})),this._hotelDescriptionControl},e.prototype._onBack=function(){n.router.back()},e.prototype._onReady=function(){this._hideWaiter()},e.displayName="HotelDescriptionPage",e}(a.BaseOrderPage);e.HotelDescriptionPage=l,t.HotelDescriptionPage=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MobileHotelDescriptionView=void 0;var r=o(2),n=o(3),s=o(1),a=o(68),l=o(18),u=o(302),c=o(92),h=function(t){function e(e){var o=t.call(this,e)||this;return o.BackButtonClicked=new n.UserEvent,o.DataLoaded=new n.UserEvent,o._Class="TVMobileHotelDescriptionView",o._HotelId=0,o._hotelData=null,o.__initSettings(e),o._onBackButtonClick=o._onBackButtonClick.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){(0,s.removeEvent)(this._backButton,"click",this._onBackButtonClick),t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this);var e={ParentNode:this._DomNode};this._hotelTitleControl=new c.HotelTitleControl(e),this._hotelDescriptionControl=new u.HotelDescriptionControl(e),this._backButton=(0,s.newDiv)("TVMobileResultBtn",this._DomNode),(0,s.addEvent)(this._backButton,"click",this._onBackButtonClick),this._updateHotelData()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._updateHotelData()},e.prototype._onBackButtonClick=function(){this.BackButtonClicked.fire()},e.prototype._updateControls=function(){if(this._hotelTitleControl){var t=l.hotelUtils.getHotelCommonData(this._hotelData);this._hotelTitleControl.update(t)}if(this._hotelDescriptionControl){var t=l.hotelUtils.getHotelDesciptionData(this._hotelData);this._hotelDescriptionControl.update(t)}},e.prototype._updateHotelData=function(){var t=this;a.hotelDataService.getHotelDataById(this._HotelId).then(function(e){t._hotelData=e,t._updateControls(),t.DataLoaded.fire()})},e}(r.Control);e.MobileHotelDescriptionView=h,t.MobileHotelDescriptionView=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelMapPage=void 0;var r=o(68),n=o(501),s=o(79),a=function(t){function e(e){var o=t.call(this,e)||this;return o._LayoutClass="TVHotelMapPage",o._HotelId=null,o._MoveOnSwipeEnabled=!1,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e)},e.prototype._getContent=function(){var t=this;return this._hotelMap||(this._hotelMap=new n.HotelMapControl({})),r.hotelDataService.getHotelDataById(this._HotelId).then(function(e){t._hotelMap.update({HotelData:e})}),this._hotelMap},e.displayName="HotelMapPage",e}(s.BaseOrderPage);e.HotelMapPage=a,t.HotelMapPage=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelReviewsPage=void 0;var r=o(4),n=o(960),s=o(79),a=function(t){function e(e){var o=t.call(this,e)||this;return o._LayoutClass="TVHotelReviewsPage",o._HotelId=null,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._mobileReviewsControl&&this._mobileReviewsControl.update(e)},e.prototype._getContent=function(){return this._showWaiter(),this._mobileReviewsControl||(this._mobileReviewsControl=new n.MobileReviewsControl({HotelId:this._HotelId,Ready:new r.Delegate(this,this._onReady)})),this._mobileReviewsControl},e.prototype._onReady=function(){this._hideWaiter()},e.displayName="HotelReviewsPage",e}(s.BaseOrderPage);e.HotelReviewsPage=a,t.HotelReviewsPage=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MobileReviewsControl=void 0;var r=o(2),n=o(4),s=o(1),a=o(5),l=o(21),u=o(14),c=o(68),h=o(18),d=o(303),p=o(92),_=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="MobileReviewsControl",o._HotelId=0,o._Ready=null,t.prototype.__initSettings.call(o,e),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){this._Ready=null,t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this),this._hotelTitleControl=new p.HotelTitleControl({ParentNode:this._DomNode}),this._hotelReviewsController=new d.HotelReviewsController({ModeView:a.ModeView.Mobile,ParentNode:this._DomNode,AddReviewClicked:new n.Delegate(this,this._onAddReviewClicked),DataLoaded:this._Ready,ReviewShow:new n.Delegate(this,this._onReviewShow)}),this._loadHotelData()},e.prototype.update=function(e){t.prototype.update.call(this,e),(0,s.isDefined)(e.HotelId)&&this._loadHotelData()},e.prototype._loadHotelData=function(){var t=this;this._HotelId&&c.hotelDataService.getHotelDataById(this._HotelId).then(function(e){var o=h.hotelUtils.getHotelCommonData(e),i=h.hotelUtils.getReviewsServicesLinks(e);t._hotelTitleControl.update(o),t._hotelReviewsController.update({HotelId:t._HotelId,ReviewsServicesLinks:i})})},e.prototype._onAddReviewClicked=function(){u.router.goTo(l.RouterPath.Hotels+"/"+this._HotelId+"/"+l.RouterPath.ReviewsCreate,{HotelId:this._HotelId})},e.prototype._onReviewShow=function(t){u.router.goTo(l.RouterPath.Reviews+"/"+t.ReviewId,{HotelId:this._HotelId})},e}(r.Control);e.MobileReviewsControl=_,t.MobileReviewsControl=_}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelVideoPage=void 0;var r=o(467),n=o(1),s=o(79),a=function(t){function e(e){var o=t.call(this,e)||this;return o._LayoutClass="TVHotelVideoPage",o._VideoLink="",o._videoControl=null,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.VideoLink;(0,n.isDefined)(o)&&this._updateLink()},e.prototype._onHide=function(){t.prototype._onHide.call(this),this._resetContent()},e.prototype._getContent=function(){return this._videoControl||(this._videoControl=new r.VideoControl({Link:this._VideoLink})),this._videoControl},e.prototype._updateLink=function(){this._videoControl&&this._videoControl.update({Link:this._VideoLink})},e.prototype._resetContent=function(){this._videoControl&&this._videoControl.update({Reset:!0})},e.displayName="HotelVideoPage",e}(s.BaseOrderPage);e.HotelVideoPage=a,t.HotelVideoPage=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OrderFromAgencyOfficePage=void 0;var r=o(36),n=o(5),s=o(488),a=function(t){function e(e){var o=t.call(this,e)||this;return o._LayoutClass="TVOrderFromAgencyOfficePage",o._ShortTourId=0,o._tourBuyFromAgencyOfficeControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.show=function(){t.prototype.show.call(this),this._tourBuyFromAgencyOfficeControl&&this._tourBuyFromAgencyOfficeControl.show()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._tourBuyFromAgencyOfficeControl&&this._tourBuyFromAgencyOfficeControl.update(e)},e.prototype._getContent=function(){return this._tourBuyFromAgencyOfficeControl||(this._tourBuyFromAgencyOfficeControl=new s.TourBuyFromAgencyOfficeControl({ModeView:n.ModeView.Mobile,ShortTourId:this._ShortTourId})),this._tourBuyFromAgencyOfficeControl},e.displayName="OrderFromAgencyOfficePage",e}(r.Page);e.OrderFromAgencyOfficePage=a,t.OrderFromAgencyOfficePage=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CreateReviewPage=void 0;var r=o(41),n=o(5),s=o(18),a=o(476),l=o(79),u=function(t){function e(e){var o=t.call(this,e)||this;return o._LayoutClass="TVCreateReviewPage",o._HotelId=null,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype._getContent=function(){this._createReview||(this._createReview=new a.CreateHotelReviewControl({HotelId:this._HotelId}));var t=r.hotelsStore.getHotelData(this._HotelId),e=s.hotelUtils.getHotelTitleSettings(t);return this._createReview.update({HotelId:this._HotelId,HotelTitleSettings:e,ModeView:n.ModeView.Mobile}),this._createReview},e.displayName="CreateReviewPage",e}(l.BaseOrderPage);e.CreateReviewPage=u,t.CreateReviewPage=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ReviewPage=void 0;var r=o(41),n=o(1),s=o(68),a=o(477),l=o(18),u=o(965),c=o(79),h=function(t){function e(e){var o=t.call(this,e)||this;return o._LayoutClass="TVHotelReviewPage",o._HotelId=null,o._ReviewId=null,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype._getContent=function(){var t=this;return this._reviewCard||(this._reviewCard=new u.ReviewCardControl({})),this._showWaiter(),a.reviewDataService.getReviewById(this._ReviewId).then(function(e){var o=l.hotelUtils.getHotelId(e);s.hotelDataService.getHotelDataById(o).then(function(i){var s=l.hotelUtils.getName(i),a=l.hotelUtils.getStars(i),u=(0,n.getProperty)(i,"region.region_name"),c=l.hotelUtils.getSubRegionName(i),h=l.hotelUtils.getAcType(i);r.hotelsStore.setHotelData(o,{hotelname:s,hotelregionname:u,hotelstars:a,hotelsubregionname:c});var d={Accomodation:h,Name:s,Region:u,Stars:a,SubRegion:c};t._reviewCard.update({HotelTitleSettings:d,ReviewData:e}),t._hideWaiter()})}),this._reviewCard},e.displayName="ReviewPage",e}(c.BaseOrderPage);e.ReviewPage=h,t.ReviewPage=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ReviewCardControl=void 0;var r=o(2),n=o(1),s=o(108),a=o(478),l=o(92),u=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVReviewCardControl",o._ReviewData=null,o._HotelTitleSettings=null,t.prototype.__initSettings.call(o,e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._hotelTitleControl=new l.HotelTitleControl({ParentNode:this._DomNode}),this._reviewControl=new a.HotelReviewItemControl({ParentNode:this._DomNode})},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ReviewData,i=e.HotelTitleSettings;(0,n.isDefined)(i)&&this._hotelTitleControl.update(i),(0,n.isDefined)(o)&&this._reviewControl.update({Content:o.content,Id:o.id,Name:s.reviewsUtils.getReviewName(o),NegativeReview:o.xminus,PositiveReview:o.xplus,Rating:o.rate_our||0}),(0,n.scrollToTop)(100,0)},e}(r.Control);e.ReviewCardControl=u,t.ReviewCardControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TimeoutDialog=void 0;var r=o(1),n=o(43),s=function(t){function e(e){var o=t.call(this,e)||this;return o._updateUrl=e.UpdateUrl,o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),(0,r.addClass)(this._ParentNode,"TVTimeOutDialog"),(0,r.addClass)(this._DomNode,"TVTimeOutDialog"),(0,r.newDiv)("TVTimeOutDialogTitle",this._DomNode),(0,r.newDiv)("TVTimeOutDialogMessage",this._DomNode),this._updatePriceBtn=(0,r.newDiv)("TVTimeOutDialogUpdatePriceButton",this._DomNode),(0,r.addEvent)(this._updatePriceBtn,"click",this._updatePrice.bind(this))},e.prototype.show=function(){t.prototype.show.call(this),this._ParentNode.style.top="0"},e.prototype._updatePrice=function(){location.href=this._updateUrl},e}(n.PopUpBase);e.TimeoutDialog=s,t.TimeoutDialog=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.resultUtils=void 0;var i=o(1),r=o(5),n=function(){function t(){}return t.prototype.getMinPrice=function(t,e){var o=Number.MAX_VALUE,i=!!e;return t&&t.forEach(function(t){i?t.hotel.forEach(function(t){t.tour.forEach(function(t){t[r.TourParam.CityTo]===e&&(o=Math.min(t[r.TourParam.Price],o))})}):o=Math.min(t.minprice,o)}),o},t.prototype.getTourCount=function(t,e){if(!t)return 0;var o=!!e;return t.reduce(function(t,n){return t+((0,i.isArray)(n.hotel)?n.hotel.reduce(function(t,i){return t+(o?i.tour.reduce(function(t,o){return o[r.TourParam.CityTo]===e?t+1:t},0):i.tour.length)},0):0)},0)},t}();e.resultUtils=new n,t.resultUtils=e.resultUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ResultViewController=void 0;var n=o(48),s=o(159),a=o(56),l=o(17),u=o(54),c=o(9),h=o(4),d=o(3),p=o(7),_=o(1),f=o(30),y=o(5),g=o(6),C=o(22),v=o(37),m=o(24),T=o(172),w=o(278),S=o(62),P=o(969),b=o(315),I=function(t){function e(e){var o=t.call(this,e)||this;return o.ResultViewChanged=new d.UserEvent,o._ExpandAll=!1,o._ModeView=y.ModeView.DescTop,o._OperatorsFilterEnable=!1,o._ParentNode=null,o._PriceType=y.PriceType.ForRoom,o._Ref=null,o._ScrollOnStart=!0,o._ShowCart=0,o._ShowHelpForm=!0,o._ShowOperator=y.Operator.Hide,o._ShowTrack=!1,o._Theme=y.Theme.Theme2,o._ToursOnly=!1,o._Width=p.DEFAULT_RESULT_WIDTH,o._AddToursCount=0,o._HasResults=!1,o._MinPrice=Number.MAX_VALUE,o._NavigationPanelEnable=!0,o._NoMoreTours=!1,o._SearchMode=null,o._ShowTours=!1,o._ResultViewType=y.ResultViewType.List,o._mobileFilterTimeout=null,o._toursCount=0,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.render=function(){var t=C.authManager.getId(),e=t>0,o=new h.Delegate(this,this._onErrorReport),i=new h.Delegate(this,this._onResortHotelsShow),r=new h.Delegate(this,this._onResortMapClicked),n=new h.Delegate(this,this._onViewTypeChanged),s=new h.Delegate(this,this._onHotelsCollectionsChanged);this._resultMapController=new b.ResultMapController({ModeView:this._ModeView,Ref:this._Ref,Theme:this._Theme,ErrorReport:o,ResortHotelsShow:i,ViewTypeChanged:n}),this._listController=new P.ListController({ExpandAll:this._ExpandAll,HotelsCollectionsEnable:!e,MngId:t,ModeView:this._ModeView,NavigationPanelEnable:this._NavigationPanelEnable,OperatorsFilterEnable:this._OperatorsFilterEnable||e,ParentNode:this._ParentNode,PriceType:this._PriceType,Ref:this._Ref,ScrollOnStart:this._ScrollOnStart,ShowCart:this._ShowCart,ShowHelpForm:this._ShowHelpForm,ShowOperator:!!this._ShowOperator||e,ShowTrack:this._ShowTrack,Theme:this._Theme,ToursOnly:this._ToursOnly,Width:this._Width,ErrorReport:o,HotelsCollectionsChanged:s,ResortHotelsShow:i,ResortMapClicked:r,ViewTypeChanged:n}),C.authManager.LoginSuccess.addOnce(new h.Delegate(this,this._onAuthManagerAction)),C.authManager.Logout.addOnce(new h.Delegate(this,this._onAuthManagerAction)),this._listController.show()},e.prototype.update=function(e){if(t.prototype.update.call(this,e),(0,_.isDefined)(e.AddToursCount)&&(this._toursCount+=e.AddToursCount),(0,_.isDefined)(e.SearchMode))switch(this._SearchMode){case T.SearchResultMode.PREPARE:this._ModeView===y.ModeView.Mobile&&(e.UpdateSearchMode=!0);break;case T.SearchResultMode.START:this._toursCount=0,e.ToursCount=this._toursCount,e.ShowPopupResultDisable=!1;var o=l.resultStore.getActualSearchSettings();e.FlyMonth=o.FlyDates[0].getMonth()+1;break;case T.SearchResultMode.END:e.ToursCount=this._toursCount}this._ResultViewType===y.ResultViewType.Map?this._resultMapController.update(e):this._listController.update(e)},e.prototype.destroy=function(){C.authManager.LoginSuccess.remove(this),C.authManager.Logout.remove(this),t.prototype.destroy.call(this)},e.prototype._onErrorReport=function(t){var e=l.resultStore.getActualSearchSettings(),o="?type=error";o+="&comments="+encodeURIComponent(t.Comments),(0,_.isDefined)(t.Name)&&(o+="&name="+encodeURIComponent(t.Name)),(0,_.isDefined)(t.Contacts)&&(o+="&contacts="+encodeURIComponent(t.Contacts)),(0,_.isDefined)(t.ManagerId)&&(o+="&managerid="+t.ManagerId),o+="&url="+encodeURIComponent(m.searchUtils.getSearchURL(e)),(0,_.isDefined)(t.HotelId)&&(o+="&hotelid="+t.HotelId),n.jsonp.update({Url:f.CoreLinks.SendRequest}),n.jsonp.send(o,t.CallBack)},e.prototype._onResortHotelsShow=function(t){var e=t.Id,o=t.ParentId,i=o?p.FIX_SUBRESORT_ID+e:e,n=u.searchCatalog.getResorts(),a=n.find(function(t){return t.id===i}),c=[i];switch(0===a.parentid&&n.forEach(function(t){t.parentid===a.id&&c.push(t.id)}),this._ResultViewType){case y.ResultViewType.List:l.resultStore.setSearchFilter(r(r({},l.resultStore.getActualSearchFilter()),{Resorts:c})),this._ModeView===y.ModeView.Mobile&&(0,S.runSearch)();break;case y.ResultViewType.Map:(o?s.resortGate.getChildItem(e):s.resortGate.getItem(e))||(0,S.runSearch)(r(r({},l.resultStore.getActualSearchSettings()),{DeepSearch:y.DeepSearchMode.Enable,Resorts:c}))}},e.prototype._onHotelsCollectionsChanged=function(t){l.resultStore.setSearchFilter(r(r({},l.resultStore.getActualSearchFilter()),{Hotels:[],HotelsCollections:t.Selected||[]})),this._ModeView===y.ModeView.Mobile&&(clearTimeout(this._mobileFilterTimeout),this._mobileFilterTimeout=setTimeout(function(){(0,S.runSearch)()},w.SearchModule.FILTER_TIMEOUT))},e.prototype._onResortMapClicked=function(t){var e=a.resortsStore.getResort(t.Id);if(e){var o=v.searchMapUtils.getBounds(e);if(!o){var i=l.resultStore.getCountryInfo();o=v.searchMapUtils.getCountryBounds(i)}l.resultStore.setGlobals({SearchBounds:o,ToursGroup:y.ToursGroupBy.Resorts});var r=(0,_.getScrolls)().Y,n=l.resultStore.getActualSearchFilter()||{};this._resultMapController.Hide.addOnce(new h.Delegate(this,this._onResortMapHide,{ScrollTop:r,SearchFilter:n})),this._onViewTypeChanged({ViewType:y.ResultViewType.Map})}},e.prototype._onResortMapHide=function(t){this._resultMapController.Hide.remove(this);var e=t.ScrollTop,o=t.SearchFilter,i=l.resultStore.getActualSearchFilter()||{},r=0;if((0,g.isEqualsSettings)(i,o))r=e;else{r=(0,_.cumulativeOffset)(this._ParentNode).top}(0,_.setScrollTop)(r)},e.prototype._onViewTypeChanged=function(t){var e=t.ViewType;switch(this._ResultViewType=e,this._ResultViewType){case y.ResultViewType.List:var o={HasResults:this._HasResults,MinPrice:this._MinPrice,NoMoreTours:this._NoMoreTours,OperatorsFilterEnable:this._OperatorsFilterEnable,Ref:this._Ref,SearchMode:this._SearchMode,ShowTours:this._ShowTours,ToursCount:this._toursCount};this._SearchMode===T.SearchResultMode.END&&(o.ShowPopupResultDisable=!0),this._resultMapController.hide(),this._listController.update(o),this._listController.show();break;case y.ResultViewType.Map:this._listController.hide(),this._resultMapController.show()}this.ResultViewChanged.fire({Type:e})},e.prototype._onAuthManagerAction=function(){var t=C.authManager.getId(),e=t>0;this._listController.update({HotelsCollectionsEnable:!e,MngId:t,OperatorsFilterEnable:this._OperatorsFilterEnable||e,ShowOperator:!!this._ShowOperator||e,ShowTrack:this._ShowTrack})},e}(c.Core);e.ResultViewController=I,t.ResultViewController=I}).call(e,o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ListController=void 0;var s=o(66),a=o(56),l=o(17),u=o(54),c=o(9),h=o(4),d=o(3),p=o(7),_=o(1),f=o(5),y=o(20),g=o(94),C=o(52),v=o(24),m=o(25),T=o(40),w=o(72),S=o(172),P=o(62),b=o(970),I=o(973),O=o(238),M=o(981),D=o(71),E=function(e){function o(t){var o=e.call(this,t)||this;return o.ResortHotelsShow=new d.UserEvent,o._ExpandAll=!1,o._HotelsCollectionsEnable=!1,o._MngId=0,o._ModeView=f.ModeView.DescTop,o._NavigationPanelEnable=!0,o._Operators=[],o._OperatorsFilterEnable=!1,o._ParentNode=null,o._PriceType=f.PriceType.ForRoom,o._Ref=null,o._ScrollOnStart=!0,o._SearchMode=null,o._ShowCart=0,o._ShowHelpForm=!0,o._ShowOperator=!1,o._ShowTrack=!1,o._Theme=f.Theme.Theme2,o._ToursOnly=!1,o._Width=p.DEFAULT_RESULT_WIDTH,o._ErrorReport=null,o._HotelsCollectionsChanged=null,o._ResortMapClicked=null,o._ViewTypeChanged=null,o._countriesSearchFilter=null,o._delegateStoreChanged=null,o._lastRenderHotel=null,o._prevSearchId=0,o._prevSelectedResorts=null,o._renderCount=-1,o.__initSettings(t),o._init(),o.render(),(0,D.listenProgress)({ProgressChanged:new h.Delegate(o,o._onProgressChanged)}),o}return r(o,e),o.prototype.hide=function(){l.resultStore.Changed.remove(this),this._resultBody.hide(),this._prevSearchId=l.resultStore.getGlobals().SearchId},o.prototype.show=function(){this._searchResultBuilder.update({ToursGroup:(0,l.getActualToursGroup)()}),this._resultBody.show(),l.resultStore.Changed.addOnce(this._delegateStoreChanged),this._ModeView===f.ModeView.Mobile&&this._prevSearchId!==l.resultStore.getGlobals().SearchId&&this._resultBody.update({UpdateSearchMode:!0})},o.prototype.update=function(t){e.prototype.update.call(this,t),(0,_.isDefined)(t.AddToursCount)&&t.AddToursCount>0&&this._renderCount<O.ResultBuilder.RenderedBlockCount&&this._renderCount>-1&&(this._renderCount=this._searchResultBuilder.renderMore(this._renderCount)),(0,_.isDefined)(t.SearchMode)&&t.SearchMode===S.SearchResultMode.END&&(this._searchResultBuilder.end(),t.AllHotelsRendered=this._lastRenderHotel&&this._lastRenderHotel===this._searchResultBuilder.getLastRenderItem()),this._resultBody.update(t),this._searchResultBuilder.update(t)},o.prototype.render=function(){this._searchResultBuilder=new M.SearchResultBuilder({ExpandAll:this._ExpandAll,MngId:this._MngId,ModeView:this._ModeView,Ref:this._Ref,ShowCart:this._ShowCart,ShowHelpForm:this._ShowHelpForm,ShowOperator:this._ShowOperator,Theme:this._Theme,ToursGroup:(0,l.getActualToursGroup)(),CountryClicked:new h.Delegate(this,this._onCountryClicked),ResortClicked:new h.Delegate(this,this._onResortClicked),ResortMapClicked:this._ResortMapClicked,SendReport:this._ErrorReport,SendRequest:new h.Delegate(this,this._onSendRequest)});var t={HotelsCollectionsEnable:this._HotelsCollectionsEnable,NavigationPanelEnable:this._NavigationPanelEnable,SearchResultBuilder:this._searchResultBuilder,Theme:this._Theme,HotelsCollectionsChanged:this._HotelsCollectionsChanged,SearchMore:new h.Delegate(this,this._onSearchMore),ToursGroupChanged:new h.Delegate(this,this._onToursGroupChanged),ViewTypeChanged:this._ViewTypeChanged};this._ModeView===f.ModeView.DescTop?this._resultBody=new I.ResultBody(n(n({},t),{ErrorReport:this._ErrorReport,OperatorsFilterEnable:this._OperatorsFilterEnable,ParentNode:this._ParentNode,ScrollOnStart:this._ScrollOnStart,ShowTrack:this._ShowTrack,ToursOnly:this._ToursOnly,Width:this._Width})):this._resultBody=new b.MobileResultBody(n(n({},t),{SendRequest:new h.Delegate(this,this._onSendRequest)}))},o.prototype.destroy=function(){(0,D.unlistenProgress)(this),l.resultStore.Changed.remove(this),this._ErrorReport=null,this._HotelsCollectionsChanged=null,this._ResortMapClicked=null,this._ViewTypeChanged=null,e.prototype.destroy.call(this)},o.prototype._init=function(){this._onSearchMore=this._onSearchMore.bind(this),this._delegateStoreChanged=new h.Delegate(this,this._onResultStoreChanged)},o.prototype._onCountryClicked=function(t){this._countriesSearchFilter=l.resultStore.getActualSearchFilter();var e=t.CityToId,o=t.CountryId,i=t.Date,r=s.countryGate.getCityToItems(o),a=r.find(function(t){return t.id===e}),c=a.regions||[],h=u.searchCatalog.getResorts(),d=C.resortUtils.getResortsByCountry(o,h);m.settingUtils.checkSelectedAllResorts(d,c)&&(c=[]),l.resultStore.setActualCountryIdFromResult(o),l.resultStore.setSearchFilter(n(n({},this._countriesSearchFilter),{CityTo:e,Countries:[o],FlyDates:T.tourUtils.getCityToFlyDates(i),Resorts:c}),!0),this._updateToursGroup(f.ToursGroupBy.Hotels)},o.prototype._onProgressChanged=function(t){var e=t.Progress;t.SearchId===l.resultStore.getGlobals().SearchId&&this._resultBody.update({Progress:e})},o.prototype._onResortClicked=function(t){this._prevSelectedResorts=l.resultStore.getActualSearchSettings().Resorts,this.ResortHotelsShow.fire(t)},o.prototype._onResultStoreChanged=function(t){t.Type===y.CatalogName.ActualCountryId&&(this._renderCount=-1,this._searchResultBuilder.clear(),this._searchResultBuilder.update({ToursGroup:(0,l.getActualToursGroup)()}),this._prevSelectedResorts=null)},o.prototype._onSearchMore=function(){this._lastRenderHotel=this._searchResultBuilder.getLastRenderItem(),this._renderCount=this._searchResultBuilder.renderMore(),this._searchResultBuilder.hideLastQuestionBlock(),(0,P.continueSearch)()},o.prototype._onSendRequest=function(e){var o=n(n({},e),{Metrica:e.Metrica||f.Metrica.HelpTour,Source:f.OrderSource.FREE,TourId:0,Type:w.RequestType.SimpleRequest}),i=l.resultStore.getActualSearchSettings(),r=l.resultStore.getGlobals(),s=r.CustomData;v.searchUtils.updateSearchLink(o,i),v.searchUtils.updateCurrency(o,i),v.searchUtils.updateCustomData(o,s),t.orderManager.sendRequest(o)},o.prototype._onToursGroupChanged=function(t){var e=t.ToursGroup;switch(e){case f.ToursGroupBy.Countries:this._searchResultBuilder.update({ToursGroup:e});var o=l.resultStore.getSearchSettings();l.resultStore.setSearchFilter(n(n({},o),this._countriesSearchFilter),!0),l.resultStore.setActualCountryIdFromResult(0),l.resultStore.setToursGroup(e),this._searchResultBuilder.update({CountryResultRestore:!0});break;case f.ToursGroupBy.Hotels:this._updateToursGroup(e);break;case f.ToursGroupBy.Resorts:this._updateToursGroup(e),this._prevSelectedResorts&&(l.resultStore.setSearchFilter(n(n({},l.resultStore.getActualSearchFilter()),{Resorts:this._prevSelectedResorts}),!0),this._prevSelectedResorts=null);var i=l.resultStore.getActualCountryId();a.resortsStore.getResorts(i)||g.regionService.all({countryId:i}).then(function(t){a.resortsStore.setResorts(i,t)})}},o.prototype._updateToursGroup=function(t){this._searchResultBuilder.update({ToursGroup:t}),l.resultStore.setToursGroup(t)},o}(c.Core);e.ListController=E,i.ListController=E}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.MobileResultBody=void 0;var s,a=o(55),l=o(66),u=o(105),c=o(159),h=o(17),d=o(117),p=o(2),_=o(4),f=o(3),y=o(7),g=o(1),C=o(5),v=o(6),m=o(119),T=o(20),w=o(21),S=o(14),P=o(50),b=o(24),I=o(25),O=o(504),M=o(85),D=o(38),E=o(172),k=o(62),R=o(505),A=o(506),V=o(507),L=o(71),N=o(509);!function(t){t[t.HOTELS=0]="HOTELS",t[t.MAP=1]="MAP",t[t.POPUP=2]="POPUP"}(s||(s={}));var B=function(e){function o(t){var o=e.call(this,t)||this;return o.SearchMore=new f.UserEvent,o.SendRequest=new f.UserEvent,o.ToursGroupChanged=new f.UserEvent,o.ViewTypeChanged=new f.UserEvent,o.templateName="result-body-mobile",o._AvailableTourDateLinks=[],o._SearchResultBuilder=null,o._SearchMode=E.SearchResultMode.PREPARE,o._HasResults=!1,o._NavigationPanelEnable=!0,o._HotelsCollectionsEnable=!0,o._NoMoreTours=!1,o._Ref=null,o._ShowPopupResultDisable=!1,o._ShowTrack=!1,o._SearchId=-1,o._ToursCount=0,o._HotelsCollectionsChanged=null,o._domNodeUpdated=!1,o._hotelsPageReady=!1,o._isNewSearch=!0,o._selectedResortsStr=void 0,o._toursGroup=C.ToursGroupBy.Hotels,o._availableTourDates=null,o._hotelsCollections=null,o._loaderControl=null,o._navigationPanel=null,o._hotelsPage=null,o._searchMapPage=null,e.prototype.__initSettings.call(o,t),o._SearchResultBuilder.HotelClicked.add(new _.Delegate(o,o._onHotelClicked)),o.render(),o}return r(o,e),o.prototype.render=function(){var t=this;e.prototype.render.call(this),this._renderAvailableTourDates(),this._updateAvailableTourDates(),this._updateSearchMoreContent();var o=this._nodes,i=o.hotelsCollectionsNode,r=o.loaderNode,n=o.navigationNode,s=o.resultEmptyNode,a=h.resultStore.getActualSearchSettings();this._toursGroup=(0,h.getActualToursGroup)(),this._loaderControl=new d.MobileLoaderControl({ParentNode:r});new M.ButtonWaiter({Class:"TVSendRequestButton",ParentNode:s,Click:new _.Delegate(this,this._onShowRequestForm,{Metrica:C.Metrica.NoTour})});if(this._NavigationPanelEnable&&(this._navigationPanel=new A.NavigationResultPanel({IsCountriesSearch:this._toursGroup===C.ToursGroupBy.Countries,IsDisabledGrouping:(0,N.isDisabledGrouping)(a),ParentNode:n,MenuClick:new _.Delegate(this,this._onNavigationClicked)})),this._HotelsCollectionsEnable){var l=h.resultStore.getActualSearchSettings(),u=I.settingUtils.getCountryId(l);this._hotelsCollections=new O.SelectReadyHotelsCollectionsController({CountryId:u,ParentNode:i,Changed:this._HotelsCollectionsChanged})}this._SearchResultBuilder.ResortClicked.addOnce(new _.Delegate(this,function(){t._navigationPanel&&t._navigationPanel.update({IsSelectedResort:!0,ToursGroup:C.ToursGroupBy.Hotels}),t._goTop()})),h.resultStore.Changed.addOnce(new _.Delegate(this,this._onResultStoreChanged))},o.prototype.show=function(){var t=h.resultStore.getActualSearchSettings(),e=t.Resorts.toString();this._toursGroup=(0,h.getActualToursGroup)(),this._navigationPanel&&this._navigationPanel.update({IsSelectedResort:this._selectedResortsStr===e,MenuClickDisabled:!0,ToursGroup:this._toursGroup});var o=(0,L.getSearchProgress)().Progress;if(o>0&&o<100&&!this._loaderControl.getIsVisible()){0===this._getSearchResultItems().length&&this._loaderControl.show()}V.updateNotificationWindow.Click.addOnce(new _.Delegate(this,this._onClosePopupEnd))},o.prototype.hide=function(){V.updateNotificationWindow.Click.remove(this);var t=h.resultStore.getActualSearchSettings().Resorts;t.length>0&&(this._selectedResortsStr=t.toString())},o.prototype.update=function(o){t.mobilePanelMaster.BodyHide.addOnce(new _.Delegate(this,this._onSearchResultShow));var i=this._SearchMode;e.prototype.update.call(this,o);var r=o.AddToursCount,n=o.AvailableTourDateLinks,s=o.HasResults,a=(o.ShowFavoriteHotels,o.UpdateSearchMode),l=o.ToursCount;if(((0,g.isDefined)(r)&&r>0||(0,g.isDefined)(l)&&l>0)&&(this._loaderControl.hide(),(0,g.show)(this._nodes.searchButtonsNode),this._hotelsCollections)){var u=h.resultStore.getActualSearchSettings(),c=I.settingUtils.getCountryId(u);this._hotelsCollections.update({CountryId:c,HasResults:this._HasResults})}if((0,g.isDefined)(s)&&this._updateNavigationPanelVisibility(),(0,g.isDefined)(n)&&this._updateAvailableTourDates(),i!==this._SearchMode||a)switch(this._SearchMode){case E.SearchResultMode.PREPARE:this._searchMoreHide(),this._updateSearchMoreContent(),this._checkBoundsInUrl(),this._switchToPrepareMode();break;case E.SearchResultMode.START:this._switchToStartMode();break;case E.SearchResultMode.SEARCH:this._searchMoreShow();break;case E.SearchResultMode.END:this._switchToEndMode()}this._updateDomClass()},o.prototype.destroy=function(){var o,i,r,n,s,a,l,u;S.router.Changed.remove(this),h.resultStore.Changed.remove(this),V.updateNotificationWindow.Click.remove(this),t.mobilePanelMaster.BodyHide.remove(this),null===(i=null===(o=this._SearchResultBuilder)||void 0===o?void 0:o.HotelClicked)||void 0===i||i.remove(this),null===(n=null===(r=this._SearchResultBuilder)||void 0===r?void 0:r.ResortClicked)||void 0===n||n.remove(this),null===(a=null===(s=this._searchMapPage)||void 0===s?void 0:s.HotelClicked)||void 0===a||a.remove(this),null===(u=null===(l=this._searchMapPage)||void 0===l?void 0:l.ResortClicked)||void 0===u||u.remove(this),e.prototype.destroy.call(this)},o.prototype._renderAvailableTourDates=function(){var t=this._nodes.availableTourDatesNode;this._availableTourDates=new R.AvailableTourDates({ParentNode:t,Clicked:new _.Delegate(this,this._onAvailableTourDatesClicked)})},o.prototype._checkBoundsInUrl=function(){var t=h.resultStore.getGlobals().SearchBounds;(0,g.isDefined)(t)&&S.router.Changed.add(new _.Delegate(this,this._onRouterHotelsChanged,{ChangedType:s.HOTELS}))},o.prototype._goTop=function(){this._DomNode.scrollIntoView(!0)},o.prototype._onAvailableTourDatesClicked=function(t){var e=t.Link,o={};(0,v.findSettingsFromUrl)(o,e),(0,k.runSearchWithUpdateFilter)(o)},o.prototype._onClosePopupEnd=function(){V.updateNotificationWindow.update({ShowButton:!1}),this._searchResultsIsShown()&&(S.router.Changed.add(new _.Delegate(this,this._onRouterPopupChanged,{ChangedType:s.POPUP})),S.router.back())},o.prototype._onHelpSendClick=function(){this._onShowRequestForm({Metrica:C.Metrica.HelpTour})},o.prototype._onShowRequestForm=function(t){var e=(0,k.getRequestTourComment)();(0,m.showRequest)({Comment:e,ModeView:C.ModeView.Mobile,SendClicked:new _.Delegate(this,this._onSendRequest,{Metrica:t.Metrica})})},o.prototype._onSendRequest=function(t){var e=n(n({},t),{IsMobile:!0});this.SendRequest.fire(e)},o.prototype._onHotelClicked=function(t){var e=h.resultStore.getActualSearchSettings().Currency,o=t.Id;S.router.goTo(w.RouterPath.Hotels+"/"+o,{Currency:e,HotelId:o,Ref:this._Ref})},o.prototype._onResortClicked=function(t){var e=t.Id,o=t.ParentId;S.router.goTo(w.RouterPath.Resorts+"/"+e,{Id:e,ParentId:o,Ref:this._Ref})},o.prototype._onNavigationClicked=function(t){switch(t.Type){case A.NavigationResultPanelMenuType.Countries:this.ToursGroupChanged.fire({ToursGroup:C.ToursGroupBy.Countries});break;case A.NavigationResultPanelMenuType.Resorts:this.ToursGroupChanged.fire({ToursGroup:C.ToursGroupBy.Resorts});break;case A.NavigationResultPanelMenuType.Hotels:this.ToursGroupChanged.fire({ToursGroup:C.ToursGroupBy.Hotels});break;case A.NavigationResultPanelMenuType.Map:S.router.goTo(w.RouterPath.SearchMap),this._searchMapPage=a.layoutPageFactory.getPage(),this._searchMapPage.HotelClicked.addOnce(new _.Delegate(this,this._onHotelClicked)),this._searchMapPage.ResortClicked.addOnce(new _.Delegate(this,this._onResortClicked)),S.router.Changed.add(new _.Delegate(this,this._onRouterMapChanged,{ChangedType:s.MAP})),this.ViewTypeChanged.fire({ViewType:C.ResultViewType.Map})}},o.prototype._onRouterCountryChanged=function(t){var e=t.Navigation,o=t.Path;if(o&&e&&o===w.RouterPath.Countries&&e===P.NavigationDirection.Back){S.router.Changed.remove(this._onRouterCountryChanged),this._onNavigationClicked({Type:A.NavigationResultPanelMenuType.Countries});a.layoutPageFactory.getPage().update({})}},o.prototype._onRouterHotelsChanged=function(t){if(t.ChangedType===s.HOTELS){var e=t.Navigation,o=t.Path;o&&e&&o===w.RouterPath.Hotels&&e===P.NavigationDirection.Forward&&(S.router.Changed.remove(this._onRouterHotelsChanged),this._showMap())}},o.prototype._onRouterMapChanged=function(t){if(t.ChangedType===s.MAP){var e=t.From,o=t.Navigation,i=t.Path;i&&e&&o&&i===w.RouterPath.Hotels&&e===w.RouterPath.SearchMap&&o===P.NavigationDirection.Back&&(S.router.Changed.remove(this._onRouterMapChanged),this.ViewTypeChanged.fire({ViewType:C.ResultViewType.List}))}},o.prototype._onRouterPopupChanged=function(t){if(t.ChangedType===s.POPUP){var e=t.Path,o=t.Navigation;e!==w.RouterPath.Hotels&&o===P.NavigationDirection.Back?S.router.back():S.router.Changed.remove(this._onRouterPopupChanged)}},o.prototype._onSearchMoreBtnClick=function(){(0,g.hide)(this._nodes.searchMoreNode),this.SearchMore.fire(),this._searchMoreShow(!0)},o.prototype._onSearchRegularClick=function(){(0,k.runSearchWithUpdateFilter)({Regular:C.RegularTours.On})},o.prototype._onSearchResultShow=function(){t.mobilePanelMaster.BodyHide.remove(this),(0,g.hide)(V.updateNotificationWindow)},o.prototype._searchMoreHide=function(){this._SearchResultBuilder.isAllRendered()&&(0,g.hide)(this._nodes.searchMoreNode)},o.prototype._updateSearchMoreContent=function(){var t=h.resultStore.getActualSearchSettings().FormMode,e=t===D.SearchFormMode.HOTELS?y.SEARCH_MORE_HOTELS_CONTENT:y.SEARCH_MORE_TOURS_CONTENT;this._nodes.searchMoreBtn.textContent=e},o.prototype._searchMoreShow=function(t){void 0===t&&(t=!1);var e=this._nodes.searchMoreNode;switch(this._toursGroup){case C.ToursGroupBy.Countries:case C.ToursGroupBy.Resorts:(0,g.hide)(e);break;case C.ToursGroupBy.Hotels:var o=this._SearchResultBuilder.isAllRendered(),i=u.hotelGate.getItems()||[],r=i.length>0,n=t||(0,L.hasSearchInProgress)(),s=h.resultStore.getActualSearchFilter()||h.resultStore.getSearchSettings()||{},a=s.Hotels||[];if(a.length>0){var l=(0,k.filterUnsearchableHotels)(a);(0,g.setVisible)(e,l.length>0&&r)}else o&&(!r||this._NoMoreTours||n)||(0,g.show)(e)}this._updateNavigationPanel()},o.prototype._searchResultsIsShown=function(){var t,e,o;return!(0,g.isVisible)(null===(o=null===(e=null===(t=this._DomNode)||void 0===t?void 0:t.parentNode)||void 0===e?void 0:e.parentNode)||void 0===o?void 0:o.parentElement)},o.prototype._showMap=function(){var t=this;setTimeout(function(){t._hotelsPageReady?t._onNavigationClicked({Type:A.NavigationResultPanelMenuType.Map}):t._showMap()},100)},o.prototype._showPopupEnd=function(){if(this._ShowPopupResultDisable)return void(this._ShowPopupResultDisable=!1);var t={};this._searchResultsIsShown()&&(t.ShowButton=!0),V.updateNotificationWindow.show(n(n({},t),{ToursCount:this._ToursCount}))},o.prototype._switchToEndMode=function(){if(0===this._getSearchResultItems().length){this._loaderControl.hide(),(0,g.hide)(this._nodes.bodyNode),(0,g.show)(this._nodes.resultEmptyNode),(0,g.hide)(this._nodes.searchButtonsNode);var t=h.resultStore.getActualSearchSettings(),e=t.FormMode,o=t.Regular,i=o===C.RegularTours.On,r=e===D.SearchFormMode.FLIGHTS;return void(0,g.setVisible)(this._nodes.searchRegular,!i&&r)}this._searchMoreShow(),this._showPopupEnd()},o.prototype._switchToPrepareMode=function(){var t;if(this._isNewSearch){this._hotelsPageReady=!1;var e=h.resultStore.getActualCountryId(),o=0===e;S.router.goTo(o?w.RouterPath.Countries:w.RouterPath.Hotels),(null===(t=this._DomNode)||void 0===t?void 0:t.parentNode)||a.layoutPageFactory.getPage().setContent(this._DomNode),this._domNodeUpdated||(this._SearchResultBuilder.setDomNode(this._nodes.hotelsNode),this._domNodeUpdated=!0,this._updateNodes()),V.updateNotificationWindow.hide();var i=this._nodes,r=i.bodyNode,n=i.resultEmptyNode,s=i.searchButtonsNode,l=i.searchMoreNode;(0,g.hide)(s),(0,g.hide)(l),(0,g.hide)(n),(0,g.show)(r),(0,g.show)(V.updateNotificationWindow),this._loaderControl.show(),this._hotelsPageReady=!0}},o.prototype._switchToStartMode=function(){if(this._isNewSearch){a.layoutPageFactory.getPage().update({TrackPriceEnable:this._ShowTrack}),this._loaderControl.show(),this._isNewSearch=!1}},o.prototype._getSearchResultItems=function(){var t=[];switch(this._toursGroup){case C.ToursGroupBy.Countries:t=l.countryGate.getItems();break;case C.ToursGroupBy.Hotels:t=u.hotelGate.getItems();break;case C.ToursGroupBy.Resorts:t=c.resortGate.getItems()}return t},o.prototype._updateNodes=function(){var t=document.body;t.insertBefore(V.updateNotificationWindow.getDomNode(),t.childNodes[0])},o.prototype._updateDomClass=function(){var t=h.resultStore.getActualSearchSettings(),e=t.Currency,o=b.searchUtils.getPriceType(t),i="TVMobileSearchResults "+(0,v.getCurrencyCssClass)(e)+" TVTheme"+this._Theme[this._Theme.length-1];o===C.PriceType.ForPerson&&(i+=" TVSRPriceTypeMan"),this._DomNode.className=i},o.prototype._onResultStoreChanged=function(t){if(t.Type===T.CatalogName.ActualCountryId&&(this._toursGroup=(0,h.getActualToursGroup)(),this._navigationPanel&&this._navigationPanel.update({IsCountriesSearch:this._toursGroup===C.ToursGroupBy.Countries}),this._goTop(),this._isNewSearch=!0),t.Type===T.CatalogName.ToursGroup){var e=this._toursGroup;this._toursGroup=(0,h.getActualToursGroup)(),e===C.ToursGroupBy.Countries&&(S.router.goTo(w.RouterPath.Hotels),a.layoutPageFactory.getPage().setContent(this._DomNode),S.router.Changed.addOnce(new _.Delegate(this,this._onRouterCountryChanged))),this._goTop(),this._searchMoreShow()}if(t.Type===T.CatalogName.SearchSettings){var o=h.resultStore.getActualSearchSettings();this._navigationPanel&&this._navigationPanel.update({IsDisabledGrouping:(0,N.isDisabledGrouping)(o)})}},o.prototype._updateAvailableTourDates=function(){this._availableTourDates||this._renderAvailableTourDates(),this._availableTourDates.update({Items:this._AvailableTourDateLinks});var t=h.resultStore.getActualSearchSettings().FormMode,e=t===D.SearchFormMode.FLIGHTS,o=e&&(0,v.isNotEmptyArray)(this._AvailableTourDateLinks);(0,g.setVisible)(this._availableTourDates,o)},o.prototype._updateNavigationPanel=function(){this._navigationPanel&&this._navigationPanel.update({MenuClickDisabled:!0,ToursGroup:this._toursGroup}),this._updateNavigationPanelVisibility()},o.prototype._updateNavigationPanelVisibility=function(){if(this._navigationPanel){var t=h.resultStore.getActualSearchSettings(),e=this._HasResults&&this._toursGroup!==C.ToursGroupBy.Countries&&t.FormMode!==D.SearchFormMode.CRAFTTOURS;this._navigationPanel.setIsVisible(e)}},o}(p.Control);e.MobileResultBody=B,i.MobileResultBody=B}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ReadyHotelsCollections=void 0;var r=o(274),n=o(2),s=o(3),a=o(1),l=o(280),u=function(t){function e(e){var o=t.call(this,e)||this;return o.HideBtnClicked=new s.UserEvent,o.templateName="ready-hotels-collections",o._Class="TVReadyHotelsCollections",o._Items=[],o._Selected=[],o._Changed=null,o._collections=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._collections=new r.ListCheckBox({ParentNode:this._nodes.list,SelectionChanged:this._Changed})},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Items,i=e.Selected;(0,a.isDefined)(o)&&this._collections.update({Items:l.hotelsCollectionsUtils.generateCheckBoxsForReadyCollections(this._Items,"TVReadyCollectionItemName","TVReadyCollectionItemCount")}),(0,a.isDefined)(i)&&this._collections.update({Selected:this._Selected})},e.prototype._onToggleBtnClick=function(){var t=this._nodes,e=t.body,o=t.toggleBtn;(0,a.toggleClass)(o,"TVActive"),(0,a.toggleClass)(e,"TVHide")},e.prototype._onHideBtnClick=function(){this.hide(),this.HideBtnClicked.fire()},e}(n.Control);e.ReadyHotelsCollections=u,t.ReadyHotelsCollections=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.AvailableTourDate=void 0;var r=o(2),n=o(1),s=o(13),a=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="available-tour-date",o._DomNode=null,o._FlyDate=null,o._Night=0,o._Url="",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._DomNode.href=this._Url;var e=this._nodes,o=e.flyNode,i=e.nightNode,r=Boolean(this._FlyDate);r&&(o.textContent=s.FormatDate.getFormatDate(this._FlyDate,"DD MMM")),(0,n.setVisible)(o,r);var a=Boolean(this._Night);a&&(i.textContent="("+this._Night+" нч)"),(0,n.setVisible)(i,a)},e.prototype._onClicked=function(t){(0,n.preventDefault)(t);var e=t.currentTarget,o=e.href;this.Click.fire({Link:o})},e}(r.Control);e.AvailableTourDate=a,t.AvailableTourDate=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ResultBody=void 0;var n=o(31),s=o(78),a=o(34),l=o(66),u=o(105),c=o(17),h=o(2),d=o(4),p=o(3),_=o(7),f=o(1),y=o(5),g=o(6),C=o(22),v=o(121),m=o(20),T=o(24),w=o(25),S=o(504),P=o(38),b=o(172),I=o(62),O=o(506),M=o(974),D=o(71),E=o(509),k=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="result-body",o.ErrorReport=new p.UserEvent,o.SearchMore=new p.UserEvent,o.ToursGroupChanged=new p.UserEvent,o.ViewTypeChanged=new p.UserEvent,o._AllHotelsRendered=!1,o._FavoriteHotels=[],o._FixOnScroll=!1,o._HasResults=!1,o._HotelsCollectionsEnable=!0,o._MinPrice=Number.MAX_VALUE,o._MngId=0,o._NavigationPanelEnable=!0,o._NoMoreTours=!1,o._OperatorsFilterEnable=!1,o._ScrollOnStart=!0,o._SearchMode=null,o._SearchResultBuilder=null,o._ShowFavoriteHotels=!1,o._ShowTrack=!1,o._ToursCount=0,o._ToursOnly=!1,o._HotelsCollectionsChanged=null,o._resultToolbar=null,o._delegateResultStoreChanged=null,o._selectedResortsStr=void 0,o._toursGroup=y.ToursGroupBy.Hotels,t.prototype.__initSettings.call(o,e),o._delegateResultStoreChanged=new d.Delegate(o,o._onResultStoreChanged),o.render(),o}return i(e,t),e.prototype.hide=function(){c.resultStore.Changed.remove(this);var t=c.resultStore.getActualSearchSettings().Resorts;t.length>0&&(this._selectedResortsStr=t.toString())},e.prototype.show=function(){if(this._toursGroup=(0,c.getActualToursGroup)(),this._updateVisibleShowMore(),this._navigationPanel){var t=c.resultStore.getActualSearchSettings().Resorts.toString();this._navigationPanel.update({IsSelectedResort:this._selectedResortsStr===t,MenuClickDisabled:!0,ToursGroup:this._toursGroup})}c.resultStore.Changed.addOnce(this._delegateResultStoreChanged)},e.prototype.render=function(){var e=this;"auto"===this._Width&&this._ParentNode&&(this._Width=this._ParentNode.offsetWidth),t.prototype.render.call(this);var o=this._nodes,i=o.bodyNode,r=o.searchMoreBtn,a=c.resultStore.getActualSearchSettings(),l=this._SearchResultBuilder;if(this._toursGroup=(0,c.getActualToursGroup)(),this._resultToolbar=new M.ResultToolbar({IsAvailableOperatorFilter:this._OperatorsFilterEnable,IsAvailableTrackPrice:this._ShowTrack,IsEnabledSticky:this._ToursOnly,IsVisibleFavoritesHotels:this._ShowFavoriteHotels,IsVisibleShareLink:!this._ToursOnly,IsVisibleShowTours:!this._ToursOnly,Link:this._getSearchLink(),LinkWithoutDate:this._getSearchLinkWithoutDate(),ParentNode:i,ErrorReport:new d.Delegate(this,function(t){return e.ErrorReport.fire(t)}),OperatorFilterShow:new d.Delegate(this,function(){(0,s.reachGoal)(n.ActionStatisticsSource.SEARCH,n.ActionStatisticsType.OPERATOR_FILTERS)}),ShareLinkShow:new d.Delegate(this,function(){(0,s.reachGoal)(n.ActionStatisticsSource.SEARCH,n.ActionStatisticsType.SEARCH_URL)}),ShowToursClicked:new d.Delegate(l,l.expand),SortChanged:new d.Delegate(l,l.sort),UpClicked:new d.Delegate(this,this._goTop)}),this._NavigationPanelEnable&&(this._navigationPanel=new O.NavigationResultPanel({IsCountriesSearch:this._toursGroup===y.ToursGroupBy.Countries,IsDisabledGrouping:(0,E.isDisabledGrouping)(a),ParentNode:i,ToursGroup:this._toursGroup,MenuClick:new d.Delegate(this,this._onMenuClicked)})),this._HotelsCollectionsEnable){var u=w.settingUtils.getCountryId(a);this._hotelsCollections=new S.SelectReadyHotelsCollectionsController({CountryId:u,ParentNode:i,Changed:this._HotelsCollectionsChanged})}this._SearchResultBuilder.ResortClicked.addOnce(new d.Delegate(this,function(){e._navigationPanel&&e._navigationPanel.update({IsSelectedResort:!0,ToursGroup:y.ToursGroupBy.Hotels}),e._goTop()})),i.appendChild(this._SearchResultBuilder.getDomNode()),this._updateSearchMoreContent(),(0,f.hide)(r),c.resultStore.Changed.addOnce(new d.Delegate(this,this._onResultStoreChanged)),this._ScrollOnStart&&this._goTop()},e.prototype.update=function(e){var o=this._SearchMode;if((0,f.isDefined)(e.MinPrice)&&(e.MinPrice=Math.min(e.MinPrice,this._MinPrice)),t.prototype.update.call(this,e),this._hotelsCollections){var i=c.resultStore.getActualSearchSettings(),r=w.settingUtils.getCountryId(i);this._hotelsCollections.update({CountryId:r,HasResults:this._HasResults,MngId:this._MngId})}var n=e.FavoriteHotels,s=e.FixOnScroll,a=e.HasResults,l=e.OperatorsFilterEnable,u=e.Progress,h=e.ShowFavoriteHotels,d=e.ShowTrack;if((0,f.isDefined)(n)&&this._resultToolbar.update({FavoriteHotels:this._FavoriteHotels}),(0,f.isDefined)(s)&&this._resultToolbar.update({IsEnabledSticky:this._FixOnScroll}),(0,f.isDefined)(l)&&this._resultToolbar.update({IsVisibleOperatorFilter:this._OperatorsFilterEnable}),(0,f.isDefined)(d)&&this._resultToolbar.update({IsVisibleTrackPrice:this._ShowTrack}),(0,f.isDefined)(h)&&this._resultToolbar.update({IsVisibleFavoritesHotels:this._ShowFavoriteHotels}),(0,f.isDefined)(a)&&(this._updateNavigationPanelVisibility(),this._updateControlPanelBtns()),(0,f.isDefined)(u)&&this._resultToolbar.update({Progress:u}),o!==this._SearchMode)switch(this._SearchMode){case b.SearchResultMode.PREPARE:this._switchtoPrepareMode();break;case b.SearchResultMode.START:this._checkBoundsInUrl(),this._switchtoStartMode();break;case b.SearchResultMode.SEARCH:this._switchtoSearchingMode();break;case b.SearchResultMode.END:this._switchtoEndMode()}this._updateDomClass()},e.prototype.destroy=function(){this._HotelsCollectionsChanged=null,c.resultStore.Changed.remove(this),t.prototype.destroy.call(this)},e.prototype._switchtoPrepareMode=function(){var t=this._nodes.searchMoreBtn;this._updateSearchMoreContent(),(0,f.hide)(t)},e.prototype._switchtoStartMode=function(){this._MinPrice=Number.MAX_VALUE;var t=C.authManager.isManager(),e=a.clientCatalog.getClientData(),o=(0,v.isEnabledErrorManager)(t,e);this._resultToolbar.update({IsEnabledSticky:!0,IsVisibleSendError:o,IsVisibleShareLink:!this._ToursOnly,IsVisibleShowTours:!this._ToursOnly}),this._updateVisibleShowMoreHotels()},e.prototype._switchtoSearchingMode=function(){this._toursGroup===y.ToursGroupBy.Hotels&&this._updateVisibleShowMore()},e.prototype._switchtoEndMode=function(){this._updateVisibleShowMore(),this._updateControlPanelBtns(),this._updateNavigationPanelVisibility()},e.prototype._checkBoundsInUrl=function(){var t=c.resultStore.getGlobals().SearchBounds;(0,f.isDefined)(t)&&this._onMenuClicked({Type:O.NavigationResultPanelMenuType.Map})},e.prototype._onResultStoreChanged=function(t){if(t.Type===m.CatalogName.ActualCountryId||t.Type===m.CatalogName.SearchSettings||t.Type===m.CatalogName.FilterHotels){var e=r({},c.resultStore.getActualSearchSettings());if(t.SubType===m.CatalogName.Operators&&(e.Operators=t.Operators),(0,f.isDefined)(e.CityTo)){var o=c.resultStore.getActualCountryId(),i=l.countryGate.getCityToItems(o),n=i.find(function(t){return t.id===e.CityTo});e.Resorts=n&&n.regions||[]}this._resultToolbar.update({Link:this._getSearchLink(e),LinkWithoutDate:this._getSearchLinkWithoutDate(e)}),this._navigationPanel&&this._navigationPanel.update({IsDisabledGrouping:(0,E.isDisabledGrouping)(e)})}if(t.Type===m.CatalogName.FilterHotels){var s=(0,c.getActualToursGroup)();0===u.hotelGate.getItems().length&&s!==y.ToursGroupBy.Countries&&(0,f.hide)(this._nodes.searchMoreBtn)}if(t.Type===m.CatalogName.ActualCountryId&&(this._toursGroup=(0,c.getActualToursGroup)(),this._navigationPanel&&this._navigationPanel.update({IsCountriesSearch:this._toursGroup===y.ToursGroupBy.Countries,IsSelectedResort:!1,MenuClickDisabled:!0,ToursGroup:this._toursGroup}),this._ScrollOnStart&&this._goTop(),this._updateVisibleShowMore()),t.Type===m.CatalogName.ToursGroup){var a=this._toursGroup;this._toursGroup=(0,c.getActualToursGroup)(),a===y.ToursGroupBy.Countries&&this._goTop(),this._updateVisibleShowMore(),this._updateControlPanelBtns(),this._updateNavigationPanelVisibility()}},e.prototype._goTop=function(t){var o=(0,f.cumulativeOffset)(this._DomNode).top,i=(0,f.getDocumentSize)().Height;(0,f.getScrolls)().Y-o>e.FIX_SCROLL_HEIGHT&&(0,f.setScrollTop)(o+e.FIX_SCROLL_HEIGHT),o-=e.TOP_OFFSET,o=Math.max(0,o),i<o||(0,f.scrollToTop)(e.SCROLL_DURATION,o,t)},e.prototype._updateSearchMoreContent=function(){var t=this._getSearchFormMode(),e=t===P.SearchFormMode.HOTELS?_.SEARCH_MORE_HOTELS_CONTENT:_.SEARCH_MORE_TOURS_CONTENT;this._nodes.searchMoreBtn.textContent=e},e.prototype._onSearchMoreBtnClick=function(){this.SearchMore.fire();var t=this._nodes.searchMoreBtn;(0,f.hide)(t),this._updateVisibleShowMoreHotels()},e.prototype._updateVisibleShowMore=function(){var t=this._nodes.searchMoreBtn;switch(this._toursGroup){case y.ToursGroupBy.Countries:var e=this._SearchResultBuilder.getActiveItemsCount()>0;(0,f.setVisible)(t,e);break;case y.ToursGroupBy.Resorts:(0,f.hide)(t);break;case y.ToursGroupBy.Hotels:var o=this._SearchResultBuilder.getActiveItemsCount()>0,i=c.resultStore.getActualSearchFilter()||c.resultStore.getSearchSettings()||{},r=i.Hotels||[];if(r.length>0){var n=(0,I.filterUnsearchableHotels)(r);(0,f.setVisible)(t,n.length>0&&o);break}this._SearchResultBuilder.isAllRendered()&&(!o||this._NoMoreTours||(0,D.hasSearchInProgress)())||(0,f.show)(t)}},e.prototype._updateVisibleShowMoreHotels=function(){var t=this._nodes.searchMoreBtn,e=this._SearchResultBuilder.isAllRendered();this._toursGroup!==y.ToursGroupBy.Hotels||e||(0,f.show)(t)},e.prototype._onMenuClicked=function(t){switch(t.Type){case O.NavigationResultPanelMenuType.Countries:this.ToursGroupChanged.fire({ToursGroup:y.ToursGroupBy.Countries});break;case O.NavigationResultPanelMenuType.Resorts:this.ToursGroupChanged.fire({ToursGroup:y.ToursGroupBy.Resorts});break;case O.NavigationResultPanelMenuType.Hotels:this.ToursGroupChanged.fire({ToursGroup:y.ToursGroupBy.Hotels});break;case O.NavigationResultPanelMenuType.Map:this.ViewTypeChanged.fire({ViewType:y.ResultViewType.Map})}},e.prototype._updateDomClass=function(){var t=c.resultStore.getActualSearchSettings(),e=t.Currency,o=T.searchUtils.getPriceType(t),i=(0,f.classNames)("TVSearchResults",(0,g.getCurrencyCssClass)(e),"TVTheme"+this._Theme[this._Theme.length-1]);o===y.PriceType.ForPerson&&(i+=" TVSRPriceTypeMan"),this._DomNode.className=i},e.prototype._updateNavigationPanelVisibility=function(){if(this._navigationPanel){var t=this._getSearchFormMode(),e=this._HasResults&&this._toursGroup!==y.ToursGroupBy.Countries&&t!==P.SearchFormMode.CRAFTTOURS;this._navigationPanel.setIsVisible(e)}},e.prototype._updateControlPanelBtns=function(){this._resultToolbar.update({IsEnabledShowTours:this._HasResults&&this._toursGroup!==y.ToursGroupBy.Resorts,IsEnabledSortFilter:this._HasResults&&this._toursGroup===y.ToursGroupBy.Hotels})},e.prototype._getSearchLink=function(t){var e=(0,f.isDefined)(t)?t:c.resultStore.getActualSearchSettings();return T.searchUtils.getSearchURL(e)},e.prototype._getSearchLinkWithoutDate=function(t){var e=(0,f.isDefined)(t)?t:c.resultStore.getActualSearchSettings(),o=r({},e);return delete o.FlyDates,T.searchUtils.getSearchURL(o)},e.prototype._getSearchFormMode=function(){var t=c.resultStore.getActualSearchSettings(),e=t.FormMode;return void 0===e?P.SearchFormMode.FLIGHTS:e},e.FIX_SCROLL_HEIGHT=1500,e.SCROLL_DURATION=100,e.TOP_OFFSET=100,e}(h.Control);e.ResultBody=k,t.ResultBody=k}).call(e,o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ResultToolbar=void 0;var n=o(31),s=o(142),a=o(63),l=o(2),u=o(4),c=o(3),h=o(1),d=o(5),p=o(109),_=o(8),f=o(975),y=o(976),g=o(248),C=function(e){function o(t){var o=e.call(this,t)||this;return o.ErrorReport=new c.UserEvent,o.FavoriteHotelsClicked=new c.UserEvent,o.OperatorFilterShow=new c.UserEvent,o.ShareLinkShow=new c.UserEvent,o.ShowToursClicked=new c.UserEvent,o.SortChanged=new c.UserEvent,o.UpClicked=new c.UserEvent,o.templateName="result-toolbar",o._FavoriteHotels=[],o._IsEnabledShowTours=!1,o._IsEnabledSticky=!1,o._IsVisibleOperatorFilter=!1,o._IsVisibleSendError=!1,o._IsVisibleShareLink=!1,o._IsVisibleShowTours=!1,o._IsVisibleTrackPrice=!1,o._IsVisibleFavoritesHotels=!1,o._Link="",o._LinkWithoutDate="",o._Progress=0,o._favoriteHotelsMenu=null,o._operatorFilterController=null,o._progressBar=null,o._sortFilter=null,o._trackPricePanel=null,o._isVisibleFavoriteHotelsMenu=!1,o._isFixed=!1,o._progressEndTimeout=null,o.__initSettings(t),o._init(),o._Render&&o.render(),o}return r(o,e),o.prototype.render=function(){e.prototype.render.call(this),this._renderSortFilter(),this._renderShareLink(),this._renderShowTours(),this._renderOperatorNode(),this._renderProgressBar(),this._renderTrackPrice(),this._renderOperatorController(),this._renderFavoriteHotelsMenu(),this._renderUpNode(),this._updateFavoriteHotels(),this._updateOperatorsNode(),this._updateVisibleUpNode(),this._updateVisibleShareLink(),this._updateVisibleShowTours(),this._updateVisibleTrackPrice(),this._updateVisibleFavoriteHotels(),this._updateEnabledShowTours(),this._updateScrollEvent()},o.prototype.update=function(t){e.prototype.update.call(this,t);var o=t.FavoriteHotels,i=t.IsEnabledShowTours,r=t.IsEnabledSortFilter,n=t.IsEnabledSticky,s=t.IsVisibleFavoritesHotels,a=t.IsVisibleOperatorFilter,l=(t.IsVisibleSendError,t.IsVisibleShareLink),u=t.IsVisibleShowTours,c=t.IsVisibleTrackPrice,d=(t.Link,t.Progress);(0,h.isDefined)(n)&&(this._updateScrollEvent(),n||(this._setIsFixed(!1),this._updateToolbarByFixed())),(0,h.isDefined)(r)&&this._sortFilter.update({IsEnabled:r}),(0,h.isDefined)(l)&&this._updateVisibleShareLink(),(0,h.isDefined)(i)&&this._updateEnabledShowTours(),(0,h.isDefined)(u)&&this._updateVisibleShowTours(),(0,h.isDefined)(c)&&this._updateVisibleTrackPrice(),(0,h.isDefined)(a)&&(this._updateVisibleOperatorsNode(),this._operatorFilterController.update({IsEnabled:a})),(0,h.isDefined)(s)&&this._updateVisibleFavoriteHotels(),(0,h.isDefined)(d)&&this._updateProgressBar(),(0,h.isDefined)(o)&&this._updateFavoriteHotels()},o.prototype.destroy=function(){this._clear(),e.prototype.destroy.call(this)},o.prototype._init=function(){this._onScrollWindow=this._onScrollWindow.bind(this)},o.prototype._clear=function(){(0,h.removeEvent)(window,"scroll",this._onScrollWindow),clearTimeout(this._progressEndTimeout)},o.prototype._renderSortFilter=function(){this._sortFilter=new a.ComboBox({DropPanelClass:"TVResultToolbarSortPanel",Items:[{Content:"По цене",Selected:!0,Id:d.SortBy.Price},{Content:"По рейтингу",Id:d.SortBy.Rating},{Content:"По популярности",Id:d.SortBy.Popularity}],ParentNode:this._nodes.sortNode,WithArrow:!1,ItemSelected:new u.Delegate(this,this._onSortFilterChanged)})},o.prototype._renderShareLink=function(){this._nodes.shareLinkNode.title="Копировать ссылку на поиск"},o.prototype._renderShowTours=function(){this._nodes.showToursNode.title="Раскрыть/скрыть все туры"},o.prototype._renderOperatorNode=function(){this._nodes.operatorsNode.title="Фильтр по туроператорам"},o.prototype._renderProgressBar=function(){this._progressBar=new g.ProgressBar({ParentNode:this._nodes.progressNode})},o.prototype._renderTrackPrice=function(){var e=this._nodes.trackNode;this._trackPricePanel=t.newTrackPrice({Nodes:{ControlNode:e}})},o.prototype._renderOperatorController=function(){this._operatorFilterController=new y.OperatorController({ParentNode:this._nodes.floatNode,Hide:new u.Delegate(this,this._onOperatorFilterHide),PriceClicked:new u.Delegate(this,this._onOperatorPriceClicked),Show:new u.Delegate(this,this._onOperatorFilterShow)})},o.prototype._renderFavoriteHotelsMenu=function(){var t=this._nodes.favoriteHotelsNode;this._favoriteHotelsMenu=new f.FavoriteHotelsMenuDropPanel({ParentNode:t,Hide:new u.Delegate(this,this._onFavoriteHotelsMenuHided),MenuClicked:new u.Delegate(this,this._onFavoriteHotelsMenuClicked)}),t.title="Избранные отели"},o.prototype._renderUpNode=function(){this._nodes.upNode.title="Наверх"},o.prototype._onShareLinkNodeClick=function(){(0,p.showShare)({ActionSource:n.ActionStatisticsSource.SEARCH,ErrorData:{Url:this._Link},IsVisibleSendError:this._IsVisibleSendError,Link:this._Link||"",LinkWithoutDate:this._LinkWithoutDate||"",ModeView:d.ModeView.DescTop,SharePanelView:s.SharePanelViewEnum.SHARE_LINK})},o.prototype._onOperatorsNodeClick=function(){this._IsVisibleOperatorFilter&&(this._operatorFilterController.toggleVisibility(),this._updateDomNodeHeight())},o.prototype._onShowToursNodeClick=function(){this._IsVisibleShowTours&&this.ShowToursClicked.fire()},o.prototype._onUpNodeClick=function(){this.UpClicked.fire()},o.prototype._onFavoriteHotelsNodeClick=function(){this._isVisibleFavoriteHotelsMenu=!this._isVisibleFavoriteHotelsMenu,this._favoriteHotelsMenu.setVisible(this._isVisibleFavoriteHotelsMenu)},o.prototype._onFavoriteHotelsMenuHided=function(){this._isVisibleFavoriteHotelsMenu=!1},o.prototype._onFavoriteHotelsMenuClicked=function(t){this.FavoriteHotelsClicked.fire(t),this._favoriteHotelsMenu.hide()},o.prototype._updateVisibleUpNode=function(){(0,h.setVisible)(this._nodes.upNode,this._isFixed)},o.prototype._updateEnabledShowTours=function(){(0,h.updateClass)(this._nodes.showToursNode,_.TV_DISABLED,!this._IsEnabledShowTours)},o.prototype._updateFloatNodeByFixed=function(){(0,h.updateClass)(this._nodes.floatNode,_.TV_FIXED,this._isFixed)},o.prototype._updateFavoriteHotels=function(){this._nodes.favoriteHotelsNode.textContent=this._FavoriteHotels.length},o.prototype._updateOperatorsNode=function(){(0,h.updateClass)(this._nodes.operatorsNode,"TVShort",this._DomNode.offsetWidth<690)},o.prototype._updateVisibleFavoriteHotels=function(){(0,h.setVisible)(this._nodes.favoriteHotelsNode,this._IsVisibleFavoritesHotels)},o.prototype._updateVisibleOperatorsNode=function(){(0,h.setVisible)(this._nodes.operatorsNode,this._IsVisibleOperatorFilter)},o.prototype._updateVisibleProgressBar=function(){var t=100!==this._Progress;(0,h.setVisible)(this._nodes.progressNode,t)},o.prototype._updateVisibleShareLink=function(){(0,h.setVisible)(this._nodes.shareLinkNode,this._IsVisibleShareLink)},o.prototype._updateVisibleShowTours=function(){(0,h.setVisible)(this._nodes.showToursNode,this._IsVisibleShowTours)},o.prototype._updateVisibleTrackPrice=function(){var t=this._IsVisibleTrackPrice&&100===this._Progress;(0,h.setVisible)(this._nodes.trackNode,t)},o.prototype._onOperatorFilterHide=function(){this._updateDomNodeHeight()},o.prototype._onOperatorFilterShow=function(){this.OperatorFilterShow.fire()},o.prototype._onOperatorPriceClicked=function(){this._isFixed&&(this._operatorFilterController.hide(),this._onUpNodeClick())},o.prototype._onShareLinkShow=function(){this.ShareLinkShow.fire()},o.prototype._onSortFilterChanged=function(t){this.SortChanged.fire(t.Item.Id)},o.prototype._onScrollWindow=function(){var t;this._isFixed&&(null===(t=this._favoriteHotelsMenu)||void 0===t?void 0:t.getIsVisible())&&this._favoriteHotelsMenu.hide();var e=(0,h.getScrolls)(),o=(0,h.cumulativeOffset)(this._DomNode);e.Y>o.top&&this._isFixed||e.Y<=o.top&&!this._isFixed||(this._updateFloatNodeHeight(),this._setIsFixed(!this._isFixed),this._updateToolbarByFixed())},o.prototype._updateDomNodeHeight=function(){var t=this._isFixed?this._nodes.floatNode.offsetHeight-30+"px":"auto";this._DomNode.style.height=t},o.prototype._updateFloatNodeHeight=function(){this._nodes.floatNode.style.width=this._DomNode.offsetWidth+"px"},o.prototype._setIsFixed=function(t){this._isFixed=t},o.prototype._updateToolbarByFixed=function(){var t=this._sortFilter.getPanel(),e=t.getPanel();this._updateFloatNodeByFixed(),this._updateDomNodeHeight(),this._updateVisibleUpNode(),t.hide(),e.update({Fixed:this._isFixed}),this._trackPricePanel&&(this._trackPricePanel.hide(),this._trackPricePanel.update({Fixed:this._isFixed}))},o.prototype._updateProgressBar=function(){var t=this;switch(this._progressBar.setProgress(this._Progress),!0){case 0===this._Progress:this._updateVisibleProgressBar(),this._updateVisibleTrackPrice(),clearTimeout(this._progressEndTimeout);break;case 100===this._Progress:this._progressEndTimeout=setTimeout(function(){t._updateVisibleProgressBar(),t._updateVisibleTrackPrice()},1e3)}},o.prototype._updateScrollEvent=function(){this._IsEnabledSticky?(0,h.addEvent)(window,"scroll",this._onScrollWindow):(0,h.removeEvent)(window,"scroll",this._onScrollWindow)},o}(l.Control);e.ResultToolbar=C,i.ResultToolbar=C}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.FavoriteHotelsMenuDropPanel=void 0;var r=o(129),n=o(9),s=o(1),a=o(61),l=o(254),u=function(t){function e(e){var o=t.call(this,e)||this;return o._MenuItems=[],o._ParentNode=null,o._Hide=null,o._MenuClicked=null,o._menu=null,o._dropPanel=null,o.__initSettings(e),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._menu&&this._menu.update(e)},e.prototype.destroy=function(){this._MenuClicked=null,this._Hide=null,t.prototype.destroy.call(this)},e.prototype.show=function(){this._dropPanel||this._render(),this._dropPanel.show(),this._menu.update({ForceUpdate:!0}),this._updatePosition(this._ParentNode)},e.prototype.hide=function(){this._dropPanel&&this._dropPanel.hide()},e.prototype.setVisible=function(t){if(t)return void this.show();this.hide()},e.prototype.getIsVisible=function(){return Boolean(this._dropPanel)&&this._dropPanel.getIsVisible()},e.prototype._render=function(){this._renderMenu(),this._renderDropPanel()},e.prototype._renderDropPanel=function(){this._dropPanel=new r.DropPanel({Class:"FavoriteHotelsMenuDropPanel",ParentNode:this._ParentNode,Hide:this._Hide}),this._dropPanel.addChild(this._menu)},e.prototype._renderMenu=function(){this._menu=new l.ResultFavoriteHotelsMenuControl({Color:a.ColorThemeEnum.INFO,MenuClicked:this._MenuClicked})},e.prototype._updatePosition=function(t){var e=(0,s.cumulativeOffset)(t);this._dropPanel.updatePosition(e.left+5,t.offsetWidth,e.top,t.offsetHeight,(0,s.getCoords)(t))},e}(n.Core);e.FavoriteHotelsMenuDropPanel=u,t.FavoriteHotelsMenuDropPanel=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.OperatorController=void 0;var n=o(17),s=o(9),a=o(4),l=o(1),u=o(5),c=o(20),h=o(71),d=o(977),p=function(t){function e(e){var o=t.call(this,e)||this;return o._IsEnabled=!1,o._Operators=[],o._ParentNode=null,o._ToursGroup=u.ToursGroupBy.Hotels,o._Hide=null,o._PriceClicked=null,o._Show=null,o._activeOperatorIds=[],o._delegateProgressChanged=null,o._operatorFilter=null,o._prevActiveOperatorIds=[],o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.destroy=function(){this._Hide=null,this._PriceClicked=null,this._Show=null,n.resultStore.Changed.remove(this),(0,h.unlistenProgress)(this),t.prototype.destroy.call(this)},e.prototype.hide=function(){this._IsEnabled&&this._operatorFilter&&this._operatorFilter.hide()},e.prototype.show=function(){this._IsEnabled&&this._operatorFilter&&(this._operatorFilter.show(),this._updateOperatorFilter())},e.prototype.toggleVisibility=function(){this._operatorFilter&&(this._operatorFilter.getIsVisible()?this.hide():this.show())},e.prototype.update=function(e){t.prototype.update.call(this,e),(0,l.isDefined)(e.IsEnabled)&&this._updateEnabled()},e.prototype._clearOperatorFilter=function(){this._activeOperatorIds=[],this._prevActiveOperatorIds=[],this._operatorFilter&&this._operatorFilter.update({ActiveOperatorIds:[],Operators:[]})},e.prototype._filterOperators=function(){n.resultStore.filterHotelsByOperators(this._activeOperatorIds)},e.prototype._init=function(){this._ToursGroup=(0,n.getActualToursGroup)(),n.resultStore.Changed.addOnce(new a.Delegate(this,this._onResultStoreChanged)),this._delegateProgressChanged=new a.Delegate(this,this._onProgressChanged),this._updateEnabled()},e.prototype._onOperatorFilterChanged=function(t){var e=t.OperatorIds;0===this._activeOperatorIds.length&&0===e.length||(this._activeOperatorIds=e,this._filterOperators())},e.prototype._onProgressChanged=function(t){var e=t.Progress,o=t.SearchId;(0,h.getCountryIdBySearchId)(o)===n.resultStore.getActualCountryId()&&100===e&&this._updateOperatorFilter()},e.prototype._onResultStoreChanged=function(t){switch(t.Type){case c.CatalogName.ActualCountryId:this._ToursGroup=(0,n.getActualToursGroup)(),this._clearOperatorFilter();break;case c.CatalogName.FilterHotels:t.SettingsFireDisable||this._updateOperatorFilter();break;case c.CatalogName.Operators:this._updateOperatorFilter();break;case c.CatalogName.ToursGroup:var e=this._ToursGroup;this._ToursGroup=(0,n.getActualToursGroup)(),e===u.ToursGroupBy.Countries&&(this._prevActiveOperatorIds=this._activeOperatorIds,this._filterOperators()),this._ToursGroup===u.ToursGroupBy.Countries&&(this._activeOperatorIds=this._prevActiveOperatorIds,this._filterOperators())}},e.prototype._updateEnabled=function(){this.hide(),this._IsEnabled?(0,h.listenProgress)({ProgressChanged:this._delegateProgressChanged}):(0,h.unlistenProgress)(this)},e.prototype._updateOperatorFilter=function(){if(this._IsEnabled){this._operatorFilter||(this._operatorFilter=new d.OperatorFilter({IsVisible:!1,ParentNode:this._ParentNode,Changed:new a.Delegate(this,this._onOperatorFilterChanged),Hide:this._Hide,PriceClicked:this._PriceClicked,Show:this._Show}));var t=n.resultStore.getActualOperators(),e=n.resultStore.getActualOperatorsData(),o=n.resultStore.getFinishedSearching(),i=t.map(function(t){var i,n=(0,l.isDefined)(e[t.Id]);switch(!0){case n&&o:i=u.OpStatus.Result;break;case n||!o:i=t.Status;break;default:i=u.OpStatus.NoTours}return r(r({},t),{Price:n?e[t.Id]:0,Status:i})});this._operatorFilter.update({ActiveOperatorIds:this._activeOperatorIds,Operators:i})}},e}(s.Core);e.OperatorController=p,t.OperatorController=p}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var i,r=0,n=e.length;r<n;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.OperatorFilter=void 0;var n=o(29),s=o(2),a=o(4),l=o(3),u=o(1),c=o(5),h=o(503),d=o(978),p=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new l.UserEvent,o.Hide=new l.UserEvent,o.PriceClicked=new l.UserEvent,o.Show=new l.UserEvent,o.templateName="operator-filter",o._ActiveOperatorIds=[],o._Operators=[],o._allOperators=null,o._allOperatorsChecked=!0,o._operatorItems={},o._searchedOperatorIds=[],o._searchedOperators=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.hide=function(){t.prototype.hide.call(this),this.Hide.fire()},e.prototype.show=function(){t.prototype.show.call(this),this.Show.fire()},e.prototype.render=function(){t.prototype.render.call(this),this._allOperators=new n.CheckBox({Content:"Все туроператоры",IsChecked:0===this._ActiveOperatorIds.length,ParentNode:this._nodes.allOperatorsNode,Checked:new a.Delegate(this,this._onAllOperatorChecked)}),this._renderLists()},e.prototype.stopUpdate=function(){this._Operators.forEach(function(t){t.Status===c.OpStatus.Search&&(t.Status=0===t.Price?c.OpStatus.NoTours:c.OpStatus.Result)}),this._clear(),this._renderLists()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&(this._clear(),this._renderLists())},e.prototype._clear=function(){this._operatorItems={},this._searchedOperatorIds=[],this._rendered&&((0,u.removeChildren)(this._nodes.searchList),(0,u.removeChildren)(this._nodes.noToursList),(0,u.removeChildren)(this._nodes.noResponseList))},e.prototype._fireChanges=function(){if(0===this._ActiveOperatorIds.length)return void this.Changed.fire({OperatorIds:[]});var t=this._searchedOperators.filter(function(t){return t.getIsChecked()}).map(function(t){return t.getId()});0!==t.length&&this.Changed.fire({OperatorIds:t})},e.prototype._getRootByStatus=function(t){switch(t){case c.OpStatus.Search:case c.OpStatus.Result:return this._nodes.searchList;case c.OpStatus.NoTours:return this._nodes.noToursList;case c.OpStatus.NoResponse:return this._nodes.noResponseList}},e.prototype._onAllOperatorChecked=function(t){var e=t.IsChecked;this._allOperatorsChecked=e,this._searchedOperators.forEach(function(t){t.update({IsChecked:e})}),this._ActiveOperatorIds=[],this._fireChanges()},e.prototype._onMinPriceClicked=function(t){var e=t.OperatorId;this._setAllOperators(!1),this._searchedOperators.forEach(function(t){var o=t.getId()===e;t.update({IsChecked:o})}),this._ActiveOperatorIds=[e],this.Changed.fire({OperatorIds:[e]}),this.PriceClicked.fire()},e.prototype._onOperatorChecked=function(t){var e=t.IsChecked,o=t.OperatorId;if(e){this._searchedOperators.some(function(t){return!t.getIsChecked()})?(0,u.insertUnique)(this._ActiveOperatorIds,o):(this._setAllOperators(!0),this._ActiveOperatorIds=[])}else this._allOperatorsChecked&&(this._ActiveOperatorIds=r([],this._searchedOperatorIds,!0)),this._ActiveOperatorIds=this._ActiveOperatorIds.filter(function(t){return t!==o}),this._setAllOperators(!1);this._fireChanges()},e.prototype._onShowOperatorClick=function(){this.hide()},e.prototype._renderLists=function(){var t=this;this.getIsVisible()&&(this._searchedOperators=[],this._Operators.sort(h.operatorUtils.sort),this._Operators.forEach(function(e){var o=e.Id,i=e.Price,r=e.Name,n=e.Status,s=n===c.OpStatus.Search||n===c.OpStatus.Result;t._operatorItems[o]||(t._operatorItems[o]=new d.OperatorItem({Id:o,Name:r,Price:i,Status:n,IsChecked:t._allOperatorsChecked||t._ActiveOperatorIds.indexOf(o)>-1,ParentNode:t._getRootByStatus(n),Checked:new a.Delegate(t,t._onOperatorChecked,{OperatorId:o}),PriceClicked:new a.Delegate(t,t._onMinPriceClicked,{OperatorId:o})}),s&&t._searchedOperators.push(t._operatorItems[o])),s&&(0,u.insertUnique)(t._searchedOperatorIds,o)}),this._searchedOperatorIds.sort())},e.prototype._setAllOperators=function(t){this._allOperatorsChecked=t,this._allOperators.update({IsChecked:t})},e}(s.Control);e.OperatorFilter=p,t.OperatorFilter=p}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.OperatorItem=void 0;var r=o(29),n=o(2),s=o(4),a=o(3),l=o(1),u=o(5),c=function(t){function e(e){var o=t.call(this,e)||this;return o.Checked=new a.UserEvent,o.PriceClicked=new a.UserEvent,o._Id=0,o._Name="",o._Price=0,o._Status=u.OpStatus.Search,o._IsChecked=!0,o.__initSettings(e),o._onPriceClicked=o._onPriceClicked.bind(o),o.render(),o}return i(e,t),e.prototype.render=function(){switch(t.prototype.render.call(this),this._Status){case u.OpStatus.Search:case u.OpStatus.Result:this._renderSearch();break;case u.OpStatus.NoTours:case u.OpStatus.NoResponse:this._renderNoTours()}},e.prototype.getIsChecked=function(){return Boolean(this._checkBox)&&this._IsChecked},e.prototype.destroy=function(){(0,l.removeEvent)(this._priceNode,"click",this._onPriceClicked),t.prototype.destroy.call(this)},e.prototype.update=function(e){t.prototype.update.call(this,e),this._checkBox&&this._checkBox.update({IsChecked:this._IsChecked})},e.prototype._renderSearch=function(){var t=(0,l.newDiv)("TVCRow",this._DomNode);if(this._checkBox=new r.CheckBox({ParentNode:t,IsChecked:this._IsChecked,Content:this._Name,Id:this._Id,Checked:new s.Delegate(this,this._onCheckboxChanged)}),this._Price>0)this._priceNode=(0,l.newDiv)("TVCPrice",t),this._priceNode.innerHTML=(0,l.getPrice)(this._Price),(0,l.addEvent)(this._priceNode,"click",this._onPriceClicked);else{(0,l.newDiv)("TVSimpleWaiter",t)}},e.prototype._renderNoTours=function(){var t=(0,l.newDiv)("TVCRow",this._DomNode);(0,l.newDiv)("TVCName",t).innerHTML=this._Name},e.prototype._onCheckboxChanged=function(t){this._IsChecked=t.IsChecked,this.Checked.fire(t)},e.prototype._onPriceClicked=function(){this.PriceClicked.fire()},e}(n.Control);e.OperatorItem=c,t.OperatorItem=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HelpFormControl=void 0;var r=o(2),n=o(4),s=o(3),a=o(1),l=o(6),u=o(10),c=o(15),h=o(505),d=function(t){function e(e){var o=t.call(this,e)||this;return o.AvailableTourDateClicked=new s.UserEvent,o.SearchRegularClicked=new s.UserEvent,o.SubmitClicked=new s.UserEvent,o.templateName="help-form",o._AvailableTourDateLinks=[],o._IsVisibleHeader=!0,o._IsVisibleRegular=!1,o._IsVisibleRequest=!1,o._IsVisibleTourDates=!1,o._StyleTheme=u.StyleThemeEnum.THEME1,o._availableTourDatesControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._addStyleClass(),this._renderAvailableTourDates(),this._updateAvailableTourDates(),this._updateHeaderVisibility(),this._updateRegularVisibility(),this._updateRequestVisibility()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.AvailableTourDateLinks,i=e.IsVisibleHeader,r=e.IsVisibleRegular,n=e.IsVisibleRequest,s=e.IsVisibleTourDates;(0,a.isDefined)(o)&&this._updateAvailableTourDates(),((0,a.isDefined)(o)||(0,a.isDefined)(s))&&this._updateAvailableTourDatesVisibility(),(0,a.isDefined)(i)&&this._updateHeaderVisibility(),(0,a.isDefined)(r)&&this._updateRegularVisibility(),(0,a.isDefined)(n)&&this._updateRequestVisibility()},e.prototype._addStyleClass=function(){var t=c.styleUtils.getClassByTheme(this._StyleTheme);(0,a.addClass)(this._DomNode,t)},e.prototype._renderAvailableTourDates=function(){var t=this._nodes.availableTourDatesNode;this._availableTourDatesControl=new h.AvailableTourDates({ParentNode:t,Clicked:new n.Delegate(this,this._onAvailableTourDatesClicked)})},e.prototype._updateHeaderVisibility=function(){var t=this._nodes.headerNode;(0,a.setVisible)(t,this._IsVisibleHeader)},e.prototype._updateRegularVisibility=function(){var t=this._nodes.regularButton;(0,a.setVisible)(t,this._IsVisibleRegular)},e.prototype._updateRequestVisibility=function(){var t=this._nodes,e=t.requestHeaderNode,o=t.requestButton;(0,a.setVisible)(e,this._IsVisibleRequest),(0,a.setVisible)(o,this._IsVisibleRequest)},e.prototype._onAvailableTourDatesClicked=function(t){this.AvailableTourDateClicked.fire(t)},e.prototype._onRegularButtonClick=function(){this.SearchRegularClicked.fire()},e.prototype._onRequestButtonClick=function(){this.SubmitClicked.fire()},e.prototype._updateAvailableTourDates=function(){this._availableTourDatesControl||this._renderAvailableTourDates(),this._availableTourDatesControl.update({Items:this._AvailableTourDateLinks})},e.prototype._updateAvailableTourDatesVisibility=function(){var t=this._nodes.availableTourDatesNode,e=this._IsVisibleTourDates&&(0,l.isNotEmptyArray)(this._AvailableTourDateLinks);(0,a.setVisible)(this._availableTourDatesControl,e),(0,a.setVisible)(t,e)},e}(r.Control);e.HelpFormControl=d,t.HelpFormControl=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HelpRequestControl=void 0;var r=o(2),n=o(3),s=o(1),a=o(10),l=o(15),u=function(t){function e(e){var o=t.call(this,e)||this;return o.SubmitClicked=new n.UserEvent,o.templateName="help-request",o._StyleTheme=a.StyleThemeEnum.THEME1,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes,o=e.title,i=e.submit;o.textContent="Нужна помощь в подборе тура?",i.textContent="Оставить заявку";var r=l.styleUtils.getClassByTheme(this._StyleTheme);(0,s.addClass)(this._DomNode,r)},e.prototype._onSubmitClick=function(){this.SubmitClicked.fire()},e}(r.Control);e.HelpRequestControl=u,t.HelpRequestControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.SearchResultBuilder=void 0;var r=o(2),n=o(4),s=o(3),a=o(1),l=o(5),u=o(982),c=o(1007),h=o(1017),d=function(t){function e(e){var o=t.call(this,e)||this;return o.HotelClicked=new s.UserEvent,o.ResortClicked=new s.UserEvent,o._ExpandAll=!1,o._FlyMonth=0,o._Ref=null,o._ShowOperator=!1,o._ModeView=l.ModeView.DescTop,o._ShowCart=0,o._ShowHelpForm=!1,o._MngId=0,o._ToursGroup=l.ToursGroupBy.Hotels,o._CountryClicked=null,o._ResortMapClicked=null,o._SendReport=null,o._SendRequest=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){var e=this;t.prototype.render.call(this),this._countryBuilder=new u.CountryBuilder({ExpandAll:this._ExpandAll,ModeView:this._ModeView,ParentNode:this._DomNode,Ref:this._Ref,SendReport:this._SendReport,ShowHelpForm:this._ShowHelpForm,ShowOperator:this._ShowOperator,Theme:this._Theme,CountryClicked:this._CountryClicked,SendRequest:this._SendRequest}),this._hotelBuilder=new c.HotelBuilder({ExpandAll:this._ExpandAll,MngId:this._MngId,ModeView:this._ModeView,ParentNode:this._DomNode,Ref:this._Ref,SendReport:this._SendReport,ShowCart:this._ShowCart,ShowHelpForm:this._ShowHelpForm,ShowOperator:this._ShowOperator,Theme:this._Theme,HotelClicked:new n.Delegate(this,function(t){return e.HotelClicked.fire(t)}),SendRequest:this._SendRequest}),this._resortBuilder=new h.ResortBuilder({FlyMonth:this._FlyMonth,IsVisible:!1,ModeView:this._ModeView,ParentNode:this._DomNode,ShowHelpForm:this._ShowHelpForm,ShowOperator:this._ShowOperator,Theme:this._Theme,MapClicked:this._ResortMapClicked,ResortClicked:new n.Delegate(this,function(t){return e.ResortClicked.fire(t)}),SendRequest:this._SendRequest}),this._updateActiveBuilders()},e.prototype.update=function(e){var o=this._ToursGroup;t.prototype.update.call(this,e);var i=e.CountryResultRestore,r=e.ToursGroup;if(this._countryBuilder.update(e),this._hotelBuilder.update(e),this._resortBuilder.update(e),r&&o!==r){var n=(0,a.getScrolls)().Y;this._updateActiveBuilders(),(0,a.setScrollTop)(n)}i&&this._countryBuilder.update({PrevResultRestore:!0})},e.prototype.destroy=function(){this._CountryClicked=null,this._ResortMapClicked=null,this._SendReport=null,this._SendRequest=null,t.prototype.destroy.call(this)},e.prototype.clear=function(){this._countryBuilder.clear(),this._hotelBuilder.clear(),this._resortBuilder.clear()},e.prototype.expand=function(){this._activeBuilder.expand()},e.prototype.sort=function(t){this._activeBuilder.sort(t)},e.prototype.updateAll=function(){this._activeBuilder.updateAll()},e.prototype.isAllRendered=function(){return this._activeBuilder.isAllRendered()},e.prototype.getActiveItemsCount=function(){return this._activeBuilder.getActiveItemsCount()},e.prototype.hideLastQuestionBlock=function(){this._activeBuilder.hideLastQuestionBlock()},e.prototype.renderMore=function(t){return this._activeBuilder.renderMore(t)},e.prototype.getLastRenderItem=function(){return this._activeBuilder.getLastRenderedItem()},e.prototype.setDomNode=function(t){this._DomNode=t,this._countryBuilder.setParentNode(t),this._hotelBuilder.setParentNode(t),this._resortBuilder.setParentNode(t),this._DomNode.appendChild(this._countryBuilder.getDomNode()),this._DomNode.appendChild(this._hotelBuilder.getDomNode()),this._DomNode.appendChild(this._resortBuilder.getDomNode())},e.prototype.end=function(){this._countryBuilder.end(),this._hotelBuilder.end(),this._resortBuilder.end()},e.prototype._updateActiveBuilders=function(){switch(this._ToursGroup){case l.ToursGroupBy.Countries:this._activeBuilder=this._countryBuilder;break;case l.ToursGroupBy.Hotels:this._activeBuilder=this._hotelBuilder;break;case l.ToursGroupBy.Resorts:this._activeBuilder=this._resortBuilder}this._countryBuilder.setIsVisible(this._ToursGroup===l.ToursGroupBy.Countries),this._hotelBuilder.setIsVisible(this._ToursGroup===l.ToursGroupBy.Hotels),this._resortBuilder.setIsVisible(this._ToursGroup===l.ToursGroupBy.Resorts)},e.RenderedBlockCount=15,e}(r.Control);e.SearchResultBuilder=d,t.SearchResultBuilder=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CountryBuilder=void 0;var r=o(66),n=o(17),s=o(4),a=o(3),l=o(1),u=o(5),c=o(20),h=o(58),d=o(35),p=o(18),_=o(24),f=o(28),y=o(983),g=o(238),C=function(t){function e(e){var o=t.call(this,e)||this;return o.CountryClicked=new a.UserEvent,o._Sort=u.SortBy.Price,o._cityToCountry=0,o._cityToDate="",o._cityToId=0,o._expandedCityToTours={},o._isMobile=!1,o._prevExpandedItems=[],o._prevTourItemViewportTop=0,o.__initSettings(e),o._init(),o._initClass(),o._isMobile=(0,l.isMobile)(),o._restorePrevResult=o._restorePrevResult.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){e.PrevResultRestore&&setTimeout(this._restorePrevResult,g.ResultBuilder.UpdateDelay),t.prototype.update.call(this,e)},e.prototype._initClass=function(){this._Class=this._ModeView===u.ModeView.Mobile?"TVMCountryResultBodyContainer":this._Theme===u.Theme.Theme1?"TVSCountryResultBodyContainer":"TVCountryResultBodyContainer"},e.prototype._getBeforeItem=function(t){var e=this,o=t.getPrice();return this._activeItemsArr.find(function(t){var i=t.getPrice();return e._isRenderedItem(t)&&i>0&&o<i})||null},e.prototype._getItems=function(){var t=this,e=[];return r.countryGate.getItems().forEach(function(o){var i=t._items[o.id];(0,l.isDefined)(i)?i.update({Price:o.minprice}):i=t._addCountry(o),i&&e.push(i)}),e},e.prototype._isRenderedItem=function(t){return t&&!!t.getDomNode()&&!!t.getParentNode()&&!!t.getParentNode().parentNode},e.prototype._onResultStoreChanged=function(t){switch(t.Type){case c.CatalogName.SearchResults:var e=r.countryGate.getItem(t.CountryId);e&&(this._addCountry(e),this._updateRenderItems());break;case c.CatalogName.FilterHotels:this.filter();break;case c.CatalogName.ActualCountryId:this._expandedCityToTours={}}},e.prototype._removeLastNotVisibleItem=function(){if(this._itemsNotViewed.length>0){var t=this._activeItemsArr[this._getIndexOfLastRenderedItem()],e=this._itemsNotViewed.indexOf(t);this._itemsNotViewed.splice(e,1),this._DomNode.removeChild(t.getDomNode()),this._renderedCount--}},e.prototype._addCountry=function(t){var e=n.resultStore.getActualSearchSettings(),o=_.searchUtils.getCurrency(e),i=_.searchUtils.getPriceType(e),r=t.id;if((0,l.isDefined)(this._items[r]))this._items[r].update({Price:t.minprice});else{var a=n.resultStore.getLinks(r),u=p.hotelUtils.getHotelLink(a),c=h.countryUtils.getLink(t);this._items[r]=new y.CountryResultItem({Currency:o,Description:h.countryUtils.getDescription(t),ExpandedCityToTours:this._expandedCityToTours,Id:r,Image:f.pictureUtils.getHorizontalPhotos(t)[0],Link:h.countryUtils.getAboutLink(u,c),Name:t.name,Price:t.minprice,PriceType:i,VisaRequired:h.countryUtils.getVisaRequired(t),ModeView:this._ModeView,Render:!1,Theme:this._Theme,CityToToursExpanded:new s.Delegate(this,this._onCityToToursExpanded),Clicked:new s.Delegate(this,this._onCountryClicked),ExpandChanged:new s.Delegate(this,this._onItemExpandChanged),PriceChanged:new s.Delegate(this,this._onMinPriceChanged)}),this._addToActiveArr(this._items[r])}return this._items[r]},e.prototype._onCityToToursExpanded=function(t){var e=t.Id,o=t.Status;this._expandedCityToTours[e]=o},e.prototype._onCountryClicked=function(t){this._cityToId=t.CityToId,this._cityToDate=t.Date,this._cityToCountry=t.CountryId,this._prevExpandedItems=this._expandItems;var e=this._getTourItemDomNode();this._prevTourItemViewportTop=e&&e.getBoundingClientRect().top||0,this.CountryClicked.fire(t)},e.prototype._addToActiveArr=function(t){var e=t.getPrice();if(0===this._activeItemsArr.length||0===e)this._activeItemsArr.push(t);else{var o=this._activeItemsArr.findIndex(function(t){return e<t.getPrice()});o>-1?this._activeItemsArr.splice(o,0,t):this._activeItemsArr.push(t)}},e.prototype._restorePrevResult=function(){var t=this;this._prevExpandedItems.length>0&&(this._expandItems=this._prevExpandedItems,Object.keys(this._items).forEach(function(e){var o=Number(e);t._prevExpandedItems.indexOf(o)>-1&&t._items[e].update({Expand:!0})})),this._prevExpandedItems=[],(0,d.restorePrevScroll)({IsMobile:this._isMobile,Node:this._getTourItemDomNode(),ScrollNode:this._isMobile?(0,d.getScrolledParentNode)(this._DomNode):void 0,PrevBoundingClientRectTop:this._prevTourItemViewportTop})},e.prototype._getTourItemDomNode=function(){var t=this._items[this._cityToCountry];return t&&t.getTourItemNode(this._cityToId,this._cityToDate)},e}(g.ResultBuilder);e.CountryBuilder=C,t.CountryBuilder=C}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)},n=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var i,r=0,n=e.length;r<n;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.CountryResultItem=void 0;var s=o(66),a=o(195),l=o(44),u=o(4),c=o(3),h=o(1),d=o(5),p=o(91),_=o(58),f=o(37),y=o(114),g=o(1001),C=o(1004),v=o(314),m=function(t){function e(e){var o=t.call(this,e)||this;return o.Clicked=new c.UserEvent,o.ExpandChanged=new c.UserEvent,o._Currency=d.Currency.Rub,o._Description="",o._Expand=!1,o._ExpandedCityToTours={},o._Id=0,o._Image="",o._Link=null,o._ModeView=d.ModeView.DescTop,o._Name="",o._VisaRequired=!1,o._CityToToursExpanded=null,o._cityToTours=null,o._countryInfo=null,o._map=null,o._markers=[],o._switcher=null,o.__initSettings(e),o.templateName=o._ModeView===d.ModeView.Mobile?"country-result-item-mobile":"country-result-item",o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderInfo(),this._renderSwitcher()},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._rendered){var o=e.Expand,i=e.Price;if((0,h.isDefined)(o)){var r=this._Expand?d.HotelBlock.Buy:d.HotelBlock.None,n=!this._Expand;this._showTabByType(r,n)}if((0,h.isDefined)(i)){this._countryInfo.update({Price:this._Price});this._switcher.getId()===d.HotelBlock.Buy&&this._showBuyBlock()}}},e.prototype.getName=function(){return this._Name},e.prototype.getTourItemNode=function(t,e){return this._cityToTours.getTourItemNode(t,e)},e.prototype.clone=function(t){return new e(r(r({},t),{Description:this._Description,Id:this._Id,Image:this._Image,ModeView:this._ModeView,Name:this._Name,Theme:this._Theme,VisaRequired:this._VisaRequired}))},e.prototype._renderInfo=function(){var t=this._nodes.infoNode;this._countryInfo=new C.CountryResultInfoControl({Currency:this._Currency,Description:this._Description,Flag:_.countryUtils.getFlagUrl(this._Id),Id:this._Id,IsRequiredVisa:this._VisaRequired,Link:this._Link,ModeView:this._ModeView,Name:this._Name,ParentNode:t,Picture:this._Image,Price:this._Price,PriceType:this._PriceType,Theme:this._Theme,PriceClicked:new u.Delegate(this,this._onPriceClicked),TabClicked:new u.Delegate(this,this._onNavButtonClicked)})},e.prototype._renderSwitcher=function(){var t=this._nodes,e=t.mapBlock,o=t.priceBlock;this._switcher=new l.LayerSwitch,this._switcher.add(e,d.HotelBlock.Map),this._switcher.add(o,d.HotelBlock.Buy),this._switcher.showById(d.HotelBlock.None)},e.prototype._updatePrice=function(){this._countryInfo&&this._countryInfo.update({Price:this._Price})},e.prototype._closeTabs=function(){this._countryInfo&&this._countryInfo.update({ActiveTab:d.HotelBlock.None}),this._switcher&&this._switcher.showById(d.HotelBlock.None)},e.prototype._onItemClicked=function(t){t.CountryId=this._Id,this.Clicked.fire(t)},e.prototype._onNavButtonClicked=function(t){var e=t.Id;t.IsLink||this._showTabByType(e)},e.prototype._onInfoNodeClick=function(){this._showTabByType(d.HotelBlock.Buy,!0)},e.prototype._onPriceClicked=function(){var t=this._switcher.getId();this._showTabByType(t===d.HotelBlock.None?d.HotelBlock.Buy:d.HotelBlock.None)},e.prototype._showTabByType=function(t,e){if(t===d.HotelBlock.None){this._closeTabsWithScroll(e);var o={Expand:!1,Id:this._Id};return void this.ExpandChanged.fire(o)}if(t===this._switcher.getId())return void this._showTabByType(d.HotelBlock.None,e);this._switcher.showById(t),this._countryInfo.update({ActiveTab:t}),this._showBlockByType(t);var i={Expand:!0,Id:this._Id};this.ExpandChanged.fire(i)},e.prototype._showBlockByType=function(t){switch(t){case d.HotelBlock.Buy:this._showBuyBlock();break;case d.HotelBlock.Map:this._showMapBlock()}},e.prototype._showBuyBlock=function(){var t=s.countryGate.getCityToItems(this._Id),e=s.countryGate.getCityToTours(this._Id);if(this._cityToTours)this._cityToTours.update({CityToItems:t,MinPrice:this._Price,TourItems:e});else{var o=this._ModeView===d.ModeView.Mobile,i=r(r({},s.countryGate.getSearchSettings(this._Id)),{Countries:[this._Id]});this._cityToTours=new g.CityToToursControl({CityToItems:t,Currency:this._Currency,ExpandedCityToTours:this._ExpandedCityToTours,LinkSettings:i,MinPrice:this._Price,ParentNode:this._nodes.priceBlock,PriceType:this._PriceType,TourItems:e,ToursLimit:o?5:0,CityToToursExpanded:this._CityToToursExpanded,Clicked:new u.Delegate(this,this._onItemClicked)})}},e.prototype._showMapBlock=function(){this._map||(this._map=new a.MapControl({IsVisibleLayers:!1,IsVisibleTools:!1,Layers:[y.LayerTypes.View],ParentNode:this._nodes.mapContainer,SelectedLayers:[{Item:y.ViewType.Scheme,LayerType:y.LayerTypes.View}],ShowMapInWindow:!1}),this._map.show());var t=s.countryGate.getCityToItems(this._Id),e=s.countryGate.getCityToHotels(this._Id),o=[],i=[];if(t.forEach(function(t){var r=p.cityUtils.getCityToCoord(t);if(r.length>0){var n=e[t.id]&&e[t.id].length||0;o.push({ChildsCount:n,ClickEnabled:!1,Coords:r,Id:t.id,Price:t.minprice||0,Title:t.name||t.areaname||""}),i.push(r)}}),!(JSON.stringify(o)===JSON.stringify(this._markers))){var r={ActiveItems:o,Bounds:i,IsNewActiveItems:!0,ToursGroup:d.ToursGroupBy.Resorts};1===i.length?r.View={Center:i[0],Zoom:f.DEFAULT_SUBREGION_ZOOM_LEVEL}:r.Bounds=i,this._map.update(r),this._markers=n([],o,!0)}},e}(v.ResultBuilderItem);e.CountryResultItem=m,t.CountryResultItem=m}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MapLayersDecorator=void 0;var r=o(96),n=o(4),s=o(3),a=o(1),l=o(5),u=o(985),c=o(311),h=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new s.UserEvent,o._Class="TVMapLayersDecorator",o._DropPanelClass="",o._Items=[],o._SelectedItems=[],o._adaptiveCore=null,o._layerSwitcher=null,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._adaptiveCore=new r.AdaptiveCore({Class:"TVMapLeayersPanel "+this._DropPanelClass,Control:this._DomNode,IsEnabled:(0,a.isMobile)(),IsMouseOver:!0,ModeView:l.ModeView.DescTop,Hide:new n.Delegate(this,this._onHidePanel),Show:new n.Delegate(this,this._onShowPanel)}),this._layerSwitcher=new u.MapLayersSwitcher({Items:this._Items,ParentNode:this._DomNode,Render:!1,SelectedItems:this._SelectedItems,Clicked:new n.Delegate(this,this._onLayerClicked)}),this._adaptiveCore.addChild(this._layerSwitcher)},e.prototype.update=function(e){if(e.SelectedItems)return void this._layerSwitcher.update(e);t.prototype.update.call(this,e)},e.prototype._onHidePanel=function(){(0,a.removeClass)(this._DomNode,"TVActive")},e.prototype._onShowPanel=function(){(0,a.addClass)(this._DomNode,"TVActive")},e.prototype._onLayerClicked=function(t){this.Changed.fire(t),this._adaptiveCore.hide()},e}(c.MapDecoratorBase);e.MapLayersDecorator=h,t.MapLayersDecorator=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MapLayersSwitcher=void 0;var r=o(2),n=o(3),s=o(1),a=function(t){function e(e){var o=t.call(this,e)||this;return o.Clicked=new n.UserEvent,o._Class="TVMapLayersSwitcher",o._Items=[],o._SelectedItems=[],o._layers=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){var o=this;t.prototype.render.call(this),this._Items.forEach(function(t,i){var r=(0,s.newDiv)("TVMapSelectorLayers",o._DomNode);o[""+e.LAYER+i]=[],o[""+e.LAYER_HANDLERS+i]=[],t.Items.forEach(function(n,a){var l=(0,s.newDiv)("TVMapLayer TV"+(0,s.capitalizeFirstLetter)(n.Type)+"Layer",r),u=o._onLayerClicked.bind(o,{LayerIndex:i,LayerItemType:n.Type,LayerItemTypeIndex:a,LayerType:t.LayerType});(0,s.addEvent)(l,"click",u),o[""+e.LAYER_HANDLERS+i].push(u),o[""+e.LAYER+i].push(l)}),o._layers.push(r)}),this._updateSelectedItems()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&this._updateSelectedItems()},e.prototype.destroy=function(){var o=this;this._Items.forEach(function(t,i){t.Items.forEach(function(t,r){var n=o[""+e.LAYER+i],a=o[""+e.LAYER_HANDLERS+i],l=n&&n[r],u=a&&a[r];(0,s.removeEvent)(l,"click",u)})}),t.prototype.destroy.call(this)},e.prototype._updateSelectedItems=function(){var t=this;(0,s.isDefined)(this._SelectedItems)&&this._SelectedItems.length>0&&this._SelectedItems.forEach(function(o){var i=t._Items.findIndex(function(t){return t.LayerType===o.LayerType}),r=t._Items[i].Items.findIndex(function(t){return t.Type===o.Item});t[""+e.LAYER+i].forEach(function(o,n){n===r?((0,s.addClass)(o,e.ACTIVE_CLASS),t[""+e.SELECTED_LAYER+i]=t._Items[i].Items[r].Type):(0,s.removeClass)(o,e.ACTIVE_CLASS)})})},e.prototype._onLayerClicked=function(t){var o=t.LayerIndex,i=t.LayerItemType,r=t.LayerItemTypeIndex,n=t.LayerType;if(this[""+e.SELECTED_LAYER+o]!==i){this[""+e.SELECTED_LAYER+o]=i,this[""+e.LAYER+o].forEach(function(t,o){o===r?(0,s.addClass)(t,e.ACTIVE_CLASS):(0,s.removeClass)(t,e.ACTIVE_CLASS)});var a={LayerType:n,Type:i};this.Clicked.fire(a)}},e.ACTIVE_CLASS="TVActive",e.LAYER="_layer",e.LAYER_HANDLERS="_layerHandlers",e.SELECTED_LAYER="_selectedLayer",e}(r.Control);e.MapLayersSwitcher=a,t.MapLayersSwitcher=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.MapToolsDecorator=void 0;var n=o(80),s=o(17),a=o(93),l=o(4),u=o(3),c=o(7),h=o(1),d=o(6),p=o(987),_=o(35),f=o(37),y=o(24),g=o(113),C=o(510),v=o(988),m=o(511),T=o(311),w=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new u.UserEvent,o.ErrorReport=new u.UserEvent,o.templateName="map-tools",o._mapPainterControl=null,o._mapRulerControl=null,o._polygon=null,o._drawHint=null,o._linkHint=null,o._priceVisibilityHint=null,o._rulerHint=null,o.__initSettings(e),o._clearPolygon=o._clearPolygon.bind(o),o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var o=this._nodes,i=o.draw,r=o.link,n=o.priceVisibility,s=o.ruler;this._drawHint=new a.Hint({Anchor:i,Content:"Выделить область"}),this._linkHint=new a.Hint({Anchor:r,Class:(0,h.isMobile)()?"TVHintLinkCopied":"TVHintLink",MobileEnable:!0}),this._priceVisibilityHint=new a.Hint({Anchor:n,Content:(0,h.hasClass)(this._nodes.priceVisibility,e.TV_ACTIVE)?"Скрывать цены":"Показывать цены"}),this._rulerHint=new a.Hint({Anchor:s,Class:"TVHintRuler"})},e.prototype.update=function(e){var o=e.IsClearPolygon,i=e.IsClearTools;return o&&this._polygon?void this._clearPolygon():i?void this._clearTools():void t.prototype.update.call(this,e)},e.prototype._clearTools=function(){if(this._mapRulerControl){this._mapRulerControl.clear();(0,h.hasClass)(this._nodes.ruler,e.TV_ACTIVE)&&this._disableRuler()}},e.prototype._addPolygon=function(t){var o=this._Map.getInstance();return(0,n.polygon)(t,{color:e.POLYGON_COLOR}).addTo(o)},e.prototype._clearPolygon=function(t){(0,h.removeClass)(this._nodes.draw,e.TV_CLEAR),this._drawHint.update({Content:"Выделить область"}),this._polygon.off("click",this._clearPolygon),this._removePolygon(),t&&t.FireDisabled||this.Changed.fire({Coords:[],Type:C.ToolType.Draw})},e.prototype._disableRuler=function(){(0,h.removeClass)(this._nodes.ruler,e.TV_ACTIVE),this._mapRulerControl.hide()},e.prototype._onPriceVisibilityClick=function(){(0,h.toggleClass)(this._Map.getDomNode(),"TVMapPriceHide"),(0,h.toggleClass)(this._nodes.priceVisibility,e.TV_ACTIVE),this._priceVisibilityHint.update({Content:(0,h.hasClass)(this._nodes.priceVisibility,e.TV_ACTIVE)?"Скрывать цены":"Показывать цены"})},e.prototype._onDrawClick=function(){if(this._polygon)return void this._clearPolygon();var t=this._nodes,o=t.draw,i=t.ruler;(0,h.hasClass)(i,e.TV_ACTIVE)&&this._disableRuler(),(0,h.toggleClass)(o,e.TV_ACTIVE);var r=this._getMapPainterControl();(0,h.hasClass)(o,e.TV_ACTIVE)?r.show():r.hide()},e.prototype._onRulerClick=function(){var t=this._nodes.ruler;this._mapRulerControl||(this._mapRulerControl=new m.MapRulerControl({LinePane:g.MapPaneType.RulerLine,Map:this._Map,MarkerPane:g.MapPaneType.RulerMarker})),(0,h.toggleClass)(t,e.TV_ACTIVE),(0,h.hasClass)(t,e.TV_ACTIVE)?this._mapRulerControl.show():this._mapRulerControl.hide()},e.prototype._onLinkClick=function(){p.copyUtils.copy(this._getLink(),this._DomNode),(0,h.addClass)(this._linkHint.getDomNode(),"TVHintLinkCopied"),this._linkHint.update({UpdatePosition:!0})},e.prototype._getLink=function(){var t=s.resultStore.getActualSearchSettings();if((0,d.isEmptySettings)(t))return window.location.href;var e=s.resultStore.getGlobals(),o=e&&e.Bounds,i=o?f.searchMapUtils.convertMapBounds(o):{};return y.searchUtils.getSearchURL(r(r({},t),i))},e.prototype._getMapPainterControl=function(){if(!this._mapPainterControl){this._mapPainterControl=new v.MapPainterControl({Changed:new l.Delegate(this,this._onChangeSelection)});var t=this._Map.getDomNode(),e=this._mapPainterControl.getDomNode();(0,_.insertAfter)(t,e)}return this._mapPainterControl},e.prototype._onChangeSelection=function(t){var o=t.Points;if((0,h.removeClass)(this._nodes.draw,e.TV_ACTIVE),!(o.length<3)){var i=n.LineUtil.simplify(o,c.MAP_SIMPLIFY_TOLERANCE),r=f.searchMapUtils.convertCoordsFromMap(i,this._Map.getInstance());this._polygon=this._addPolygon(r),this._polygon.on("click",this._clearPolygon),(0,h.addClass)(this._nodes.draw,e.TV_CLEAR),this._drawHint.update({Content:"Очистить выделение"}),this.Changed.fire({Coords:r,Type:C.ToolType.Draw})}},e.prototype._removePolygon=function(){this._Map.getInstance().removeLayer(this._polygon),this._polygon=null},e.POLYGON_COLOR="#185584",e.TV_ACTIVE="TVActive",e.TV_CLEAR="TVClear",e}(T.MapDecoratorBase);e.MapToolsDecorator=w,t.MapToolsDecorator=w}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.copyUtils=void 0;var i=o(1),r=function(){function t(){}return t.prototype.copy=function(t,e){var o=(0,i.newInput)("text","",e||document.body);o.value=t,o.select();try{document.execCommand("copy")}catch(t){console.log("Oops, unable to copy")}o.parentNode.removeChild(o)},t}();e.copyUtils=new r,t.copyUtils=e.copyUtils}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MapPainterControl=void 0;var r=o(80),n=o(2),s=o(3),a=o(1),l=o(35),u=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new s.UserEvent,o._Class="TVMapPainterControl",o._points=[],o._isMobile=!1,o.__initSettings(e),o._init(),o._isMobile=(0,a.isMobile)(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),(0,a.hide)(this._DomNode),this._canvas=(0,l.createDomElement)("canvas"),this._DomNode.appendChild(this._canvas),this._ctx=this._canvas.getContext("2d")},e.prototype.show=function(){(0,a.show)(this._DomNode),this._points=[],this._canvas.width=this._canvas.offsetWidth,this._canvas.height=this._canvas.offsetHeight,(0,a.addEvent)(this._canvas,this._isMobile?"touchstart":"mousedown",this._onSelectionStart)},e.prototype.hide=function(){(0,a.hide)(this._DomNode),(0,a.removeEvent)(this._canvas,this._isMobile?"touchstart":"mousedown",this._onSelectionStart),(0,a.removeEvent)(this._canvas,this._isMobile?"touchmove":"mousemove",this._onSelection),(0,a.removeEvent)(this._canvas,this._isMobile?"touchend":"mouseup",this._onSelectionEnd),(0,a.removeEvent)(this._canvas,this._isMobile?"touchcancel":"mouseout",this._onSelectionEnd)},e.prototype._init=function(){this._onSelectionStart=this._onSelectionStart.bind(this),this._onSelection=this._onSelection.bind(this),this._onSelectionEnd=this._onSelectionEnd.bind(this)},e.prototype._onSelectionStart=function(){(0,a.addEvent)(this._canvas,this._isMobile?"touchmove":"mousemove",this._onSelection),(0,a.addEvent)(this._canvas,this._isMobile?"touchend":"mouseup",this._onSelectionEnd),(0,a.addEvent)(this._canvas,this._isMobile?"touchcancel":"mouseout",this._onSelectionEnd)},e.prototype._onSelection=function(t){var o=0,i=0,n=t.target,s=n.getBoundingClientRect();if(this._isMobile?(o=t.touches[0].clientX,i=t.touches[0].clientY):(o=t.clientX,i=t.clientY),o-=s.left,i-=s.top,this._points.push(new r.Point(o,i)),this._points.length>1){var l=this._points.length>0?this._points[this._points.length-2].x:0,u=this._points.length>0?this._points[this._points.length-2].y:0;this._ctx.beginPath(),this._ctx.strokeStyle=e.LINE_COLOR,this._ctx.lineWidth=e.LINE_WIDTH,this._ctx.moveTo(l,u),this._ctx.lineTo(o,i),this._ctx.stroke()}(0,a.preventDefault)(t)},e.prototype._onSelectionEnd=function(){this.hide(),this.Changed.fire({Points:this._points}),this._points=[]},e.LINE_COLOR="#185584",e.LINE_WIDTH=3,e}(n.Control);e.MapPainterControl=u,t.MapPainterControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MapRulerResult=void 0;var r=o(80),n=o(9),s=o(3),a=o(1),l=o(6),u=o(113),c=o(513),h=o(512),d=o(511),p=function(t){function e(e){var o=t.call(this,e)||this;return o.MarkerClicked=new s.UserEvent,o.MarkerRemoved=new s.UserEvent,o._IsMobile=!1,o._Map=null,o._ResultId=0,o._distance=0,o._markers=[],o._markersEvents=[],o._polylines=[],o.__initSettings(e),o}return i(e,t),e.prototype.addMarker=function(t){var e=t.Coords,o=this._markers[this._markers.length-1],i=this._createMarker(e);this._markers.push(i);var r=this._createTooltip(o,i);if(i.bindTooltip(r),o){var n=this._createPolyline(o,i);this._polylines.push(n)}},e.prototype.removeMarker=function(t){var e=this,o=this._markers.findIndex(function(e){return e.getId()===t}),i=[],r=[];this._distance=0,this._markers.forEach(function(t,r){if(r<o)i.push(t);else{var n=e._markersEvents[r];(0,a.removeEvent)(t.getElement(),e._IsMobile?"touchend":"click",n),h.rulerUtils.removeElement(t,e._Map)}}),this._markersEvents=this._markersEvents.splice(0,i.length),this._polylines.forEach(function(t,i){i<o-1?r.push(t):h.rulerUtils.removeElement(t,e._Map)}),i.forEach(function(t,o,i){var r=i[o-1];if((0,a.isDefined)(r)){var n=t.getLatLng(),s=r.getLatLng();e._distance+=h.rulerUtils.getDistance(n,s,e._Map)}t.getTooltip().setContent((0,l.convertDistance)(e._distance))});var n=i[i.length-1],s=n?n.getLatLng():null;this.MarkerRemoved.fire({LastMarkerCoords:s,LastMarkerDistance:this._distance,ResultId:this._ResultId}),this._markers=i,this._polylines=r},e.prototype.getMarkers=function(){return this._markers},e.prototype.destroy=function(){var e=this;this._markers.forEach(function(t,o){h.rulerUtils.removeElement(t,e._Map);var i=e._markersEvents[o];(0,a.removeEvent)(t.getElement(),e._IsMobile?"touchend":"click",i)}),this._polylines.forEach(function(t){return h.rulerUtils.removeElement(t,e._Map)}),this._markers=null,this._polylines=null,this._Map=null,t.prototype.destroy.call(this)},e.prototype._createMarker=function(t){var e=this,o=(new Date).getTime(),i=this._IsMobile?" TVLeafletRulerMobileMarker":"",n=(0,c.tvMarker)([t.lat,t.lng],{icon:new r.DivIcon({className:"TVLeafletRulerMarker"+i}),id:o,pane:u.MapPaneType.RulerMarker}).addTo(this._Map),s=function(t){t.stopPropagation(),e.MarkerClicked.fire({MarkerCoords:n.getLatLng(),MarkerId:n.getId(),ResultId:e._ResultId})};return this._markersEvents.push(s),(0,a.addEvent)(n.getElement(),this._IsMobile?"touchend":"click",s),n},e.prototype._createPolyline=function(t,e){return(0,d.rulerPolyline)([t.getLatLng(),e.getLatLng()]).addTo(this._Map)},e.prototype._createTooltip=function(t,e){return t&&(this._distance+=h.rulerUtils.getDistance(t.getLatLng(),e.getLatLng(),this._Map)),(0,d.rulerTooltip)((0,l.convertDistance)(this._distance))},e}(n.Core);e.MapRulerResult=p,t.MapRulerResult=p}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RulerMarkerPopup=e.PopupClickType=void 0;var r,n=o(2),s=o(3),a=o(1);!function(t){t[t.DeleteMarker=1]="DeleteMarker",t[t.DeletePath=2]="DeletePath",t[t.FinishedPath=3]="FinishedPath"}(r=e.PopupClickType||(e.PopupClickType={}));var l=function(t){function e(e){var o=t.call(this,e)||this;return o.Hide=new s.UserEvent,o.PopupClicked=new s.UserEvent,o.Show=new s.UserEvent,o.templateName="ruler-marker-popup",o._Class="TVRulerMarkerPopup",o._Position={left:0,top:0},o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsActual,i=e.Position;(0,a.isDefined)(o)&&(0,a.setVisible)(this._nodes.finishedPath,o),(0,a.isDefined)(i)&&this._updatePosition()},e.prototype.show=function(){t.prototype.show.call(this),this.Show.fire()},e.prototype.hide=function(){t.prototype.hide.call(this),this.Hide.fire()},e.prototype._updatePosition=function(){var t=(0,a.getComputedSize)(this._DomNode),o=this._Position;this._DomNode.style.left=t.Width+o.left>this._ParentNode.offsetWidth?o.left-t.Width+e.MARKER_SIZE/2+"px":o.left-e.MARKER_SIZE/2+"px",this._DomNode.style.top=t.Height+o.top>this._ParentNode.offsetHeight?o.top-t.Height+e.MARKER_SIZE/2+"px":o.top-e.MARKER_SIZE/2+"px"},e.prototype._onDeleteMarkerClick=function(t){this.PopupClicked.fire({Event:t,Type:r.DeleteMarker}),t.stopImmediatePropagation()},e.prototype._onDeletePathClick=function(t){this.PopupClicked.fire({Event:t,Type:r.DeletePath}),t.stopImmediatePropagation()},e.prototype._onFinishedPathClick=function(t){this.PopupClicked.fire({Event:t,Type:r.FinishedPath}),t.stopImmediatePropagation()},e.MARKER_SIZE=14,e}(n.Control);e.RulerMarkerPopup=l,t.RulerMarkerPopup=l,t.PopupClickType=r}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.MapZoomDecorator=void 0;var r=o(992),n=o(311),s=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="map-zoom",o.render(),o}return i(e,t),e.prototype._changeZoom=function(t){var e=t.Type,o=this._Map.getInstance();switch(e){case r.ZoomType.ZoomOut:o.zoomOut();break;case r.ZoomType.ZoomIn:o.zoomIn()}},e.prototype._onZoomPlusClick=function(){this._changeZoom({Type:r.ZoomType.ZoomIn})},e.prototype._onZoomMinusClick=function(){this._changeZoom({Type:r.ZoomType.ZoomOut})},e}(n.MapDecoratorBase);e.MapZoomDecorator=s,t.MapZoomDecorator=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.ZoomType=void 0;var o;!function(t){t[t.ZoomOut=-1]="ZoomOut",t[t.None=0]="None",t[t.ZoomIn=1]="ZoomIn"}(o=e.ZoomType||(e.ZoomType={})),t.ZoomType=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.LeafletMapControl=void 0;var r=o(80),n=o(2),s=o(3),a=o(7),l=o(1),u=o(188),c=o(114),h=o(994),d=function(t){function e(e){var o=t.call(this,e)||this;return o.ViewChanged=new s.UserEvent,o._Bounds=[],o._Class="TVLeafletMapControl",o._SelectedLayer=c.ViewType.Scheme,o._ShowMapInWindow=!0,o._crs={},o._isReady=!1,o._map=null,o._layers={},o._prevLayer=null,o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){this._map&&this._map.remove(),t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this),this._fixedMap();var e={maxBounds:a.WORLD_BOUNDS,zoomControl:!1};this._map=(0,h.tvMap)(this._DomNode,e),this._updateLayer()},e.prototype.update=function(o){var i=o.Bounds,r=o.SelectedLayer,n=o.View,s=(0,l.isDefined)(r);if(s&&(this._prevLayer=this._SelectedLayer),t.prototype.update.call(this,o),i&&this._map.fitBounds(this._Bounds,e.BOUND_OPTIONS),n){var a=n.Center,u=n.Options,c=n.Zoom;this._map.setView(a,c,u)}s&&this._updateLayer()},e.prototype.addLayer=function(t){this._map.addLayer(t)},e.prototype.createPane=function(t,e){var o=this._map.createPane(t);return(0,l.isDefined)(e)&&Object.keys(e).forEach(function(t){o.style[t]=e[t]}),o},e.prototype.getInstance=function(){return this._map},e.prototype.setViewPort=function(t,e){this._map.panBy([t,e])},e.prototype._addToMap=function(t){var e=this;this._layers[t].forEach(function(t){t.addTo(e._map)})},e.prototype._init=function(){this._onMapLayerLoaded=this._onMapLayerLoaded.bind(this),this._onMapLayerAdded=this._onMapLayerAdded.bind(this)},e.prototype._onMapLayerAdded=function(){this.ViewChanged.fire({View:this._SelectedLayer})},e.prototype._onMapLayerLoaded=function(){this._layers[this._SelectedLayer].forEach(function(t){t.off("load")}),this._isReady||(this._unfixedMap(),this._map.invalidateSize(!0),this._isReady=!0)},e.prototype._removeFromMap=function(t){this._layers[t].forEach(function(t){t.remove()})},e.prototype._updateLayer=function(){var t,o;switch(this._layers[this._prevLayer]&&(t=this._map.getCenter(),o=this._map.getZoom(),delete this._map.options.crs,this._removeFromMap(this._prevLayer)),this._SelectedLayer){case c.ViewType.Satellite:if(this._layers[c.ViewType.Satellite])this._crs[c.ViewType.Satellite]&&(this._map.options.crs=this._crs[c.ViewType.Satellite]),this._addToMap(c.ViewType.Satellite),this._updateMapView(t,o);else{var i=r.CRS.EPSG3395,n=(0,r.tileLayer)(u.ExternalLinks.LeafletYandexSatellite,{attribution:e.TOURVISOR_ATTRIBUTION+" "+e.YANDEX_MAP_ATTRIBUTION,maxZoom:e.MAX_ZOOM,minZoom:e.MIN_ZOOM}),s=(0,r.tileLayer)(u.ExternalLinks.LeafletYandexHybrid,{attribution:e.TOURVISOR_ATTRIBUTION+" "+e.YANDEX_MAP_ATTRIBUTION,maxZoom:e.MAX_ZOOM,minZoom:e.MIN_ZOOM});this._crs[c.ViewType.Satellite]=i,this._map.options.crs=i,this._layers[c.ViewType.Satellite]=[n,s],n.on("load",this._onMapLayerLoaded),n.on("add",this._onMapLayerAdded),this._addToMap(c.ViewType.Satellite),this._updateMapView(t,o)}break;case c.ViewType.Scheme:if(!this._layers[c.ViewType.Scheme]){var a=(0,r.tileLayer)(u.ExternalLinks.LeafletMapLink,{attribution:e.TOURVISOR_ATTRIBUTION+" "+e.OPEN_STREET_MAP_ATTRIBUTION,maxZoom:e.MAX_ZOOM,minZoom:e.MIN_ZOOM});this._layers[c.ViewType.Scheme]=[a],a.on("load",this._onMapLayerLoaded),a.on("add",this._onMapLayerAdded)}this._addToMap(c.ViewType.Scheme),this._updateMapView(t,o)}},e.prototype._updateMapView=function(t,e){this._isReady&&this._map.updateView(t,e)},e.prototype._fixedMap=function(){if(this._ShowMapInWindow){var t=(0,l.isMobile)()&&!(0,l.isBigTablet)(),e=t?{height:"calc(100% - 50px)",position:"fixed",width:"100%"}:{height:"calc(100% - 40px)",left:"20px",position:"fixed",top:"20px",width:"calc(100% - 40px)"};(0,l.updateNodeStyle)(this._DomNode,e)}},e.prototype._unfixedMap=function(){this._ShowMapInWindow&&(0,l.updateNodeStyle)(this._DomNode,{height:"",left:"",position:"",top:"",width:""})},e.BOUND_OPTIONS={padding:[50,50]},e.MAX_ZOOM=18,e.MIN_ZOOM=2,e.YANDEX_MAP_ATTRIBUTION='&copy; Яндекс <a href="https://yandex.ru/legal/maps_termsofuse/" rel="nofollow noopener" target="_blank">Условия использования</a> <a href="https://yandex.ru/legal/right_holders/" rel="nofollow noopener" target="_blank" >Правообладатели</a>',e.OPEN_STREET_MAP_ATTRIBUTION='&copy; <a href="https://www.openstreetmap.org/copyright" rel="nofollow noopener" target="_blank">OpenStreetMap</a> contributors',e.TOURVISOR_ATTRIBUTION='&copy; <a href="https://tourvisor.ru/about.php" rel="nofollow noopener" target="_blank">Tourvisor</a>',e}(n.Control);e.LeafletMapControl=d,t.LeafletMapControl=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.tvMap=e.TVMap=void 0;var r=o(80),n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.updateView=function(t,e){this._resetView(t,e)},e}(r.Map);e.TVMap=n;var s=function(t,e){return new n(t,e)};e.tvMap=s,t.tvMap=e.tvMap,t.TVMap=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.AdditionsClusterBuilder=void 0;var n=o(515),s=o(196),a=o(113),l=o(9),u=o(1),c=function(t){function e(e){var o=t.call(this,e)||this;return o._IconClassName="",o._Items=[],o._Map=null,o._PaneName=a.MapPaneType.None,o._ZIndex=0,o._cluster=null,o._zoomLevel=0,o.__initSettings(e),o._onMapZoomChanged=o._onMapZoomChanged.bind(o),o._render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Items,i=e.Map;(0,u.isDefined)(i)&&(this._cluster.update({Map:i}),this._Map.getInstance().on("zoomend",this._onMapZoomChanged),this._PaneName!==a.MapPaneType.None&&this._Map.createPane(this._PaneName,{zIndex:""+(this._ZIndex||s.defaultMarkerPaneZindex)})),(0,u.isDefined)(o)&&this._createMarkers()},e.prototype.clear=function(){this._cluster.clear()},e.prototype.destroy=function(){var e=this._Map&&this._Map.getInstance();e&&e.off("zoomend",this._onMapZoomChanged),this._Map=null,t.prototype.destroy.call(this)},e.prototype._createMarkers=function(){var t=this;this._Items.filter(function(e){return t._zoomLevel>=e.Zoom}).forEach(function(e){var o=t._createMarker(e),i=o.getLayer();t._cluster.addMarker(i)})},e.prototype._createMarker=function(t){var e=r({},t);return this._IconClassName&&(e.IconClassName=this._IconClassName),this._PaneName!==a.MapPaneType.None&&(e.Pane=this._PaneName),new s.LeafletMarkerControl(e)},e.prototype._render=function(){this._cluster=new n.LeafletCommonClusterControl({})},e.prototype._onMapZoomChanged=function(t){this._zoomLevel=t.sourceTarget.getZoom(),this.clear(),this._createMarkers()},e}(l.Core);e.AdditionsClusterBuilder=c,t.AdditionsClusterBuilder=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.HotelsClusterBuilder=void 0;var n=o(1),s=o(997),a=o(196),l=o(113),u=o(144),c=o(5),h=o(516),d=function(t){function e(e){var o=t.call(this,e)||this;return o._ActiveHotelsPane=null,o._InactiveHotelsPane=null,o._activePolygonCluster=null,o._inactivePolygonCluster=null,o._activePolygonMarkers={},o._inactivePolygonMarkers={},o._activeHotelsItems={},o._inactiveHotelsItems={},o._activeMarkers={},o._inactiveMarkers={},o._activeHotelsCluster=null,o._inactiveHotelsCluster=null,o._selectedMarker=null,o._selectedMarkerPaneName="",o._createInactiveMarkersTimeout=null,o.__initSettings(e),o._render(),o}return i(e,t),e.prototype.destroy=function(){clearTimeout(this._createInactiveMarkersTimeout),t.prototype.destroy.call(this)},e.prototype.update=function(e){var o=this;t.prototype.update.call(this,e);var i=e.ActiveItems,r=e.InactiveItems,s=e.IsRefresh,a=e.Map,l=e.PolygonParams,h=e.SelectionDisable,d=e.ToursGroup;(0,n.isDefined)(a)&&(this._activeHotelsCluster.update({Map:a}),this._inactiveHotelsCluster.update({Map:a}),this._activePolygonCluster.update({Map:a}),this._inactivePolygonCluster.update({Map:a})),h&&this._selectedMarker&&(this._removeSelectedMarkerFromMap(),this._addSelectedMarkerInCluster(),this._selectedMarker=null,this._setViewPort({isMarkerDeselected:!0})),(0,n.isDefined)(d)&&d===c.ToursGroupBy.Hotels&&((0,n.isDefined)(i)&&this._ActiveItems.forEach(function(t){var e=o._activeHotelsItems[t.Id],i=o._activeMarkers[t.Id];if(e&&i){if(!(t.Price<e.Price))return;o._activeHotelsItems[t.Id]=t;var r=i.getLayer();o._removeActiveMarker(r),o._createMarkers([t],u.MarkerType.Active)}else o._activeHotelsItems[t.Id]=t,o._createMarkers([t],u.MarkerType.Active)}),(0,n.isDefined)(r)&&(this._InactiveItems.forEach(function(t){o._inactiveHotelsItems[t.Id]=t}),this._createInactiveMarkersTimeout=setTimeout(function(){o._createMarkers(o._InactiveItems,u.MarkerType.InActive)},0))),l&&this._ToursGroup===c.ToursGroupBy.Hotels&&this._checkMarkersInPolygon(),s&&this._refreshClusters()},e.prototype.clear=function(t){switch(t.Type){case u.MarkerType.Active:this._activeHotelsCluster.clear(),this._activePolygonCluster.clear(),this._activeMarkers={};break;case u.MarkerType.InActive:this._inactiveHotelsCluster.clear(),this._inactivePolygonCluster.clear(),this._inactiveMarkers={}}},e.prototype._render=function(){this._activePolygonCluster=new s.LeafletHotelClusterControl({ClusterPane:l.MapPaneType.ActivePolygonCluster,MarkerType:u.MarkerType.Active,ZIndex:a.defaultMarkerPaneZindex+1}),this._inactivePolygonCluster=new s.LeafletHotelClusterControl({ClusterPane:l.MapPaneType.InactivePolygonCluster,MarkerType:u.MarkerType.InActive,ZIndex:a.defaultMarkerPaneZindex-1}),this._activeHotelsCluster=new s.LeafletHotelClusterControl({ClusterPane:l.MapPaneType.ActiveHotelsCluster,MarkerType:u.MarkerType.Active,ZIndex:a.defaultMarkerPaneZindex+1}),this._inactiveHotelsCluster=new s.LeafletHotelClusterControl({ClusterPane:l.MapPaneType.InactiveHotelsCluster,MarkerType:u.MarkerType.InActive,ZIndex:a.defaultMarkerPaneZindex-1})},e.prototype._createMarkers=function(t,e){for(var o=this,i=this._PolygonParams.Polygon.length>0,r=t.length,n=[],s=[],a=[],h=[],d=null,p=0;p<r;p++){var _=t[p],f=this._createMarker(_,e,c.ToursGroupBy.Hotels),y=f.getLayer();switch(this._checkInactiveHotelMarker(_),this._selectedMarker&&this._selectedMarker.getId()===_.Id&&(d=y),e){case u.MarkerType.Active:this._activeMarkers[_.Id]=f,i&&this._checkMarkerInPolygon(y)&&a.push(y),n.push(y);break;case u.MarkerType.InActive:this._inactiveMarkers[_.Id]=f,i&&this._checkMarkerInPolygon(y)&&h.push(y),s.push(y)}}if(n.length>0&&this._activeHotelsCluster.addMarkers(n),s.length>0&&this._inactiveHotelsCluster.addMarkers(s),a.length>0){var g=[];a.forEach(function(t){var e=t.getId(),i=o._inactivePolygonMarkers[e];i&&(o._inactivePolygonCluster.removeMarker(i.getLayer()),delete o._inactivePolygonMarkers[e]);var r,n=o._activePolygonMarkers[e],s=o._activeHotelsItems[e];if(n&&s){if(!(n.getLayer().getPrice()>=s.Price))return;o._activePolygonCluster.removeMarker(n.getLayer()),r=o._createMarker(s,u.MarkerType.Active,c.ToursGroupBy.Hotels)}else r=o._createMarker(s,u.MarkerType.Active,c.ToursGroupBy.Hotels);o._activePolygonMarkers[e]=r,r.getLayer().setPaneName(l.MapPaneType.ActivePolygonCluster),g.push(r.getLayer())}),this._activePolygonCluster.addMarkers(g)}if(h.length>0){var C=[];h.forEach(function(t){var e=t.getId(),i=o._inactiveHotelsItems[e],r=o._createMarker(i,u.MarkerType.InActive,c.ToursGroupBy.Hotels);o._inactivePolygonMarkers[e]=r,r.getLayer().setPaneName(l.MapPaneType.InactivePolygonCluster),C.push(r.getLayer())}),this._inactivePolygonCluster.addMarkers(C)}d&&(this._selectedMarker=i?this._activePolygonMarkers[d.getId()].getLayer():d,this._removeSelectedMarkerFromCluster(),this._addSelectedMarkerInMap())},e.prototype._checkMarkersInPolygon=function(){var t=this;if(this._clearMarkersInPolygon(),0===this._PolygonParams.Polygon.length){if(this._selectedMarker){var e=this._selectedMarker.getId();this._selectedMarker.removeFrom(this._Map.getInstance());var o=this._activeMarkers[e]||this._inactiveMarkers[e];if(o){var i=o.getLayer();this._selectedMarker=i;var r=this._selectedMarker.getType()===u.MarkerType.Active;this._selectedMarkerPaneName=r?l.MapPaneType.ActiveHotelsMarkers:l.MapPaneType.InactiveHotelsMarkers,this._selectedMarker.setPaneName(this._selectedMarkerPaneName),this._removeSelectedMarkerFromCluster(),this._addSelectedMarkerInMap()}}return(0,n.show)(this._ActiveHotelsPane),(0,n.show)(this._InactiveHotelsPane),this._activeHotelsCluster.show(),void this._inactiveHotelsCluster.show()}(0,n.hide)(this._ActiveHotelsPane),(0,n.hide)(this._InactiveHotelsPane),this._activeHotelsCluster.hide(),this._inactiveHotelsCluster.hide();var s=[],a=[];this._activeHotelsCluster.getInstance().eachLayer(function(e){if(t._checkMarkerInPolygon(e)){var o=e.getId(),i=t._activeHotelsItems[o],r=t._createMarker(i,u.MarkerType.Active,c.ToursGroupBy.Hotels);t._activePolygonMarkers[o]=r,r.getLayer().setPaneName(l.MapPaneType.ActivePolygonCluster),s.push(r.getLayer())}}),this._inactiveHotelsCluster.getInstance().eachLayer(function(e){if(t._checkMarkerInPolygon(e)){var o=e.getId(),i=t._inactiveHotelsItems[o],r=t._createMarker(i,u.MarkerType.InActive,c.ToursGroupBy.Hotels),n=r.getLayer();t._inactivePolygonMarkers[o]=r,n.setPaneName(l.MapPaneType.InactivePolygonCluster),a.push(n)}}),this._activePolygonCluster.addMarkers(s),this._inactivePolygonCluster.addMarkers(a)},e.prototype._onMarkerClicked=function(e){if(this._ToursGroup===c.ToursGroupBy.Hotels){var o=e.sourceTarget;this._selectedMarker&&(this._removeSelectedMarkerFromMap(),this._addSelectedMarkerInCluster()),this._selectedMarker!==o?(this._selectedMarker||this._setViewPort(e),this._selectedMarker=o,this._removeSelectedMarkerFromCluster(),this._addSelectedMarkerInMap()):(this._selectedMarker=null,this._setViewPort(r(r({},e),{isMarkerDeselected:!0})))}t.prototype._onMarkerClicked.call(this,e)},e.prototype._checkInactiveHotelMarker=function(t){var e=this._inactiveMarkers[t.Id];if(e){var o=e.getLayer();this._removeInactiveMarker(o),delete this._inactiveMarkers[t.Id]}this._selectedMarker&&this._selectedMarker.getId()===t.Id&&this._removeSelectedMarkerFromMap()},e.prototype._removeSelectedMarkerFromCluster=function(){this._selectedMarker.getType()===u.MarkerType.Active?this._removeActiveMarker(this._selectedMarker):this._removeInactiveMarker(this._selectedMarker)},e.prototype._removeActiveMarker=function(t){this._activePolygonCluster.removeMarker(t),this._activeHotelsCluster.removeMarker(t)},e.prototype._removeInactiveMarker=function(t){this._inactivePolygonCluster.removeMarker(t),this._inactiveHotelsCluster.removeMarker(t)},e.prototype._addSelectedMarkerInCluster=function(){var t=this._selectedMarker.getType()===u.MarkerType.Active,e=this._PolygonParams.Polygon.length>0;t?this._addActiveMarker(e,this._selectedMarker):this._addInactiveMarker(e,this._selectedMarker)},e.prototype._addActiveMarker=function(t,e){t&&this._checkMarkerInPolygon(e)?this._activePolygonCluster.addMarker(e):this._activeHotelsCluster.addMarker(e)},e.prototype._addInactiveMarker=function(t,e){t&&this._checkMarkerInPolygon(e)?this._inactivePolygonCluster.addMarker(e):this._inactiveHotelsCluster.addMarker(e)},e.prototype._addSelectedMarkerInMap=function(){this._selectedMarkerPaneName=this._selectedMarker.getPaneName(),this._selectedMarker.setPaneName(l.MapPaneType.SelectedMarker);var t=this._selectedMarker.addTo(this._Map.getInstance());(0,n.addClass)(t.getElement(),h.ResultClusterBuilder.TV_MARKER_SELECTED)},e.prototype._removeSelectedMarkerFromMap=function(){this._selectedMarker.setPaneName(this._selectedMarkerPaneName),this._selectedMarkerPaneName="";var t=this._selectedMarker.removeFrom(this._Map.getInstance());(0,n.removeClass)(t.getElement(),h.ResultClusterBuilder.TV_MARKER_SELECTED)},e.prototype._clearMarkersInPolygon=function(){this._activePolygonCluster.clear(),this._inactivePolygonCluster.clear(),this._activePolygonMarkers={},this._inactivePolygonMarkers={}},e.prototype._refreshClusters=function(){this._activePolygonCluster.refresh(),this._inactivePolygonCluster.refresh(),this._activeHotelsCluster.refresh(),this._inactiveHotelsCluster.refresh()},e}(h.ResultClusterBuilder);e.HotelsClusterBuilder=d,t.HotelsClusterBuilder=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.LeafletHotelClusterControl=void 0;var r=o(2),n=o(1),s=o(113),a=o(144),l=o(998),u=o(514),c=o(196),h=function(t){function e(e){var o=t.call(this,e)||this;return o._ClusterPane=s.MapPaneType.None,o._MarkerType=a.MarkerType.InActive,o._Map=null,o._ZIndex=c.defaultMarkerPaneZindex,o._markerClusters=null,o._pane=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.addMarker=function(t){this._markerClusters.addLayer(t)},e.prototype.addMarkers=function(t){this._markerClusters.addLayers(t)},e.prototype.clear=function(){this._markerClusters.clearLayers()},e.prototype.refresh=function(){var t=this._markerClusters.getLayers();this.clear(),this.addMarkers(t)},e.prototype.destroy=function(){this.clear(),t.prototype.destroy.call(this)},e.prototype.getInstance=function(){return this._markerClusters},e.prototype.hide=function(){(0,n.hide)(this._pane)},e.prototype.removeMarker=function(t){this._markerClusters.hasLayer(t)&&this._markerClusters.removeLayer(t)},e.prototype.show=function(){(0,n.show)(this._pane)},e.prototype.update=function(e){t.prototype.update.call(this,e),!this._markerClusters&&this._Map&&(this._createPane(),this._createCluster(),this._Map.addLayer(this._markerClusters))},e.prototype._createCluster=function(){var t=this,o={disableClusteringAtZoom:e.MAX_CLUSTER_ZOOM,maxClusterRadius:e.MAX_CLUSTER_RADIUS,showCoverageOnHover:!1,spiderfyOnMaxZoom:!1,iconCreateFunction:function(e){var o=e.getAllChildMarkers(),i=o[0].getPrice();o.forEach(function(t){var e=t.getPrice();e<i&&(i=e)});var r={className:c.LeafletMarkerControl.TV_LEAFLET_MARKER,iconAnchor:u.CLUSTER_ICON_ANCHOR},n={ChildsCount:o.length,Price:i,Type:t._MarkerType};return u.markerUtils.getMarkerIcon(r,n)}};this._ClusterPane&&(o.clusterPane=this._ClusterPane),this._markerClusters=(0,l.tvMarkerClusterGroup)(o)},e.prototype._createPane=function(){if(!this._pane){var t={zIndex:""+this._ZIndex};this._pane=this._Map.createPane(this._ClusterPane,t)}},e.MAX_CLUSTER_RADIUS=50,e.MAX_CLUSTER_ZOOM=16,e}(r.Control);e.LeafletHotelClusterControl=h,t.LeafletHotelClusterControl=h}).call(e,o(0))},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TVMarkerClusterGroup=e.tvMarkerClusterGroup=void 0,o(999);var i=o(80);Object.defineProperty(e,"tvMarkerClusterGroup",{enumerable:!0,get:function(){return i.markerClusterGroup}}),Object.defineProperty(e,"TVMarkerClusterGroup",{enumerable:!0,get:function(){return i.MarkerClusterGroup}})},function(t,e,o){!function(t,o){o(e)}(0,function(t){"use strict";var e=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var e=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,e?this._withAnimation:this._noAnimation),this._markerCluster=e?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(t){if(t instanceof L.LayerGroup)return this.addLayers([t]);if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this.fire("layeradd",{layer:t}),this;if(!this._map)return this._needsClustering.push(t),this.fire("layeradd",{layer:t}),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom),this.fire("layeradd",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var e=t,o=this._zoom;if(t.__parent)for(;e.__parent._zoom>=o;)e=e.__parent;return this._currentShownBounds.contains(e.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,e):this._animationAddLayerNonAnimated(t,e)),this},removeLayer:function(t){return t instanceof L.LayerGroup?this.removeLayers([t]):t.getLatLng?this._map?t.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this.fire("layerremove",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),t.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push({layer:t,latlng:t._latlng}),this.fire("layerremove",{layer:t}),this):(this._nonPointGroup.removeLayer(t),this.fire("layerremove",{layer:t}),this)},addLayers:function(t,e){if(!L.Util.isArray(t))return this.addLayer(t);var o,i=this._featureGroup,r=this._nonPointGroup,n=this.options.chunkedLoading,s=this.options.chunkInterval,a=this.options.chunkProgress,l=t.length,u=0,c=!0;if(this._map){var h=(new Date).getTime(),d=L.bind(function(){var p=(new Date).getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();u<l;u++){if(n&&u%200==0){if((new Date).getTime()-p>s)break}if((o=t[u])instanceof L.LayerGroup)c&&(t=t.slice(),c=!1),this._extractNonGroupLayers(o,t),l=t.length;else if(o.getLatLng){if(!this.hasLayer(o)&&(this._addLayer(o,this._maxZoom),e||this.fire("layeradd",{layer:o}),o.__parent&&2===o.__parent.getChildCount())){var _=o.__parent.getAllChildMarkers(),f=_[0]===o?_[1]:_[0];i.removeLayer(f)}}else r.addLayer(o),e||this.fire("layeradd",{layer:o})}a&&a(u,l,(new Date).getTime()-h),u===l?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(d,this.options.chunkDelay)},this);d()}else for(var p=this._needsClustering;u<l;u++)o=t[u],o instanceof L.LayerGroup?(c&&(t=t.slice(),c=!1),this._extractNonGroupLayers(o,t),l=t.length):o.getLatLng?this.hasLayer(o)||p.push(o):r.addLayer(o);return this},removeLayers:function(t){var e,o,i=t.length,r=this._featureGroup,n=this._nonPointGroup,s=!0;if(!this._map){for(e=0;e<i;e++)o=t[e],o instanceof L.LayerGroup?(s&&(t=t.slice(),s=!1),this._extractNonGroupLayers(o,t),i=t.length):(this._arraySplice(this._needsClustering,o),n.removeLayer(o),this.hasLayer(o)&&this._needsRemoving.push({layer:o,latlng:o._latlng}),this.fire("layerremove",{layer:o}));return this}if(this._unspiderfy){this._unspiderfy();var a=t.slice(),l=i;for(e=0;e<l;e++)o=a[e],o instanceof L.LayerGroup?(this._extractNonGroupLayers(o,a),l=a.length):this._unspiderfyLayer(o)}for(e=0;e<i;e++)o=t[e],o instanceof L.LayerGroup?(s&&(t=t.slice(),s=!1),this._extractNonGroupLayers(o,t),i=t.length):o.__parent?(this._removeLayer(o,!0,!0),this.fire("layerremove",{layer:o}),r.hasLayer(o)&&(r.removeLayer(o),o.clusterShow&&o.clusterShow())):(n.removeLayer(o),this.fire("layerremove",{layer:o}));return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(t){t.off(this._childMarkerEventHandlers,this),delete t.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;this._topClusterLevel&&t.extend(this._topClusterLevel._bounds);for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var o,i,r,n=this._needsClustering.slice(),s=this._needsRemoving;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(n),i=n.length-1;i>=0;i--){for(o=!0,r=s.length-1;r>=0;r--)if(s[r].layer===n[i]){o=!1;break}o&&t.call(e,n[i])}this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer(function(e){t.push(e)}),t},getLayer:function(t){var e=null;return t=parseInt(t,10),this.eachLayer(function(o){L.stamp(o)===t&&(e=o)}),e},hasLayer:function(t){if(!t)return!1;var e,o=this._needsClustering;for(e=o.length-1;e>=0;e--)if(o[e]===t)return!0;for(o=this._needsRemoving,e=o.length-1;e>=0;e--)if(o[e].layer===t)return!1;return!(!t.__parent||t.__parent._group!==this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){var o=this._map;"function"!=typeof e&&(e=function(){});var i=function(){!o.hasLayer(t)&&!o.hasLayer(t.__parent)||this._inZoomAnimation||(this._map.off("moveend",i,this),this.off("animationend",i,this),o.hasLayer(t)?e():t.__parent._icon&&(this.once("spiderfied",e,this),t.__parent.spiderfy()))};t._icon&&this._map.getBounds().contains(t.getLatLng())?e():t.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",i,this),this._map.panTo(t.getLatLng())):(this._map.on("moveend",i,this),this.on("animationend",i,this),t.__parent.zoomToBounds())},onAdd:function(t){this._map=t;var e,o,i;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(t),this._nonPointGroup.addTo(t),this._gridClusters||this._generateInitialClusters(),this._maxLat=t.options.crs.projection.MAX_LATITUDE,e=0,o=this._needsRemoving.length;e<o;e++)i=this._needsRemoving[e],i.newlatlng=i.layer._latlng,i.layer._latlng=i.latlng;for(e=0,o=this._needsRemoving.length;e<o;e++)i=this._needsRemoving[e],this._removeLayer(i.layer,!0),i.layer._latlng=i.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),o=this._needsClustering,this._needsClustering=[],this.addLayers(o,!0)},onRemove:function(t){t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var o=t.length-1;o>=0;o--)if(t[o]===e)return t.splice(o,1),!0},_removeFromGridUnclustered:function(t,e){for(var o=this._map,i=this._gridUnclustered,r=Math.floor(this._map.getMinZoom());e>=r&&i[e].removeObject(t,o.project(t.getLatLng(),e));e--);},_childMarkerDragStart:function(t){t.target.__dragStart=t.target._latlng},_childMarkerMoved:function(t){if(!this._ignoreMove&&!t.target.__dragStart){var e=t.target._popup&&t.target._popup.isOpen();this._moveChild(t.target,t.oldLatLng,t.latlng),e&&t.target.openPopup()}},_moveChild:function(t,e,o){t._latlng=e,this.removeLayer(t),t._latlng=o,this.addLayer(t)},_childMarkerDragEnd:function(t){var e=t.target.__dragStart;delete t.target.__dragStart,e&&this._moveChild(t.target,e,t.target._latlng)},_removeLayer:function(t,e,o){var i=this._gridClusters,r=this._gridUnclustered,n=this._featureGroup,s=this._map,a=Math.floor(this._map.getMinZoom());e&&this._removeFromGridUnclustered(t,this._maxZoom);var l,u=t.__parent,c=u._markers;for(this._arraySplice(c,t);u&&(u._childCount--,u._boundsNeedUpdate=!0,!(u._zoom<a));)e&&u._childCount<=1?(l=u._markers[0]===t?u._markers[1]:u._markers[0],i[u._zoom].removeObject(u,s.project(u._cLatLng,u._zoom)),r[u._zoom].addObject(l,s.project(l.getLatLng(),u._zoom)),this._arraySplice(u.__parent._childClusters,u),u.__parent._markers.push(l),l.__parent=u.__parent,u._icon&&(n.removeLayer(u),o||n.addLayer(l))):u._iconNeedsUpdate=!0,u=u.__parent;delete t.__parent},_isOrIsParent:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},fire:function(t,e,o){if(e&&e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget))return;t="cluster"+t}L.FeatureGroup.prototype.fire.call(this,t,e,o)},listens:function(t,e){return L.FeatureGroup.prototype.listens.call(this,t,e)||L.FeatureGroup.prototype.listens.call(this,"cluster"+t,e)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),o=" marker-cluster-";return o+=e<10?"small":e<100?"medium":"large",new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+o,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.spiderfyOnMaxZoom,o=this.options.showCoverageOnHover,i=this.options.zoomToBoundsOnClick;(e||i)&&this.on("clusterclick",this._zoomOrSpiderfy,this),o&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),t.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){for(var e=t.layer,o=e;1===o._childClusters.length;)o=o._childClusters[0];o._zoom===this._maxZoom&&o._childCount===e._childCount&&this.options.spiderfyOnMaxZoom?e.spiderfy():this.options.zoomToBoundsOnClick&&e.zoomToBounds(),t.originalEvent&&13===t.originalEvent.keyCode&&this._map._container.focus()},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,o=this.options.zoomToBoundsOnClick,i=this._map;(t||o)&&this.off("clusterclick",this._zoomOrSpiderfy,this),e&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),i.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=Math.ceil(this._map.getMaxZoom()),e=Math.floor(this._map.getMinZoom()),o=this.options.maxClusterRadius,i=o;"function"!=typeof o&&(i=function(){return o}),null!==this.options.disableClusteringAtZoom&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var r=t;r>=e;r--)this._gridClusters[r]=new L.DistanceGrid(i(r)),this._gridUnclustered[r]=new L.DistanceGrid(i(r));this._topClusterLevel=new this._markerCluster(this,e-1)},_addLayer:function(t,e){var o,i,r=this._gridClusters,n=this._gridUnclustered,s=Math.floor(this._map.getMinZoom());for(this.options.singleMarkerMode&&this._overrideMarkerIcon(t),t.on(this._childMarkerEventHandlers,this);e>=s;e--){o=this._map.project(t.getLatLng(),e);var a=r[e].getNearObject(o);if(a)return a._addChild(t),void(t.__parent=a);if(a=n[e].getNearObject(o)){var l=a.__parent;l&&this._removeLayer(a,!1);var u=new this._markerCluster(this,e,a,t);r[e].addObject(u,this._map.project(u._cLatLng,e)),a.__parent=u,t.__parent=u;var c=u;for(i=e-1;i>l._zoom;i--)c=new this._markerCluster(this,i,c),r[i].addObject(c,this._map.project(a.getLatLng(),i));return l._addChild(c),void this._removeFromGridUnclustered(a,e)}n[e].addObject(t,o)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()})},_enqueue:function(t){this._queue.push(t),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var t=0;t<this._queue.length;t++)this._queue[t].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var t=Math.round(this._map._zoom);this._processQueue(),this._zoom<t&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,t)):this._zoom>t?(this._animationStart(),this._animationZoomOut(this._zoom,t)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):this._mapBoundsInfinite},_checkBoundsMaxLat:function(t){var e=this._maxLat;return void 0!==e&&(t.getNorth()>=e&&(t._northEast.lat=1/0),t.getSouth()<=-e&&(t._southWest.lat=-1/0)),t},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(2===e._childCount){e._addToMap();var o=e.getAllChildMarkers();this._featureGroup.removeLayer(o[0]),this._featureGroup.removeLayer(o[1])}else e._updateIcon()},_extractNonGroupLayers:function(t,e){var o,i=t.getLayers(),r=0;for(e=e||[];r<i.length;r++)o=i[r],o instanceof L.LayerGroup?this._extractNonGroupLayers(o,e):e.push(o);return e},_overrideMarkerIcon:function(t){return t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}})}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(t,e){var o,i=this._getExpandedVisibleBounds(),r=this._featureGroup,n=Math.floor(this._map.getMinZoom());this._ignoreMove=!0,this._topClusterLevel._recursively(i,t,n,function(n){var s,a=n._latlng,l=n._markers;for(i.contains(a)||(a=null),n._isSingleParent()&&t+1===e?(r.removeLayer(n),n._recursivelyAddChildrenToMap(null,e,i)):(n.clusterHide(),n._recursivelyAddChildrenToMap(a,e,i)),o=l.length-1;o>=0;o--)s=l[o],i.contains(s._latlng)||r.removeLayer(s)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(i,e),r.eachLayer(function(t){t instanceof L.MarkerCluster||!t._icon||t.clusterShow()}),this._topClusterLevel._recursively(i,t,e,function(t){t._recursivelyRestoreChildPositions(e)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(i,t,n,function(t){r.removeLayer(t),t.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){var o=this,i=this._featureGroup;i.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.clusterHide(),this._enqueue(function(){i.removeLayer(t),t.clusterShow(),o._animationEnd()})):(this._forceLayout(),o._animationStart(),o._animationZoomOutSingle(e,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(t,e,o){var i=this._getExpandedVisibleBounds(),r=Math.floor(this._map.getMinZoom());t._recursivelyAnimateChildrenInAndAddSelfToMap(i,r,e+1,o);var n=this;this._forceLayout(),t._recursivelyBecomeVisible(i,o),this._enqueue(function(){if(1===t._childCount){var s=t._markers[0];this._ignoreMove=!0,s.setLatLng(s.getLatLng()),this._ignoreMove=!1,s.clusterShow&&s.clusterShow()}else t._recursively(i,o,r,function(t){t._recursivelyRemoveChildrenFromMap(i,r,e+1)});n._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)};var o=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(t,e,o,i){L.Marker.prototype.initialize.call(this,o?o._cLatLng||o.getLatLng():new L.LatLng(0,0),{icon:this,pane:t.options.clusterPane}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,o&&this._addChild(o),i&&this._addChild(i)},getAllChildMarkers:function(t,e){t=t||[];for(var o=this._childClusters.length-1;o>=0;o--)this._childClusters[o].getAllChildMarkers(t);for(var i=this._markers.length-1;i>=0;i--)e&&this._markers[i].__dragStart||t.push(this._markers[i]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(t){for(var e,o=this._childClusters.slice(),i=this._group._map,r=i.getBoundsZoom(this._bounds),n=this._zoom+1,s=i.getZoom();o.length>0&&r>n;){n++;var a=[];for(e=0;e<o.length;e++)a=a.concat(o[e]._childClusters);o=a}r>n?this._group._map.setView(this._latlng,n):r<=s?this._group._map.setView(this._latlng,s+1):this._group._map.fitBounds(this._bounds,t)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_setClusterCenter:function(t){this._cLatLng||(this._cLatLng=t._cLatLng||t._latlng)},_resetBounds:function(){var t=this._bounds;t._southWest&&(t._southWest.lat=1/0,t._southWest.lng=1/0),t._northEast&&(t._northEast.lat=-1/0,t._northEast.lng=-1/0)},_recalculateBounds:function(){var t,e,o,i,r=this._markers,n=this._childClusters,s=0,a=0,l=this._childCount;if(0!==l){for(this._resetBounds(),t=0;t<r.length;t++)o=r[t]._latlng,this._bounds.extend(o),s+=o.lat,a+=o.lng;for(t=0;t<n.length;t++)e=n[t],e._boundsNeedUpdate&&e._recalculateBounds(),this._bounds.extend(e._bounds),o=e._wLatLng,i=e._childCount,s+=o.lat*i,a+=o.lng*i;this._latlng=this._wLatLng=new L.LatLng(s/l,a/l),this._boundsNeedUpdate=!1}},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,o){this._recursively(t,this._group._map.getMinZoom(),o-1,function(t){var o,i,r=t._markers;for(o=r.length-1;o>=0;o--)i=r[o],i._icon&&(i._setPos(e),i.clusterHide())},function(t){var o,i,r=t._childClusters;for(o=r.length-1;o>=0;o--)i=r[o],i._icon&&(i._setPos(e),i.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,o,i){this._recursively(t,i,e,function(r){r._recursivelyAnimateChildrenIn(t,r._group._map.latLngToLayerPoint(r.getLatLng()).round(),o),r._isSingleParent()&&o-1===i?(r.clusterShow(),r._recursivelyRemoveChildrenFromMap(t,e,o)):r.clusterHide(),r._addToMap()})},_recursivelyBecomeVisible:function(t,e){this._recursively(t,this._group._map.getMinZoom(),e,null,function(t){t.clusterShow()})},_recursivelyAddChildrenToMap:function(t,e,o){this._recursively(o,this._group._map.getMinZoom()-1,e,function(i){if(e!==i._zoom)for(var r=i._markers.length-1;r>=0;r--){var n=i._markers[r];o.contains(n._latlng)&&(t&&(n._backupLatlng=n.getLatLng(),n.setLatLng(t),n.clusterHide&&n.clusterHide()),i._group._featureGroup.addLayer(n))}},function(e){e._addToMap(t)})},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var o=this._markers[e];o._backupLatlng&&(o.setLatLng(o._backupLatlng),delete o._backupLatlng)}if(t-1===this._zoom)for(var i=this._childClusters.length-1;i>=0;i--)this._childClusters[i]._restorePosition();else for(var r=this._childClusters.length-1;r>=0;r--)this._childClusters[r]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,o,i){var r,n;this._recursively(t,e-1,o-1,function(t){for(n=t._markers.length-1;n>=0;n--)r=t._markers[n],i&&i.contains(r._latlng)||(t._group._featureGroup.removeLayer(r),r.clusterShow&&r.clusterShow())},function(t){for(n=t._childClusters.length-1;n>=0;n--)r=t._childClusters[n],i&&i.contains(r._latlng)||(t._group._featureGroup.removeLayer(r),r.clusterShow&&r.clusterShow())})},_recursively:function(t,e,o,i,r){var n,s,a=this._childClusters,l=this._zoom;if(e<=l&&(i&&i(this),r&&l===o&&r(this)),l<e||l<o)for(n=a.length-1;n>=0;n--)s=a[n],s._boundsNeedUpdate&&s._recalculateBounds(),t.intersects(s._bounds)&&s._recursively(t,e,o,i,r)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var t=this.options.opacity;return this.setOpacity(0),this.options.opacity=t,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var o=this._getCoord(e.x),i=this._getCoord(e.y),r=this._grid,n=r[i]=r[i]||{},s=n[o]=n[o]||[],a=L.Util.stamp(t);this._objectPoint[a]=e,s.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var o,i,r=this._getCoord(e.x),n=this._getCoord(e.y),s=this._grid,a=s[n]=s[n]||{},l=a[r]=a[r]||[];for(delete this._objectPoint[L.Util.stamp(t)],o=0,i=l.length;o<i;o++)if(l[o]===t)return l.splice(o,1),1===i&&delete a[r],!0},eachObject:function(t,e){var o,i,r,n,s,a,l=this._grid;for(o in l){s=l[o];for(i in s)for(a=s[i],r=0,n=a.length;r<n;r++)t.call(e,a[r])&&(r--,n--)}},getNearObject:function(t){var e,o,i,r,n,s,a,l,u=this._getCoord(t.x),c=this._getCoord(t.y),h=this._objectPoint,d=this._sqCellSize,p=null;for(e=c-1;e<=c+1;e++)if(r=this._grid[e])for(o=u-1;o<=u+1;o++)if(n=r[o])for(i=0,s=n.length;i<s;i++)a=n[i],((l=this._sqDist(h[L.Util.stamp(a)],t))<d||l<=d&&null===p)&&(d=l,p=a);return p},_getCoord:function(t){var e=Math.floor(t/this._cellSize);return isFinite(e)?e:t},_sqDist:function(t,e){var o=e.x-t.x,i=e.y-t.y;return o*o+i*i}},function(){L.QuickHull={getDistant:function(t,e){var o=e[1].lat-e[0].lat;return(e[0].lng-e[1].lng)*(t.lat-e[0].lat)+o*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var o,i,r,n=0,s=null,a=[];for(o=e.length-1;o>=0;o--)i=e[o],(r=this.getDistant(i,t))>0&&(a.push(i),r>n&&(n=r,s=i));return{maxPoint:s,newPoints:a}},buildConvexHull:function(t,e){var o=[],i=this.findMostDistantPointFromBaseLine(t,e);return i.maxPoint?(o=o.concat(this.buildConvexHull([t[0],i.maxPoint],i.newPoints)),o=o.concat(this.buildConvexHull([i.maxPoint,t[1]],i.newPoints))):[t[0]]},getConvexHull:function(t){var e,o=!1,i=!1,r=!1,n=!1,s=null,a=null,l=null,u=null,c=null,h=null;for(e=t.length-1;e>=0;e--){var d=t[e];(!1===o||d.lat>o)&&(s=d,o=d.lat),(!1===i||d.lat<i)&&(a=d,i=d.lat),(!1===r||d.lng>r)&&(l=d,r=d.lng),(!1===n||d.lng<n)&&(u=d,n=d.lng)}return i!==o?(h=a,c=s):(h=u,c=l),[].concat(this.buildConvexHull([h,c],t),this.buildConvexHull([c,h],t))}}}(),L.MarkerCluster.include({getConvexHull:function(){var t,e,o=this.getAllChildMarkers(),i=[];for(e=o.length-1;e>=0;e--)t=o[e].getLatLng(),i.push(t);return L.QuickHull.getConvexHull(i)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var t,e=this.getAllChildMarkers(null,!0),o=this._group,i=o._map,r=i.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?t=this._group.options.spiderfyShapePositions(e.length,r):e.length>=this._circleSpiralSwitchover?t=this._generatePointsSpiral(e.length,r):(r.y+=10,t=this._generatePointsCircle(e.length,r)),this._animationSpiderfy(e,t)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var o,i,r=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t),n=r/this._2PI,s=this._2PI/t,a=[];for(n=Math.max(n,35),a.length=t,o=0;o<t;o++)i=this._circleStartAngle+o*s,a[o]=new L.Point(e.x+n*Math.cos(i),e.y+n*Math.sin(i))._round();return a},_generatePointsSpiral:function(t,e){var o,i=this._group.options.spiderfyDistanceMultiplier,r=i*this._spiralLengthStart,n=i*this._spiralFootSeparation,s=i*this._spiralLengthFactor*this._2PI,a=0,l=[];for(l.length=t,o=t;o>=0;o--)o<t&&(l[o]=new L.Point(e.x+r*Math.cos(a),e.y+r*Math.sin(a))._round()),a+=n/r+5e-4*o,r+=s/a;return l},_noanimationUnspiderfy:function(){var t,e,o=this._group,i=o._map,r=o._featureGroup,n=this.getAllChildMarkers(null,!0);for(o._ignoreMove=!0,this.setOpacity(1),e=n.length-1;e>=0;e--)t=n[e],r.removeLayer(t),t._preSpiderfyLatlng&&(t.setLatLng(t._preSpiderfyLatlng),delete t._preSpiderfyLatlng),t.setZIndexOffset&&t.setZIndexOffset(0),t._spiderLeg&&(i.removeLayer(t._spiderLeg),delete t._spiderLeg);o.fire("unspiderfied",{cluster:this,markers:n}),o._ignoreMove=!1,o._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(t,e){var o,i,r,n,s=this._group,a=s._map,l=s._featureGroup,u=this._group.options.spiderLegPolylineOptions;for(s._ignoreMove=!0,o=0;o<t.length;o++)n=a.layerPointToLatLng(e[o]),i=t[o],r=new L.Polyline([this._latlng,n],u),a.addLayer(r),i._spiderLeg=r,i._preSpiderfyLatlng=i._latlng,i.setLatLng(n),i.setZIndexOffset&&i.setZIndexOffset(1e6),l.addLayer(i);this.setOpacity(.3),s._ignoreMove=!1,s.fire("spiderfied",{cluster:this,markers:t})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(t,e){var o,i,r,n,s,a,l=this,u=this._group,c=u._map,h=u._featureGroup,d=this._latlng,p=c.latLngToLayerPoint(d),_=L.Path.SVG,f=L.extend({},this._group.options.spiderLegPolylineOptions),y=f.opacity;for(void 0===y&&(y=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),_?(f.opacity=0,f.className=(f.className||"")+" leaflet-cluster-spider-leg"):f.opacity=y,u._ignoreMove=!0,o=0;o<t.length;o++)i=t[o],a=c.layerPointToLatLng(e[o]),r=new L.Polyline([d,a],f),c.addLayer(r),i._spiderLeg=r,_&&(n=r._path,s=n.getTotalLength()+.1,n.style.strokeDasharray=s,n.style.strokeDashoffset=s),i.setZIndexOffset&&i.setZIndexOffset(1e6),i.clusterHide&&i.clusterHide(),h.addLayer(i),i._setPos&&i._setPos(p);for(u._forceLayout(),u._animationStart(),o=t.length-1;o>=0;o--)a=c.layerPointToLatLng(e[o]),i=t[o],i._preSpiderfyLatlng=i._latlng,i.setLatLng(a),i.clusterShow&&i.clusterShow(),_&&(r=i._spiderLeg,n=r._path,n.style.strokeDashoffset=0,r.setStyle({opacity:y}));this.setOpacity(.3),u._ignoreMove=!1,setTimeout(function(){u._animationEnd(),u.fire("spiderfied",{cluster:l,markers:t})},200)},_animationUnspiderfy:function(t){var e,o,i,r,n,s,a=this,l=this._group,u=l._map,c=l._featureGroup,h=t?u._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):u.latLngToLayerPoint(this._latlng),d=this.getAllChildMarkers(null,!0),p=L.Path.SVG;for(l._ignoreMove=!0,l._animationStart(),this.setOpacity(1),o=d.length-1;o>=0;o--)e=d[o],e._preSpiderfyLatlng&&(e.closePopup(),e.setLatLng(e._preSpiderfyLatlng),delete e._preSpiderfyLatlng,s=!0,e._setPos&&(e._setPos(h),s=!1),e.clusterHide&&(e.clusterHide(),s=!1),s&&c.removeLayer(e),p&&(i=e._spiderLeg,r=i._path,n=r.getTotalLength()+.1,r.style.strokeDashoffset=n,i.setStyle({opacity:0})));l._ignoreMove=!1,setTimeout(function(){var t=0;for(o=d.length-1;o>=0;o--)e=d[o],e._spiderLeg&&t++;for(o=d.length-1;o>=0;o--)e=d[o],e._spiderLeg&&(e.clusterShow&&e.clusterShow(),e.setZIndexOffset&&e.setZIndexOffset(0),t>1&&c.removeLayer(e),u.removeLayer(e._spiderLeg),delete e._spiderLeg);l._animationEnd(),l.fire("unspiderfied",{cluster:a,markers:d})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow(),t.setZIndexOffset&&t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(t){return t?t instanceof L.MarkerClusterGroup?t=t._topClusterLevel.getAllChildMarkers():t instanceof L.LayerGroup?t=t._layers:t instanceof L.MarkerCluster?t=t.getAllChildMarkers():t instanceof L.Marker&&(t=[t]):t=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(t),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(t),this},_flagParentsIconsNeedUpdate:function(t){var e,o;for(e in t)for(o=t[e].__parent;o;)o._iconNeedsUpdate=!0,o=o.__parent},_refreshSingleMarkerModeMarkers:function(t){var e,o;for(e in t)o=t[e],this.hasLayer(o)&&o.setIcon(this._overrideMarkerIcon(o))}}),L.Marker.include({refreshIconOptions:function(t,e){var o=this.options.icon;return L.setOptions(o,t),this.setIcon(o),e&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),t.MarkerClusterGroup=e,t.MarkerCluster=o,Object.defineProperty(t,"__esModule",{value:!0})})},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ResortsClusterBuilder=void 0;var n=o(1),s=o(515),a=o(144),l=o(5),u=o(516),c=function(t){function e(e){var o=t.call(this,e)||this;return o._activeResortsCluster=null,o._inactiveResortsCluster=null,o._activeResortsItems={},o._inactiveResortsItems={},o._activeMarkers={},o._inactiveMarkers={},o._selectedMarker=null,o.__initSettings(e),o._render(),o}return i(e,t),e.prototype.update=function(o){var i=this;t.prototype.update.call(this,o);var r=o.ActiveItems,s=o.InactiveItems,u=o.Map,c=o.SelectionDisable,h=o.ToursGroup;(0,n.isDefined)(u)&&(this._activeResortsCluster.update({Map:u}),this._inactiveResortsCluster.update({Map:u})),c&&this._selectedMarker&&((0,n.removeClass)(this._selectedMarker.getElement(),e.TV_MARKER_SELECTED),this._selectedMarker=null,this._setViewPort({isMarkerDeselected:!0})),(0,n.isDefined)(h)&&h===l.ToursGroupBy.Resorts&&((0,n.isDefined)(s)&&(this._InactiveItems.forEach(function(t){i._inactiveResortsItems[t.Id]=t}),this._createMarkers(this._InactiveItems,a.MarkerType.InActive)),(0,n.isDefined)(r)&&(this._ActiveItems.forEach(function(t){i._activeResortsItems[t.Id]&&i._activeMarkers[t.Id]&&i._activeResortsCluster.removeMarker(i._activeMarkers[t.Id].getLayer()),i._activeResortsItems[t.Id]=t}),this._createMarkers(this._ActiveItems,a.MarkerType.Active)))},e.prototype.clear=function(t){switch(t.Type){case a.MarkerType.Active:this._activeResortsCluster.clear(),this._activeMarkers={};break;case a.MarkerType.InActive:this._inactiveResortsCluster.clear(),this._inactiveMarkers={}}},e.prototype._render=function(){this._activeResortsCluster=new s.LeafletCommonClusterControl({}),this._inactiveResortsCluster=new s.LeafletCommonClusterControl({})},e.prototype._createMarkers=function(t,e){for(var o=t.length,i=0;i<o;i++){var r=t[i],s=this._createMarker(r,e,l.ToursGroupBy.Resorts),c=s.getLayer();switch(this._checkInactiveResortsMarkers(r),e){case a.MarkerType.Active:this._activeMarkers[r.Id]=s,this._activeResortsCluster.addMarker(c);break;case a.MarkerType.InActive:this._inactiveMarkers[r.Id]=s,this._inactiveResortsCluster.addMarker(c)}this._selectedMarker&&this._selectedMarker.getId()===r.Id&&((0,n.addClass)(c.getElement(),u.ResultClusterBuilder.TV_MARKER_SELECTED),this._selectedMarker=c)}},e.prototype._onMarkerClicked=function(e){if(this._ToursGroup===l.ToursGroupBy.Resorts){var o=e.sourceTarget;this._selectedMarker&&(0,n.removeClass)(this._selectedMarker.getElement(),u.ResultClusterBuilder.TV_MARKER_SELECTED),this._selectedMarker!==o?(this._selectedMarker||this._setViewPort(e),this._selectedMarker=o,(0,n.addClass)(this._selectedMarker.getElement(),u.ResultClusterBuilder.TV_MARKER_SELECTED)):(this._selectedMarker=null,this._setViewPort(r(r({},e),{isMarkerDeselected:!0})))}t.prototype._onMarkerClicked.call(this,e)},e.prototype._checkInactiveResortsMarkers=function(t){var e=this._inactiveMarkers[t.Id];e&&this._inactiveResortsCluster.removeMarker(e.getLayer())},e}(u.ResultClusterBuilder);e.ResortsClusterBuilder=c,t.ResortsClusterBuilder=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CityToToursControl=void 0;var n=o(2),s=o(1),a=o(5),l=o(6),u=o(91),c=o(40),h=o(1002),d=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="cityto-tours",o._CityToItems=[],o._Currency=a.Currency.Rub,o._ExpandedCityToTours={},o._LinkSettings=null,o._MinPrice=0,o._PriceType=a.PriceType.None,o._TourItems={},o._ToursLimit=0,o._Clicked=null,o._CityToToursExpanded=null,o._cityToToursItems=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){this._LinkSettings=null,t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this),this._renderItems(),this._updatePriceType()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&(this._clear(),this._renderItems())},e.prototype.getTourItemNode=function(t,e){var o=this._cityToToursItems.find(function(e){return e.getId()===t});return o&&o.getItemNodeByDate(e)},e.prototype._clear=function(){this._cityToToursItems.forEach(function(t){t.destroy()}),(0,s.removeChildren)(this._nodes.bodyNode)},e.prototype._renderItems=function(){var t=this;this._cityToToursItems=[],this._CityToItems.forEach(function(e){var o=t._TourItems[e.id]||[];if(0!==o.length){var i=c.tourUtils.getCityToTours(o,t._Currency),n=u.cityUtils.getCityToItem(e),s=r(r({},t._LinkSettings),{Resorts:e.regions});t._cityToToursItems.push(new h.CityToToursItemControl(r(r({},n),{LinkSettings:s,MinPrice:t._MinPrice,ParentNode:t._nodes.bodyNode,PriceType:(0,l.getPriceTypeStr)(t._PriceType,{withPreposition:!0,isShort:!0}),Tours:i,ToursExpandStatus:t._ExpandedCityToTours[n.Id]||h.ToursExpandStatus.Default,ToursLimit:t._ToursLimit,CityToToursExpanded:t._CityToToursExpanded,Clicked:t._Clicked})))}})},e.prototype._updatePriceType=function(){this._nodes.priceTypeNode.textContent=(0,l.getPriceTypeStr)(this._PriceType,{withPreposition:!0})},e}(n.Control);e.CityToToursControl=d,t.CityToToursControl=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CityToToursItemControl=e.ToursExpandStatus=void 0;var n,s=o(2),a=o(4),l=o(3),u=o(1),c=o(64),h=o(24),d=o(40),p=o(8),_=o(1003);!function(t){t[t.Default=0]="Default",t[t.Expand=1]="Expand",t[t.Close=2]="Close"}(n=e.ToursExpandStatus||(e.ToursExpandStatus={}));var f=function(t){function e(e){var o=t.call(this,e)||this;return o.Clicked=new l.UserEvent,o.CityToToursExpanded=new l.UserEvent,o.templateName="cityto-tours-item",o._FlightHours=0,o._Id=0,o._LinkSettings=null,o._MinPrice=0,o._Name="",o._PriceType="",o._Subname="",o._TemperatureAir=c.calendarUtils.NONE_TEMPERATURE,o._TemperatureWater=c.calendarUtils.NONE_TEMPERATURE,o._Tours=[],o._ToursExpandStatus=n.Default,o._ToursLimit=0,o._allItemsRendered=!1,o._delegateCityToClicked=null,o._tourItems=[],o.__initSettings(e),o._delegateCityToClicked=new a.Delegate(o,o._onCityToClicked),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){this._LinkSettings=null,t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this),(0,u.setVisible)(this._nodes.subname,Boolean(this._Subname)),(0,u.setVisible)(this._nodes.flightHours,Boolean(this._FlightHours)),this._renderTemperatures(),this._renderTours(),this._updatePriceType()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&(0,u.isDefined)(e.Tours)&&(this._clear(),this._renderTours())},e.prototype.getItemNodeByDate=function(t){var e=this._tourItems.find(function(e){return e.getDate()===t});return e&&e.getDomNode()},e.prototype._clear=function(){this._tourItems.forEach(function(t){t.destroy()}),this._tourItems=[],(0,u.removeChildren)(this._nodes.listNode)},e.prototype._fastRenderTours=function(t,e){for(var o=t;o<e;o++){var i=this._Tours[o],n=new _.CityToTourItemControl(r(r({},i),{Link:h.searchUtils.getSearchURL(r(r({},this._LinkSettings),{FlyDates:d.tourUtils.getCityToFlyDates(i.Date)})),ParentNode:this._nodes.listNode,Clicked:this._delegateCityToClicked}));this._tourItems.push(n),(0,u.updateClass)(n.getDomNode(),"TVMinPriceTour",this._MinPrice===i.Price)}},e.prototype._onCityToClicked=function(t){t.CityToId=this._Id,this.Clicked.fire(t)},e.prototype._onShowMoreClick=function(){var t=this._nodes,e=t.headerNode,o=t.listNode,i=t.showMore;if(this._allItemsRendered)return(0,u.toggleClass)(e,p.TV_HIDE),(0,u.toggleClass)(o,p.TV_HIDE),(0,u.toggleClass)(i,p.TV_CLOSE),this._ToursExpandStatus=(0,u.hasClass)(i,p.TV_CLOSE)?n.Expand:n.Close,void this.CityToToursExpanded.fire({Id:this._Id,Status:this._ToursExpandStatus});this._fastRenderTours(this._ToursLimit,this._Tours.length),this._allItemsRendered=!0,(0,u.addClass)(i,p.TV_CLOSE),this._ToursExpandStatus=n.Expand,this.CityToToursExpanded.fire({Id:this._Id,Status:this._ToursExpandStatus})},e.prototype._renderTemperatures=function(){var t=this._nodes,e=t.tempAir,o=t.tempWater;c.calendarUtils.updateTemperature(e,this._TemperatureAir,!1),c.calendarUtils.updateTemperature(o,this._TemperatureWater,!1),(0,u.setVisible)(e,this._TemperatureAir!==c.calendarUtils.NONE_TEMPERATURE),(0,u.setVisible)(o,this._TemperatureWater!==c.calendarUtils.NONE_TEMPERATURE)},e.prototype._renderTours=function(){var t=this._ToursLimit>0,e=t?Math.min(this._ToursLimit,this._Tours.length):this._Tours.length;this._fastRenderTours(0,e),this._allItemsRendered=!t||this._Tours.length<=this._ToursLimit,(0,u.setVisible)(this._nodes.showMore,!this._allItemsRendered),this._ToursExpandStatus===n.Expand&&this._onShowMoreClick(),this._ToursExpandStatus===n.Close&&(this._onShowMoreClick(),this._onShowMoreClick())},e.prototype._updatePriceType=function(){this._nodes.priceTypeNode.textContent=this._PriceType},e}(s.Control);e.CityToToursItemControl=f,t.CityToToursItemControl=f,t.ToursExpandStatus=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CityToTourItemControl=void 0;var r=o(2),n=o(3),s=o(1),a=o(13),l=o(40),u=function(t){function e(e){var o=t.call(this,e)||this;return o.Clicked=new n.UserEvent,o.templateName="cityto-tour-item",o._Currency="",o._Date="",o._Link="",o._Nights=[],o._Price=0,o._Time="",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes,o=e.currencyNode,i=e.dateNode,r=e.linkNode,n=e.nightsNode,u=e.priceNode,c=l.tourUtils.getCityToTourNights(this._Nights);i.textContent=a.FormatDate.getFormatDate(new Date(this._Date),"DD MMM"),n.title=c,r.href=this._Link,n.textContent=c,u.textContent=(0,s.getPrice)(this._Price),o.textContent=this._Currency},e.prototype.getDate=function(){return this._Date},e.prototype._onClicked=function(t){this.Clicked.fire({Date:this._Date}),(0,s.stopPropagation)(t)},e.prototype._onLinkNodeClick=function(t){(0,s.preventDefault)(t)},e}(r.Control);e.CityToTourItemControl=u,t.CityToTourItemControl=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.CountryResultInfoControl=void 0;var r=o(66),n=o(2),s=o(4),a=o(3),l=o(1),u=o(5),c=o(6),h=o(16),d=o(91),p=o(312),_=o(313),f=function(t){function e(e){var o=t.call(this,e)||this;return o.PriceClicked=new a.UserEvent,o.TabClicked=new a.UserEvent,o._ActiveTab=u.HotelBlock.None,o._Currency=u.Currency.Rub,o._Description="",o._Flag="",o._IsRequiredVisa=!1,o._Id=0,o._Link="",o._ModeView=u.ModeView.DescTop,o._Name="",o._Picture="",o._Price=0,o._PriceType=u.PriceType.None,o._resultItem=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderResultItem()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ActiveTab,i=e.Price;(0,l.isDefined)(o)&&this._resultItem.update({ActiveNavButton:this._ActiveTab!==u.HotelBlock.None?this._ActiveTab:null,IsActiveArrowButton:this._ActiveTab===u.HotelBlock.Buy}),(0,l.isDefined)(i)&&this._resultItem.update({Price:this._Price})},e.prototype._renderResultItem=function(){this._resultItem=new _.ResultItem({Currency:(0,c.getCurrencyValue)(this._Currency),Description:this._Description,DescriptionClampSize:h.SizeEnum.L,GoToItemSubmitTitle:"Перейти к стране",GoToItemTitle:"Минимальная цена по стране изменилась,",ModeView:this._ModeView,NavButtons:this._getNavButtons(),ParentNode:this._DomNode,Picture:this._Picture,Price:this._Price,PriceType:this._getPriceType(),Subtitle:this._getSubtitle(),Theme:this._Theme,Title:this._getTitle(),NavButtonClicked:new s.Delegate(this,this._onNavButtonClicked),PriceClicked:new s.Delegate(this,this._onPriceClicked)})},e.prototype._getNavButtons=function(){var t=[];return this._Link&&t.push({Id:u.HotelBlock.Desc,Content:"О стране",Link:this._Link}),r.countryGate.getCityToItems(this._Id).some(function(t){return d.cityUtils.getCityToCoord(t).length>0})&&t.push({Id:u.HotelBlock.Map,Content:"На карте"}),t.push({Id:u.HotelBlock.Buy,Content:"Цены"}),t},e.prototype._getSubtitle=function(){return""},e.prototype._getTitle=function(){if(!this._Flag&&!this._IsRequiredVisa)return this._Name;var t=(0,l.newDiv)("TVCountryResultInfoNameWrapper");if(this._Flag){(0,l.newDiv)("TVCountryResultInfoFlag",t).style.backgroundImage=this._Flag}((0,l.newDiv)("TVCountryResultInfoName",t).textContent=this._Name,this._IsRequiredVisa)&&((0,l.newDiv)("TVCountryResultInfoVisa",t).textContent="Виза");return t.outerHTML},e.prototype._getPriceType=function(){return p.resultPriceUtils.getPriceType(this._PriceType,this._Theme,this._ModeView)},e.prototype._onNavButtonClicked=function(t){this.TabClicked.fire(t)},e.prototype._onPriceClicked=function(){this.PriceClicked.fire()},e}(n.Control);e.CountryResultInfoControl=f,t.CountryResultInfoControl=f}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.GoToResultControl=void 0;var r=o(2),n=o(3),s=o(1),a=o(5),l=o(10),u=o(15),c=o(8),h=function(t){function e(e){var o=t.call(this,e)||this;return o.SubmitClicked=new n.UserEvent,o._Class="TVGoToResultControl",o._ModeView=a.ModeView.DescTop,o._StyleTheme=l.StyleThemeEnum.THEME1,o._SubmitTitle="",o._Title="",o._submitNode=null,o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateTitle(),this._renderSubmitTitle(),this._updateStyleTheme(),this._updateStyleMobile()},e.prototype.destroy=function(){(0,s.removeEvent)(this._submitNode,"click",this._onSubmitClicked),t.prototype.destroy.call(this)},e.prototype._init=function(){this._onSubmitClicked=this._onSubmitClicked.bind(this)},e.prototype._renderSubmitTitle=function(){this._submitNode=(0,s.newSpan)("TVGoToResultControlGoTo",this._DomNode),this._submitNode.textContent=this._SubmitTitle,(0,s.addEvent)(this._submitNode,"click",this._onSubmitClicked)},e.prototype._updateTitle=function(){this._DomNode.textContent=this._Title},e.prototype._updateStyleTheme=function(){var t=u.styleUtils.getClassByTheme(this._StyleTheme);(0,s.addClass)(this._DomNode,t)},e.prototype._updateStyleMobile=function(){(0,s.updateClass)(this._DomNode,c.TV_MOBILE,this._ModeView===a.ModeView.Mobile)},e.prototype._onSubmitClicked=function(){this.SubmitClicked.fire()},e}(r.Control);e.GoToResultControl=h,t.GoToResultControl=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ResultNavButtons=void 0;var n=o(2),s=o(1),a=o(5),l=o(10),u=o(158),c=function(t){function e(e){var o=t.call(this,e)||this;return o._Active=null,o._Class="TVResultNavButtons",o._Items=[],o._Clicked=null,o._items=[],o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderItems()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Active,i=e.Items;(0,s.isDefined)(o)&&this._updateActiveItem(),(0,s.isDefined)(i)&&(this._clearItems(),this._renderItems())},e.prototype.destroy=function(){this._Clicked=null,t.prototype.destroy.call(this)},e.prototype._renderItems=function(){var t=this;this._items=this._Items.map(function(e){var o=r(r({},e),{ParentNode:t._DomNode,StyleTheme:t._Theme===a.Theme.Theme1?l.StyleThemeEnum.THEME1:l.StyleThemeEnum.THEME2,Clicked:t._Clicked});return{control:new u.ResultNavButton(o),id:e.Id}})},e.prototype._updateActiveItem=function(){var t=this;this._items.forEach(function(e){var o=e.id,i=e.control;i&&i.update({IsActive:o===t._Active})})},e.prototype._clearItems=function(){this._items.forEach(function(t){t.control&&t.control.destroy()}),this._items=[]},e}(n.Control);e.ResultNavButtons=c,t.ResultNavButtons=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.HotelBuilder=void 0;var n=o(34),s=o(105),a=o(17),l=o(155),u=o(4),c=o(3),h=o(1),d=o(5),p=o(6),_=o(20),f=o(32),y=o(24),g=o(1008),C=o(238),v=function(t){function e(e){var o=t.call(this,e)||this;return o.HotelClicked=new c.UserEvent,o.SendReport=new c.UserEvent,o.ShowLink=new c.UserEvent,o._MngId=0,o._Ref=null,o._ShowCart=0,o._ShowTours=!1,o._Theme=d.Theme.Theme1,o.__initSettings(e),o._init(),o._initClass(),o._Render&&o.render(),o}return i(e,t),e.prototype.end=function(){this._ShowTours&&1===this._activeItemsArr.length&&this._activeItemsArr[0].showTours(),t.prototype.end.call(this)},e.prototype.update=function(e){var o=this;t.prototype.update.call(this,e);var i=e.MngId;(0,h.isDefined)(i)&&this._activeItemsArr.forEach(function(t){t.update({MngId:o._MngId})})},e.prototype.clear=function(){var e=this;Object.keys(this._items).forEach(function(t){return e._items[t].destroy()}),t.prototype.clear.call(this)},e.prototype._initClass=function(){this._Class=this._ModeView===d.ModeView.Mobile?"TVMHotelResultBodyContainer":this._Theme===d.Theme.Theme1?"TVSHotelResultBodyContainer":"TVHotelResultBodyContainer"},e.prototype._onResultStoreChanged=function(t){switch(t.Type){case _.CatalogName.Hotel:if(!t.IsPassedFilteringFunction)break;var e=s.hotelGate.getItem(t.Id),o=l.tourGate.getItems(t.Id);if(e&&o.length>0){var i=o.reduce(function(t,e){return e.pr<t?e.pr:t},Number.MAX_VALUE),n=r(r({},e),{price:i,tour:o});o[0].prold>0&&o[0].pr===i&&(n.priceold=o[0].prold),this._addHotel(n),this._updateRenderItems(),this._updateExpandItemsTours(e.id)}break;case _.CatalogName.FilterHotels:this.filter()}},e.prototype._renderItemsByRating=function(){var t=this._getItems();t.sort(function(t,e){return t.getRating()>e.getRating()?-1:t.getRating()<e.getRating()?1:t.getPrice()<e.getPrice()?-1:t.getPrice()>e.getPrice()?1:0}),this._activeItemsArr=t,this._renderFirst()},e.prototype._renderItemsByPop=function(){var t=this._getItems();t.sort(function(t,e){return t.getPop()>e.getPop()?-1:t.getPop()<e.getPop()?1:t.getPrice()<e.getPrice()?-1:t.getPrice()>e.getPrice()?1:0}),this._activeItemsArr=t,this._renderFirst()},e.prototype._renderItemsByName=function(){var t=this._getItems();t.sort(function(t,e){return t.getName()>e.getName()?-1:t.getName()<e.getName()?1:t.getPrice()<e.getPrice()?-1:t.getPrice()>e.getPrice()?1:0}),this._activeItemsArr=t,this._renderFirst()},e.prototype._isRenderedItem=function(t){return t&&t.getIsRendered()&&!!t.getParentNode()&&!!t.getParentNode().parentNode},e.prototype._renderItem=function(e,o){void 0===o&&(o=!1);var i=t.prototype._renderItem.call(this,e,o);return i&&e.update({Expand:this._expand}),i},e.prototype._removeLastNotVisibleItem=function(){t.prototype._removeLastNotVisibleItem.call(this);var e=this._activeItemsArr[this._getIndexOfLastRenderedItem()];e.isToursExpanded()&&e.update({Expand:!1})},e.prototype._getItems=function(){var t=this,e=[];return(s.hotelGate.getItems()||[]).forEach(function(o){var i=t._items[o.id];(0,h.isDefined)(i)?i.update({Price:o.price,TourOperator:o.operators,Tours:o.tour}):i=t._addHotel(o),e.push(i)}),e},e.prototype._getBeforeItem=function(t){var e=this,o=t.getPrice(),i=t.getRating(),r=t.getPop();return this._activeItemsArr.find(function(t){var n=e._isRenderedItem(t)&&t.getPrice()>0;switch(e._Sort){case d.SortBy.Price:return o<t.getPrice()&&n;case d.SortBy.Rating:return i>t.getRating()&&n;case d.SortBy.Popularity:return r>t.getPop()&&n;default:return!1}})||null},e.prototype._updateExpandItemsTours=function(t){this._expandItems.some(function(e){return e===t})&&(this._items[t]&&this._items[t].updateTours())},e.prototype._addHotel=function(t){var e=a.resultStore.getActualSearchSettings(),o=a.resultStore.getLinks(),i=(0,p.isNotEmptyArray)(e.Hotels)?"":o?""+(o.searchlink+(0,p.formUri)(e)):"",s=y.searchUtils.getCurrency(e),l=n.clientCatalog.getClientData(),c=f.clientUtils.getHotelEditEnabled(l),_=y.searchUtils.getPriceType(e),C=t.priceold?Number(t.priceold):0,v=t.price?Number(t.price):0;return(0,h.isDefined)(this._items[t.id])?this._items[t.id].update({Price:v,PriceOld:C,TourOperator:t.operators,Tours:t.tour}):(this._items[t.id]=new g.HotelResultItem({ClickEnabled:this._ModeView===d.ModeView.Mobile,Currency:s,Id:t.id,IsEnabledEdit:c,MngId:this._MngId,ModeView:this._ModeView,Price:v,PriceOld:C,PriceType:_,Ref:r({},this._Ref),Render:!1,SearchHotelLink:i,ShowCart:this._ShowCart,ShowOperator:this._ShowOperator,ShowTours:this._ShowTours,Theme:this._Theme,TourOperator:t.operators,Tours:t.tour,Clicked:new u.Delegate(this,this._onHotelClicked),ExpandChanged:new u.Delegate(this,this._onItemExpandChanged),PriceChanged:new u.Delegate(this,this._onMinPriceChanged)}),this._addToActiveArr(this._items[t.id])),this._items[t.id]},e.prototype._addToActiveArr=function(t){var e,o=this;switch(this._Sort){case d.SortBy.Price:e=t.getPrice();break;case d.SortBy.Rating:e=t.getRating();break;case d.SortBy.Popularity:e=t.getPop()}if(0===this._activeItemsArr.length||0===e)this._activeItemsArr.push(t);else{var i=this._activeItemsArr.findIndex(function(t){switch(o._Sort){case d.SortBy.Price:var i=t.getPrice();return e<i||0===i;case d.SortBy.Rating:var r=t.getRating();return e>r||0===r;case d.SortBy.Popularity:var n=t.getPop();return e>n||0===n;default:return!1}});i>-1?this._activeItemsArr.splice(i,0,t):this._activeItemsArr.push(t)}},e.prototype._onHotelClicked=function(t){this.HotelClicked.fire(t)},e}(C.ResultBuilder);e.HotelBuilder=v,t.HotelBuilder=v}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)},n=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var i,r=0,n=e.length;r<n;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.HotelResultItem=void 0;var s=o(105),a=o(106),l=o(17),u=o(93),c=o(44),h=o(4),d=o(3),p=o(7),_=o(1),f=o(5),y=o(6),g=o(135),C=o(45),v=o(20),m=o(10),T=o(210),w=o(209),S=o(68),P=o(18),b=o(28),I=o(114),O=o(245),M=o(67),D=o(137),E=o(1009),k=o(1011),R=o(1013),A=o(1014),V=o(1015),L=o(314),N=o(1016),B=function(t){function e(e){var o=t.call(this,e)||this;return o.ExpandChanged=new d.UserEvent,o.ShowLink=new d.UserEvent,o.Clicked=new d.UserEvent,o._Currency=f.Currency.Rub,o._Expand=!1,o._HotelData=null,o._Id=0,o._IsEnabledEdit=!1,o._Max=Number.MAX_VALUE,o._Meal=0,o._Min=0,o._MngId=0,o._ModeView=f.ModeView.None,o._Ref=null,o._SearchHotelLink="",o._ShowCart=0,o._ShowOperator=!1,o._ShowTours=!1,o._Theme=f.Theme.Theme1,o._TourOperator=[],o._Tours=[],o._isLiked=!1,o._isLoadedDescription=!1,o._isLoadedReviews=!1,o._isToursExpanded=!1,o._aboutControl=null,o._editControl=null,o._infoControl=null,o._likeLimitHint=null,o._mapControl=null,o._resultTours=null,o._reviewsControl=null,o._switcher=null,o.__initSettings(e),o._initHotelData(),o._initResultTours(),o.templateName=o._ModeView===f.ModeView.Mobile?"result-hotel-item-mobile":"result-hotel-item",o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){if(t.prototype.render.call(this),!this._HotelData)return void this.hide();this._ShowTours&&this.hide(),this._renderInfo(),this._updateIsLiked(),this._renderResultTours(),this._renderSwitcher(),a.hotelsCollectionsStore.Changed.addOnce(new h.Delegate(this,this._onHotelsCollectionsStoreChanged)),w.favoriteHotelsService.Changed.addOnce(new h.Delegate(this,this._onFavoriteHotelsChanged))},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.Expand,i=e.IsVisibleGoToItem,r=e.MngId,n=(e.Price,e.PriceOld),s=e.TourOperator,a=e.Tours;if((0,_.insertUnique)(s,this._TourOperator),(0,_.isDefined)(a)&&this._resultTours.update({Tours:this._Tours}),this._rendered){if((0,_.isDefined)(o)){var l=this._Expand?{Type:f.HotelBlock.Buy}:{Type:f.HotelBlock.None,NoScroll:!0};this._onTabClicked(l)}if(this._isToursExpanded&&!this._resultTours.isLoadedAllTours()){this._resultTours.clearDOM();this._switcher.getId()===f.HotelBlock.Buy&&(this._resultTours.showTours(),this._resultTours.updateVisibleShowMoreButton())}(0,_.isDefined)(r)&&this._infoControl.update({MngId:this._MngId}),(0,_.isDefined)(i)&&this._infoControl.update({IsVisibleGoToItem:i}),(0,_.isDefined)(n)&&this._updateTags()}},e.prototype.getId=function(){return this._Id},e.prototype.getName=function(){return this._HotelData?this._HotelData.name:""},e.prototype.getRating=function(){return this._HotelData?Number(this._HotelData.rating):0},e.prototype.getPop=function(){return this._HotelData?Number(this._HotelData.pop):0},e.prototype.updateTours=function(){this._resultTours.clearDOM(),this._resultTours.showTours()},e.prototype.showTours=function(){this._ShowTours&&(this.show(),this._onTabClicked({Type:f.HotelBlock.Buy}))},e.prototype.isToursExpanded=function(){return Boolean(this._isToursExpanded)},e.prototype.destroy=function(){a.hotelsCollectionsStore.Changed.remove(this),w.favoriteHotelsService.Changed.remove(this),t.prototype.destroy.call(this)},e.prototype.clone=function(t){return new e(r(r({},t),{Id:this._Id,ModeView:this._ModeView,Theme:this._Theme}))},e.prototype._renderInfo=function(){var t=this._nodes.infoNode,e=this._getTags();this._infoControl=new R.HotelInfoControl({Currency:this._Currency,Description:this._HotelData.desc,HotelData:this._HotelData,IsEnabledEdit:this._IsEnabledEdit,MngId:this._MngId,ModeView:this._ModeView,ParentNode:t,Price:this._Price,PriceOld:this._PriceOld,PriceType:this._PriceType,Tags:e,Theme:this._Theme,GoToItemClicked:new h.Delegate(this,this._onGoToItemClicked),LikeClicked:new h.Delegate(this,this._onLikeClicked),NameClicked:new h.Delegate(this,this._onHotelNameClicked),PriceClicked:new h.Delegate(this,this._onPriceClicked),ShowGallery:new h.Delegate(this,this._onShowPhotoGallery),TabClicked:new h.Delegate(this,this._onTabClicked)})},e.prototype._renderResultTours=function(){var t=this._nodes.priceNode;t&&(this._resultTours.setParentNode(t),this._resultTours.render())},e.prototype._renderLikeLimitHint=function(){if(!this._likeLimitHint){var t=this._nodes.infoNode;this._likeLimitHint=new u.Hint({Anchor:t,Content:"Превышено максимальное количество избранных отелей",MouseEventEnable:!1})}},e.prototype._onClicked=function(t){(0,_.stopPropagation)(t);var e={Id:this._Id};this.Clicked.fire(e)},e.prototype._initHotelData=function(){this._HotelData=s.hotelGate.getItemData(this._Id),this._HotelData&&((0,_.isDefined)(this._HotelData.rating)||(this._HotelData.rating=0),(0,_.isString)(this._HotelData.types)&&(this._HotelData.types=0!==this._HotelData.types.length?(0,y.strToArrInt)(this._HotelData.types):[]),(0,_.isString)(this._HotelData.services)&&(this._HotelData.services=0!==this._HotelData.services.length?(0,y.strToArrInt)(this._HotelData.services):[]),(0,_.isDefined)(this._HotelData.type)&&this._HotelData.type===M.TourType.CRAFT&&(this._PriceType=f.PriceType.ForTour))},e.prototype._initResultTours=function(){this._resultTours=new N.ResultToursControl({Currency:this._Currency,HotelId:this._Id,Ref:this._Ref,Render:!1,RoomInfo:this._HotelData&&this._HotelData.roominfo||{},ShowCart:this._ShowCart,ShowOperator:this._ShowOperator,StyleTheme:this._Theme===f.Theme.Theme1?m.StyleThemeEnum.THEME1:m.StyleThemeEnum.THEME2,Theme:this._Theme,Tours:this._Tours,ToursType:this._HotelData&&this._HotelData.type||M.TourType.FLIGHT,ScrollToTop:new h.Delegate(this,this._onScrollToTop)})},e.prototype._updateIsLiked=function(){var t=Number(this._HotelData.countrycode);this._isLiked=w.favoriteHotelsService.isFavorite(this._Id,t),this._infoControl.update({IsLiked:this._isLiked})},e.prototype._updatePrice=function(){this._infoControl&&this._infoControl.update({Price:this._Price,PriceOld:this._PriceOld})},e.prototype._closeTabs=function(){this._infoControl&&this._infoControl.update({ActiveTab:f.HotelBlock.None}),this._switcher&&this._switcher.showById(f.HotelBlock.None)},e.prototype._renderSwitcher=function(){var t=this._nodes,e=t.aboutNode,o=t.mapNode,i=t.priceNode,r=t.reviewsNode;this._switcher=new c.LayerSwitch,this._switcher.add(e,f.HotelBlock.Desc),this._switcher.add(o,f.HotelBlock.Map),this._switcher.add(r,f.HotelBlock.Review),this._switcher.add(i,f.HotelBlock.Buy),this._switcher.showById(f.HotelBlock.None)},e.prototype._onTabClicked=function(t){var e=t.Type,o=t.NoScroll;if(e===f.HotelBlock.None){this._closeTabsWithScroll(o);var i={Expand:!1,Id:this._Id};return void this.ExpandChanged.fire(i)}if(e===this._switcher.getId())return void this._onTabClicked({Type:f.HotelBlock.None,NoScroll:o});if(e===f.HotelBlock.Edit)return void this._showEditBlock();this._switcher.showById(e),this._infoControl.update({ActiveTab:e}),this._showBlockByType(e);var r={Expand:!0,Id:this._Id};this.ExpandChanged.fire(r)},e.prototype._showBlockByType=function(t){switch(t){case f.HotelBlock.Desc:this._showDescriptionBlock();break;case f.HotelBlock.Map:this._showMapBlock();break;case f.HotelBlock.Review:this._showReviewBlock();break;case f.HotelBlock.Buy:this._showBuyBlock()}},e.prototype._showDescriptionBlock=function(){if(!this._isLoadedDescription){if(!this._aboutControl){var t=this._nodes.aboutNode;this._aboutControl=new E.ResultAboutHotelControl({HotelId:this._Id,HotelLink:this._HotelData.link,ParentNode:t,StyleTheme:this._Theme===f.Theme.Theme1?m.StyleThemeEnum.THEME1:m.StyleThemeEnum.THEME2,PreviewEnter:new h.Delegate(this,this._onPreviewEnter),PreviewMouseOut:new h.Delegate(this,this._onPreviewMouseOut),PreviewMouseOver:new h.Delegate(this,this._onPreviewMouseOver)})}this._isLoadedDescription=!0}},e.prototype._onPreviewMouseOver=function(){(0,_.show)(this._nodes.zoomImgWrapperNode)},e.prototype._onPreviewMouseOut=function(){(0,_.hide)(this._nodes.zoomImgWrapperNode)},e.prototype._onPreviewEnter=function(t){var e=this._nodes,o=e.zoomImgWrapperNode,i=e.zoomImgNode;(0,_.show)(o),i.style.backgroundImage='url("'+t.Pic+'")'},e.prototype._onScrollToTop=function(){var t=(0,_.cumulativeOffset)(this._DomNode).top;(0,_.scrollToTop)(p.SCROLL_DURATION_M,t-p.FIXED_TOOLBAR_HEIGHT)},e.prototype._showMapBlock=function(){if(!this._mapControl){var t=(0,C.getLocalStorage)(p.LOCSTORAGE_HOTEL_MAP_LAYER),e=this._HotelData,o=e.lat,i=e.lng,r=this._nodes.mapNode;this._mapControl=new A.ResultHotelMapControl({Lat:o,LayerViewType:t||I.ViewType.Scheme,Lng:i,ParentNode:r,StyleTheme:this._Theme===f.Theme.Theme1?m.StyleThemeEnum.THEME1:m.StyleThemeEnum.THEME2,LayerChanged:new h.Delegate(this,this._onMapLayerChanged)})}},e.prototype._showReviewBlock=function(){if(!this._isLoadedReviews){if(!this._reviewsControl){var t=this._nodes.reviewsNode;this._reviewsControl=new V.ResultHotelReviewsControl({HotelId:this._Id,ParentNode:t,StyleTheme:this._Theme===f.Theme.Theme1?m.StyleThemeEnum.THEME1:m.StyleThemeEnum.THEME2})}this._isLoadedReviews=!0}},e.prototype._showBuyBlock=function(){this._isToursExpanded=!0,this._ShowTours?this._resultTours.showMore():(this._resultTours.clearDOM(),this._resultTours.showTours(),this._resultTours.updateVisibleShowMoreButton())},e.prototype._onPriceClicked=function(){this._onTabClicked({Type:f.HotelBlock.Buy})},e.prototype._showEditBlock=function(){if(!this._editControl){var t=this._nodes.infoNode;this._editControl=new k.HotelEditor({Class:"TVHotelEditor",CountryId:Number(this._HotelData.countrycode),Description:this._HotelData.desc||"",HotelId:this._Id,RelativeNode:t,Changed:new h.Delegate(this,this._onHotelEditorChanged)})}this._editControl.getIsVisible()?this._editControl.hide():this._editControl.show()},e.prototype._onGoToItemClicked=function(){this.GoToItemClicked.fire()},e.prototype._onLikeClicked=function(){var t=!this._isLiked,e=Number(this._HotelData.countrycode);if(t){return w.favoriteHotelsService.getHotels(e).length>=p.FAVORITE_HOTELS_LIMIT?(this._renderLikeLimitHint(),void this._likeLimitHint.show()):void w.favoriteHotelsService.add(this._Id,e)}w.favoriteHotelsService.remove(this._Id,e)},e.prototype._onHotelNameClicked=function(t){var e=this._resultTours.getLength()>0?this._resultTours.getTours()[0]:null;null!==e&&(0,D.showTour)({Currency:this._Currency,CustomData:l.resultStore.getGlobals().CustomData,TourId:e[f.TourParam.TourId],Ref:this._Ref}),(0,_.preventDefault)(t.Event)},e.prototype._onHotelEditorChanged=function(t){this._infoControl.update({Description:t.Description})},e.prototype._onMapLayerChanged=function(t){var e=t.LayerType,o=t.Type;e===I.LayerTypes.View&&(0,C.setLocalStorage)(p.LOCSTORAGE_HOTEL_MAP_LAYER,o)},e.prototype._onShowPhotoGallery=function(){var t=this;(this._HotelData.type===M.TourType.CRAFT?T.craftTourPhotoService.all({tourId:this._HotelData.crafttourid}).then(function(t){return(0,y.isNotEmptyArray)(t)?b.pictureUtils.getCraftTourLinks(t):null}):S.hotelDataService.getHotelDataById(this._Id).then(function(t){var e=P.hotelUtils.getHotelPhoto(t);return P.hotelUtils.getPhotoGalleryItems(e)})).then(function(e){if(e){var o=P.hotelUtils.getHotelResultName(t._HotelData,O.TextTransformEnum.LOWERCASE);(0,g.showGallery)({ActiveIndex:0,Items:e,ModeView:t._ModeView,Title:o})}})},e.prototype._onHotelsCollectionsStoreChanged=function(t){t.Type===v.CatalogName.HotelsCollections&&this._updateTags()},e.prototype._updateTags=function(){var t=this._getTags();this._infoControl.update({Tags:t})},e.prototype._onFavoriteHotelsChanged=function(t){var e=t.Type,o=t.Id;switch(e){case w.FavoriteHotelsServiceChangeType.ADD:case w.FavoriteHotelsServiceChangeType.REMOVE:this._Id===o&&this._updateIsLiked();break;case w.FavoriteHotelsServiceChangeType.CLEAR:this._updateIsLiked()}},e.prototype._getTags=function(){var t=a.hotelsCollectionsStore.getCollectionsByHotel(this._Id)||[];return this._PriceOld>0?n([{access:f.HotelsCollectionsAccess.ALL,mark_color:f.Color.RED550,mark_text:"Горящий тур",marked:!0}],t,!0):n([],t,!0)},e}(L.ResultBuilderItem);e.HotelResultItem=B,t.HotelResultItem=B}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ResultAboutHotelControl=void 0;var r=o(17),n=o(23),s=o(2),a=o(3),l=o(1),u=o(1010),c=o(10),h=o(68),d=o(12),p=o(426),_=o(18),f=o(15),y=o(158),g=function(t){function e(e){var o=t.call(this,e)||this;return o.PreviewMouseOver=new a.UserEvent,o.PreviewMouseOut=new a.UserEvent,o.PreviewEnter=new a.UserEvent,o.templateName="result-about-hotel",o._HotelId=0,o._HotelLink="",o._StyleTheme=c.StyleThemeEnum.THEME1,o._fullAboutLink=null,o._previewTable=null,o._waiter=null,o._images=[],t.prototype.__initSettings.call(o,e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._loadData(),this._renderAboutLink(),this._updateStyleThemeClass()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.HotelId;(0,l.isDefined)(o)&&this._loadData()},e.prototype.destroy=function(){this._previewTable&&((0,l.removeEvent)(this._previewTable,"mouseenter",this._onMouseOver),(0,l.removeEvent)(this._previewTable,"mouseleave",this._onMouseOut)),this._images&&this._images.forEach(function(t){(0,l.removeEvent)(t.Node,"mouseenter",t.Handler)}),t.prototype.destroy.call(this)},e.prototype._init=function(){this._onDataLoaded=this._onDataLoaded.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onMouseOut=this._onMouseOut.bind(this)},e.prototype._renderAboutLink=function(){var t=this._nodes.footerNode,e=r.resultStore.getLinks(),o=e?""+e.hotellink+this._HotelLink:"";this._fullAboutLink=new y.ResultNavButton({Content:"Подробнее об отеле",Link:o,ParentNode:t,StyleTheme:this._StyleTheme})},e.prototype._updateGallery=function(t){var e=this._nodes.imagesNode;this._previewTable=(0,l.newDiv)("TVResultAboutHotelPrewiews",e),(0,l.addEvent)(this._previewTable,"mouseenter",this._onMouseOver),(0,l.addEvent)(this._previewTable,"mouseleave",this._onMouseOut);for(var o=Math.min(t.length,12),i=0;i<o;i++){var r=t[i].previewlink;if(!r)return;var n=(0,l.newDiv)("TVResultAboutHotelPrewiewItem",this._previewTable);n.style.backgroundImage="url("+r+")";var s=this._onPreviewEnter.bind(this,{Pic:t[i].biglink});(0,l.addEvent)(n,"mouseenter",s),this._images.push({Handler:s,Node:n})}},e.prototype._updateInfo=function(t){this._nodes.infoNode.innerHTML=t},e.prototype._updateStyleThemeClass=function(){var t=f.styleUtils.getClassByTheme(this._StyleTheme);(0,l.addClass)(this._DomNode,t)},e.prototype._loadData=function(){var t=this;this._HotelId&&(this._showWaiter(),h.hotelDataService.getHotelDataById(this._HotelId).then(function(e){t._hideWaiter(),t._onDataLoaded(e)}))},e.prototype._onDataLoaded=function(t){if((0,l.isObject)(t)){var e=t.short_desc,o=t.pictures;if((0,l.isDefined)(e)){var i=this._getInfo(t);this._updateInfo(i)}if((0,l.isDefined)(o)){var r=_.hotelUtils.getHotelPhoto(t);this._updateGallery(r)}}},e.prototype._showWaiter=function(){this._waiter||(this._waiter=new n.Waiter({ParentNode:this._DomNode})),this._waiter.show()},e.prototype._hideWaiter=function(){this._waiter&&this._waiter.hide()},e.prototype._onMouseOver=function(){this.PreviewMouseOver.fire()},e.prototype._onMouseOut=function(){this.PreviewMouseOut.fire()},e.prototype._onPreviewEnter=function(t){this.PreviewEnter.fire(t)},e.prototype._getInfo=function(t){void 0===t&&(t={});var e="",o=t.info,i=t.services;if(o&&(o.date_build&&(e+=this._getInfoItem("Построен",o.date_build)),o.date_repair&&(e+=this._getInfoItem("Реставрация",o.date_repair)),o.place&&(e+=this._getInfoItem("Расположен",o.place))),i){var r=p.hotelServiceGroupUtils.getGroupedServices(i);if(r[u.HotelServiceGroupEnum.BEACH]){var n=this._getGroupServiceNames(r[u.HotelServiceGroupEnum.BEACH]);e+=this._getInfoItem("Пляж",n)}if(r[u.HotelServiceGroupEnum.TERRITORY]){var n=this._getGroupServiceNames(r[u.HotelServiceGroupEnum.TERRITORY]);e+=this._getInfoItem("Территория",n)}if(r[u.HotelServiceGroupEnum.SERVICE]){var n=this._getGroupServiceNames(r[u.HotelServiceGroupEnum.SERVICE]);e+=this._getInfoItem("Услуги",n)}if(r[u.HotelServiceGroupEnum.ROOM]){var n=this._getGroupServiceNames(r[u.HotelServiceGroupEnum.ROOM]);e+=this._getInfoItem("Номер",n)}if(r[u.HotelServiceGroupEnum.CHILDREN]){var n=this._getGroupServiceNames(r[u.HotelServiceGroupEnum.CHILDREN]);e+=this._getInfoItem("Для детей",n)}}return e||(e="Детальное описание отеля временно отсутствует."),e},e.prototype._getInfoItem=function(t,e){return'<div class="TVResultAboutHotelInfoItem">\n                    <div class="TVResultAboutHotelInfoItemTitle">'+t+'</div>\n                    <div class="TVResultAboutHotelInfoItemContent">'+(0,d.sanitizeHTML)(e)+"</div>\n                </div>"},e.prototype._getGroupServiceNames=function(t){var e=t.filter(function(t){return Boolean(t.name)}).map(function(t){return t.name}).join(", ").toLocaleLowerCase();return(0,l.capitalizeFirstLetter)(e)},e}(s.Control);e.ResultAboutHotelControl=g,t.ResultAboutHotelControl=g}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.HotelServiceGroupEnum=void 0;var o;!function(t){t[t.CHILDREN=1]="CHILDREN",t[t.ROOM=2]="ROOM",t[t.BEACH=3]="BEACH",t[t.LOCATION=4]="LOCATION",t[t.TERRITORY=5]="TERRITORY",t[t.SERVICE=6]="SERVICE",t[t.EXTRA=7]="EXTRA",t[t.HOTEL_TYPE=8]="HOTEL_TYPE"}(o=e.HotelServiceGroupEnum||(e.HotelServiceGroupEnum={})),t.HotelServiceGroupEnum=o}).call(e,o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelEditor=void 0;var n=o(48),s=o(106),a=o(129),l=o(93),u=o(23),c=o(4),h=o(3),d=o(1),p=o(30),_=o(5),f=o(20),y=o(18),g=o(8),C=o(390),v=o(1012),m=p.CoreLinks.ManagerAction+"?json",T=function(e){function o(t){var o=e.call(this,t)||this;return o.Changed=new h.UserEvent,o._CountryId=0,o._Description="",o._HotelId=0,o._RelativeNode=null,o._hotelEditorForm=null,o._hotelsCollections=null,o._saveBtn=null,o._closeBtn=null,o._savedHint=null,o._waiter=null,o._hotelsCollectionsSaveCount=0,o._hotelsCollectionsSavedCount=0,o._isDescriptionSaved=!1,o._isHotelsCollectionsSavedSuccess=!1,o._selectedCollections=[],o._addedCollections=[],o._deletedCollections=[],o._prevDescription="",o.__initSettings(t),o._onSaveBtnClicked=o._onSaveBtnClicked.bind(o),o._onCloseBtnClicked=o._onCloseBtnClicked.bind(o),o._Render&&o.render(),o}return r(o,e),o.prototype.render=function(){e.prototype.render.call(this);var t=(0,d.newDiv)("TVHotelEditorHeader "+g.TV_MAIN_COLOR,this._DomNode);this._saveBtn=(0,d.newDiv)("TVHotelEditorSaveBtn",t),this._closeBtn=(0,d.newDiv)(g.TV_CLOSE_POPUP+" "+g.TV_MAIN_COLOR,t),this._savedHint=new l.Hint({Anchor:this._saveBtn,MouseEventEnable:!1}),this._waiter=new u.Waiter({ParentNode:t,Class:"TVHotelEditorWaiter"}),(0,d.addEvent)(this._saveBtn,"click",this._onSaveBtnClicked),(0,d.addEvent)(this._closeBtn,"click",this._onCloseBtnClicked),this._hotelEditorForm=new v.HotelEditorForm({Description:this._Description,DescriptionChanged:new c.Delegate(this,this._onDescriptionChanged)}),this.addChild(this._hotelEditorForm);var o=(0,d.newDiv)("TVHotelsEditorCollectionsWrapper",this._ContentNode);this._hotelsCollections=new C.HotelsCollections({ParentNode:o,SelectedHotel:this._HotelId,Changed:new c.Delegate(this,this._onCollectionsChanged)})},o.prototype.update=function(t){e.prototype.update.call(this,t),this._rendered&&this._hotelEditorForm.update(t)},o.prototype.show=function(){e.prototype.show.call(this);var t=(0,d.cumulativeOffset)(this._RelativeNode);this.updatePosition(t.left+5,this._RelativeNode.offsetWidth,t.top,this._RelativeNode.offsetHeight,(0,d.getCoords)(this._RelativeNode)),this._prevDescription=this._Description.slice(),this._updateHotelsCollections(),this._updateSaveBtnClass(),s.hotelsCollectionsStore.Changed.addOnce(new c.Delegate(this,this._onHotelsCollectionsStoreChanged))},o.prototype.hide=function(){e.prototype.hide.call(this),s.hotelsCollectionsStore.Changed.remove(this),this._savedHint.hide()},o.prototype.destroy=function(){(0,d.removeEvent)(this._saveBtn,"click",this._onSaveBtnClicked),(0,d.removeEvent)(this._closeBtn,"click",this._onCloseBtnClicked),e.prototype.destroy.call(this)},o.prototype._onHotelsCollectionsStoreChanged=function(t){t.Type===f.CatalogName.HotelsCollections&&this._updateHotelsCollections()},o.prototype._updateHotelsCollections=function(){var t=s.hotelsCollectionsStore.getCollections(this._CountryId)||[];this._selectedCollections=y.hotelUtils.getCollectionsContainHotel(t,this._HotelId),this._hotelsCollections.update({CountryId:this._CountryId,Items:t,Selected:this._selectedCollections})},o.prototype._onSaveBtnClicked=function(){var t=this;if(this._hotelEditorForm.isValid()){if(this._waiter.show(),this._savedHint.hide(),(0,d.addClass)(this._DomNode,"TVHotelEditorSaveInProccess"),this._Description!==this._prevDescription){var e="";this._HotelId&&(e+="&hotelcode="+this._HotelId),this._Description&&(e+="&desc="+encodeURIComponent(this._Description)),this._CountryId&&(e+="&country="+this._CountryId),e+="&mngaction=dosavedesc",e+="&ts_jjhref="+location.href,n.jsonp.update({Url:m}),n.jsonp.send(e,new c.Delegate(this,this._onDescriptionSaved))}else this._isDescriptionSaved=!0;this._isHotelsCollectionsSavedSuccess=!0,this._addedCollections.forEach(function(e){t._updateHotelInCollections(e,_.HotelsCollectionsManage.AddHotels)}),this._deletedCollections.forEach(function(e){t._updateHotelInCollections(e,_.HotelsCollectionsManage.DeleteHotels)}),this._hotelsCollectionsSaveCount=this._addedCollections.length+this._deletedCollections.length,this._addedCollections=[],this._deletedCollections=[]}},o.prototype._updateHotelInCollections=function(e,o){var i={collectionId:e,countryId:this._CountryId,hotelId:this._HotelId};t.hotelsCollectionsManager.updateHotelInCollections(i,o,new c.Delegate(this,this._onCollectionsSaved))},o.prototype._onCollectionsSaved=function(t){this._hotelsCollectionsSavedCount+=1,this._updateSaveBtnClassAfterSave(),t&&0!==t.length||(this._isHotelsCollectionsSavedSuccess=!1)},o.prototype._onDescriptionSaved=function(){this._isDescriptionSaved=!0,this._prevDescription=this._Description.slice(),this._updateSaveBtnClassAfterSave()},o.prototype._onCloseBtnClicked=function(){this.hide()},o.prototype._onDescriptionChanged=function(t){this._Description=t.Description,this._updateSaveBtnClass()},o.prototype._onCollectionsChanged=function(t){var e=this,o=t.Selected,i=this._selectedCollections;this._addedCollections=[],this._deletedCollections=[],o.forEach(function(t){-1===i.findIndex(function(e){return e===t})&&(e._addedCollections.push(t),e._deletedCollections=e._deletedCollections.filter(function(e){return e!==t}))}),i.forEach(function(t){-1===o.findIndex(function(e){return e===t})&&(e._deletedCollections.push(t),e._addedCollections=e._addedCollections.filter(function(e){return e!==t}))}),this._updateSaveBtnClass()},o.prototype._updateSaveBtnClass=function(){this._Description===this._prevDescription&&0===this._addedCollections.length&&0===this._deletedCollections.length?(0,d.addClass)(this._saveBtn,"TVHotelEditorSaveDisable"):(0,d.removeClass)(this._saveBtn,"TVHotelEditorSaveDisable")},o.prototype._updateSaveBtnClassAfterSave=function(){if(this._isDescriptionSaved&&this._hotelsCollectionsSaveCount===this._hotelsCollectionsSavedCount){(0,d.addClass)(this._saveBtn,"TVHotelEditorSaveDisable"),this._isDescriptionSaved=!1,this._hotelsCollectionsSaveCount=0,this._hotelsCollectionsSavedCount=0;var t={Description:this._Description};this.Changed.fire(t),this._savedHint.update({Class:this._isHotelsCollectionsSavedSuccess?"TVHotelEditorSavedSuccess":"TVHotelEditorSavedError"}),this._waiter.hide(),this._savedHint.show(),(0,d.removeClass)(this._DomNode,"TVHotelEditorSaveInProccess")}},o}(a.DropPanel);e.HotelEditor=T,i.HotelEditor=T}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelEditorForm=void 0;var r=o(2),n=o(3),s=o(1),a=function(t){function e(e){var o=t.call(this,e)||this;return o.DescriptionChanged=new n.UserEvent,o.templateName="hotel-editor-form",o._Description="",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._nodes.descriptionNode.value=this._Description},e.prototype.isValid=function(){return this._isValidDescription()},e.prototype._onDescriptionNodeBlur=function(){this.DescriptionChanged.fire({Description:this._nodes.descriptionNode.value}),this._isValidDescription()},e.prototype._onStandartDescriptionClick=function(){this._nodes.descriptionNode.value=this._Description,this.DescriptionChanged.fire({Description:this._nodes.descriptionNode.value}),this._isValidDescription()},e.prototype._isValidDescription=function(){var t=this._nodes.descriptionNode,e=t.value.trim().length>0;return e?(0,s.removeClass)(t,"TVInvalidInput"):(0,s.addClass)(t,"TVInvalidInput"),e},e}(r.Control);e.HotelEditorForm=a,t.HotelEditorForm=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.HotelInfoControl=void 0;var r=o(17),n=o(222),s=o(252),a=o(2),l=o(4),u=o(3),c=o(7),h=o(1),d=o(5),p=o(6),_=o(16),f=o(183),y=o(18),g=o(245),C=o(67),v=o(8),m=o(312),T=o(313),w=function(t){function e(e){var o=t.call(this,e)||this;return o.GoToItemClicked=new u.UserEvent,o.LikeClicked=new u.UserEvent,o.NameClicked=new u.UserEvent,o.PriceClicked=new u.UserEvent,o.ShowGallery=new u.UserEvent,o.TabClicked=new u.UserEvent,o._ActiveTab=d.HotelBlock.None,o._Currency=d.Currency.Rub,o._Class="TVHotelInfo",o._Description="",o._IsEnabledEdit=!1,o._IsLiked=!1,o._HotelData=null,o._MngId=0,o._ModeView=d.ModeView.DescTop,o._Price=0,o._PriceOld=0,o._PriceType=d.PriceType.None,o._Tags=[],o._resultItem=null,o._likeButton=null,o.__initSettings(e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._getBeforeDescription();this._resultItem=new T.ResultItem({AfterHeader:this._getAfterHeader(),BeforeDescription:e,Currency:(0,p.getCurrencyValue)(this._Currency),Description:this._getDescription(),DescriptionTextIndent:e?35:0,GoToItemSubmitTitle:"Перейти к отелю",GoToItemTitle:"Минимальная цена по отелю изменилась,",IsEnabledPictureClick:!0,IsVisibleLike:this._isVisibleLike(),ModeView:this._ModeView,NavButtons:this._getNavButtons(),ParentNode:this._DomNode,Picture:this._getPicture(),Pretitle:this._getPretitle(),Price:this._Price,PriceOld:this._PriceOld,PriceType:this._getPriceType(),Subtitle:this._getSubtitle(),Theme:this._Theme,Title:this._getTitle(),GoToClicked:new l.Delegate(this,this._onGoToItemClicked),LikeClicked:new l.Delegate(this,this._onLikeClicked),NavButtonClicked:new l.Delegate(this,this._onNavButtonClicked),PictureClicked:new l.Delegate(this,this._onShowPhotoGallery),PriceClicked:new l.Delegate(this,this._onPriceClicked),TitleClicked:new l.Delegate(this,this._onHotelNameClicked)})},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.ActiveTab,i=e.Description,r=e.IsLiked,n=e.IsVisibleGoToItem,s=e.MngId,a=e.Price,l=e.PriceOld,u=e.Tags;(0,h.isDefined)(o)&&this._resultItem.update({ActiveNavButton:this._ActiveTab!==d.HotelBlock.None?this._ActiveTab:null,IsActiveArrowButton:this._ActiveTab===d.HotelBlock.Buy}),(0,h.isDefined)(u)&&this._resultItem.update({Subtitle:this._getSubtitle()}),(0,h.isDefined)(i)&&this._resultItem.update({Description:this._Description}),((0,h.isDefined)(a)||(0,h.isDefined)(l))&&this._resultItem.update({Price:this._Price,PriceOld:this._PriceOld}),(0,h.isDefined)(s)&&this._resultItem.update({NavButtons:this._getNavButtons()}),(0,h.isDefined)(r)&&(this._likeButton&&this._likeButton.update({IsActive:this._IsLiked}),this._resultItem.update({IsLiked:this._IsLiked})),(0,h.isDefined)(n)&&this._resultItem.update({IsVisibleGoToItem:n})},e.prototype._init=function(){this._onHotelNameClicked=this._onHotelNameClicked.bind(this)},e.prototype._renderGalleryButton=function(){var t,e,o=this._nodes.galleryButton;if(o){var i=this._HotelData.type===C.TourType.CRAFT||Boolean(null===(e=null===(t=this._HotelData)||void 0===t?void 0:t.detail)||void 0===e?void 0:e.foto);(0,h.setVisible)(o,i)}},e.prototype._getPicture=function(){if(this._HotelData.pic)return this._HotelData.pic;var t=r.resultStore.getLinks(),e=this._ModeView===d.ModeView.DescTop?y.PictureSize.MEDIUM:y.PictureSize.MAIN;return y.hotelUtils.getPicture(t,e,this._HotelData.pict,this._Id,this._HotelData)},e.prototype._getAfterHeader=function(){return this._Theme===d.Theme.Theme1?this._getRating():""},e.prototype._getBeforeDescription=function(){return this._Theme===d.Theme.Theme2?this._getRating():""},e.prototype._getDescription=function(){return Boolean(this._Description)?this._Description:"Описание отеля временно отсутствует. Ведется добавление информации."},e.prototype._getRating=function(){var t=Number(this._HotelData.rating);if(!t)return"";var e=t.toFixed(1),o=this._Theme===d.Theme.Theme1?"TVSHotelInfoRating":"TVHotelInfoRating",i=(0,h.newDiv)((0,h.classNames)(o,(0,p.getRatingClass)(e)));return i.textContent=""+e,i.outerHTML},e.prototype._getNavButtons=function(){var t=[];return 1===this._HotelData.details&&t.push({Id:d.HotelBlock.Desc,Content:"Об отеле"}),1===this._HotelData.reviews&&t.push({Id:d.HotelBlock.Review,Content:"Отзывы"}),(0,h.isDefined)(this._HotelData.lat)&&t.push({Id:d.HotelBlock.Map,Content:"На карте"}),this._isVisibleLike()&&(this._likeButton=new n.LikeButtonControl({Color:"#c71111",IsActive:this._IsLiked,Size:_.SizeEnum.XS}),t.push({Id:d.HotelBlock.Like,Content:this._likeButton,Class:"TVHotelInfoLikeNavButton",PaddingSize:_.SizeEnum.S})),this._isVisibleEdit()&&t.push({Id:d.HotelBlock.Edit,Content:"",Class:"TVHotelInfoEditNavButton",PaddingSize:_.SizeEnum.S}),this._Theme===d.Theme.Theme1&&t.push({Id:d.HotelBlock.Buy,Content:"Выбрать",Class:"TVHotelInfoChooseNavButton"}),t},e.prototype._getSubtitle=function(){var t=this,e=y.hotelUtils.getHotelResultSubTitle(this._HotelData);if((0,p.isNotEmptyArray)(this._Tags)){var o=(0,h.newDiv)("TVHotelInfoSubTitleWrapper");(0,h.newDiv)("TVHotelInfoSubTitle",o).textContent=e;var i=(0,h.newDiv)("TVHotelInfoTags",o);return this._Tags.forEach(function(e){var o=e.access,r=e.marked,n=e.mark_color,a=void 0===n?"":n,l=e.mark_text,u=void 0===l?"":l,c=e.tsmng;if(r){var h=Number(c);(o===d.HotelsCollectionsAccess.ALL||o===d.HotelsCollectionsAccess.MANAGER&&t._MngId===h||o===d.HotelsCollectionsAccess.MANAGERS&&t._MngId>0)&&new s.Tag({Color:a,Content:u,ParentNode:i})}}),o.outerHTML}return e},e.prototype._getTitle=function(){var t,e=this._ModeView===d.ModeView.Mobile,o=this._getTitleTextTransform(),i=this._isTitleEllipsis(),n=y.hotelUtils.getHotelResultName(this._HotelData,o);if(e){var s=(0,h.newDiv)((0,h.classNames)((t={},t.TVHotelInfoTextEllipsis=i,t)));return s.innerHTML=n,s.outerHTML}if((0,h.isDefined)(this._HotelData.link)){var a=(0,h.newDomNode)("a","");a.innerHTML=n,a.target="_blank";var l=r.resultStore.getLinks();return"#!/hotel="===l.hotellink&&(l.hotellink="http://manyhotels.ru/"+l.hotellink),a.href=l.hotellink+this._HotelData.link,a.outerHTML}return n},e.prototype._getPretitle=function(){var t,e=this,o=null;switch(!0){case this._HotelData.type===C.TourType.CRAFT:(0,p.isNotEmptyArray)(this._HotelData.types)&&this._HotelData.types.forEach(function(t){o=(0,h.newDiv)("TVHotelInfoAcType"),o.textContent=t});break;case this._HotelData.actype>0:f.hotelAcTypesService.getAcTypeById(this._HotelData.actype).then(function(t){o=(0,h.newDiv)("TVHotelInfoAcType"),o.textContent=t.name,e._resultItem.update({Pretitle:o&&o.outerHTML||""})});break;case Boolean(this._HotelData.stars):o=(0,h.newDiv)();for(var i=0;i<this._HotelData.stars;i++)(0,h.newDiv)((0,h.classNames)("TVHotelInfoStar",(t={},t[v.TV_SMALL]=this._ModeView===d.ModeView.Mobile,t)),o)}return o&&o.outerHTML||""},e.prototype._getTitleTextTransform=function(){return this._HotelData.type===C.TourType.CRAFT?g.TextTransformEnum.NONE:g.TextTransformEnum.CAPITALIZE},e.prototype._getPriceType=function(){return m.resultPriceUtils.getPriceType(this._PriceType,this._Theme,this._ModeView)},e.prototype._isTitleEllipsis=function(){return this._HotelData.type!==C.TourType.CRAFT},e.prototype._isVisibleLike=function(){return this._HotelData.type!==C.TourType.CRAFT&&!this._HotelData.temp},e.prototype._isVisibleEdit=function(){return this._IsEnabledEdit&&this._MngId>0&&this._Id<c.HOTEL_MAX_BIND_ID&&!this._HotelData.temp},e.prototype._onShowPhotoGallery=function(){this.ShowGallery.fire()},e.prototype._onHotelNameClicked=function(t){this.NameClicked.fire(t)},e.prototype._onNavButtonClicked=function(t){var e=t.Id;if(e===d.HotelBlock.Like)return void this._onLikeClicked();var o={Type:e};this.TabClicked.fire(o)},e.prototype._onGoToItemClicked=function(){this.GoToItemClicked.fire()},e.prototype._onLikeClicked=function(){this.LikeClicked.fire()},e.prototype._onPriceClicked=function(){this.PriceClicked.fire()},e}(a.Control);e.HotelInfoControl=w,t.HotelInfoControl=w}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ResultHotelMapControl=void 0;var r=o(195),n=o(2),s=o(1),a=o(5),l=o(188),u=o(10),c=o(37),h=o(15),d=o(114),p=o(158),_=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="result-hotel-map",o._Lat=0,o._LayerViewType=d.ViewType.Scheme,o._Lng=0,o._ParentNode=null,o._StyleTheme=u.StyleThemeEnum.THEME1,o._LayerChanged=null,o._map=null,o._googleLink=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderMap(),this._renderGoogleLink(),this._updateStyleThemeClass()},e.prototype.destroy=function(){this._LayerChanged=null,t.prototype.destroy.call(this)},e.prototype._renderMap=function(){var t=this._nodes.contentNode;this._map=new r.MapControl({IsVisibleLayers:!0,IsVisibleTools:!1,Layers:[d.LayerTypes.View],ParentNode:t,SelectedLayers:[{Item:this._LayerViewType,LayerType:d.LayerTypes.View}],ShowMapInWindow:!1,LayerChanged:this._LayerChanged}),this._map.show(),this._updateMarker()},e.prototype._updateMarker=function(){var t={ClickEnabled:!1,Coords:[this._Lat,this._Lng]},e={ActiveItems:[t],IsNewActiveItems:!0,ToursGroup:a.ToursGroupBy.Hotels,View:{Center:[this._Lat,this._Lng],Zoom:c.DEFAULT_HOTEL_ZOOM_LEVEL}};this._map.update(e)},e.prototype._renderGoogleLink=function(){var t=this._nodes.footerNode,e=l.ExternalLinks.GoogleMapLink;e=e.replace(/lat/g,""+this._Lat),e=e.replace(/lng/g,""+this._Lng),this._googleLink=new p.ResultNavButton({Class:"TVResultHotelMapGoogle",Content:"Oткрыть на Google Maps",Link:e,ParentNode:t,StyleTheme:this._StyleTheme})},e.prototype._updateStyleThemeClass=function(){var t=h.styleUtils.getClassByTheme(this._StyleTheme);(0,s.addClass)(this._DomNode,t)},e}(n.Control);e.ResultHotelMapControl=_,t.ResultHotelMapControl=_}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ResultHotelReviewsControl=void 0;var r=o(23),n=o(2),s=o(4),a=o(1),l=o(10),u=o(68),c=o(18),h=o(15),d=o(234),p=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVResultHotelReviewsControl",o._HotelId=0,o._StyleTheme=l.StyleThemeEnum.THEME1,o._waiter=null,t.prototype.__initSettings.call(o,e),o._init(),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._hotelReviewsView=new d.HotelReviewsView({InitReviewsCount:3,ParentNode:this._DomNode,UpButtonEnable:!1,Ready:new s.Delegate(this,this._onReady)}),this._loadHotelData(),this._updateThemeClass()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.HotelId;(0,a.isDefined)(o)&&this._loadHotelData()},e.prototype._init=function(){this._onLoadedHotelData=this._onLoadedHotelData.bind(this)},e.prototype._loadHotelData=function(){this._HotelId&&(this._hotelReviewsView.hide(),this._waiter||(this._waiter=new r.Waiter({ParentNode:this._DomNode})),this._waiter.show(),u.hotelDataService.getHotelDataById(this._HotelId).then(this._onLoadedHotelData))},e.prototype._updateThemeClass=function(){var t=h.styleUtils.getClassByTheme(this._StyleTheme);(0,a.addClass)(this._DomNode,t)},e.prototype._onLoadedHotelData=function(t){var e=c.hotelUtils.getReviewsServicesLinks(t);this._hotelReviewsView.update({HotelId:this._HotelId,ReviewsServicesLinks:e})},e.prototype._onReady=function(){this._hotelReviewsView.show(),this._waiter&&this._waiter.hide()},e}(n.Control);e.ResultHotelReviewsControl=p,t.ResultHotelReviewsControl=p}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ResultToursControl=void 0;var n=o(31),s=o(34),a=o(105),l=o(17),u=o(142),c=o(23),h=o(2),d=o(4),p=o(3),_=o(7),f=o(1),y=o(5),g=o(22),C=o(121),v=o(156),m=o(109),T=o(10),w=o(18),S=o(250),P=o(24),b=o(15),I=o(67),O=o(62),M=o(158),D=o(71),E=o(253),k=o(372),R=function(t){function e(e){var o=t.call(this,e)||this;return o.ScrollToTop=new p.UserEvent,o.templateName="result-tours",o._HotelId=0,o._StyleTheme=T.StyleThemeEnum.THEME1,o._Tours=[],o._ToursType=I.TourType.FLIGHT,o._isAllToursRendered=!1,o._isLoadedAllTours=!1,o._searchId=0,o._isGroupedByRoom=!1,o._groupingByRoomsButton=null,o._shareButton=null,o._showMoreButton=null,o._tourBuilder=null,o._toursByRoomBuilder=null,o._waiter=null,o.__initSettings(e),o._initTourBuilder(e),o._initToursByRoomBuilder(e),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this);var e=this._nodes,o=e.toursblock,i=e.toursByRoomNode;o&&this._tourBuilder.setParentNode(o),i&&this._toursByRoomBuilder.setParentNode(i),this._renderShareButton(),this._renderShowMoreButton(),this._renderGroupingByRoomsButton(),this._updateStyleThemeClass(),this._updateVisibleGrouping(),this._updateVisibleShowMore()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._tourBuilder.update(e),this._toursByRoomBuilder.update(e)},e.prototype.destroy=function(){(0,D.unlistenProgress)(this),t.prototype.destroy.call(this)},e.prototype.clearDOM=function(){this._tourBuilder.clearDOM(),this._toursByRoomBuilder.clearDOM()},e.prototype.showTours=function(){this._tourBuilder.showTours(),this._toursByRoomBuilder.showRooms()},e.prototype.showMore=function(){this._tourBuilder.showMore()},e.prototype.getLength=function(){return this._tourBuilder.getLength()},e.prototype.getTours=function(){return this._tourBuilder.getTours()},e.prototype.getToursMinPrice=function(){return this._tourBuilder.getToursMinPrice()},e.prototype.isLoadedAllTours=function(){return this._isLoadedAllTours},e.prototype.updateVisibleShowMoreButton=function(){this._updateVisibleShowMore()},e.prototype._initTourBuilder=function(t){this._tourBuilder=new E.TourBuilder(r(r({},t),{RoomClicked:new d.Delegate(this,this._onRoomClicked),ShowMoreEnd:new d.Delegate(this,this._updateVisibleShowMore)}))},e.prototype._initToursByRoomBuilder=function(t){this._toursByRoomBuilder=new k.ToursByRoomBuilder(r(r({},t),{RoomClicked:new d.Delegate(this,this._onRoomClicked)}))},e.prototype._renderShareButton=function(){var t=this._nodes.footerNode;this._shareButton=new M.ResultNavButton({Class:"TVResultToursShareButton",Content:_.SHARE_CONTENT,ParentNode:t,StyleTheme:this._StyleTheme,Clicked:new d.Delegate(this,this._onShareLinkShow)})},e.prototype._renderShowMoreButton=function(){var t=this._nodes.footerNode,e=this._ToursType===I.TourType.HOTEL?_.FIND_MORE_HOTELS_CONTENT:_.FIND_MORE_TOURS_CONTENT;this._showMoreButton=new M.ResultNavButton({Class:"TVResultToursShowMoreButton",Content:e,ParentNode:t,StyleTheme:this._StyleTheme,Clicked:new d.Delegate(this,this._onShowMoreToursClicked)})},e.prototype._renderGroupingByRoomsButton=function(){if(this._ToursType!==I.TourType.CRAFT){var t=this._nodes.footerNode;this._groupingByRoomsButton=new M.ResultNavButton({Class:"TVResultToursGroupButton",Content:_.GROUP_BY_ROOMS_CONTENT,ParentNode:t,StyleTheme:this._StyleTheme,Clicked:new d.Delegate(this,this._onGroupingByRoomsСlicked)})}},e.prototype._renderWaiter=function(){if(!this._waiter){var t=this._nodes.footerNode;this._waiter=new c.Waiter({ParentNode:t,IsRelative:!0})}},e.prototype._startLoadMoreTours=function(){(0,D.listenProgress)({ProgressChanged:new d.Delegate(this,this._onProgressChanged)}),this._showMoreButton.update({Content:_.SHOW_MORE_TOURS_CONTENT}),(0,f.setVisible)(this._shareButton,!1),(0,f.setVisible)(this._showMoreButton,!1),(0,f.setVisible)(this._groupingByRoomsButton,!1),this._showWaiter()},e.prototype._showWaiter=function(){if(this._isGroupedByRoom)return void this._toursByRoomBuilder.update({IsVisibleWaiter:!0});this._renderWaiter(),this._waiter.show()},e.prototype._hideWaiter=function(){this._isGroupedByRoom&&this._toursByRoomBuilder.update({IsVisibleWaiter:!1}),this._waiter&&this._waiter.hide()},e.prototype._updateVisibleGrouping=function(){if(this._groupingByRoomsButton){var t=this._isGroupedByRoom?_.CANCEL_GROUP_BY_ROOMS_CONTENT:_.GROUP_BY_ROOMS_CONTENT;this._groupingByRoomsButton.update({Content:t,IsActive:this._isGroupedByRoom})}var e=this._nodes,o=e.toursNode,i=e.toursByRoomNode;(0,f.setVisible)(o,!this._isGroupedByRoom),(0,f.setVisible)(i,this._isGroupedByRoom)},e.prototype._onProgressChanged=function(t){var e=t.Progress,o=t.SearchId;if(0===this._searchId&&a.hotelGate.isCheckingItem(this._HotelId)){var i=l.resultStore.getGlobals();this._searchId=i.SearchId}100===e&&o===this._searchId&&(this._searchId=0,(0,D.unlistenProgress)(this),(0,f.setVisible)(this._groupingByRoomsButton,!0),(0,f.setVisible)(this._shareButton,!0),this._updateVisibleShowMore(),this._hideWaiter())},e.prototype._onShowMoreToursClicked=function(){this.showMore(),this._isLoadedAllTours||this._runSearchOnly()},e.prototype._onGroupingByRoomsСlicked=function(){this._isGroupedByRoom=!this._isGroupedByRoom,this._scrollToTop(),this._updateVisibleGrouping(),this._updateVisibleShowMore(),this._isLoadedAllTours||this._runSearchOnly()},e.prototype._runSearchOnly=function(){var t=(0,O.runSearchOnly)({Hotels:[this._HotelId]});!1!==t&&(this._searchId=t,this._isLoadedAllTours=!0,this._startLoadMoreTours())},e.prototype._scrollToTop=function(){(0,f.getScrolls)().Y>(0,f.cumulativeOffset)(this._DomNode).top-_.FIXED_TOOLBAR_HEIGHT&&this.ScrollToTop.fire()},e.prototype._onShareLinkShow=function(){var t=g.authManager.isManager(),e=s.clientCatalog.getClientData(),o=(0,C.isEnabledErrorManager)(t,e),i=l.resultStore.getActualSearchSettings(),a=r(r({},i),{Hotels:[this._HotelId]}),c=P.searchUtils.getSearchURL(a);delete a.FlyDates;var h=P.searchUtils.getSearchURL(a);(0,m.showShare)({ActionSource:n.ActionStatisticsSource.SEARCH,ErrorData:{Url:c},IsVisibleSendError:o,Link:c||"",LinkWithoutDate:h||"",ModeView:y.ModeView.DescTop,SharePanelView:u.SharePanelViewEnum.SHARE_LINK})},e.prototype._onRoomClicked=function(t){var e=t.RoomId;(0,v.showRoom)({ActionSource:n.ActionStatisticsSource.SEARCH,ModeView:y.ModeView.DescTop,RoomId:e,RoomServiceType:S.roomUtils.getRoomServiceTypeByTourType(this._ToursType)})},e.prototype._updateVisibleShowMore=function(){var t=a.hotelGate.getCheckedToursItemData(this._HotelId);this._isLoadedAllTours=w.hotelUtils.isCheckedToursHotel(t,l.resultStore.getActualSearchSettings());var e=this._Tours.length>this._tourBuilder.getLastRenderedIndex(),o=(e||!this._isLoadedAllTours)&&!this._isGroupedByRoom;(0,f.setVisible)(this._showMoreButton,o)},e.prototype._updateStyleThemeClass=function(){var t=b.styleUtils.getClassByTheme(this._StyleTheme);(0,f.addClass)(this._DomNode,t)},e}(h.Control);e.ResultToursControl=R,t.ResultToursControl=R}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ResortBuilder=void 0;var r=o(159),n=o(56),s=o(17),a=o(4),l=o(1),u=o(5),c=o(20),h=o(24),d=o(28),p=o(1018),_=o(238),f=function(t){function e(e){var o=t.call(this,e)||this;return o._MapClicked=null,o._ResortClicked=null,o.__initSettings(e),o._init(),o._initClass(),o._Render&&o.render(),o}return i(e,t),e.prototype._initClass=function(){this._Class=this._ModeView===u.ModeView.Mobile?"TVMResortResultBodyContainer":this._Theme===u.Theme.Theme1?"TVSResortResultBodyContainer":"TVResortResultBodyContainer"},e.prototype._onResultStoreChanged=function(t){switch(t.Type){case c.CatalogName.SearchResults:this._updateRenderItems();break;case c.CatalogName.ResortByHotel:if(!t.IsPassedFilteringFunction)break;var e=r.resortGate.getItem(t.Id);this._addResort(e),this._updateRenderItems();break;case c.CatalogName.FilterHotels:this.filter()}},e.prototype._isRenderedItem=function(t){return t&&!!t.getDomNode()&&!!t.getDomNode().parentNode&&!!t.getParentNode()&&!!t.getParentNode().parentNode},e.prototype._getItems=function(){var t=this,e=[];return(r.resortGate.getItems()||[]).forEach(function(o){var i=t._items[o.id];(0,l.isDefined)(i)?i.update({Price:o.minprice}):i=t._addResort(o),i&&e.push(i)}),e},e.prototype._getBeforeItem=function(t){var e=this,o=t.getPrice(),i=t.getName(),r=t.getPopularity();return this._activeItemsArr.find(function(t){var n=e._isRenderedItem(t)&&t.getPrice()>0;switch(e._Sort){case u.SortBy.Price:return o<t.getPrice()&&n;case u.SortBy.Name:return i>t.getName()&&n;case u.SortBy.Popularity:return r>t.getPopularity()&&n;default:return!1}})||null},e.prototype._addResort=function(t){var e=this,o=s.resultStore.getActualSearchSettings(),i=h.searchUtils.getCurrency(o),r=h.searchUtils.getPriceType(o);if((0,l.isDefined)(this._items[t.id])){var u=this._items[t.id].getPrice();t.minprice<u&&this._items[t.id].update({Price:t.minprice})}else{var c=n.resortsStore.getResort(t.id);if(!c)return null;var _=null;c.weather&&c.weather.length>0&&(_=c.weather.find(function(t){return t.month===e._FlyMonth})),this._items[t.id]=new p.ResortResultItem({Coord:c.coord,Currency:i,Description:c.info.short_desc,Id:c.region_code,Image:d.pictureUtils.getHorizontalPhotos(c)[0],Link:c.link,Links:s.resultStore.getLinks(),ModeView:this._ModeView,Name:c.region_name,Popularity:c.popularity,Price:t.minprice,PriceType:r,Render:!1,SunTemperature:_?_.temp_air:null,Theme:this._Theme,WaterTemperature:_?_.temp_water:null,MapClicked:this._MapClicked,PriceChanged:new a.Delegate(this,this._onMinPriceChanged),ResortClicked:this._ResortClicked})}return this._activeItemsArr.find(function(e){return Number(e.getId())===Number(t.id)})||this._addToActiveArr(this._items[t.id]),this._items[t.id]},e.prototype._addToActiveArr=function(t){var e,o=this;switch(this._Sort){case u.SortBy.Price:e=t.getPrice();break;case u.SortBy.Name:e=t.getName();break;case u.SortBy.Popularity:e=t.getPopularity()}if(0===this._activeItemsArr.length||0===e)this._activeItemsArr.push(t);else{var i=this._activeItemsArr.findIndex(function(t){switch(o._Sort){case u.SortBy.Price:var i=t.getPrice();return e<i||0===i;case u.SortBy.Name:var r=t.getName();return e>r;case u.SortBy.Popularity:var n=t.getPopularity();return e>n||0===n;default:return!1}});i>-1?this._activeItemsArr.splice(i,0,t):this._activeItemsArr.push(t)}},e}(_.ResultBuilder);e.ResortBuilder=f,t.ResortBuilder=f}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ResortResultItem=void 0;var n=o(4),s=o(3),a=o(1),l=o(5),u=o(6),c=o(16),h=o(52),d=o(312),p=o(314),_=o(313),f=function(t){function e(e){var o=t.call(this,e)||this;return o.MapClicked=new s.UserEvent,o.ResortClicked=new s.UserEvent,o._Coord=null,o._Currency=l.Currency.Rub,o._Description="",o._Image="",o._Info="",o._Link=null,o._Links=null,o._ModeView=l.ModeView.DescTop,o._Name="",o._Popularity=0,o._PriceType=l.PriceType.None,o._SunTemperature=0,o._WaterTemperature=0,o._resultItem=null,o.__initSettings(e),o.templateName=o._ModeView===l.ModeView.Mobile?"resort-result-item-mobile":"resort-result-item",o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderResultItem()},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._rendered){var o=e.Price;(0,a.isDefined)(o)&&this._resultItem.update({Price:this._Price})}},e.prototype.getPopularity=function(){return this._Popularity},e.prototype.getName=function(){return this._Name},e.prototype.clone=function(t){return new e(r(r({},t),{Description:this._Description,Image:this._Image,Info:this._Info,ModeView:this._ModeView,Name:this._Name,SunTemperature:this._SunTemperature,WaterTemperature:this._WaterTemperature}))},e.prototype._renderResultItem=function(){var t=this._nodes.infoNode;this._resultItem=new _.ResultItem({Currency:(0,u.getCurrencyValue)(this._Currency),Description:this._Description,DescriptionClampSize:c.SizeEnum.L,GoToItemSubmitTitle:"Перейти к курорту",GoToItemTitle:"Минимальная цена по курорту изменилась,",ModeView:this._ModeView,NavButtons:this._getNavButtons(),ParentNode:t,Picture:this._Image,Price:this._Price,PriceType:this._getPriceType(),Subtitle:this._getSubtitle(),Theme:this._Theme,Title:this._getTitle(),NavButtonClicked:new n.Delegate(this,this._onNavButtonClicked),PriceClicked:new n.Delegate(this,this._onPriceClicked)})},e.prototype._updatePrice=function(){this._resultItem&&this._resultItem.update({Price:this._Price})},e.prototype._getNavButtons=function(){var t,e,o=[],i=(null===(t=this._Links)||void 0===t?void 0:t.hotellink)||"",r=(null===(e=this._Link)||void 0===e?void 0:e.info_link)||"";if(i&&r){var n=i.replace("hotel=","region=");o.push({Id:l.HotelBlock.Desc,Content:"О курорте",Link:""+n+r})}return o.push({Id:l.HotelBlock.Buy,Content:"Отели"}),o.push({Id:l.HotelBlock.Map,Content:"На карте"}),o},e.prototype._onNavButtonClicked=function(t){switch(t.Id){case l.HotelBlock.Buy:this._onPriceClicked();break;case l.HotelBlock.Map:this.MapClicked.fire({Id:this._Id})}},e.prototype._onInfoNodeClick=function(){this._onPriceClicked()},e.prototype._onPriceClicked=function(){this.ResortClicked.fire({Id:this._Id})},e.prototype._getTitle=function(){var t=null!==this._SunTemperature,e=null!==this._WaterTemperature&&0!==this._WaterTemperature;if(!t&&!e)return this._Name;var o=(0,a.newDiv)("TVResortResultItemNameWrapper");((0,a.newDiv)("TVResortResultItemName",o).textContent=this._Name,t)&&((0,a.newDiv)("TVResortResultItemSun",o).textContent=this._SunTemperature>0?"+"+this._SunTemperature:"");if(e){(0,a.newDiv)("TVResortResultItemWater",o).textContent=this._WaterTemperature>0?"+"+this._WaterTemperature:""}return o.outerHTML},e.prototype._getSubtitle=function(){var t=h.resortUtils.getResortSubTitleInfo(this._Coord);return[t.BeachTypesStr,t.DistanceStr].filter(function(t){return t}).join(", ")},e.prototype._getPriceType=function(){return d.resultPriceUtils.getPriceType(this._PriceType,this._Theme,this._ModeView)},e}(p.ResultBuilderItem);e.ResortResultItem=f,t.ResortResultItem=f}).call(e,o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.MapControllerCardDecorator=void 0;var s=o(17),a=o(4),l=o(3),u=o(1),c=o(114),h=o(517),d=o(315),p=o(518),_=function(e){function o(t){var o=e.call(this,t)||this;return o.PopupHide=new l.UserEvent,o.PopupShow=new l.UserEvent,o._Id=0,o._Ref=null,o._RunSearchOnResort=null,o._mapCard=null,o._flyMonth=0,o.__initSettings(t),o._MapController.HotelsSelected.addOnce(new a.Delegate(o,o._onHotelsSelected)),o._MapController.LayerChanged.addOnce(new a.Delegate(o,o._onLayerChanged)),o._MapController.MarkerClicked.addOnce(new a.Delegate(o,o._onMarkerClicked)),o}return r(o,e),o.prototype.render=function(){e.prototype.render.call(this),this._mapCard=new h.MapCardControl({ParentNode:this._ParentNode,RequestPopupHide:new a.Delegate(this,this._onRequestPopupHide),RequestPopupShow:new a.Delegate(this,this._onRequestPopupShow),RunSearchOnResort:this._RunSearchOnResort,Hide:new a.Delegate(this,this._onHideCardPanel),TourClicked:new a.Delegate(this,this._onTourClicked)})},o.prototype.update=function(t){var o=this._Id;this.apllyNewParams(t);var i=t.Decorator,r=t.Id,s=t.LayerChange,a=t.ToursGroup,l=t.UpdateCard;if(i===d.MapDecorators.Card&&this._mapCard){if((0,u.isDefined)(r)&&(0,u.isDefined)(a)){o===r?(this._mapCard.hide(),this._resetSelectionMarker()):(this._mapCard.show(),this._mapCard.update(n(n({},t),{FlyMonth:this._flyMonth})))}return(0,u.isDefined)(l)&&this._mapCard.update(),void((0,u.isDefined)(s)&&this._mapCard&&this._mapCard.hide())}e.prototype.update.call(this,t)},o.prototype.hide=function(){e.prototype.hide.call(this),this._mapCard&&this._mapCard.hide()},o.prototype.show=function(){e.prototype.show.call(this);var t=s.resultStore.getActualSearchSettings();this._flyMonth=t.FlyDates[0].getMonth()+1},o.prototype._onHideCardPanel=function(){this._resetSelectionMarker()},o.prototype._onHotelsSelected=function(){this._mapCard.hide(),this._resetSelectionMarker()},o.prototype._onLayerChanged=function(t){var e=t.LayerType,o=t.Type;e===c.LayerTypes.ToursGroup&&this.update({Decorator:d.MapDecorators.Card,LayerChange:!0,ToursGroup:o})},o.prototype._onMarkerClicked=function(t){this.update(n(n({},t),{Decorator:d.MapDecorators.Card}))},o.prototype._onRequestPopupHide=function(){this.PopupHide.fire()},o.prototype._onRequestPopupShow=function(){this.PopupShow.fire()},o.prototype._onTourClicked=function(e){t.orderManager.Hide.addOnce(new a.Delegate(this,this._onTourCardWindowHide)),t.orderManager.AfterShow.addOnce(new a.Delegate(this,this._onTourCardWindowShow))},o.prototype._onTourCardWindowHide=function(){this.PopupHide.fire(),t.orderManager.Hide.remove(this),t.orderManager.AfterShow.remove(this)},o.prototype._onTourCardWindowShow=function(){this.PopupShow.fire()},o.prototype._resetSelectionMarker=function(){this._Id&&(this._MapController.update({SelectionDisable:!0}),this._Id=0)},o}(p.MapControllerDecoratorBase);e.MapControllerCardDecorator=_,i.MapControllerCardDecorator=_}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CardController=void 0;var s=o(56),a=o(17),l=o(2),u=o(4),c=o(3),h=o(1),d=o(5),p=o(119),_=o(68),f=o(94),y=o(107),g=o(160),C=o(32),v=o(18),m=o(70),T=o(24),w=o(25),S=o(72),P=o(8),b=o(62),I=o(367),O=o(375),M=function(e){function o(t){var o=e.call(this,t)||this;return o.RequestPopupHide=new c.UserEvent,o.RequestPopupShow=new c.UserEvent,o._Class="TVCardController",o._FlyMonth=0,o._Id=0,o._IsVisibleRequestButton=!0,o._IsVisibleSearchButton=!0,o._IsVisibleTours=!0,o._Links=null,o._ParentId=0,o._ToursGroup=d.ToursGroupBy.Hotels,o._RunSearchOnResort=null,o._TourClicked=null,o._hotelCard=null,o._resortCard=null,o.__initSettings(t),o.render(),o}return r(o,e),o.prototype.render=function(){e.prototype.render.call(this),this._hotelCard=new I.HotelCardControl({IsVisibleRequestButton:this._IsVisibleRequestButton,IsVisibleSearchButton:this._IsVisibleSearchButton,IsVisibleTours:this._IsVisibleTours,ModeView:d.ModeView.DescTop,ParentNode:this._DomNode,ShowTourModeView:d.ModeView.DescTop,RequestBtnClicked:new u.Delegate(this,this._onRequestBtnClicked),TourClicked:this._TourClicked}),this._resortCard=new O.ResortCardControl({IsVisibleSearchButton:this._IsVisibleSearchButton,ModeView:d.ModeView.DescTop,ParentNode:this._DomNode,RunSearch:this._RunSearchOnResort}),this._updateContent()},o.prototype.update=function(t){e.prototype.update.call(this,t),this._updateContent()},o.prototype.hide=function(){this._hotelCard.disable(),this._hotelCard.hide(),this._resortCard.disable(),this._resortCard.hide()},o.prototype.destroy=function(){this._RunSearchOnResort=null,this._TourClicked=null,e.prototype.destroy.call(this)},o.prototype._updateContent=function(){var t=this;if(this._Id)switch(this._ToursGroup){case d.ToursGroupBy.Hotels:this._resortCard.disable(),this._resortCard.hide(),this._hotelCard.enable(),this._hotelCard.show();var e=y.settingsService.getSettings(),o=_.hotelDataService.getHotelDataById(this._Id);(0,h.addClass)(this._DomNode,P.TV_PREVIEW),this._hotelCard.update({IsVisiblePreview:!0}),Promise.all([e,o]).then(function(e){(0,h.removeClass)(t._DomNode,P.TV_PREVIEW),t._hotelCard.update({IsVisiblePreview:!1});var o=e[0],i=e[1],r=w.settingUtils.getClientData(o),n=C.clientUtils.getShowOperator(r),s=!!v.hotelUtils.getTUrl(i),a=t._Links?{AboutLink:s?m.routeUtils.getHotelInCountryLink(i):"",SearchLink:v.hotelUtils.getSearchLink(i)}:null;t._hotelCard.update({HotelData:i,Id:t._Id,Links:a,ShowOperator:n})});break;case d.ToursGroupBy.Resorts:if(this._hotelCard.disable(),this._hotelCard.hide(),this._resortCard.enable(),this._resortCard.show(),this._ParentId){var i=s.resortsStore.getSubResort(this._Id);i?this._updateResortCard(i):g.subRegionService.read(this._Id).then(function(e){t._updateResortCard(e)})}else{var r=s.resortsStore.getResort(this._Id);r?this._updateResortCard(r):f.regionService.read(this._Id).then(function(e){t._updateResortCard(e)})}}},o.prototype._onRequestBtnClicked=function(){var t=(0,b.getRequestTourComment)(this._Id),e=(0,b.getRequestAboutTour)(this._Id);(0,p.showRequest)({Comment:t,Description:e,ModeView:d.ModeView.DescTop,AfterShow:new u.Delegate(this,this._onRequestPopupShow),Hide:new u.Delegate(this,this._onRequestPopupHide),SendClicked:new u.Delegate(this,this._onSendRequest)})},o.prototype._updateResortCard=function(t){var e=this,o=n({},t);o.weather&&o.weather.length>0&&(o.weather=o.weather.filter(function(t){return t.month===e._FlyMonth})),this._resortCard.update({Id:this._Id,Links:this._Links,ParentId:this._ParentId,ResortData:o})},o.prototype._onSendRequest=function(e){var o=n(n({},e),{Metrica:d.Metrica.NoTour,Source:d.OrderSource.FREE,TourId:0,Type:S.RequestType.SimpleRequest}),i=a.resultStore.getActualSearchSettings(),r=a.resultStore.getGlobals(),s=r.CustomData;T.searchUtils.updateSearchLink(o,i),T.searchUtils.updateCurrency(o,i),T.searchUtils.updateCustomData(o,s),t.orderManager.sendRequest(o)},o.prototype._onRequestPopupHide=function(){this.RequestPopupHide.fire()},o.prototype._onRequestPopupShow=function(){this.RequestPopupShow.fire()},o}(l.Control);e.CardController=M,i.CardController=M}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ViewPanel=void 0;var r=o(2),n=o(3),s=o(1),a=function(t){function e(e){var o=t.call(this,e)||this;return o.Hide=new n.UserEvent,o._Class="TVViewPanel TVStyleScroll",o._Content=null,o._closeBtn=null,o.__initSettings(e),o._onCloseClicked=o._onCloseClicked.bind(o),o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._closeBtn=(0,s.newDiv)("TVViewPanelCloseBtn",this._DomNode),(0,s.addEvent)(this._closeBtn,"click",this._onCloseClicked),this._DomNode.appendChild(this._Content.getDomNode())},e.prototype.update=function(e){t.prototype.update.call(this,e),this._Content.update(e)},e.prototype.destroy=function(){(0,s.removeEvent)(this._closeBtn,"click",this._onCloseClicked),t.prototype.destroy.call(this)},e.prototype._onCloseClicked=function(t){t.preventDefault(),this.Hide.fire()},e}(r.Control);e.ViewPanel=a,t.ViewPanel=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)},n=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var i,r=0,n=e.length;r<n;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.SearchMapControl=void 0;var s=o(41),a=o(17),l=o(54),u=o(195),c=o(2),h=o(4),d=o(1),p=o(5),_=o(18),f=o(37),y=o(25),g=o(62),C=o(248),v=o(71),m=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVSearchMapControl",o._ModeView=p.ModeView.DescTop,o._NoMoreTours=!1,o._ToursGroup=p.ToursGroupBy.Hotels,o._ErrorReport=null,o._LayerChanged=null,o._MarkerClicked=null,o._MapZoomChanged=null,o._ToolDrawChanged=null,o._hotelsInViewPort=[],o._hideMoreSearchBtn=!0,o._map=null,o._progress=100,o._mapSearchMoreBtn=null,o._mapProgressBar=null,o._progressBar=null,o.__initSettings(e),o._onMapMoveEnd=o._onMapMoveEnd.bind(o),o._onSearchMoreClicked=o._onSearchMoreClicked.bind(o),o._Render&&o.render(),o}return i(e,t),e.prototype.destroy=function(){(0,d.removeEvent)(this._mapSearchMoreBtn,"click",this._onSearchMoreClicked);var e=this._map&&this._map.getInstance();e&&e.off("moveend",this._onMapMoveEnd),t.prototype.destroy.call(this)},e.prototype.render=function(){t.prototype.render.call(this),this._map=new u.MapControl({ModeView:this._ModeView,ParentNode:this._DomNode,ToursGroup:this._ToursGroup,ErrorReport:this._ErrorReport,LayerChanged:this._LayerChanged,MarkerClicked:this._MarkerClicked,MapZoomChanged:this._MapZoomChanged,ToolDrawChanged:this._ToolDrawChanged}),this._mapSearchMoreBtn=(0,d.newDiv)("TVMapUpdateMoreBtn TVHide",this._DomNode),(0,d.addEvent)(this._mapSearchMoreBtn,"click",this._onSearchMoreClicked),this._ModeView===p.ModeView.DescTop&&(this._mapProgressBar=(0,d.newDiv)("TVMapProgressBar TVHide",this._DomNode),this._progressBar=new C.ProgressBar({IsVisible:!1,ParentNode:this._mapProgressBar,TextEnable:!0}))},e.prototype.show=function(){if(this._map){this._map.show();this._map.getInstance().invalidateSize(!1),this._map.getInstance().on("moveend",this._onMapMoveEnd)}(0,v.listenProgress)({ProgressChanged:new h.Delegate(this,this._onProgressChanged)});var t=(0,v.getSearchProgress)();t&&this._ModeView===p.ModeView.DescTop&&this._onProgressChanged(t)},e.prototype.hide=function(){this._map.getInstance().off("moveend",this._onMapMoveEnd),this._map.hide(),(0,v.unlistenProgress)(this)},e.prototype.update=function(e){t.prototype.update.call(this,e),this._map.update(e)},e.prototype._onMapMoveEnd=function(){a.resultStore.setGlobals({Bounds:this._map.getInstance().getBounds()}),this._updateSearchMoreBtn()},e.prototype._onSearchMoreClicked=function(){(0,d.hide)(this._mapSearchMoreBtn);var t=this._hotelsInViewPort.length>0,e=r({},a.resultStore.getActualSearchSettings());this._ToursGroup===p.ToursGroupBy.Hotels&&t?e.Hotels=this._hotelsInViewPort:e.DeepSearch=p.DeepSearchMode.Enable,(0,g.continueSearch)(e),this._map.update({IsClearPolygon:!0})},e.prototype._onProgressChanged=function(t){var e=this,o=t.Progress;if(t.SearchId===a.resultStore.getGlobals().SearchId)switch(this._progress=o,this._progressBar&&this._progressBar.setProgress(o),!0){case o>=0&&o<100:(0,d.isVisible)(this._mapSearchMoreBtn)&&(0,d.hide)(this._mapSearchMoreBtn),this._progressBar&&!this._progressBar.getIsVisible()&&((0,d.show)(this._mapProgressBar),this._progressBar.show());break;case 100===o:this._progressBar?setTimeout(function(){(0,d.hide)(e._mapProgressBar),e._progressBar.hide(),e._updateSearchMoreBtn()},1e3):this._updateSearchMoreBtn()}},e.prototype._updateSearchMoreBtn=function(){var t=!this._NoMoreTours;this._progress>=0&&this._progress<100||((0,d.setVisible)(this._mapSearchMoreBtn,t),t&&this._ToursGroup===p.ToursGroupBy.Hotels&&(this._updateHotelsInViewPort(),0===this._hotelsInViewPort.length?((0,d.removeClass)(this._mapSearchMoreBtn,e.TV_MAP_UPDATE_MORE_BTN_REGION),this._hideMoreSearchBtn&&(0,d.hide)(this._mapSearchMoreBtn)):(0,d.addClass)(this._mapSearchMoreBtn,e.TV_MAP_UPDATE_MORE_BTN_REGION)))},e.prototype._updateHotelsInViewPort=function(){this._hideMoreSearchBtn=!0,this._hotelsInViewPort=[];var t=a.resultStore.getActualSearchFilter(),o=y.settingUtils.getHotels(t);if(o.length>0)this._hotelsInViewPort=n([],o,!0);else{var i=y.settingUtils.getResorts(t);if(this._map.getInstance().getZoom()<=e.SEARCH_MORE_BUTTON_ZOOM||i.length>0)return void(this._hideMoreSearchBtn=!1);for(var r=a.resultStore.getActualCountryId(),u=s.hotelsStore.getHotelsByCountry(r),c=l.searchCatalog.getResorts(),h=_.hotelUtils.getItemsByAirport(u,c,a.resultStore.getActualSearchSettings()),d=a.resultStore.getHotelsFilterFunction(),p=Boolean(d),C=this._map.getInstance().getBounds(),v=0,m=h.length;v<m;v++){var T=h[v],w=T.coord;if(w&&((!p||d(T))&&C.contains(w))){if(this._hotelsInViewPort.push(T.id)>=f.filterLimit){this._hotelsInViewPort=[],this._hideMoreSearchBtn=!1;break}}}}if(this._hotelsInViewPort.length>0){0===(0,g.filterUnsearchableHotels)(this._hotelsInViewPort).length&&(this._hotelsInViewPort=[])}},e.SEARCH_MORE_BUTTON_ZOOM=7,e.TV_MAP_UPDATE_MORE_BTN_REGION="TVMapUpdateMoreBtnRegion",e}(c.Control);e.SearchMapControl=m,t.SearchMapControl=m}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.MapControllerFilterDecorator=void 0;var n=o(106),s=o(41),a=o(17),l=o(54),u=o(4),c=o(3),h=o(5),d=o(18),p=o(52),_=o(25),f=o(148),y=o(520),g=o(315),C=o(518),v=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new c.UserEvent,o._Theme=h.Theme.Theme2,o._FilterVisibilityChanged=null,o._countryId=0,o._mapFilter=null,o.__initSettings(e),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._mapFilter=new y.MapFilterControl({ParentNode:this._ParentNode,Theme:this._Theme,Changed:new u.Delegate(this,this._onSearchFormChanged),FilterVisibilityChanged:this._FilterVisibilityChanged})},e.prototype.update=function(e){if(this.apllyNewParams(e),e.Decorator===g.MapDecorators.Filter&&this._mapFilter)return void this._mapFilter.update(e);t.prototype.update.call(this,e)},e.prototype.show=function(){t.prototype.show.call(this);var e=a.resultStore.getActualSearchSettings();this._updateFilterProps(e)},e.prototype._onSearchFormChanged=function(t){this.Changed.fire(t),this._updateFilterProps(t)},e.prototype._updateFilterProps=function(t){var e=a.resultStore.getActualSearchSettings(),o=l.searchCatalog.getResorts(),i=p.resortUtils.getSelectedResorts(_.settingUtils.getResorts(e),o),u={};if(Object.keys(t).forEach(function(t){switch(t){case f.PropertyName.Price:u.PriceProps={Currency:e.Currency,Price:e.Price};break;case f.PropertyName.Feed:u.Feed=e.Feed;case f.PropertyName.Resorts:u.Resorts=i;case f.PropertyName.HotelClass:case f.PropertyName.HotelRating:case f.PropertyName.HotelServices:case f.PropertyName.Accomodation:case f.PropertyName.HotelsCollections:t===f.PropertyName.HotelClass&&(u.HotelClass=e.HotelClass),t===f.PropertyName.HotelRating&&(u.HotelRating=e.HotelRating),t===f.PropertyName.Accomodation&&(u.Accomodation=e.Accomodation),u.HotelProps={FilterAcType:e.Accomodation,FilterRating:e.HotelRating,FilterRegion:i,FilterStars:e.HotelClass},u.Hotels=e.Hotels||[],u.HotelsCollections=e.HotelsCollections||[],u.HotelServices=e.HotelServices}}),this._isNewCountry()){var c=a.resultStore.getActualSearchSettings(),h=_.settingUtils.getAirportId(c),y=p.resortUtils.getResortsByCountryAirport(this._countryId,h,o),g=s.hotelsStore.getHotelsByCountry(this._countryId),C=d.hotelUtils.getItemsByAirport(g,o,a.resultStore.getActualSearchSettings()),v=n.hotelsCollectionsStore.getCollections(this._countryId),m=l.searchCatalog.getHotelServices(this._countryId),T=l.searchCatalog.getAccommodations(this._countryId);u.HotelItems=C,u.HotelsCollectionProps=r(r({},u.HotelsCollectionProps),{CountryId:this._countryId}),u.HotelsCollectionItems=v||[],u.HotelServiceItems=m||[],u.ResortItems=y||[],u.AccommodationItems=T||[]}this._mapFilter.update(u)},e.prototype._isNewCountry=function(){var t=a.resultStore.getActualCountryId(),e=this._countryId!==t;return e&&(this._countryId=t),e},e}(C.MapControllerDecoratorBase);e.MapControllerFilterDecorator=v,t.MapControllerFilterDecorator=v}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__assign||function(){return i=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},i.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.CartService=void 0;var r=o(432),n=o(46),s=o(48),a=o(104),l=o(4),u=o(1),c=o(30),h=o(5),d=o(22),p=function(){function t(){}return t.prototype.addTour=function(t,e){this._sendRequest(i(i({},t),{action:r.CartAction.Add}),e)},t.prototype.delete=function(t,e){this._sendRequest({action:r.CartAction.Delete,cartid:t},e)},t.prototype.exportToLM=function(t){this._sendRequest({action:r.CartAction.ExportToLM},t)},t.prototype.getCartListFull=function(t){this._sendRequest({action:r.CartAction.CartListFull},t)},t.prototype.getEmail=function(t){this._sendRequest({action:r.CartAction.GetEmail},t)},t.prototype.getPrint=function(t){this._sendRequest({action:r.CartAction.GetPrint},t)},t.prototype.getSms=function(t){this._sendRequest({action:r.CartAction.GetSms},t)},t.prototype.getStatus=function(t){this._sendRequest({action:r.CartAction.Status},t)},t.prototype.getList=function(t){this._sendRequest({action:r.CartAction.List},t)},t.prototype.linkManager=function(t){this._sendRequest({action:r.CartAction.LinkManager},t)},t.prototype.refreshCart=function(t){this._sendRequest({action:r.CartAction.Refresh},t)},t.prototype.remove=function(t,e){this._sendRequest({action:r.CartAction.Remove,tourid:t},e)},t.prototype.save=function(t,e){this._sendRequest({action:r.CartAction.Save,comment:encodeURIComponent(t.Comment),name:encodeURIComponent(t.Name),showtoclient:t.ShowToClient?1:0},e)},t.prototype.sendAgency=function(t){this._sendRequest({action:r.CartAction.SendAgency,comment:encodeURIComponent(t.UserComment),email:encodeURIComponent(t.UserEmail),name:encodeURIComponent(t.UserName),office:encodeURIComponent(t.UserOffice),phone:encodeURIComponent(t.UserPhone)},t.CallBack)},t.prototype.sendLog=function(t){t!==h.ShareType.Copy&&this._sendRequest({action:r.CartAction.SendLog,media:t})},t.prototype.sendMail=function(t,e){var o={action:r.CartAction.Email,email:t.Mail,mailbegin:t.Text,mailend:t.Signature,mailsubject:t.Subject,selfcopy:t.CopyCheck};this._addParams(o),n.cors.update({Url:c.CoreLinks.Cart}),n.cors.send((0,u.newFormData)(o,!1),new l.Delegate(this,function(t){var o=JSON.parse(t.Response);e.fire(o)}))},t.prototype.sendSms=function(t,e){this._sendRequest({action:r.CartAction.Sms,phone:t.Phone,shortlink:t.ShortLink?1:0,smstext:encodeURIComponent(t.Message)},e)},t.prototype.setDiscount=function(t,e){this._sendRequest({action:r.CartAction.List,discount:t},e)},t.prototype.updateClientData=function(t,e){this._sendRequest({action:r.CartAction.ClientData,comment:encodeURIComponent(t.Comment),email:encodeURIComponent(t.Email),fullName:encodeURIComponent(t.Name),telephone:encodeURIComponent(t.Phone)},e)},t.prototype.updateTour=function(t,e){var o={action:r.CartAction.UpdateTour,tourid:t.TourId};(0,u.isDefined)(t.Comment)&&(o.comment=encodeURIComponent(t.Comment)),(0,u.isDefined)(t.Price)&&(o.price=encodeURIComponent(t.Price)),(0,u.isDefined)(t.Recommend)&&(o.recommend=Number(t.Recommend)),this._sendRequest(o,e)},t.prototype._sendRequest=function(t,e){this._addParams(t);var o=this._getUri(t);s.jsonp.update({Url:c.CoreLinks.Cart}),s.jsonp.send(o,e)},t.prototype._getUri=function(t){var e="";return Object.keys(t).forEach(function(o){e+="&"+o+"="+t[o]}),e},t.prototype._addParams=function(t){d.authManager.isManager()&&(t.manager=d.authManager.getId()),(0,u.isDefined)(t.cartid)||(t.cartid=a.cartCatalog.getActiveCartId()||0)},t}();e.CartService=p,t.CartService=p}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.LeadManagerService=void 0;var i=o(116),r=o(47),n=function(){function t(){this.api_url="//pro.tourvisor.ru/api/v1"}return t.prototype.getLead=function(t){return i.corsNative.update({Url:this.api_url+"/leads/"+t}),i.corsNative.get("",!0).catch(function(t){return r.logService.error(t)})},t.prototype.updateCustomer=function(t,e){return i.corsNative.update({Url:this.api_url+"/leads/"+t}),i.corsNative.put(e,!0)},t.prototype.getCustomers=function(t){return i.corsNative.update({Url:this.api_url+"/customers"}),i.corsNative.get(t,!0).then(function(t){return t?t.items:[]})},t}();e.LeadManagerService=n,t.LeadManagerService=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorManager=void 0;var n=o(31),s=o(78),a=o(34),l=o(1027),u=o(9),c=o(4),h=o(5),d=o(22),p=o(1028),_=o(1030),f=o(121);o(1031);var y=n.ActionStatisticsSource.NONE,g=h.ModeView.DescTop,C=!1,v=0,m=function(t){function e(e){var o=t.call(this,e)||this;return o._ActionSource=y,o._ErrorData={},o._ErrorEnabled=C,o._ModeView=g,o._OffsetTop=v,o._instance=null,o.__initSettings(e),o}return i(e,t),e.prototype.show=function(t){this.__initSettings(t),this._initInstance(),this._showInstance(),this._updateInstance()},e.prototype.hide=function(){this._hideInstance()},e.prototype.hideWindow=function(){this._instance instanceof p.ErrorDesktopController&&this.hide()},e.prototype._initInstance=function(){var t={Hide:new c.Delegate(this,this._onInstanceHided),SendMessage:new c.Delegate(this,this._onSendMessage)};this._ModeView===h.ModeView.Mobile?this._initMobileController(t):this._initDesktopController(t)},e.prototype._initMobileController=function(t){if(this._instance instanceof _.ErrorMobileController)return this._instance;this._instance=new _.ErrorMobileController(t)},e.prototype._initDesktopController=function(t){if(this._instance instanceof p.ErrorDesktopController)return this._instance;this._instance=new p.ErrorDesktopController(t)},e.prototype._showInstance=function(){this._instance.show()},e.prototype._hideInstance=function(){this._instance.hide()},e.prototype._updateInstance=function(){var t=this._isEnabled(),e={IsManager:t,OffsetTop:this._OffsetTop};this._instance.update(e)},e.prototype._onInstanceHided=function(){this._ActionSource=y,this._ErrorData={},this._ErrorEnabled=C,this._ModeView=g,this._OffsetTop=0,this._instance.update({Email:"",Message:"",ShowResult:!1})},e.prototype._onSendMessage=function(t){if(this._isEnabled()){var e=t.Email,o=t.Message,i=r(r({},this._ErrorData),{Mail:e,ManagerId:d.authManager.getId(),Message:o});this._instance.update({ShowResult:!0,ShowWaiter:!0}),l.errorService.sendErrorMessage(i,new c.Delegate(this,this._onAfterSend)),this._ActionSource!==n.ActionStatisticsSource.NONE&&(0,s.reachGoal)(this._ActionSource,n.ActionStatisticsType.ERROR_MESSAGE)}},e.prototype._onAfterSend=function(){this._instance.update({ShowWaiter:!1})},e.prototype._isEnabled=function(){var t=d.authManager.isManager(),e=a.clientCatalog.getClientData();return(0,f.isEnabledErrorManager)(t,e)},e}(u.Core);e.ErrorManager=m,t.ErrorManager=m}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.errorService=e.ErrorService=void 0;var i,r=o(48);!function(t){t.TYPE="type",t.COMMENTS="comments",t.CONTACTS="contacts",t.NAME="name",t.TOUR="tourid",t.OFFER="offerid",t.MANAGER="managerid",t.URL="url"}(i||(i={}));var n=function(){function t(){}return t.prototype.sendErrorMessage=function(e,o){var n={};n[i.TYPE]=t.TYPE,n[i.COMMENTS]=this._addUserAgent(e.Message),n[i.CONTACTS]=encodeURIComponent(e.Mail),n[i.MANAGER]=e.ManagerId,e.TourId&&(n[i.TOUR]=e.TourId),e.OfferId&&(n[i.OFFER]=e.OfferId),e.Url&&(n[i.URL]=encodeURIComponent(e.Url)),r.jsonp.update({Url:t.SERVICE_URL}),r.jsonp.send(this.getQueryString(n),o)},t.prototype.getQueryString=function(t){return Object.keys(t).map(function(e){return t[e]?e+"="+t[e]:e}).join("&")},t.prototype._addUserAgent=function(t){return encodeURIComponent(t+"\n\n")+"browser:"+encodeURIComponent(navigator.userAgent)},t.SERVICE_URL="//tourvisor.ru/xml/sendrequest.php?",t.TYPE="error",t}();e.ErrorService=n,e.errorService=new n,t.errorService=e.errorService,t.ErrorService=n}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorDesktopController=void 0;var r=o(9),n=o(1029),s=function(t){function e(e){var o=t.call(this,e)||this;return o._Hide=null,o._SendMessage=null,o._window=null,o.__initSettings(e),o}return i(e,t),e.prototype.show=function(){this._initWindow(),this._window.show()},e.prototype.hide=function(){this._window.hide()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._window&&this._window.update(e)},e.prototype.destroy=function(){this._Hide=null,this._SendMessage=null,t.prototype.destroy.call(this)},e.prototype._initWindow=function(){this._window||(this._window=new n.ErrorWindow({Hide:this._Hide,SendMessage:this._SendMessage}))},e}(r.Core);e.ErrorDesktopController=s,t.ErrorDesktopController=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorWindow=void 0;var r=o(522),n=o(43),s=o(1),a=o(5),l=function(t){function e(e){var o=t.call(this,e)||this;return o._IsManager=!1,o._OffsetTop=0,o._WindowClass="TVErrorWindow",o._SendMessage=null,o._content=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.show=function(){t.prototype.show.call(this),this._updateErrorPosition()},e.prototype.render=function(){t.prototype.render.call(this),this._renderContent()},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._content){var o=e.OffsetTop;(0,s.isDefined)(o)&&this._updateErrorPosition(),this._content.update(e)}},e.prototype.destroy=function(){this._SendMessage=null,t.prototype.destroy.call(this)},e.prototype._renderContent=function(){this._content=new r.ErrorMessage({IsManager:this._IsManager,ModeView:a.ModeView.DescTop,ParentNode:this._DomNode,SendMessage:this._SendMessage})},e.prototype._updateErrorPosition=function(){var t=(0,s.getScrolls)().Y,e=(0,s.getViewPort)().y;this._mainContainer.style.top=this._OffsetTop>0?this._OffsetTop+"px":t+(e-this._mainContainer.offsetHeight)/2+"px"},e}(n.PopUpBase);e.ErrorWindow=l,t.ErrorWindow=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorMobileController=void 0;var r,n=o(55),s=o(21),a=o(14),l=o(9),u=o(4);!function(t){t.Error="ErrorPage"}(r||(r={}));var c=function(t){function e(e){var o=t.call(this,e)||this;return o._Hide=null,o._SendMessage=null,o._errorPage=null,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.show=function(){a.router.goTo(""+s.RouterPath.Error)},e.prototype.hide=function(){a.router.back()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._errorPage&&this._errorPage.update(e)},e.prototype.destroy=function(){this._Hide=null,this._SendMessage=null,n.layoutPageFactory.PageCreated.remove(this),t.prototype.destroy.call(this)},e.prototype._init=function(){n.layoutPageFactory.PageCreated.addOnce(new u.Delegate(this,this._onPageCreated))},e.prototype._onPageCreated=function(t){var e=n.layoutPageFactory.getPage();switch(t.PageClassName){case r.Error:this._errorPage=e,this._errorPage.update({Hide:this._Hide,SendMessage:this._SendMessage})}},e}(l.Core);e.ErrorMobileController=c,t.ErrorMobileController=c}).call(e,o(0))},function(t,e,o){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});var r=o(21),n=o(14),s=o(1032);n.router.addRoutes((i={},i[r.RouterPath.Error]=s.ErrorPage,i))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorPage=void 0;var r=o(522),n=o(36),s=o(5),a=function(t){function e(e){var o=t.call(this,e)||this;return o._LayoutClass="TVErrorPage",o._IsManager=!1,o._SendMessage=null,o.__initSettings(e),o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var o=this._getContent();o&&o.update(e)},e.prototype.destroy=function(){this._SendMessage=null,t.prototype.destroy.call(this)},e.prototype._getContent=function(){return this._errorMessage||(this._errorMessage=new r.ErrorMessage({IsManager:this._IsManager,ModeView:s.ModeView.Mobile,SendMessage:this._SendMessage})),this._errorMessage},e.displayName="ErrorPage",e}(n.Page);e.ErrorPage=a,t.ErrorPage=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.GalleryManager=void 0;var r=o(31),n=o(78),s=o(9),a=o(4),l=o(5),u=o(1034),c=o(1036);o(1037);var h=r.ActionStatisticsSource.COMMON,d=l.ModeView.DescTop,p=function(t){function e(e){var o=t.call(this,e)||this;return o._ActionSource=h,o._ActiveIndex=0,o._Items=[],o._ModeView=d,o._Title="",o._Changed=null,o._instance=null,o.__initSettings(e),o}return i(e,t),e.prototype.show=function(t){this.__initSettings(t),this._initInstance(),this._showInstance(),this._updateInstance()},e.prototype.hide=function(){this._hideInstance()},e.prototype.hideWindow=function(){this._instance instanceof u.GalleryDesktopController&&this.hide()},e.prototype._initInstance=function(){var t={Change:new a.Delegate(this,this._onPictureChanged),Hide:new a.Delegate(this,this._onInstanceHided)};this._ModeView===l.ModeView.Mobile?this._initMobileController(t):this._initDesktopController(t)},e.prototype._initMobileController=function(t){if(this._instance instanceof c.GalleryMobileController)return this._instance;this._instance=new c.GalleryMobileController(t)},e.prototype._initDesktopController=function(t){if(this._instance instanceof u.GalleryDesktopController)return this._instance;this._instance=new u.GalleryDesktopController(t)},e.prototype._showInstance=function(){this._instance.show(),(0,n.reachGoal)(this._ActionSource,r.ActionStatisticsType.HOTEL_GALLERY)},e.prototype._updateInstance=function(){this._instance.update({ActiveIndex:this._ActiveIndex,Items:this._Items,Title:this._Title})},e.prototype._hideInstance=function(){this._instance.hide()},e.prototype._errorLoaded=function(){throw this._instance.update({ErrorEnabled:!0}),new Error("Gallery manager: can't show gallery")},e.prototype._onInstanceHided=function(){this._ActionSource=h,this._ActiveIndex=0,this._Items=[],this._ModeView=d,this._Title="",this._Changed=null},e.prototype._onPictureChanged=function(t){this._Changed&&this._Changed.fire(t)},e}(s.Core);e.GalleryManager=p,t.GalleryManager=p}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.GalleryDesktopController=void 0;var r=o(9),n=o(1035),s=function(t){function e(e){var o=t.call(this,e)||this;return o._Hide=null,o._Change=null,o._window=null,o.__initSettings(e),o}return i(e,t),e.prototype.show=function(){this._initWindow(),this._window.show()},e.prototype.hide=function(){this._window.hide()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._window&&this._window.update(e)},e.prototype.destroy=function(){this._Change=null,this._Hide=null,t.prototype.destroy.call(this)},e.prototype._initWindow=function(){this._window||(this._window=new n.GalleryWindow({Change:this._Change,Hide:this._Hide}))},e}(r.Core);e.GalleryDesktopController=s,t.GalleryDesktopController=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.GalleryWindow=void 0;var r=o(43),n=o(136),s=o(1),a=function(t){function e(e){var o=t.call(this,e)||this;return o._ActiveIndex=0,o._Class="TVGalleryWindowContent",o._Items=[],o._Title="",o._WindowClass="TVGalleryWindow",o._Change=null,o._content=null,o._popUpOffsetTop=0,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderContent()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._content&&this._content.update(e)},e.prototype.show=function(){t.prototype.show.call(this),this._updatePosition(),(0,s.addClass)(document.body,"TVFixedPopUp")},e.prototype.hide=function(){(0,s.removeClass)(document.body,"TVFixedPopUp"),t.prototype.hide.call(this)},e.prototype.destroy=function(){this._Change=null,t.prototype.destroy.call(this)},e.prototype._renderContent=function(){(0,s.addClass)(this._overlay,"TVDarkBackground"),this._content=new n.PhotoGalleryControl({ActiveIndex:this._ActiveIndex,IsEnabledKeyboardSwitch:!0,Items:this._Items,ParentNode:this._DomNode,Title:this._Title,Change:this._Change})},e.prototype._updatePosition=function(){this._mainContainer.style.top=this._popUpOffsetTop+"px"},e}(r.PopUpBase);e.GalleryWindow=a,t.GalleryWindow=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.GalleryMobileController=void 0;var r=o(55),n=o(21),s=o(14),a=o(9),l=o(4),u=o(523),c=function(t){function e(e){var o=t.call(this,e)||this;return o._Hide=null,o._Change=null,o._page=null,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.show=function(){s.router.goTo(n.RouterPath.PhotoGallery)},e.prototype.hide=function(){s.router.back()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._page&&this._page.update(e)},e.prototype.destroy=function(){this._Change=null,this._Hide=null,r.layoutPageFactory.PageCreated.remove(this),t.prototype.destroy.call(this)},e.prototype._init=function(){r.layoutPageFactory.PageCreated.addOnce(new l.Delegate(this,this._onPageCreated))},e.prototype._onPageCreated=function(t){if(t.PageClassName===u.GalleryPage.displayName){var e=r.layoutPageFactory.getPage();this._page=e,this._page.update({Change:this._Change,Hide:this._Hide})}},e}(a.Core);e.GalleryMobileController=c,t.GalleryMobileController=c}).call(e,o(0))},function(t,e,o){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});var r=o(21),n=o(14),s=o(523);n.router.addRoutes((i={},i[r.RouterPath.PhotoGallery]=s.GalleryPage,i))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RequestForm=void 0;var r,n=o(85),s=o(490),a=o(193),l=o(8),u=o(44),c=o(12),h=o(25),d=o(133),p=o(2),_=o(4),f=o(3),y=o(7),g=o(1),C=o(5);!function(t){t[t.FORM=0]="FORM",t[t.MESSAGE=1]="MESSAGE"}(r||(r={}));var v=function(t){function e(e){var o=t.call(this,e)||this;return o.SendingClicked=new f.UserEvent,o._Description="",o._Discount=0,o._FormRequiredFields=C.FormRequiredFieldsType.PhoneOrEmail,o._IsEnabledPromocode=!1,o._ModeView=C.ModeView.DescTop,o._PromoCode="",o._PromocodeTourId=0,o._PromocodeTourPrice=0,o._ResultMessage="",o._UserComment="",o._UserEmail="",o._UserName="",o._UserPhone="",o._UserInputFields=[a.UserInputType.NAME,a.UserInputType.PHONE,a.UserInputType.EMAIL],o._UserInputLabels={EMAIL:y.EMAIL_LABEL,NAME:y.NAME_LABEL,PHONE:y.MOBILE_PHONE_LABEL},o._agreement=null,o._sendRequestButton=null,o._switcher=null,o._form=null,o.__initSettings(e),o.templateName=o._ModeView===C.ModeView.Mobile?"mobile-request-form":"request-form",o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderForm(),this._renderAgreement(),this._renderRequestButton(),this._renderSwitcher(),this._updateDescription(),this._updateData()},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._rendered){var o=e.Description;(0,g.isDefined)(o)&&this._updateDescription(),this._switcher.showById(r.FORM),this._updateData()}},e.prototype._renderForm=function(){var t=this._nodes.formNode;this._form=new s.CustomerContactsForm({FormRequiredFields:this._FormRequiredFields,IsVisibleContract:!1,ParentNode:t,UserInputFields:this._UserInputFields,UserInputLabels:this._UserInputLabels,Changed:new _.Delegate(this,this._onUserDataChanged),PromocodeChanged:new _.Delegate(this,this._onPromocodeChanged)})},e.prototype._renderAgreement=function(){var t=this._nodes.linkNode;this._agreement=new d.AgreementControl({IsMobile:this._ModeView===C.ModeView.Mobile,ParentNode:t})},e.prototype._renderRequestButton=function(){var t=this._nodes.sendButton;this._sendRequestButton=new n.ButtonWaiter({Class:(0,g.classNames)("TVRequestFormSendButton",l.TV_BUTTON_HOVER),ParentNode:t,Click:new _.Delegate(this,this._onSendRequest)})},e.prototype._renderSwitcher=function(){this._switcher=new u.LayerSwitch({ParentNode:this._DomNode,ViewLayerId:r.FORM});var t=this._nodes,e=t.messageNode,o=t.panelNode;this._switcher.add(o,r.FORM),this._switcher.add(e,r.MESSAGE),this._switcher.showById(r.FORM)},e.prototype._onUserDataChanged=function(t){var e=t.Value,o=e.EMAIL,i=e.NAME,r=e.PHONE,n=e.Comment;this._UserName=i,this._UserPhone=r,this._UserEmail=o,this._UserComment=n},e.prototype._updateDescription=function(){var t=this._nodes.descriptionNode;if(this._ModeView===C.ModeView.Mobile)return void(t.textContent=y.REQUEST_DESCRIPTION_MOBILE);t.innerHTML=this._Description?(0,c.sanitizeHTML)(this._Description):y.REQUEST_DESCRIPTION_DESCTOP},e.prototype._updateData=function(){this._form.update({IsEnabledPromocode:this._IsEnabledPromocode,TourId:this._PromocodeTourId,TourPrice:this._PromocodeTourPrice,Value:{Comment:this._UserComment,EMAIL:this._UserEmail,NAME:this._UserName,PHONE:this._UserPhone}})},e.prototype._clearData=function(){this._UserName="",this._UserEmail="",this._UserPhone="",this._UserComment="",this._PromoCode="",this._Discount=0,this._form.update({Value:{Comment:this._UserComment,EMAIL:this._UserEmail,NAME:this._UserName,PHONE:this._UserPhone}})},e.prototype._onPromocodeChanged=function(t){this._Discount=t.Discount,this._PromoCode=t.PromoCode},e.prototype._onResponse=function(t){var e=this._nodes.messageNode;this._switcher.showById(r.MESSAGE),this._sendRequestButton.update({WaiterVisible:!1}),this._clearData();var o=h.settingUtils.getIsSuccessResponse(t);(0,g.updateClass)(e,"TVResponseSuccess",o),(0,g.updateClass)(e,"TVResponseError",!o)},e.prototype._onSendRequest=function(){if(this._form.validate()){this._sendRequestButton.update({WaiterVisible:!0});var t={PromoCode:this._PromoCode,PromoDiscount:this._Discount,UserComment:this._UserComment,UserEmail:this._UserEmail.replace(/ /g,""),UserName:this._UserName,UserPhone:this._UserPhone,CallBack:new _.Delegate(this,this._onResponse)};this.SendingClicked.fire(t)}},e}(p.Control);e.RequestForm=v,t.RequestForm=v}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RequestManager=void 0;var r=o(31),n=o(9),s=o(4),a=o(5),l=o(1040),u=o(1042);o(1043);var c=r.ActionStatisticsSource.COMMON,h=a.ModeView.DescTop,d=function(t){function e(e){var o=t.call(this,e)||this;return o._ActionSource=c,o._Description="",o._Comment="",o._IsEnabledMultiOffice=!0,o._IsEnabledPromocode=!1,o._ModeView=h,o._PromocodeTourPrice=0,o._PromocodeTourId=0,o._AfterShow=null,o._Hide=null,o._SendClicked=null,o._instance=null,o.__initSettings(e),o}return i(e,t),e.prototype.show=function(t){this._reset(),this.__initSettings(t),this._initInstance(),this._showInstance(),this._updateInstance()},e.prototype.hide=function(){this._hideInstance()},e.prototype.hideWindow=function(){this._instance instanceof l.RequestDesktopController&&this.hide()},e.prototype.destroy=function(){this._AfterShow=null,this._Hide=null,this._SendClicked=null,t.prototype.destroy.call(this)},e.prototype._initInstance=function(){var t={IsEnabledMultiOffice:this._IsEnabledMultiOffice,AfterShow:new s.Delegate(this,this._onInstanceShowed),Hide:new s.Delegate(this,this._onInstanceHided),SendClicked:new s.Delegate(this,this._onSendClicked)};this._ModeView===a.ModeView.Mobile?this._initMobileController(t):this._initDesktopController(t)},e.prototype._initMobileController=function(t){if(this._instance instanceof u.RequestMobileController)return this._instance;this._instance=new u.RequestMobileController(t)},e.prototype._initDesktopController=function(t){if(this._instance instanceof l.RequestDesktopController)return this._instance;this._instance=new l.RequestDesktopController(t)},e.prototype._reset=function(){this._ActionSource=c,this._Comment="",this._Description="",this._IsEnabledMultiOffice=!0,this._IsEnabledPromocode=!1,this._ModeView=h,this._PromocodeTourPrice=0,this._PromocodeTourId=0,this._AfterShow=null,this._Hide=null,this._SendClicked=null},e.prototype._showInstance=function(){this._instance.show()},e.prototype._updateInstance=function(){this._instance.update({Description:this._Description,IsEnabledMultiOffice:this._IsEnabledMultiOffice,IsEnabledPromocode:this._IsEnabledPromocode,PromocodeTourId:this._PromocodeTourId,PromocodeTourPrice:this._PromocodeTourPrice,UserComment:this._Comment})},e.prototype._hideInstance=function(){this._instance.hide()},e.prototype._onInstanceShowed=function(){this._AfterShow&&this._AfterShow.fire()},e.prototype._onInstanceHided=function(){this._Hide&&this._Hide.fire()},e.prototype._onSendClicked=function(t){this._SendClicked&&this._SendClicked.fire(t)},e}(n.Core);e.RequestManager=d,t.RequestManager=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RequestDesktopController=void 0;var r=o(9),n=o(1041),s=function(t){function e(e){var o=t.call(this,e)||this;return o._AfterShow=null,o._Hide=null,o._SendClicked=null,o._window=null,o.__initSettings(e),o}return i(e,t),e.prototype.show=function(){this._initWindow(),this._window.show()},e.prototype.hide=function(){this._window.hide()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._window&&this._window.update(e)},e.prototype.destroy=function(){this._AfterShow=null,this._Hide=null,this._SendClicked=null,t.prototype.destroy.call(this)},e.prototype._initWindow=function(){this._window||(this._window=new n.RequestWindow({AfterShow:this._AfterShow,Hide:this._Hide,SendClicked:this._SendClicked}))},e}(r.Core);e.RequestDesktopController=s,t.RequestDesktopController=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RequestWindow=void 0;var r=o(43),n=o(12),s=o(1),a=o(317),l=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVRequestWindowContent",o._Description="",o._IsFixScroll=!0,o._WindowClass="TVRequestWindow",o._SendClicked=null,o._content=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderContent()},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._content){var o=e.Description;(0,s.isDefined)(o)&&(e.Description=this._getDescription()),this._content.update(e)}},e.prototype.show=function(){t.prototype.show.call(this),this._content.show()},e.prototype.hide=function(){t.prototype.hide.call(this)},e.prototype.destroy=function(){this._SendClicked=null,t.prototype.destroy.call(this)},e.prototype._renderContent=function(){var t=this._getDescription();this._content=new a.RequestControl({Description:t,ParentNode:this._DomNode,Send:this._SendClicked})},e.prototype._getDescription=function(){var t=(0,s.newDiv)("TVRequestWindowBeforeDescription");t.innerHTML=(0,n.sanitizeHTML)(this._Description);var e=(0,s.newDiv)("TVRequestWindowAfterDescription");return e.textContent="Наши специалисты подберут подходящие туры по Вашему запросу или предложат альтернативные варианты",""+t.outerHTML+e.outerHTML},e}(r.PopUpBase);e.RequestWindow=l,t.RequestWindow=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RequestMobileController=void 0;var r=o(55),n=o(21),s=o(14),a=o(50),l=o(9),u=o(4),c=o(3),h=o(524),d=function(t){function e(e){var o=t.call(this,e)||this;return o.Hide=new c.UserEvent,o._SendClicked=null,o._page=null,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.show=function(){s.router.goTo(n.RouterPath.Request),s.router.Changed.addOnce(new u.Delegate(this,this._onRouteChanged))},e.prototype.hide=function(){s.router.back()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._page&&this._page.update(e)},e.prototype.destroy=function(){this._SendClicked=null,r.layoutPageFactory.PageCreated.remove(this),t.prototype.destroy.call(this)},e.prototype._init=function(){r.layoutPageFactory.PageCreated.addOnce(new u.Delegate(this,this._onPageCreated))},e.prototype._onRouteChanged=function(t){var e=t.From,o=t.Navigation;e.includes(""+n.RouterPath.Request)&&o===a.NavigationDirection.Back&&(s.router.Changed.remove(this),this.Hide.fire())},e.prototype._onPageCreated=function(t){if(t.PageClassName===h.RequestPage.displayName){var e=r.layoutPageFactory.getPage();this._page=e,this._page.update({SendClicked:this._SendClicked})}},e}(l.Core);e.RequestMobileController=d,t.RequestMobileController=d}).call(e,o(0))},function(t,e,o){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});var r=o(21),n=o(14),s=o(524);n.router.addRoutes((i={},i[r.RouterPath.Request]=s.RequestPage,i))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RoomManager=void 0;var r=o(31),n=o(78),s=o(1045),a=o(1046),l=o(151),u=o(250),c=o(9),h=o(4),d=o(5),p=o(6),_=o(1047),f=o(1050),y=o(211);o(1051);var g=r.ActionStatisticsSource.NONE,C=d.ModeView.DescTop,v=function(t){function e(e){var o=t.call(this,e)||this;return o._ActionSource=g,o._ModeView=C,o._RoomId=0,o._instance=null,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.show=function(t){this.__initSettings(t),this._initInstance(),this._showInstance();var e=t.RoomData,o=t.RoomServiceType,i=void 0===o?y.RoomServiceTypeEnum.COMMON:o;if((0,p.isNotEmptyObject)(e))return void this._updateData(e);this._requestData(i)},e.prototype.hide=function(){this._hideInstance()},e.prototype.hideWindow=function(){this._instance instanceof _.RoomDesktopController&&this.hide()},e.prototype._init=function(){this._onRoomDataLoaded=this._onRoomDataLoaded.bind(this),this._onCraftRoomDataLoaded=this._onCraftRoomDataLoaded.bind(this)},e.prototype._initInstance=function(){var t={Hide:new h.Delegate(this,this._onInstanceHided)};this._ModeView===d.ModeView.Mobile?this._initMobileController(t):this._initDesktopController(t)},e.prototype._initMobileController=function(t){if(this._instance instanceof f.RoomMobileController)return this._instance;this._instance=new f.RoomMobileController(t)},e.prototype._initDesktopController=function(t){if(this._instance instanceof _.RoomDesktopController)return this._instance;this._instance=new _.RoomDesktopController(t)},e.prototype._showInstance=function(){this._instance.show(),this._instance.update({IsVisiblePreview:!0})},e.prototype._hideInstance=function(){this._instance.hide()},e.prototype._updateData=function(t){void 0===t&&(t={}),this._instance.update({ErrorEnabled:!1,IsVisiblePreview:!1,RoomInfo:t}),(0,n.reachGoal)(this._ActionSource,r.ActionStatisticsType.ROOM_DESCRIPTION)},e.prototype._requestData=function(t){switch(t){case y.RoomServiceTypeEnum.CRAFT:return s.craftTourRoomService.read(this._RoomId).then(this._onCraftRoomDataLoaded).catch(l.errorCatched);case y.RoomServiceTypeEnum.COMMON:default:return a.roomService.getRoomById(this._RoomId).then(this._onRoomDataLoaded).catch(l.errorCatched)}},e.prototype._onCraftRoomDataLoaded=function(t){(!t||(null===t||void 0===t?void 0:t.error))&&this._errorLoaded();var e=t.id;if(0!==this._RoomId&&0!==e&&e===this._RoomId){var o=u.roomUtils.getCraftRoomInfo(t);this._updateData(o)}},e.prototype._onRoomDataLoaded=function(t){t&&!t.error||this._errorLoaded();var e=u.roomUtils.getRoomId(t);if(0!==this._RoomId&&0!==e&&e===this._RoomId){var o=u.roomUtils.getRoomInfo(t);this._updateData(o)}},e.prototype._errorLoaded=function(){throw this._instance.update({ErrorEnabled:!0}),new Error("Room manager: can't read room")},e.prototype._onInstanceHided=function(){this._RoomId=0,this._ModeView=C,this._ActionSource=g},e}(c.Core);e.RoomManager=v,t.RoomManager=v}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.craftTourRoomService=void 0;var r=o(27),n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e}(r.ApiService);e.craftTourRoomService=new n("/api/v1.1/booking/rooms"),t.craftTourRoomService=e.craftTourRoomService}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__awaiter||function(t,e,o,i){function r(t){return t instanceof o?t:new o(function(e){e(t)})}return new(o||(o=Promise))(function(o,n){function s(t){try{l(i.next(t))}catch(t){n(t)}}function a(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){t.done?o(t.value):r(t.value).then(s,a)}l((i=i.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){function o(t){return function(e){return i([t,e])}}function i(o){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,n=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){l.label=o[1];break}if(6===o[0]&&l.label<s[1]){l.label=s[1],s=o;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(o);break}s[2]&&l.ops.pop(),l.trys.pop();continue}o=e.call(t,l)}catch(t){o=[6,t],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var r,n,s,a,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(e,"__esModule",{value:!0}),e.roomService=e.RoomService=void 0;var s=o(54),a=o(27),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.getRoomById=function(t){return r(this,void 0,void 0,function(){var e;return n(this,function(o){return e=s.searchCatalog.getRoom(t),e?[2,e]:[2,this.read(t).then(function(e){return e&&s.searchCatalog.setRoom(t,e),e})]})})},e}(a.ApiService);e.RoomService=l,e.roomService=new l("/api/v1.1/room-infos"),t.roomService=e.roomService,t.RoomService=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RoomDesktopController=void 0;var r=o(9),n=o(1048),s=function(t){function e(e){var o=t.call(this,e)||this;return o._Hide=null,o._window=null,o.__initSettings(e),o}return i(e,t),e.prototype.show=function(){this._initWindow(),this._window.show()},e.prototype.hide=function(){this._window.hide()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._window&&this._window.update(e)},e.prototype.destroy=function(){this._Hide=null,t.prototype.destroy.call(this)},e.prototype._initWindow=function(){this._window||(this._window=new n.RoomWindow({Hide:this._Hide}))},e}(r.Core);e.RoomDesktopController=s,t.RoomDesktopController=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.RoomWindow=void 0;var n=o(43),s=o(525),a=o(1),l=o(6),u=function(t){function e(e){var o=t.call(this,e)||this;return o._Class="TVRoomWindowContent",o._IsVisiblePreview=!1,o._RoomInfo={},o._WindowClass="TVRoomWindow",o._content=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.show=function(){t.prototype.show.call(this),this._updateRoomPosition()},e.prototype.render=function(){t.prototype.render.call(this),this._renderContent()},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._content){var o=e.IsVisiblePreview,i=e.RoomInfo;((0,a.isDefined)(i)||(0,a.isDefined)(o))&&(this._updateWindowWidth(),this._content.update(r(r({},this._RoomInfo),{IsVisiblePreview:this._IsVisiblePreview})))}},e.prototype._renderContent=function(){this._content=new s.RoomControl(r(r({},this._RoomInfo),{ParentNode:this._DomNode}))},e.prototype._updateRoomPosition=function(){var t=(0,a.getScrolls)().Y,e=(0,a.getViewPort)().y;this._mainContainer.style.top=t+(e-this._mainContainer.offsetHeight)/2+"px"},e.prototype._updateWindowWidth=function(){var t=this._RoomInfo&&(0,l.isEmptyArray)(this._RoomInfo.Photos);(0,a.updateClass)(this._mainContainer,"TVRoomNoPhotoWindow",t)},e}(n.PopUpBase);e.RoomWindow=u,t.RoomWindow=u}).call(e,o(0))},function(t,e,o){"use strict";function i(t,e){var o=null;return function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];o||(o=setTimeout(function(){t.apply(void 0,i),clearTimeout(o),o=null},e))}}Object.defineProperty(e,"__esModule",{value:!0}),e.throttle=void 0,e.throttle=i},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.RoomMobileController=void 0;var r=o(55),n=o(21),s=o(14),a=o(9),l=o(4),u=o(526),c=function(t){function e(e){var o=t.call(this,e)||this;return o._Hide=null,o._roomPage=null,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.show=function(){s.router.goTo(n.RouterPath.Room)},e.prototype.hide=function(){s.router.back()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._roomPage&&this._roomPage.update(e)},e.prototype.destroy=function(){this._Hide=null,r.layoutPageFactory.PageCreated.remove(this),t.prototype.destroy.call(this)},e.prototype._init=function(){r.layoutPageFactory.PageCreated.addOnce(new l.Delegate(this,this._onPageCreated))},e.prototype._onPageCreated=function(t){if(t.PageClassName===u.RoomPage.displayName){var e=r.layoutPageFactory.getPage();this._roomPage=e,this._roomPage.update({Hide:this._Hide})}},e}(a.Core);e.RoomMobileController=c,t.RoomMobileController=c}).call(e,o(0))},function(t,e,o){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});var r=o(21),n=o(14),s=o(526);n.router.addRoutes((i={},i[r.RouterPath.Room]=s.RoomPage,i))},function(t,e,o){"use strict";(function(t,i){var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.ShareManager=void 0;var s=o(31),a=o(142),l=o(207),u=o(9),c=o(4),h=o(7),d=o(1),p=o(5),_=o(22),f=o(121),y=o(1053),g=o(1055),C=o(1056);o(1057);var v=a.SharePanelViewEnum.SHARE_MAIN,m=s.ActionStatisticsSource.NONE,T=p.ModeView.DescTop,w=!1,S=!1,P=!1,b=function(e){function o(t){var o=e.call(this,t)||this;return o._ActionSource=m,o._ErrorData={},o._Info={},o._IsEnabledShareBlob=w,o._IsEnabledSharePicture=S,o._IsVisibleSendError=P,o._Link="",o._LinkWithoutDate="",o._ModeView=T,o._SharePanelView=v,o._Text="",o._ChangePictureClicked=null,o._Shared=null,o._instance=null,o._postingSettings=h.DEFAULT_POSTING_SETTINGS,o.__initSettings(t),o._init(),o}return r(o,e),o.prototype.show=function(t){this.__initSettings(t),this._updateLink(t),this._initInstance(),this._showInstance(),this._updateInstance()},o.prototype.hide=function(){this._hideInstance()},o.prototype.hideWindow=function(){this._instance instanceof y.ShareDesktopController&&this.hide()},o.prototype.update=function(t){e.prototype.update.call(this,t),this._updateInstance()},o.prototype.destroy=function(){this._Info=null,this._Shared=null,e.prototype.destroy.call(this)},o.prototype._init=function(){this._updateSharePictureEnabled=this._updateSharePictureEnabled.bind(this);var t=C.ShareManagerStorageService.getPostingSettings,e=t();(0,d.isDefined)(e)&&(this._postingSettings=e)},o.prototype._updateLink=function(e){if(this._Link&&this._Link.indexOf(h.TOUR_CART_LINK)>-1){var o=e.Currency,i=e.IsEnabledAddClientId,r=t.clientId;i&&r&&(this._Link+="&"+p.Hash.ClientId+"="+r),(0,d.isDefined)(o)&&o!==p.Currency.Rub&&o!==p.Currency.None&&(this._Link+="&"+p.Hash.Currency+"="+o)}},o.prototype._initInstance=function(){var t={IsEnabledShareBlob:this._IsEnabledShareBlob,ChangePictureClicked:new c.Delegate(this,this._onChangePictureClicked),Hide:new c.Delegate(this,this._onInstanceHided),PostingSettingsChanged:new c.Delegate(this,this._onPostingSettingsChanged),SendErrorClicked:new c.Delegate(this,this._onSendErrorClicked),ShareClicked:new c.Delegate(this,this._onShareClicked)};this._ModeView===p.ModeView.Mobile?this._initMobileController(t):this._initDesktopController(t)},o.prototype._initMobileController=function(t){if(this._instance instanceof g.ShareMobileController)return this._instance;this._instance=new g.ShareMobileController(t)},o.prototype._initDesktopController=function(t){if(this._instance instanceof y.ShareDesktopController)return this._instance;this._instance=new y.ShareDesktopController(t)},o.prototype._showInstance=function(){this._instance.show()},o.prototype._hideInstance=function(){this._instance.hide()},o.prototype._onChangePictureClicked=function(){this._ChangePictureClicked&&this._ChangePictureClicked.fire()},o.prototype._onInstanceHided=function(){this._ChangePictureClicked=null,this._Shared=null,this._ActionSource=m,this._ErrorData={},this._Info={},this._Link="",this._LinkWithoutDate="",this._ModeView=T,this._IsEnabledShareBlob=w,this._IsEnabledSharePicture=S,this._IsVisibleSendError=P,this._SharePanelView=v,this._Text="",this._instance.update({SharePanelView:a.SharePanelViewEnum.SHARE_MAIN,Reset:!0})},o.prototype._onPostingSettingsChanged=function(t){this._postingSettings=n(n({},this._postingSettings),t),this._updateRememberPostingSettings()},o.prototype._onSendErrorClicked=function(){var t=this._instance instanceof y.ShareDesktopController?this._instance.getOffsetTop():0;(0,f.showError)({ActionSource:this._ActionSource,ErrorData:n({},this._ErrorData),ModeView:this._ModeView,OffsetTop:t}),this.hideWindow()},o.prototype._onShareClicked=function(t){this._Shared&&this._Shared.fire(t)},o.prototype._updateRememberPostingSettings=function(){(0,C.ShareManagerStorageService.setPostingSettings)(this._postingSettings)},o.prototype._updateInstance=function(){this._instance&&(this._instance.update({Info:this._Info,IsVisibleSendError:this._IsVisibleSendError,Link:this._Link,LinkWithoutDate:this._LinkWithoutDate,ModeView:this._ModeView,PostingSettings:this._postingSettings,SharePanelView:this._SharePanelView,Text:this._Text}),_.authManager.getRole().then(this._updateSharePictureEnabled))},o.prototype._updateSharePictureEnabled=function(t){var e=t===l.Role.PROMANAGER&&this._IsEnabledSharePicture;return this._instance.update({IsEnabledSharePicture:e}),t},o}(u.Core);e.ShareManager=b,i.ShareManager=b}).call(e,o(11),o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ShareDesktopController=void 0;var r=o(9),n=o(1054),s=function(t){function e(e){var o=t.call(this,e)||this;return o._ChangePictureClicked=null,o._Hide=null,o._PostingSettingsChanged=null,o._IsEnabledShareBlob=!0,o._IsEnabledSharePicture=!1,o._IsVisibleSendError=!1,o._SendErrorClicked=null,o._ShareClicked=null,o._window=null,o.__initSettings(e),o}return i(e,t),e.prototype.show=function(){this._initWindow(),this._window.show()},e.prototype.hide=function(){this._window.hide()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._window&&this._window.update(e)},e.prototype.destroy=function(){this._ChangePictureClicked=null,this._Hide=null,this._PostingSettingsChanged=null,this._SendErrorClicked=null,this._ShareClicked=null,t.prototype.destroy.call(this)},e.prototype.getOffsetTop=function(){return this._window&&this._window.getOffsetTop()?this._window.getOffsetTop():0},e.prototype._initWindow=function(){this._window||(this._window=new n.ShareWindow({IsEnabledShareBlob:this._IsEnabledShareBlob,IsEnabledSharePicture:this._IsEnabledSharePicture,IsVisibleSendError:this._IsVisibleSendError,ChangePictureClicked:this._ChangePictureClicked,Hide:this._Hide,PostingSettingsChanged:this._PostingSettingsChanged,SendErrorClicked:this._SendErrorClicked,ShareClicked:this._ShareClicked}))},e}(r.Core);e.ShareDesktopController=s,t.ShareDesktopController=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ShareWindow=void 0;var r=o(43),n=o(142),s=o(269),a=o(4),l=o(1),u=function(t){function e(e){var o=t.call(this,e)||this;return o._WindowClass="TVShareWindow",o._ChangePictureClicked=null,o._PostingSettingsChanged=null,o._RememberPostingSettingsClicked=null,o._IsEnabledShareBlob=!0,o._IsEnabledSharePicture=!1,o._IsVisibleSendError=!1,o._SendErrorClicked=null,o._ShareClicked=null,o._content=null,o.__initSettings(e),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderContent()},e.prototype.show=function(){t.prototype.show.call(this),this._updateSharePosition()},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._rendered&&this._content){var o=e.Reset;(0,l.isDefined)(o)&&(0,l.removeClass)(this._mainContainer,"TVPictureShare"),this._content.update(e)}},e.prototype.destroy=function(){this._ChangePictureClicked=null,this._PostingSettingsChanged=null,this._SendErrorClicked=null,this._ShareClicked=null,this._RememberPostingSettingsClicked=null,t.prototype.destroy.call(this)},e.prototype.getOffsetTop=function(){return this._mainContainer?this._mainContainer.offsetTop:0},e.prototype._renderContent=function(){this._content=new s.ShareControl({IsEnabledShareBlob:this._IsEnabledShareBlob,IsEnabledSharePicture:this._IsEnabledSharePicture,IsVisibleSendError:this._IsVisibleSendError,ParentNode:this._DomNode,BeforePanelSwitched:new a.Delegate(this,this._onSharePanelSwitched),ChangePictureClicked:this._ChangePictureClicked,PostingSettingsChanged:this._PostingSettingsChanged,SendErrorClicked:this._SendErrorClicked,ShareClicked:this._ShareClicked})},e.prototype._onSharePanelSwitched=function(t){var e=t.View;(0,l.updateClass)(this._mainContainer,"TVPictureShare",e===n.SharePanelViewEnum.SHARE_PICTURE)},e.prototype._updateSharePosition=function(){var t=(0,l.getScrolls)().Y,e=(0,l.getViewPort)().y;this._mainContainer.style.top=t+(e-this._mainContainer.offsetHeight)/2+"px"},e}(r.PopUpBase);e.ShareWindow=u,t.ShareWindow=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ShareMobileController=void 0;var r,n=o(55),s=o(21),a=o(14),l=o(9),u=o(4);!function(t){t.SharePage="SharePage"}(r||(r={}));var c=function(t){function e(e){var o=t.call(this,e)||this;return o._Hide=null,o._IsEnabledShareBlob=!0,o._IsEnabledSharePicture=!1,o._IsVisibleSendError=!1,o._ChangePictureClicked=null,o._PostingSettingsChanged=null,o._SendErrorClicked=null,o._ShareClicked=null,o._sharePage=null,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.show=function(){a.router.goTo(""+s.RouterPath.Share)},e.prototype.hide=function(){a.router.back()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._sharePage&&this._sharePage.update(e)},e.prototype.destroy=function(){this._ChangePictureClicked=null,this._Hide=null,this._PostingSettingsChanged=null,this._SendErrorClicked=null,this._ShareClicked=null,n.layoutPageFactory.PageCreated.remove(this),t.prototype.destroy.call(this)},e.prototype._init=function(){n.layoutPageFactory.PageCreated.addOnce(new u.Delegate(this,this._onPageCreated))},e.prototype._onPageCreated=function(t){var e=n.layoutPageFactory.getPage();switch(t.PageClassName){case r.SharePage:this._sharePage=e,this._sharePage.update({IsEnabledShareBlob:this._IsEnabledShareBlob,IsEnabledSharePicture:this._IsEnabledSharePicture,IsVisibleSendError:this._IsVisibleSendError,ChangePictureClicked:this._ChangePictureClicked,Hide:this._Hide,PostingSettingsChanged:this._PostingSettingsChanged,SendErrorClicked:this._SendErrorClicked,ShareClicked:this._ShareClicked})}},e}(l.Core);e.ShareMobileController=c,t.ShareMobileController=c}).call(e,o(0))},function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.ShareManagerStorageService=void 0;var i=o(7),r=o(45),n=function(){function t(){}return t.setPostingSettings=function(t){(0,r.setLocalStorage)(i.LOCSTORAGE_SHARE_POSTING_SETTINGS,JSON.stringify(t))},t.getPostingSettings=function(){var t=(0,r.getLocalStorage)(i.LOCSTORAGE_SHARE_POSTING_SETTINGS)||"";try{if(t)return JSON.parse(t)}catch(t){}},t.deletePostingSettings=function(){(0,r.deleteLocalStorage)(i.LOCSTORAGE_SHARE_POSTING_SETTINGS)},t}();e.ShareManagerStorageService=n,t.ShareManagerStorageService=n}).call(e,o(0))},function(t,e,o){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});var r=o(21),n=o(14),s=o(1058);n.router.addRoutes((i={},i[r.RouterPath.Share]=s.SharePage,i))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.SharePage=void 0;var r=o(36),n=o(142),s=o(269),a=o(5),l=function(t){function e(e){var o=t.call(this,e)||this;return o._ExtraBackBtnEnabled=!0,o._LayoutClass="TVSharePage",o._IsEnabledShareBlob=!0,o._IsEnabledSharePicture=!1,o._IsVisibleSendError=!1,o._ChangePictureClicked=null,o._PostingSettingsChanged=null,o._SendErrorClicked=null,o._ShareClicked=null,o._share=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._share&&this._share.update(e)},e.prototype.destroy=function(){this._ChangePictureClicked=null,this._PostingSettingsChanged=null,this._SendErrorClicked=null,this._ShareClicked=null,t.prototype.destroy.call(this)},e.prototype._getContent=function(){return this._share||(this._share=new s.ShareControl({IsEnabledShareBlob:this._IsEnabledShareBlob,IsEnabledSharePicture:this._IsEnabledSharePicture,IsVisibleSendError:this._IsVisibleSendError,ModeView:a.ModeView.Mobile,ChangePictureClicked:this._ChangePictureClicked,PostingSettingsChanged:this._PostingSettingsChanged,SendErrorClicked:this._SendErrorClicked,ShareClicked:this._ShareClicked})),this._share},e.prototype._onExtraBackBtnClicked=function(){if(this._share.getPanelType()!==n.SharePanelViewEnum.SHARE_MAIN)return void this._share.update({SharePanelView:n.SharePanelViewEnum.SHARE_MAIN});t.prototype._onExtraBackBtnClicked.call(this)},e.displayName="SharePage",e}(r.Page);e.SharePage=l,t.SharePage=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourRedirectionInfoManager=void 0;var r=o(137),n=o(8),s=o(276),a=o(73),l=o(28),u=o(9),c=o(4),h=o(1),d=o(5),p=o(6),_=o(1060),f=o(1062);o(1063);var y=function(t){function e(e){var o=t.call(this,e)||this;return o._ModeView=d.ModeView.DescTop,o._OfficeId=0,o._TourId=0,o._instance=null,o._searchLink="",o.__initSettings(e),o}return i(e,t),e.prototype.show=function(t){this.__initSettings(t),this._initInstance(),this._showInstance(),this._updateInstance()},e.prototype.hide=function(){this._hideInstance()},e.prototype._initInstance=function(){if(!this._instance){var t={Hide:new c.Delegate(this,this._onInstanceHided),Submit:new c.Delegate(this,this._onSubmit)};this._ModeView===d.ModeView.Mobile?this._initMobileController(t):this._initDesktopController(t)}},e.prototype._initMobileController=function(t){this._instance instanceof f.TourRedirectionInfoMobileController||(this._instance=new f.TourRedirectionInfoMobileController(t))},e.prototype._initDesktopController=function(t){this._instance instanceof _.TourRedirectionInfoDesktopController||(this._instance=new _.TourRedirectionInfoDesktopController(t))},e.prototype._showInstance=function(){this._instance&&(this._instance.show(),(0,h.addClass)(document.body,n.TV_BODY_SCROLL_DISABLED))},e.prototype._hideInstance=function(){this._instance&&this._instance.hide()},e.prototype._updateInstance=function(){var t=this;this._instance&&(this._instance.update({IsVisiblePreview:!0,ToAddress:"",ToLogo:"",ToName:"",ToPhone:""}),s.officeService.getOffice(this._OfficeId).then(function(e){t._searchLink=a.officeUtils.getOfficeSearchLink(e);var o=a.officeUtils.getLogoPath(e),i=l.pictureUtils.getOfficeLogoLink(o),r=a.officeUtils.getOfficeName(e),n=a.officeUtils.getOfficeFullAddress(e),s=a.officeUtils.getOfficePhone(e);t._instance.update({IsVisiblePreview:!1,ToAddress:n,ToLogo:i,ToName:r,ToPhone:s})}))},e.prototype._onInstanceHided=function(){this._OfficeId=0,this._TourId=0,this._searchLink="",(0,h.removeClass)(document.body,n.TV_BODY_SCROLL_DISABLED)},e.prototype._onSubmit=function(){var t=this._TourId,e={HashUserOfficeId:this._OfficeId,ModeView:this._ModeView};if(this._ModeView===d.ModeView.DescTop){var o=(0,p.getCurrentURL)()+"#"+d.Hash.Tourid+"="+this._TourId;window.location.replace(o),this.hide()}(0,r.showTourByShortId)(t,e)},e}(u.Core);e.TourRedirectionInfoManager=y,t.TourRedirectionInfoManager=y}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourRedirectionInfoDesktopController=void 0;var r=o(9),n=o(1061),s=function(t){function e(e){var o=t.call(this,e)||this;return o._Hide=null,o._Submit=null,o._window=null,o.__initSettings(e),o}return i(e,t),e.prototype.show=function(){this._initWindow(),this._window.show()},e.prototype.hide=function(){this._window.hide()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._window&&this._window.update(e)},e.prototype.destroy=function(){this._Hide=null,this._Submit=null,t.prototype.destroy.call(this)},e.prototype._initWindow=function(){this._window||(this._window=new n.TourRedirectionInfoWindow({Hide:this._Hide,Submit:this._Submit}))},e}(r.Core);e.TourRedirectionInfoDesktopController=s,t.TourRedirectionInfoDesktopController=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourRedirectionInfoWindow=void 0;var r=o(2),n=o(3),s=o(1),a=o(5),l=o(527),u=function(t){function e(e){var o=t.call(this,e)||this;return o.Hide=new n.UserEvent,o._Class="TVTourRedirectionInfoWindow",o._ModeView=a.ModeView.DescTop,o._Submit=null,o._redirectionInfoControl=null,o.__initSettings(e),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderRedirectionInfoControl()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._redirectionInfoControl.update(e)},e.prototype.show=function(){this._rendered||this.render(),t.prototype.show.call(this),this._show()},e.prototype.hide=function(){t.prototype.hide.call(this),this._hide()},e.prototype.destroy=function(){this._Submit=null,t.prototype.destroy.call(this)},e.prototype._show=function(){document.body.appendChild(this._DomNode)},e.prototype._hide=function(){(0,s.remove)(this._DomNode),this.Hide.fire()},e.prototype._renderRedirectionInfoControl=function(){var t=(0,s.newDiv)("TVTourRedirectionInfoWindowContent",this._DomNode);this._redirectionInfoControl=new l.TourRedirectionInfoControl({ModeView:this._ModeView,ParentNode:t,Submit:this._Submit})},e}(r.Control);e.TourRedirectionInfoWindow=u,t.TourRedirectionInfoWindow=u}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourRedirectionInfoMobileController=void 0;var r,n=o(55),s=o(21),a=o(14),l=o(9),u=o(4);!function(t){t.TourRedirectionInfoPage="TourRedirectionInfoPage"}(r||(r={}));var c=function(t){function e(e){var o=t.call(this,e)||this;return o._Hide=null,o._Submit=null,o._tourRedirectionInfoPage=null,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.show=function(){a.router.goTo(""+s.RouterPath.TourRedirectionInfo)},e.prototype.hide=function(){a.router.back()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._tourRedirectionInfoPage&&this._tourRedirectionInfoPage.update(e)},e.prototype.destroy=function(){this._Hide=null,this._Submit=null,n.layoutPageFactory.PageCreated.remove(this),t.prototype.destroy.call(this)},e.prototype._init=function(){n.layoutPageFactory.PageCreated.addOnce(new u.Delegate(this,this._onPageCreated))},e.prototype._onPageCreated=function(t){if(t.PageClassName===r.TourRedirectionInfoPage){var e=n.layoutPageFactory.getPage();this._tourRedirectionInfoPage=e,this._tourRedirectionInfoPage.update({Hide:this._Hide,Submit:this._Submit})}},e}(l.Core);e.TourRedirectionInfoMobileController=c,t.TourRedirectionInfoMobileController=c}).call(e,o(0))},function(t,e,o){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});var r=o(21),n=o(14),s=o(1064);n.router.addRoutes((i={},i[r.RouterPath.TourRedirectionInfo]=s.TourRedirectionInfoPage,i))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourRedirectionInfoPage=void 0;var r=o(36),n=o(5),s=o(527),a=function(t){function e(e){var o=t.call(this,e)||this;return o._LayoutClass="TVTourRedirectionInfoPage",o._Transitions=[],o._Submit=null,o._redirectionControl=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._redirectionControl&&this._redirectionControl.update(e)},e.prototype.destroy=function(){this._Submit=null,t.prototype.destroy.call(this)},e.prototype._getContent=function(){return this._redirectionControl||(this._redirectionControl=new s.TourRedirectionInfoControl({ModeView:n.ModeView.Mobile,Submit:this._Submit})),this._redirectionControl},e.displayName="TourRedirectionInfoPage",e}(r.Page);e.TourRedirectionInfoPage=a,t.TourRedirectionInfoPage=a}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourRedirectionManager=void 0;var r=o(224),n=o(276),s=o(73),a=o(28),l=o(9),u=o(4),c=o(5),h=o(1066),d=o(1070),p=o(307);o(1071);var _=function(t){function e(e){var o=t.call(this,e)||this;return o._ModeView=c.ModeView.DescTop,o._OfficeId=0,o._TourId=0,o._ViewMode=r.TourRedirectionViewModeEnum.SUCCESS,o._ErrorClicked=null,o._instance=null,o._timeout=null,o.__initSettings(e),o}return i(e,t),e.prototype.show=function(t){this.__initSettings(t),this._initInstance(),this._showInstance(),this._updateInstance()},e.prototype.hide=function(){this._hideInstance()},e.prototype.destroy=function(){clearTimeout(this._timeout),this._timeout=null,t.prototype.destroy.call(this)},e.prototype._initInstance=function(){if(!this._instance){var t={ErrorClicked:new u.Delegate(this,this._onErrorRedirectClicked),Hide:new u.Delegate(this,this._onInstanceHided)};this._ModeView===c.ModeView.Mobile?this._initMobileController(t):this._initDesktopController(t)}},e.prototype._initMobileController=function(t){this._instance instanceof d.TourRedirectionMobileController||(this._instance=new d.TourRedirectionMobileController(t))},e.prototype._initDesktopController=function(t){this._instance instanceof h.TourRedirectionDesktopController||(this._instance=new h.TourRedirectionDesktopController(t))},e.prototype._showInstance=function(){this._instance&&this._instance.show()},e.prototype._hideInstance=function(){this._instance&&this._instance.hide()},e.prototype._updateInstance=function(){var t=this;if(this._instance)switch(this._ViewMode){case r.TourRedirectionViewModeEnum.ERROR:this._instance.update({ViewMode:this._ViewMode});break;case r.TourRedirectionViewModeEnum.SUCCESS:this._instance.update({IsVisibleToLogoWaiter:!0,ToLogo:"",ToText:"",ViewMode:this._ViewMode}),n.officeService.getOffice(this._OfficeId).then(function(e){var o=s.officeUtils.getOfficeSearchLink(e),i=s.officeUtils.getLogoPath(e),r=a.pictureUtils.getOfficeLogoLink(i),n=s.officeUtils.getOfficeName(e);t._instance.update({IsVisibleToLogoWaiter:!1,ToLogo:r,ToText:n,ViewMode:t._ViewMode}),t._setDelayRedirect(o)})}},e.prototype._onInstanceHided=function(){this._ErrorClicked=null,this._OfficeId=0,this._TourId=0,this._ViewMode=r.TourRedirectionViewModeEnum.SUCCESS,clearTimeout(this._timeout)},e.prototype._onErrorRedirectClicked=function(){this._ErrorClicked&&this._ErrorClicked.fire()},e.prototype._setDelayRedirect=function(t){var e=p.tourRedirectionUtils.getLink({OfficeId:this._OfficeId,SearchLink:t,TourId:this._TourId});this._timeout=setTimeout(function(){window.location.replace(e)},4e3)},e}(l.Core);e.TourRedirectionManager=_,t.TourRedirectionManager=_}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourRedirectionDesktopController=void 0;var r=o(9),n=o(528),s=function(t){function e(e){var o=t.call(this,e)||this;return o._ErrorClicked=null,o._Hide=null,o._window=null,o.__initSettings(e),o}return i(e,t),e.prototype.show=function(){this._initWindow(),this._window.show()},e.prototype.hide=function(){this._window.hide()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._window&&this._window.update(e)},e.prototype.destroy=function(){this._ErrorClicked=null,this._Hide=null,t.prototype.destroy.call(this)},e.prototype._initWindow=function(){this._window||(this._window=new n.TourRedirectionWindow({ErrorClicked:this._ErrorClicked,Hide:this._Hide}))},e}(r.Core);e.TourRedirectionDesktopController=s,t.TourRedirectionDesktopController=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourErrorRedirectionControl=void 0;var r=o(85),n=o(8),s=o(2),a=o(4),l=o(3),u=o(1),c=o(5),h=function(t){function e(e){var o=t.call(this,e)||this;return o.Clicked=new l.UserEvent,o.templateName="tour-error-redirection",o._ModeView=c.ModeView.DescTop,o._button=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._updateModeViewClass(),this._updateTitle(),this._updateSubtitle1(),this._updateSubtitle2(),this._renderChangeButton()},e.prototype._updateModeViewClass=function(){(0,u.updateClass)(this._DomNode,n.TV_MOBILE,this._ModeView===c.ModeView.Mobile)},e.prototype._updateTitle=function(){this._nodes.titleNode.textContent="Ошибка!"},e.prototype._updateSubtitle1=function(){this._nodes.subtitleNode1.textContent="К сожалению, нам не удалось перейти на сайт"},e.prototype._updateSubtitle2=function(){this._nodes.subtitleNode2.textContent="Выберите любое другое туристическое агентство для покупки тура"},e.prototype._renderChangeButton=function(){var t=this._nodes.contentNode;this._button=new r.ButtonWaiter({Class:(0,u.classNames)("TVTourErrorRedirectionButton",n.TV_BUTTON_HOVER),Content:"Выбрать другой офис",ParentNode:t,Click:new a.Delegate(this,this._onButtonClicked)})},e.prototype._onButtonClicked=function(){this.Clicked.fire()},e}(s.Control);e.TourErrorRedirectionControl=h,t.TourErrorRedirectionControl=h}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourRedirectionControl=void 0;var r=o(8),n=o(1069),s=o(23),a=o(51),l=o(2),u=o(7),c=o(1),h=o(5),d=function(t){function e(e){var o=t.call(this,e)||this;return o.templateName="tour-redirection",o._IsVisibleToLogoWaiter=!1,o._ModeView=h.ModeView.DescTop,o._ToLogo="",o._ToText="",o._separator=null,o._waiter=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._renderSeparator(),this._updateModeViewClass(),this._updateTitle(),this._updateSubtitle(),this._updateFromLogo(),this._updateToLogo(),this._updateFromInfo(),this._updateToInfo()},e.prototype.update=function(e){t.prototype.update.call(this,e);var o=e.IsVisibleToLogoWaiter,i=e.ToLogo,r=e.ToText;((0,c.isDefined)(i)||(0,c.isDefined)(r))&&this._updateToLogo(),(0,c.isDefined)(o)&&this._updateToLogoVisibility()},e.prototype._renderSeparator=function(){var t=this._nodes.separatorNode,e=this._ModeView===h.ModeView.Mobile?a.DirectionEnum.BOTTOM:a.DirectionEnum.RIGHT;this._separator=new n.Chevron({Direction:e,ParentNode:t})},e.prototype._renderWaiter=function(){var t=this._nodes.toLogoNode;this._waiter=new s.Waiter({ParentNode:t})},e.prototype._updateModeViewClass=function(){(0,c.updateClass)(this._DomNode,r.TV_MOBILE,this._ModeView===h.ModeView.Mobile)},e.prototype._updateTitle=function(){this._nodes.titleNode.textContent="Спасибо! Почти готово…"},e.prototype._updateSubtitle=function(){this._nodes.subtitleNode.textContent="Идет переадресация на сайт партнера"},e.prototype._updateFromInfo=function(){this._nodes.fromInfoNode.textContent="Вы нашли нужный тур"},e.prototype._updateToInfo=function(){this._nodes.toInfoNode.textContent="Завершите процесс покупки на сайте партнера"},e.prototype._updateFromLogo=function(){this._nodes.fromLogoNode.style.backgroundImage='url("'+u.TOURVISOR_LOGO+'")'},e.prototype._updateToLogo=function(){var t=this._nodes.toLogoNode,e=Boolean(this._ToLogo),o=this._ToText||"";t.style.backgroundImage=e?'url("'+this._ToLogo+'")':"",t.textContent=e?"":o},e.prototype._updateToLogoVisibility=function(){if(this._waiter||this._renderWaiter(),this._IsVisibleToLogoWaiter)return void this._waiter.show();this._waiter.hide()},e}(l.Control);e.TourRedirectionControl=d,t.TourRedirectionControl=d}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.Chevron=void 0;var r=o(2),n=o(1),s=o(51),a=o(15),l=function(t){function e(e){var o=t.call(this,e)||this;return o._Direction=s.DirectionEnum.LEFT,o._Class="TVChevron",o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.render=function(){t.prototype.render.call(this),this._addDirectionClass(),this._renderItems()},e.prototype._addDirectionClass=function(){var t=a.styleUtils.getClassByDirection(this._Direction);(0,n.addClass)(this._DomNode,t)},e.prototype._renderItems=function(){for(var t=0;t<3;t++)(0,n.newDiv)((0,n.classNames)("TVChevronItem"),this._DomNode)},e}(r.Control);e.Chevron=l,t.Chevron=l}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourRedirectionMobileController=void 0;var r,n=o(55),s=o(21),a=o(14),l=o(9),u=o(4);!function(t){t.TourRedirectionPage="TourRedirectionPage"}(r||(r={}));var c=function(t){function e(e){var o=t.call(this,e)||this;return o._ErrorClicked=null,o._Hide=null,o._tourRedirectionPage=null,o.__initSettings(e),o._init(),o}return i(e,t),e.prototype.show=function(){a.router.goTo(""+s.RouterPath.TourRedirection)},e.prototype.hide=function(){a.router.back()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._tourRedirectionPage&&this._tourRedirectionPage.update(e)},e.prototype.destroy=function(){this._ErrorClicked=null,this._Hide=null,n.layoutPageFactory.PageCreated.remove(this),t.prototype.destroy.call(this)},e.prototype._init=function(){n.layoutPageFactory.PageCreated.addOnce(new u.Delegate(this,this._onPageCreated))},e.prototype._onPageCreated=function(t){if(t.PageClassName===r.TourRedirectionPage){var e=n.layoutPageFactory.getPage();this._tourRedirectionPage=e,this._tourRedirectionPage.update({ErrorClicked:this._ErrorClicked,Hide:this._Hide})}},e}(l.Core);e.TourRedirectionMobileController=c,t.TourRedirectionMobileController=c}).call(e,o(0))},function(t,e,o){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0});var r=o(21),n=o(14),s=o(1072);n.router.addRoutes((i={},i[r.RouterPath.TourRedirection]=s.TourRedirectionPage,i))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.TourRedirectionPage=void 0;var r=o(36),n=o(5),s=o(528),a=function(t){function e(e){var o=t.call(this,e)||this;return o._LayoutClass="TVTourRedirectionPage",o._Transitions=[],o._ErrorClicked=null,o._redirectionWindow=null,o.__initSettings(e),o._Render&&o.render(),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._redirectionWindow&&this._redirectionWindow.update(e)},e.prototype.destroy=function(){this._ErrorClicked=null,t.prototype.destroy.call(this)},e.prototype._getContent=function(){return this._redirectionWindow||(this._redirectionWindow=new s.TourRedirectionWindow({ModeView:n.ModeView.Mobile,ErrorClicked:this._ErrorClicked}),this._redirectionWindow.show()),this._redirectionWindow},e.displayName="TourRedirectionPage",e}(r.Page);e.TourRedirectionPage=a,t.TourRedirectionPage=a}).call(e,o(0))},,,,,function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.calendarService=void 0;var r=o(27),n=function(t){function e(e){var o=t.call(this,e)||this;return o.url="//tourvisor.ru"+e,o}return i(e,t),e}(r.ApiService);e.calendarService=new n("/xml/modcalendar.php"),t.calendarService=e.calendarService}).call(e,o(0))},,,,,,,,,,,,,,,,,function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.ListSelectCity=void 0;var r=o(149),n=o(8),s=o(2),a=o(4),l=o(3),u=o(7),c=o(1),h=o(5),d=o(91),p=o(96),_=o(292),f=o(395),y=function(t){function e(e){var o=t.call(this,e)||this;return o.Changed=new l.UserEvent,o._ContentNode=null,o._Items=[],o._ModeView=h.ModeView.DescTop,o._ParentVoice=!0,o._Selected=[],o._adaptiveCore=null,o._listCity=null,o._prevSelected=[],o._tabbedList=null,t.prototype.__initSettings.call(o,e),o.render(),o}return i(e,t),e.prototype.getDropPanel=function(){return this._adaptiveCore},e.prototype.render=function(){t.prototype.render.call(this),this._ContentNode=this._ContentNode?this._ContentNode:this._DomNode,this._adaptiveCore=new p.AdaptiveCore({Class:"TVCityPanel",Control:this._DomNode,FooterFixed:!0,ModeView:this._ModeView,Hide:new a.Delegate(this,this._onAdaptiveCoreHide),Show:new a.Delegate(this,this._onAdaptiveCoreShow)}),this._listCity=new f.ListCities({Items:this._Items,Render:!1,Changed:new a.Delegate(this,this._onListChanged)}),this._tabbedList=new _.TabbedListControl({ListControl:this._listCity,Render:!1,TabItems:[{AlwaysShow:!1,FilterFunction:function(t){return t.popular===r.Popular.YES},Key:"Популярные"}],FilterSearchedItemFunc:d.cityUtils.filterSearchedItemFunc}),this._adaptiveCore.addChild(this._tabbedList),this._updateContent()},e.prototype.update=function(e){t.prototype.update.call(this,e),this._rendered&&(this._listCity.update(e),this._tabbedList.update({Reset:!0}),this._updateContent())},e.prototype._onListChanged=function(t){this._Selected=t.Selected,this._updateContent(),this._adaptiveCore.hide()},e.prototype._onAdaptiveCoreHide=function(){this._prevSelected.toString()===this._Selected.toString()||this.Changed.fire({Selected:this._Selected})},e.prototype._onAdaptiveCoreShow=function(){this._prevSelected=this._Selected,this._tabbedList.update({Reset:!0})},e.prototype._updateContent=function(){var t=this,e="";if(this._Items&&this._Selected.length>0)switch(this._Selected.length){case 1:var o=this._Selected[0],i=this._Items.find(function(t){return Number(t.id)===o});i&&(e=this._ParentVoice?i.namefrom:i.name,Number(i.id)===u.DEPARTURE_NO_FLIGHT_ID?(0,c.addClass)(this._ContentNode.parentNode,n.TV_CITY_NO_FLIGHT):(0,c.removeClass)(this._ContentNode.parentNode,n.TV_CITY_NO_FLIGHT));break;default:e=this._Items.filter(function(e){return t._Selected.indexOf(Number(e.id))>-1}).map(function(e){return t._ParentVoice?e.namefrom:e.name}).join(", ")}this._ContentNode.textContent=e,(0,c.updateClass)(this._DomNode,n.TV_NOT_SELECTED,""===e)},e}(s.Control);e.ListSelectCity=y,t.ListSelectCity=y}).call(e,o(0))},,,,,function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.additionsStore=e.AdditionsStore=void 0;var i=o(81),r=o(1),n=o(20),s=function(){function t(){var e=r.initSinglton.call(this,t);if(e)return e;this._catalog=i.catalogManager}return t.prototype.setAirportsByCountry=function(t,e){this._catalog.set(n.CatalogName.Airports)(t).data(e)},t.prototype.getAirportsByCountry=function(t){return this._catalog.get(n.CatalogName.Airports)(t)()},t}();e.AdditionsStore=s,e.additionsStore=new s,t.additionsStore=e.additionsStore,t.AdditionsStore=s}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.airportsService=void 0;var r=o(27),n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e}(r.ApiService);e.airportsService=new n("/api/v1.1/airports"),t.airportsService=e.airportsService}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.HotelsMapController=void 0;var n=o(41),s=o(56),a=o(9),l=o(4),u=o(3),c=o(1),h=o(5),d=o(6),p=o(18),_=o(52),f=o(37),y=o(25),g=o(541),C=function(t){function e(e){var o=t.call(this,e)||this;return o.Hide=new u.UserEvent,o._Bounds=[],o._DefaultBounds=[],o._FilterSettings={},o._ParentNode=null,o._Ref=null,o._View=null,o._WindowClass="",o._MarkerClicked=null,o._map=null,o.__initSettings(e),o}return i(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._map&&(e.InfoRecieved&&(this._updateFilteredInactiveHotels(),this._updateMarkers(),e.FilterProps={ResortItems:this._getResortItems(),Resorts:this._FilterSettings.Resorts}),this._map.update(e))},e.prototype.show=function(){this._map||(this._map=new g.MapCardController({FormType:h.FormType.HotelSmallFilter,ParentNode:this._ParentNode,ToursGroup:h.ToursGroupBy.Hotels,WindowClass:this._WindowClass,Hide:new l.Delegate(this,this._onHide),MarkerClicked:this._MarkerClicked,FilterChanged:new l.Delegate(this,this._onFilterChanged)})),this._map.update({Bounds:this._Bounds,FilterProps:{HotelClass:this._FilterSettings.HotelClass,HotelRating:this._FilterSettings.HotelRating},IsNewInactiveItems:!0,View:this._View}),this._map.show()},e.prototype._updateMarkers=function(){var t=this._getInactiveHotels();this._map.update({InactiveItems:t,IsNewInactiveItems:!0,ToursGroup:h.ToursGroupBy.Hotels})},e.prototype._getInactiveHotels=function(){var t=n.hotelsStore.getFilteredInactiveHotels();return this._getHotelItemsForMap(t)},e.prototype._getHotelItemsForMap=function(t){for(var e=[],o=0;o<t.length;o++){var i=t[o];if(i){var s=n.hotelsStore.getHotel(i.id);(0,c.isDefined)(s)&&f.searchMapUtils.hasCoords(s.coord)&&e.push(f.searchMapUtils.hotelForMap(r(r({},i),s)))}}return e},e.prototype._onHide=function(){this.Hide.fire(this._FilterSettings)},e.prototype._onFilterChanged=function(t){var e=t.Resorts,o=this._DefaultBounds;if((0,d.isNotEmptyArray)(e)&&1===e.length){var i=e[0],n=s.resortsStore.getResort(i);o=f.searchMapUtils.getBounds(n)||this._DefaultBounds}this._FilterSettings=r(r({},this._FilterSettings),t);var a=this._FilterSettings,l=a.HotelClass,u=a.HotelRating,c=a.Resorts;this._map.update({Bounds:o,FilterProps:{HotelClass:l,HotelRating:u,Resorts:c}}),this._updateFilteredInactiveHotels(),this._updateMarkers()},e.prototype._updateFilteredInactiveHotels=function(){var t=p.hotelUtils.getHotelsFilterFunction(this._FilterSettings),e=y.settingUtils.getCountryId(this._FilterSettings);n.hotelsStore.updateFilteredInactiveHotels(e,t)},e.prototype._getResortItems=function(){var t=y.settingUtils.getCountryId(this._FilterSettings),e=s.resortsStore.getResorts(t);return _.resortUtils.getItems(e)},e}(a.Core);e.HotelsMapController=C,t.HotelsMapController=C}).call(e,o(0))},function(t,e,o){"use strict";(function(t){var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},r.apply(this,arguments)},n=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var i,r=0,n=e.length;r<n;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.ResortsMapController=void 0;var s=o(41),a=o(56),l=o(9),u=o(4),c=o(3),h=o(5),d=o(52),p=o(37),_=o(25),f=o(541),y=function(t){function e(e){var o=t.call(this,e)||this;return o.Hide=new c.UserEvent,o._Bounds=[],o._FilterSettings={},o._FlyMonth=0,o._ParentNode=null,o._Ref=null,o._View=null,o._WindowClass="",o._MarkerClicked=null,o._map=null,o._zoomLevel=0,o.__initSettings(e),o}return i(e,t),e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._map){if(e.InfoRecieved){var o=_.settingUtils.getCountryId(this._FilterSettings);s.hotelsStore.updateFilteredInactiveHotels(o),this._updateMarkers()}this._map.update(e)}},e.prototype.show=function(){this._map||(this._map=new f.MapCardController({FlyMonth:this._FlyMonth,FormType:h.FormType.ResortFilter,ParentNode:this._ParentNode,ToursGroup:h.ToursGroupBy.Resorts,WindowClass:this._WindowClass,Hide:new u.Delegate(this,this._onHide),FilterChanged:new u.Delegate(this,this._onFilterChanged),MarkerClicked:this._MarkerClicked,MapZoomChanged:new u.Delegate(this,this._onMapZoomChanged)})),this._map.update({Bounds:this._Bounds,FilterProps:{BeachType:this._FilterSettings.BeachType,RestTypes:this._FilterSettings.RestTypes},IsNewInactiveItems:!0,View:this._View}),this._map.show()},e.prototype._onMapZoomChanged=function(t){this._zoomLevel=t.Zoom,this._updateMarkers()},e.prototype._updateMarkers=function(){var t=this._getFilterInactiveResorts(),e=this._convertResortsFromInactiveResorts(t),o=n(n([],e.InactiveResorts,!0),e.InactiveSubResorts,!0);this._map.update({InactiveItems:o,IsNewInactiveItems:!0,ToursGroup:h.ToursGroupBy.Resorts})},e.prototype._convertResortsFromInactiveResorts=function(t){var e=a.resortsStore.getInactiveSubResorts(),o=this._separateResortsToExpanding(t),i=[],r=[];o.Expand.forEach(function(t){i=n(n([],i,!0),a.resortsStore.getSubResortsByResort(t.Id),!0);var o=Object.keys(e).map(function(t){return e[t]}).filter(function(e){return e.resortId===t.Id});r=n(n([],r,!0),o,!0)});var s=p.searchMapUtils.getResortItemsForMap(r,i);return{InactiveResorts:o.NoExpand,InactiveSubResorts:s}},e.prototype._getFilterInactiveResorts=function(){var t=[],e=_.settingUtils.getCountryId(this._FilterSettings);if(e){var o=a.resortsStore.getResorts(e)||[],i=a.resortsStore.getInactiveResorts(),r=Object.keys(i).map(function(t){return i[t]}),n=d.resortUtils.getResortsFilterFunction(this._FilterSettings);n&&(o=o.filter(function(t){return n(t)})),t=p.searchMapUtils.getResortItemsForMap(r,o)}return t},e.prototype._separateResortsToExpanding=function(t){var e=this,o=[],i=[];return t.forEach(function(t){if(e._zoomLevel>=t.Zoom){a.resortsStore.getSubResortsByResort(t.Id).length>0?o.push(t):i.push(t)}else i.push(t)}),{Expand:o,NoExpand:i}},e.prototype._onHide=function(){this.Hide.fire(this._FilterSettings)},e.prototype._onFilterChanged=function(t){this._FilterSettings=r(r({},this._FilterSettings),t),this._map.update({FilterProps:{BeachType:this._FilterSettings.BeachType,RestTypes:this._FilterSettings.RestTypes}}),this._updateMarkers()},e}(l.Core);e.ResortsMapController=y,t.ResortsMapController=y}).call(e,o(0))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,o){"use strict";/*! Fast Average Color | © 2020 Denis Seleznev | MIT License | https://github.com/fast-average-color/fast-average-color */
function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,e,o){return e&&r(t.prototype,e),o&&r(t,o),t}function s(t,e,o){return t[e]===o[0]&&t[e+1]===o[1]&&t[e+2]===o[2]&&t[e+3]===o[3]}function a(t,e,o){for(var i={},r=o.ignoredColor,n=0;n<e;n+=o.step){var a=t[n],l=t[n+1],u=t[n+2],c=t[n+3];if(!r||!s(t,n,r)){var h=Math.round(a/24)+","+Math.round(l/24)+","+Math.round(u/24);i[h]?i[h]=[i[h][0]+a*c,i[h][1]+l*c,i[h][2]+u*c,i[h][3]+c,i[h][4]+1]:i[h]=[a*c,l*c,u*c,c,1]}}var d=Object.keys(i).map(function(t){return i[t]}).sort(function(t,e){var o=t[4],i=e[4];return o>i?-1:o===i?0:1}),p=d[0],_=p[0],f=p[1],y=p[2],g=p[3],C=p[4];return g?[Math.round(_/g),Math.round(f/g),Math.round(y/g),Math.round(g/C)]:o.defaultColor}function l(t,e,o){for(var i=0,r=0,n=0,a=0,l=0,u=o.ignoredColor,c=0;c<e;c+=o.step){var h=t[c+3],d=t[c]*h,p=t[c+1]*h,_=t[c+2]*h;u&&s(t,c,u)||(i+=d,r+=p,n+=_,a+=h,l++)}return a?[Math.round(i/a),Math.round(r/a),Math.round(n/a),Math.round(a/l)]:o.defaultColor}function u(t,e,o){for(var i=0,r=0,n=0,a=0,l=0,u=o.ignoredColor,c=0;c<e;c+=o.step){var h=t[c],d=t[c+1],p=t[c+2],_=t[c+3];u&&s(t,c,u)||(i+=h*h*_,r+=d*d*_,n+=p*p*_,a+=_,l++)}return a?[Math.round(Math.sqrt(i/a)),Math.round(Math.sqrt(r/a)),Math.round(Math.sqrt(n/a)),Math.round(a/l)]:o.defaultColor}var c="FastAverageColor: ",h=function(){function t(){i(this,t)}return n(t,[{key:"getColorAsync",value:function(t,e){if(t){if("string"==typeof t){var o=new Image;return o.src=t,this._bindImageEvents(o,e)}if(t.complete){var i=this.getColor(t,e);return i.error?Promise.reject(i.error):Promise.resolve(i)}return this._bindImageEvents(t,e)}return Promise.reject(Error("".concat(c,"call .getColorAsync() without resource.")))}},{key:"getColor",value:function(t,e){e=e||{};var o=this._getDefaultColor(e),i=o;if(!t)return this._outputError(e,"call .getColor(null) without resource."),this._prepareResult(o);var r=this._getOriginalSize(t),n=this._prepareSizeAndPosition(r,e);if(!(n.srcWidth&&n.srcHeight&&n.destWidth&&n.destHeight))return this._outputError(e,'incorrect sizes for resource "'.concat(t.src,'".')),this._prepareResult(o);if(!this._ctx&&(this._canvas=this._makeCanvas(),this._ctx=this._canvas.getContext&&this._canvas.getContext("2d"),!this._ctx))return this._outputError(e,"Canvas Context 2D is not supported in this browser."),this._prepareResult(o);this._canvas.width=n.destWidth,this._canvas.height=n.destHeight;try{this._ctx.clearRect(0,0,n.destWidth,n.destHeight),this._ctx.drawImage(t,n.srcLeft,n.srcTop,n.srcWidth,n.srcHeight,0,0,n.destWidth,n.destHeight);var s=this._ctx.getImageData(0,0,n.destWidth,n.destHeight).data;i=this.getColorFromArray4(s,e)}catch(o){this._outputError(e,"security error (CORS) for resource ".concat(t.src,".\nDetails: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image"),o)}return this._prepareResult(i)}},{key:"getColorFromArray4",value:function(t,e){e=e||{};var o=t.length,i=this._getDefaultColor(e);if(o<4)return i;var r,n=o-o%4,s=4*(e.step||1);switch(e.algorithm||"sqrt"){case"simple":r=l;break;case"sqrt":r=u;break;case"dominant":r=a;break;default:throw Error("".concat(c).concat(e.algorithm," is unknown algorithm."))}return r(t,n,{defaultColor:i,ignoredColor:e.ignoredColor,step:s})}},{key:"destroy",value:function(){delete this._canvas,delete this._ctx}},{key:"_getDefaultColor",value:function(t){return this._getOption(t,"defaultColor",[0,0,0,0])}},{key:"_getOption",value:function(t,e,o){return void 0===t[e]?o:t[e]}},{key:"_prepareSizeAndPosition",value:function(t,e){var o=this._getOption(e,"left",0),i=this._getOption(e,"top",0),r=this._getOption(e,"width",t.width),n=this._getOption(e,"height",t.height),s=r,a=n;if("precision"===e.mode)return{srcLeft:o,srcTop:i,srcWidth:r,srcHeight:n,destWidth:s,destHeight:a};var l;return r>n?(l=r/n,s=100,a=Math.round(s/l)):(l=n/r,a=100,s=Math.round(a/l)),(s>r||a>n||s<10||a<10)&&(s=r,a=n),{srcLeft:o,srcTop:i,srcWidth:r,srcHeight:n,destWidth:s,destHeight:a}}},{key:"_bindImageEvents",value:function(t,e){var o=this;return new Promise(function(i,r){var n=function(){l();var n=o.getColor(t,e);n.error?r(n.error):i(n)},s=function(){l(),r(Error("".concat(c,"Error loading image ").concat(t.src,".")))},a=function(){l(),r(Error("".concat(c,'Image "').concat(t.src,'" loading aborted.')))},l=function(){t.removeEventListener("load",n),t.removeEventListener("error",s),t.removeEventListener("abort",a)};t.addEventListener("load",n),t.addEventListener("error",s),t.addEventListener("abort",a)})}},{key:"_prepareResult",value:function(t){var e=t.slice(0,3),o=[].concat(e,t[3]/255),i=this._isDark(t);return{value:t,rgb:"rgb("+e.join(",")+")",rgba:"rgba("+o.join(",")+")",hex:this._arrayToHex(e),hexa:this._arrayToHex(t),isDark:i,isLight:!i}}},{key:"_getOriginalSize",value:function(t){return t instanceof HTMLImageElement?{width:t.naturalWidth,height:t.naturalHeight}:t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:{width:t.width,height:t.height}}},{key:"_toHex",value:function(t){var e=t.toString(16);return 1===e.length?"0"+e:e}},{key:"_arrayToHex",value:function(t){return"#"+t.map(this._toHex).join("")}},{key:"_isDark",value:function(t){return(299*t[0]+587*t[1]+114*t[2])/1e3<128}},{key:"_makeCanvas",value:function(){return"undefined"==typeof window?new OffscreenCanvas(1,1):document.createElement("canvas")}},{key:"_outputError",value:function(t,e,o){t.silent||(console.error("".concat(c).concat(e)),o&&console.error(o))}}]),t}();t.exports=h}]),[798])}]);